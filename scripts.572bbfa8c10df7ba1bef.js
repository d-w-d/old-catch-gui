var JS9Prefs={globalOpts:{helperType:"none",helperPort:2718,helperCGI:"./cgi-bin/js9/js9Helper.cgi",fits2png:!1,debug:0,loadProxy:!0,workDir:"./tmp",workDirQuota:100,dataPath:"$HOME/Desktop:$HOME/data",analysisPlugins:"./analysis-plugins",analysisWrappers:"./analysis-wrappers"},imageOpts:{colormap:"grey",scale:"linear"}};function sprintf(){var e=arguments,t=0,i=function(e,t,i,s){return i||(i=" "),t=e.length>=t?"":Array(1+t-e.length>>>0).join(i),s?e+t:t+e},s=function(e,t,s,a,n,r){var o=a-e.length;return 0<o&&(e=s||!n?i(e,a,r,s):e.slice(0,t.length)+i("",o,"0",!0)+e.slice(t.length)),e},a=function(e,t,a,n,r,o,l){return e>>>=0,e=(a=a&&e&&{2:"0b",8:"0",16:"0x"}[t]||"")+i(e.toString(t),o||0,"0",!1),s(e,a,n,r,l)};return e[t++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuidfegEG])/g,function(n,r,o,l,c,h,u){var d,p;if("%%"==n)return"%";var f=!1;p="";var g=c=!1;d=" ";for(var m=o.length,v=0;o&&v<m;v++)switch(o.charAt(v)){case" ":p=" ";break;case"+":p="+";break;case"-":f=!0;break;case"'":d=o.charAt(v+1);break;case"0":c=!0;break;case"#":g=!0}if(0>(l=l?"*"==l?+e[t++]:"*"==l.charAt(0)?+e[l.slice(1,-1)]:+l:0)&&(l=-l,f=!0),!isFinite(l))throw Error("sprintf: (minimum-)width must be finite");switch(h=h?"*"==h?+e[t++]:"*"==h.charAt(0)?+e[h.slice(1,-1)]:+h:-1<"fFeE".indexOf(u)?6:"d"==u?0:void 0,r=r?e[r.slice(0,-1)]:e[t++],u){case"s":return u=String(r),null!=h&&(u=u.slice(0,h)),s(u,"",f,l,c,d);case"c":return u=String.fromCharCode(+r),null!=h&&(u=u.slice(0,h)),s(u,"",f,l,c,void 0);case"b":return a(r,2,g,f,l,h,c);case"o":return a(r,8,g,f,l,h,c);case"x":return a(r,16,g,f,l,h,c);case"X":return a(r,16,g,f,l,h,c).toUpperCase();case"u":return a(r,10,g,f,l,h,c);case"i":case"d":return r=(n=0>(d=0|+r)?"-":p)+i(String(Math.abs(d)),h,"0",!1),s(r,n,f,l,c);case"e":case"E":case"f":case"F":case"g":case"G":return n=0>(d=+r)?"-":p,p=["toExponential","toFixed","toPrecision"]["efg".indexOf(u.toLowerCase())],u=["toString","toUpperCase"]["eEfFgG".indexOf(u)%2],r=n+Math.abs(d)[p](h),s(r,n,f,l,c)[u]();default:return n}})}"object"==typeof module&&(window.module=module,module=void 0),function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var i=[],s=e.document,a=Object.getPrototypeOf,n=i.slice,r=i.concat,o=i.push,l=i.indexOf,c={},h=c.toString,u=c.hasOwnProperty,d=u.toString,p=d.call(Object),f={};function g(e,t){var i=(t=t||s).createElement("script");i.text=e,t.head.appendChild(i).parentNode.removeChild(i)}var m="3.2.1",v=function(e,t){return new v.fn.init(e,t)},b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,y=/^-ms-/,x=/-([a-z])/g,w=function(e,t){return t.toUpperCase()};function S(e){var t=!!e&&"length"in e&&e.length,i=v.type(e);return"function"!==i&&!v.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}v.fn=v.prototype={jquery:m,constructor:v,length:0,toArray:function(){return n.call(this)},get:function(e){return null==e?n.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=v.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return v.each(this,e)},map:function(e){return this.pushStack(v.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(n.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:o,sort:i.sort,splice:i.splice},v.extend=v.fn.extend=function(){var e,t,i,s,a,n,r=arguments[0]||{},o=1,l=arguments.length,c=!1;for("boolean"==typeof r&&(c=r,r=arguments[o]||{},o++),"object"==typeof r||v.isFunction(r)||(r={}),o===l&&(r=this,o--);o<l;o++)if(null!=(e=arguments[o]))for(t in e)i=r[t],r!==(s=e[t])&&(c&&s&&(v.isPlainObject(s)||(a=Array.isArray(s)))?(a?(a=!1,n=i&&Array.isArray(i)?i:[]):n=i&&v.isPlainObject(i)?i:{},r[t]=v.extend(c,n,s)):void 0!==s&&(r[t]=s));return r},v.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===v.type(e)},isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=v.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==h.call(e)||(t=a(e))&&(i=u.call(t,"constructor")&&t.constructor,"function"!=typeof i||d.call(i)!==p))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[h.call(e)]||"object":typeof e},globalEval:function(e){g(e)},camelCase:function(e){return e.replace(y,"ms-").replace(x,w)},each:function(e,t){var i,s=0;if(S(e))for(i=e.length;s<i&&!1!==t.call(e[s],s,e[s]);s++);else for(s in e)if(!1===t.call(e[s],s,e[s]))break;return e},trim:function(e){return null==e?"":(e+"").replace(b,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(S(Object(e))?v.merge(i,"string"==typeof e?[e]:e):o.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:l.call(t,e,i)},merge:function(e,t){for(var i=+t.length,s=0,a=e.length;s<i;s++)e[a++]=t[s];return e.length=a,e},grep:function(e,t,i){for(var s=[],a=0,n=e.length,r=!i;a<n;a++)!t(e[a],a)!==r&&s.push(e[a]);return s},map:function(e,t,i){var s,a,n=0,o=[];if(S(e))for(s=e.length;n<s;n++)null!=(a=t(e[n],n,i))&&o.push(a);else for(n in e)null!=(a=t(e[n],n,i))&&o.push(a);return r.apply([],o)},guid:1,proxy:function(e,t){var i,s,a;if("string"==typeof t&&(i=e[t],t=e,e=i),v.isFunction(e))return s=n.call(arguments,2),(a=function(){return e.apply(t||this,s.concat(n.call(arguments)))}).guid=e.guid=e.guid||v.guid++,a},now:Date.now,support:f}),"function"==typeof Symbol&&(v.fn[Symbol.iterator]=i[Symbol.iterator]),v.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});var C=function(e){var t,i,s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y,x="sizzle"+1*new Date,w=e.document,S=0,C=0,A=oe(),_=oe(),k=oe(),T=function(e,t){return e===t&&(u=!0),0},I={}.hasOwnProperty,M=[],O=M.pop,P=M.push,D=M.push,J=M.slice,E=function(e,t){for(var i=0,s=e.length;i<s;i++)if(e[i]===t)return i;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",j="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",R="\\["+j+"*("+F+")(?:"+j+"*([*^$|!~]?=)"+j+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+F+"))|)"+j+"*\\]",N=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",z=new RegExp(j+"+","g"),B=new RegExp("^"+j+"+|((?:^|[^\\\\])(?:\\\\.)*)"+j+"+$","g"),H=new RegExp("^"+j+"*,"+j+"*"),W=new RegExp("^"+j+"*([>+~]|"+j+")"+j+"*"),q=new RegExp("="+j+"*([^\\]'\"]*?)"+j+"*\\]","g"),G=new RegExp(N),$=new RegExp("^"+F+"$"),U={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F+"|[*])"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+N),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+j+"*(even|odd|(([+-]|)(\\d*)n|)"+j+"*(?:([+-]|)"+j+"*(\\d+)|))"+j+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+j+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+j+"*((?:-\\d)?\\d*)"+j+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,V=/^[^{]+\{\s*\[native \w/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/[+~]/,Q=new RegExp("\\\\([\\da-f]{1,6}"+j+"?|("+j+")|.)","ig"),ee=function(e,t,i){var s="0x"+t-65536;return s!=s||i?t:s<0?String.fromCharCode(s+65536):String.fromCharCode(s>>10|55296,1023&s|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,se=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ae=function(){d()},ne=ye(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{D.apply(M=J.call(w.childNodes),w.childNodes)}catch(ie){D={apply:M.length?function(e,t){P.apply(e,J.call(t))}:function(e,t){for(var i=e.length,s=0;e[i++]=t[s++];);e.length=i-1}}}function re(e,t,s,a){var n,o,c,h,u,f,v,b=t&&t.ownerDocument,S=t?t.nodeType:9;if(s=s||[],"string"!=typeof e||!e||1!==S&&9!==S&&11!==S)return s;if(!a&&((t?t.ownerDocument||t:w)!==p&&d(t),t=t||p,g)){if(11!==S&&(u=K.exec(e)))if(n=u[1]){if(9===S){if(!(c=t.getElementById(n)))return s;if(c.id===n)return s.push(c),s}else if(b&&(c=b.getElementById(n))&&y(t,c)&&c.id===n)return s.push(c),s}else{if(u[2])return D.apply(s,t.getElementsByTagName(e)),s;if((n=u[3])&&i.getElementsByClassName&&t.getElementsByClassName)return D.apply(s,t.getElementsByClassName(n)),s}if(i.qsa&&!k[e+" "]&&(!m||!m.test(e))){if(1!==S)b=t,v=e;else if("object"!==t.nodeName.toLowerCase()){for((h=t.getAttribute("id"))?h=h.replace(te,se):t.setAttribute("id",h=x),o=(f=r(e)).length;o--;)f[o]="#"+h+" "+be(f[o]);v=f.join(","),b=Z.test(e)&&me(t.parentNode)||t}if(v)try{return D.apply(s,b.querySelectorAll(v)),s}catch(C){}finally{h===x&&t.removeAttribute("id")}}}return l(e.replace(B,"$1"),t,s,a)}function oe(){var e=[];return function t(i,a){return e.push(i+" ")>s.cacheLength&&delete t[e.shift()],t[i+" "]=a}}function le(e){return e[x]=!0,e}function ce(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){for(var i=e.split("|"),a=i.length;a--;)s.attrHandle[i[a]]=t}function ue(e,t){var i=t&&e,s=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(s)return s;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function de(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function fe(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ne(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ge(e){return le(function(t){return t=+t,le(function(i,s){for(var a,n=e([],i.length,t),r=n.length;r--;)i[a=n[r]]&&(i[a]=!(s[a]=i[a]))})})}function me(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in i=re.support={},n=re.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},d=re.setDocument=function(e){var t,a,r=e?e.ownerDocument||e:w;return r!==p&&9===r.nodeType&&r.documentElement?(f=(p=r).documentElement,g=!n(p),w!==p&&(a=p.defaultView)&&a.top!==a&&(a.addEventListener?a.addEventListener("unload",ae,!1):a.attachEvent&&a.attachEvent("onunload",ae)),i.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),i.getElementsByTagName=ce(function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length}),i.getElementsByClassName=V.test(p.getElementsByClassName),i.getById=ce(function(e){return f.appendChild(e).id=x,!p.getElementsByName||!p.getElementsByName(x).length}),i.getById?(s.filter.ID=function(e){var t=e.replace(Q,ee);return function(e){return e.getAttribute("id")===t}},s.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i=t.getElementById(e);return i?[i]:[]}}):(s.filter.ID=function(e){var t=e.replace(Q,ee);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},s.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i,s,a,n=t.getElementById(e);if(n){if((i=n.getAttributeNode("id"))&&i.value===e)return[n];for(a=t.getElementsByName(e),s=0;n=a[s++];)if((i=n.getAttributeNode("id"))&&i.value===e)return[n]}return[]}}),s.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,s=[],a=0,n=t.getElementsByTagName(e);if("*"===e){for(;i=n[a++];)1===i.nodeType&&s.push(i);return s}return n},s.find.CLASS=i.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],m=[],(i.qsa=V.test(p.querySelectorAll))&&(ce(function(e){f.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+j+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+j+"*(?:value|"+L+")"),e.querySelectorAll("[id~="+x+"-]").length||m.push("~="),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||m.push(".#.+[+~]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+j+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(i.matchesSelector=V.test(b=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ce(function(e){i.disconnectedMatch=b.call(e,"*"),b.call(e,"[s!='']:x"),v.push("!=",N)}),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=V.test(f.compareDocumentPosition),y=t||V.test(f.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,s=t&&t.parentNode;return e===s||!(!s||1!==s.nodeType||!(i.contains?i.contains(s):e.compareDocumentPosition&&16&e.compareDocumentPosition(s)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},T=t?function(e,t){if(e===t)return u=!0,0;var s=!e.compareDocumentPosition-!t.compareDocumentPosition;return s||(1&(s=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===s?e===p||e.ownerDocument===w&&y(w,e)?-1:t===p||t.ownerDocument===w&&y(w,t)?1:h?E(h,e)-E(h,t):0:4&s?-1:1)}:function(e,t){if(e===t)return u=!0,0;var i,s=0,a=e.parentNode,n=t.parentNode,r=[e],o=[t];if(!a||!n)return e===p?-1:t===p?1:a?-1:n?1:h?E(h,e)-E(h,t):0;if(a===n)return ue(e,t);for(i=e;i=i.parentNode;)r.unshift(i);for(i=t;i=i.parentNode;)o.unshift(i);for(;r[s]===o[s];)s++;return s?ue(r[s],o[s]):r[s]===w?-1:o[s]===w?1:0},p):p},re.matches=function(e,t){return re(e,null,null,t)},re.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&d(e),t=t.replace(q,"='$1']"),i.matchesSelector&&g&&!k[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var s=b.call(e,t);if(s||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return s}catch(a){}return re(t,p,null,[e]).length>0},re.contains=function(e,t){return(e.ownerDocument||e)!==p&&d(e),y(e,t)},re.attr=function(e,t){(e.ownerDocument||e)!==p&&d(e);var a=s.attrHandle[t.toLowerCase()],n=a&&I.call(s.attrHandle,t.toLowerCase())?a(e,t,!g):void 0;return void 0!==n?n:i.attributes||!g?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},re.escape=function(e){return(e+"").replace(te,se)},re.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},re.uniqueSort=function(e){var t,s=[],a=0,n=0;if(u=!i.detectDuplicates,h=!i.sortStable&&e.slice(0),e.sort(T),u){for(;t=e[n++];)t===e[n]&&(a=s.push(n));for(;a--;)e.splice(s[a],1)}return h=null,e},a=re.getText=function(e){var t,i="",s=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=a(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[s++];)i+=a(t);return i},(s=re.selectors={cacheLength:50,createPseudo:le,match:U,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Q,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(Q,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||re.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&re.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return U.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&G.test(i)&&(t=r(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Q,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=A[e+" "];return t||(t=new RegExp("(^|"+j+")"+e+"("+j+"|$)"))&&A(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,i){return function(s){var a=re.attr(s,e);return null==a?"!="===t:!t||(a+="","="===t?a===i:"!="===t?a!==i:"^="===t?i&&0===a.indexOf(i):"*="===t?i&&a.indexOf(i)>-1:"$="===t?i&&a.slice(-i.length)===i:"~="===t?(" "+a.replace(z," ")+" ").indexOf(i)>-1:"|="===t&&(a===i||a.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,s,a){var n="nth"!==e.slice(0,3),r="last"!==e.slice(-4),o="of-type"===t;return 1===s&&0===a?function(e){return!!e.parentNode}:function(t,i,l){var c,h,u,d,p,f,g=n!==r?"nextSibling":"previousSibling",m=t.parentNode,v=o&&t.nodeName.toLowerCase(),b=!l&&!o,y=!1;if(m){if(n){for(;g;){for(d=t;d=d[g];)if(o?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[r?m.firstChild:m.lastChild],r&&b){for(y=(p=(c=(h=(u=(d=m)[x]||(d[x]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]||[])[0]===S&&c[1])&&c[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(y=p=0)||f.pop();)if(1===d.nodeType&&++y&&d===t){h[e]=[S,p,y];break}}else if(b&&(y=p=(c=(h=(u=(d=t)[x]||(d[x]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]||[])[0]===S&&c[1]),!1===y)for(;(d=++p&&d&&d[g]||(y=p=0)||f.pop())&&((o?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++y||(b&&((h=(u=d[x]||(d[x]={}))[d.uniqueID]||(u[d.uniqueID]={}))[e]=[S,y]),d!==t)););return(y-=a)===s||y%s==0&&y/s>=0}}},PSEUDO:function(e,t){var i,a=s.pseudos[e]||s.setFilters[e.toLowerCase()]||re.error("unsupported pseudo: "+e);return a[x]?a(t):a.length>1?(i=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,i){for(var s,n=a(e,t),r=n.length;r--;)e[s=E(e,n[r])]=!(i[s]=n[r])}):function(e){return a(e,0,i)}):a}},pseudos:{not:le(function(e){var t=[],i=[],s=o(e.replace(B,"$1"));return s[x]?le(function(e,t,i,a){for(var n,r=s(e,null,a,[]),o=e.length;o--;)(n=r[o])&&(e[o]=!(t[o]=n))}):function(e,a,n){return t[0]=e,s(t,null,n,i),t[0]=null,!i.pop()}}),has:le(function(e){return function(t){return re(e,t).length>0}}),contains:le(function(e){return e=e.replace(Q,ee),function(t){return(t.textContent||t.innerText||a(t)).indexOf(e)>-1}}),lang:le(function(e){return $.test(e||"")||re.error("unsupported lang: "+e),e=e.replace(Q,ee).toLowerCase(),function(t){var i;do{if(i=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:fe(!1),disabled:fe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return X.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ge(function(){return[0]}),last:ge(function(e,t){return[t-1]}),eq:ge(function(e,t,i){return[i<0?i+t:i]}),even:ge(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:ge(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:ge(function(e,t,i){for(var s=i<0?i+t:i;--s>=0;)e.push(s);return e}),gt:ge(function(e,t,i){for(var s=i<0?i+t:i;++s<t;)e.push(s);return e})}}).pseudos.nth=s.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[t]=de(t);for(t in{submit:!0,reset:!0})s.pseudos[t]=pe(t);function ve(){}function be(e){for(var t=0,i=e.length,s="";t<i;t++)s+=e[t].value;return s}function ye(e,t,i){var s=t.dir,a=t.next,n=a||s,r=i&&"parentNode"===n,o=C++;return t.first?function(t,i,a){for(;t=t[s];)if(1===t.nodeType||r)return e(t,i,a);return!1}:function(t,i,l){var c,h,u,d=[S,o];if(l){for(;t=t[s];)if((1===t.nodeType||r)&&e(t,i,l))return!0}else for(;t=t[s];)if(1===t.nodeType||r)if(h=(u=t[x]||(t[x]={}))[t.uniqueID]||(u[t.uniqueID]={}),a&&a===t.nodeName.toLowerCase())t=t[s]||t;else{if((c=h[n])&&c[0]===S&&c[1]===o)return d[2]=c[2];if(h[n]=d,d[2]=e(t,i,l))return!0}return!1}}function xe(e){return e.length>1?function(t,i,s){for(var a=e.length;a--;)if(!e[a](t,i,s))return!1;return!0}:e[0]}function we(e,t,i,s,a){for(var n,r=[],o=0,l=e.length,c=null!=t;o<l;o++)(n=e[o])&&(i&&!i(n,s,a)||(r.push(n),c&&t.push(o)));return r}function Se(e,t,i,s,a,n){return s&&!s[x]&&(s=Se(s)),a&&!a[x]&&(a=Se(a,n)),le(function(n,r,o,l){var c,h,u,d=[],p=[],f=r.length,g=n||function(e,t,i){for(var s=0,a=t.length;s<a;s++)re(e,t[s],i);return i}(t||"*",o.nodeType?[o]:o,[]),m=!e||!n&&t?g:we(g,d,e,o,l),v=i?a||(n?e:f||s)?[]:r:m;if(i&&i(m,v,o,l),s)for(c=we(v,p),s(c,[],o,l),h=c.length;h--;)(u=c[h])&&(v[p[h]]=!(m[p[h]]=u));if(n){if(a||e){if(a){for(c=[],h=v.length;h--;)(u=v[h])&&c.push(m[h]=u);a(null,v=[],c,l)}for(h=v.length;h--;)(u=v[h])&&(c=a?E(n,u):d[h])>-1&&(n[c]=!(r[c]=u))}}else v=we(v===r?v.splice(f,v.length):v),a?a(null,r,v,l):D.apply(r,v)})}function Ce(e){for(var t,i,a,n=e.length,r=s.relative[e[0].type],o=r||s.relative[" "],l=r?1:0,h=ye(function(e){return e===t},o,!0),u=ye(function(e){return E(t,e)>-1},o,!0),d=[function(e,i,s){var a=!r&&(s||i!==c)||((t=i).nodeType?h(e,i,s):u(e,i,s));return t=null,a}];l<n;l++)if(i=s.relative[e[l].type])d=[ye(xe(d),i)];else{if((i=s.filter[e[l].type].apply(null,e[l].matches))[x]){for(a=++l;a<n&&!s.relative[e[a].type];a++);return Se(l>1&&xe(d),l>1&&be(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(B,"$1"),i,l<a&&Ce(e.slice(l,a)),a<n&&Ce(e=e.slice(a)),a<n&&be(e))}d.push(i)}return xe(d)}function Ae(e,t){var i=t.length>0,a=e.length>0,n=function(n,r,o,l,h){var u,f,m,v=0,b="0",y=n&&[],x=[],w=c,C=n||a&&s.find.TAG("*",h),A=S+=null==w?1:Math.random()||.1,_=C.length;for(h&&(c=r===p||r||h);b!==_&&null!=(u=C[b]);b++){if(a&&u){for(f=0,r||u.ownerDocument===p||(d(u),o=!g);m=e[f++];)if(m(u,r||p,o)){l.push(u);break}h&&(S=A)}i&&((u=!m&&u)&&v--,n&&y.push(u))}if(v+=b,i&&b!==v){for(f=0;m=t[f++];)m(y,x,r,o);if(n){if(v>0)for(;b--;)y[b]||x[b]||(x[b]=O.call(l));x=we(x)}D.apply(l,x),h&&!n&&x.length>0&&v+t.length>1&&re.uniqueSort(l)}return h&&(S=A,c=w),y};return i?le(n):n}return ve.prototype=s.filters=s.pseudos,s.setFilters=new ve,r=re.tokenize=function(e,t){var i,a,n,r,o,l,c,h=_[e+" "];if(h)return t?0:h.slice(0);for(o=e,l=[],c=s.preFilter;o;){for(r in i&&!(a=H.exec(o))||(a&&(o=o.slice(a[0].length)||o),l.push(n=[])),i=!1,(a=W.exec(o))&&(i=a.shift(),n.push({value:i,type:a[0].replace(B," ")}),o=o.slice(i.length)),s.filter)!(a=U[r].exec(o))||c[r]&&!(a=c[r](a))||(i=a.shift(),n.push({value:i,type:r,matches:a}),o=o.slice(i.length));if(!i)break}return t?o.length:o?re.error(e):_(e,l).slice(0)},o=re.compile=function(e,t){var i,s=[],a=[],n=k[e+" "];if(!n){for(t||(t=r(e)),i=t.length;i--;)(n=Ce(t[i]))[x]?s.push(n):a.push(n);(n=k(e,Ae(a,s))).selector=e}return n},l=re.select=function(e,t,i,a){var n,l,c,h,u,d="function"==typeof e&&e,p=!a&&r(e=d.selector||e);if(i=i||[],1===p.length){if((l=p[0]=p[0].slice(0)).length>2&&"ID"===(c=l[0]).type&&9===t.nodeType&&g&&s.relative[l[1].type]){if(!(t=(s.find.ID(c.matches[0].replace(Q,ee),t)||[])[0]))return i;d&&(t=t.parentNode),e=e.slice(l.shift().value.length)}for(n=U.needsContext.test(e)?0:l.length;n--&&!s.relative[h=(c=l[n]).type];)if((u=s.find[h])&&(a=u(c.matches[0].replace(Q,ee),Z.test(l[0].type)&&me(t.parentNode)||t))){if(l.splice(n,1),!(e=a.length&&be(l)))return D.apply(i,a),i;break}}return(d||o(e,p))(a,t,!g,i,!t||Z.test(e)&&me(t.parentNode)||t),i},i.sortStable=x.split("").sort(T).join("")===x,i.detectDuplicates=!!u,d(),i.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||he("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),i.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||he("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||he(L,function(e,t,i){var s;if(!i)return!0===e[t]?t.toLowerCase():(s=e.getAttributeNode(t))&&s.specified?s.value:null}),re}(e);v.find=C,v.expr=C.selectors,v.expr[":"]=v.expr.pseudos,v.uniqueSort=v.unique=C.uniqueSort,v.text=C.getText,v.isXMLDoc=C.isXML,v.contains=C.contains,v.escapeSelector=C.escape;var A=function(e,t,i){for(var s=[],a=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(a&&v(e).is(i))break;s.push(e)}return s},_=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},k=v.expr.match.needsContext;function T(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var I=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,M=/^.[^:#\[\.,]*$/;function O(e,t,i){return v.isFunction(t)?v.grep(e,function(e,s){return!!t.call(e,s,e)!==i}):t.nodeType?v.grep(e,function(e){return e===t!==i}):"string"!=typeof t?v.grep(e,function(e){return l.call(t,e)>-1!==i}):M.test(t)?v.filter(t,e,i):(t=v.filter(t,e),v.grep(e,function(e){return l.call(t,e)>-1!==i&&1===e.nodeType}))}v.filter=function(e,t,i){var s=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===s.nodeType?v.find.matchesSelector(s,e)?[s]:[]:v.find.matches(e,v.grep(t,function(e){return 1===e.nodeType}))},v.fn.extend({find:function(e){var t,i,s=this.length,a=this;if("string"!=typeof e)return this.pushStack(v(e).filter(function(){for(t=0;t<s;t++)if(v.contains(a[t],this))return!0}));for(i=this.pushStack([]),t=0;t<s;t++)v.find(e,a[t],i);return s>1?v.uniqueSort(i):i},filter:function(e){return this.pushStack(O(this,e||[],!1))},not:function(e){return this.pushStack(O(this,e||[],!0))},is:function(e){return!!O(this,"string"==typeof e&&k.test(e)?v(e):e||[],!1).length}});var P,D=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(v.fn.init=function(e,t,i){var a,n;if(!e)return this;if(i=i||P,"string"==typeof e){if(!(a="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:D.exec(e))||!a[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(a[1]){if(v.merge(this,v.parseHTML(a[1],(t=t instanceof v?t[0]:t)&&t.nodeType?t.ownerDocument||t:s,!0)),I.test(a[1])&&v.isPlainObject(t))for(a in t)v.isFunction(this[a])?this[a](t[a]):this.attr(a,t[a]);return this}return(n=s.getElementById(a[2]))&&(this[0]=n,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v.isFunction(e)?void 0!==i.ready?i.ready(e):e(v):v.makeArray(e,this)}).prototype=v.fn,P=v(s);var J=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};function L(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}v.fn.extend({has:function(e){var t=v(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(v.contains(this,t[e]))return!0})},closest:function(e,t){var i,s=0,a=this.length,n=[],r="string"!=typeof e&&v(e);if(!k.test(e))for(;s<a;s++)for(i=this[s];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(r?r.index(i)>-1:1===i.nodeType&&v.find.matchesSelector(i,e))){n.push(i);break}return this.pushStack(n.length>1?v.uniqueSort(n):n)},index:function(e){return e?"string"==typeof e?l.call(v(e),this[0]):l.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(v.uniqueSort(v.merge(this.get(),v(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),v.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return A(e,"parentNode")},parentsUntil:function(e,t,i){return A(e,"parentNode",i)},next:function(e){return L(e,"nextSibling")},prev:function(e){return L(e,"previousSibling")},nextAll:function(e){return A(e,"nextSibling")},prevAll:function(e){return A(e,"previousSibling")},nextUntil:function(e,t,i){return A(e,"nextSibling",i)},prevUntil:function(e,t,i){return A(e,"previousSibling",i)},siblings:function(e){return _((e.parentNode||{}).firstChild,e)},children:function(e){return _(e.firstChild)},contents:function(e){return T(e,"iframe")?e.contentDocument:(T(e,"template")&&(e=e.content||e),v.merge([],e.childNodes))}},function(e,t){v.fn[e]=function(i,s){var a=v.map(this,t,i);return"Until"!==e.slice(-5)&&(s=i),s&&"string"==typeof s&&(a=v.filter(s,a)),this.length>1&&(E[e]||v.uniqueSort(a),J.test(e)&&a.reverse()),this.pushStack(a)}});var j=/[^\x20\t\r\n\f]+/g;function F(e){return e}function R(e){throw e}function N(e,t,i,s){var a;try{e&&v.isFunction(a=e.promise)?a.call(e).done(t).fail(i):e&&v.isFunction(a=e.then)?a.call(e,t,i):t.apply(void 0,[e].slice(s))}catch(e){i.apply(void 0,[e])}}v.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return v.each(e.match(j)||[],function(e,i){t[i]=!0}),t}(e):v.extend({},e);var t,i,s,a,n=[],r=[],o=-1,l=function(){for(a=a||e.once,s=t=!0;r.length;o=-1)for(i=r.shift();++o<n.length;)!1===n[o].apply(i[0],i[1])&&e.stopOnFalse&&(o=n.length,i=!1);e.memory||(i=!1),t=!1,a&&(n=i?[]:"")},c={add:function(){return n&&(i&&!t&&(o=n.length-1,r.push(i)),function t(i){v.each(i,function(i,s){v.isFunction(s)?e.unique&&c.has(s)||n.push(s):s&&s.length&&"string"!==v.type(s)&&t(s)})}(arguments),i&&!t&&l()),this},remove:function(){return v.each(arguments,function(e,t){for(var i;(i=v.inArray(t,n,i))>-1;)n.splice(i,1),i<=o&&o--}),this},has:function(e){return e?v.inArray(e,n)>-1:n.length>0},empty:function(){return n&&(n=[]),this},disable:function(){return a=r=[],n=i="",this},disabled:function(){return!n},lock:function(){return a=r=[],i||t||(n=i=""),this},locked:function(){return!!a},fireWith:function(e,i){return a||(i=[e,(i=i||[]).slice?i.slice():i],r.push(i),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!s}};return c},v.extend({Deferred:function(t){var i=[["notify","progress",v.Callbacks("memory"),v.Callbacks("memory"),2],["resolve","done",v.Callbacks("once memory"),v.Callbacks("once memory"),0,"resolved"],["reject","fail",v.Callbacks("once memory"),v.Callbacks("once memory"),1,"rejected"]],s="pending",a={state:function(){return s},always:function(){return n.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var e=arguments;return v.Deferred(function(t){v.each(i,function(i,s){var a=v.isFunction(e[s[4]])&&e[s[4]];n[s[1]](function(){var e=a&&a.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[s[0]+"With"](this,a?[e]:arguments)})}),e=null}).promise()},then:function(t,s,a){var n=0;function r(t,i,s,a){return function(){var o=this,l=arguments,c=function(){var e,c;if(!(t<n)){if((e=s.apply(o,l))===i.promise())throw new TypeError("Thenable self-resolution");v.isFunction(c=e&&("object"==typeof e||"function"==typeof e)&&e.then)?a?c.call(e,r(n,i,F,a),r(n,i,R,a)):c.call(e,r(++n,i,F,a),r(n,i,R,a),r(n,i,F,i.notifyWith)):(s!==F&&(o=void 0,l=[e]),(a||i.resolveWith)(o,l))}},h=a?c:function(){try{c()}catch(e){v.Deferred.exceptionHook&&v.Deferred.exceptionHook(e,h.stackTrace),t+1>=n&&(s!==R&&(o=void 0,l=[e]),i.rejectWith(o,l))}};t?h():(v.Deferred.getStackHook&&(h.stackTrace=v.Deferred.getStackHook()),e.setTimeout(h))}}return v.Deferred(function(e){i[0][3].add(r(0,e,v.isFunction(a)?a:F,e.notifyWith)),i[1][3].add(r(0,e,v.isFunction(t)?t:F)),i[2][3].add(r(0,e,v.isFunction(s)?s:R))}).promise()},promise:function(e){return null!=e?v.extend(e,a):a}},n={};return v.each(i,function(e,t){var r=t[2],o=t[5];a[t[1]]=r.add,o&&r.add(function(){s=o},i[3-e][2].disable,i[0][2].lock),r.add(t[3].fire),n[t[0]]=function(){return n[t[0]+"With"](this===n?void 0:this,arguments),this},n[t[0]+"With"]=r.fireWith}),a.promise(n),t&&t.call(n,n),n},when:function(e){var t=arguments.length,i=t,s=Array(i),a=n.call(arguments),r=v.Deferred(),o=function(e){return function(i){s[e]=this,a[e]=arguments.length>1?n.call(arguments):i,--t||r.resolveWith(s,a)}};if(t<=1&&(N(e,r.done(o(i)).resolve,r.reject,!t),"pending"===r.state()||v.isFunction(a[i]&&a[i].then)))return r.then();for(;i--;)N(a[i],o(i),r.reject);return r.promise()}});var z=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;v.Deferred.exceptionHook=function(t,i){e.console&&e.console.warn&&t&&z.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,i)},v.readyException=function(t){e.setTimeout(function(){throw t})};var B=v.Deferred();function H(){s.removeEventListener("DOMContentLoaded",H),e.removeEventListener("load",H),v.ready()}v.fn.ready=function(e){return B.then(e).catch(function(e){v.readyException(e)}),this},v.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--v.readyWait:v.isReady)||(v.isReady=!0,!0!==e&&--v.readyWait>0||B.resolveWith(s,[v]))}}),v.ready.then=B.then,"complete"===s.readyState||"loading"!==s.readyState&&!s.documentElement.doScroll?e.setTimeout(v.ready):(s.addEventListener("DOMContentLoaded",H),e.addEventListener("load",H));var W=function(e,t,i,s,a,n,r){var o=0,l=e.length,c=null==i;if("object"===v.type(i))for(o in a=!0,i)W(e,t,o,i[o],!0,n,r);else if(void 0!==s&&(a=!0,v.isFunction(s)||(r=!0),c&&(r?(t.call(e,s),t=null):(c=t,t=function(e,t,i){return c.call(v(e),i)})),t))for(;o<l;o++)t(e[o],i,r?s:s.call(e[o],o,t(e[o],i)));return a?e:c?t.call(e):l?t(e[0],i):n},q=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=v.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},q(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var s,a=this.cache(e);if("string"==typeof t)a[v.camelCase(t)]=i;else for(s in t)a[v.camelCase(s)]=t[s];return a},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][v.camelCase(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,s=e[this.expando];if(void 0!==s){if(void 0!==t){i=(t=Array.isArray(t)?t.map(v.camelCase):(t=v.camelCase(t))in s?[t]:t.match(j)||[]).length;for(;i--;)delete s[t[i]]}(void 0===t||v.isEmptyObject(s))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!v.isEmptyObject(t)}};var $=new G,U=new G,X=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Y=/[A-Z]/g;function V(e,t,i){var s;if(void 0===i&&1===e.nodeType)if(s="data-"+t.replace(Y,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(s))){try{i=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:X.test(e)?JSON.parse(e):e)}(i)}catch(a){}U.set(e,t,i)}else i=void 0;return i}v.extend({hasData:function(e){return U.hasData(e)||$.hasData(e)},data:function(e,t,i){return U.access(e,t,i)},removeData:function(e,t){U.remove(e,t)},_data:function(e,t,i){return $.access(e,t,i)},_removeData:function(e,t){$.remove(e,t)}}),v.fn.extend({data:function(e,t){var i,s,a,n=this[0],r=n&&n.attributes;if(void 0===e){if(this.length&&(a=U.get(n),1===n.nodeType&&!$.get(n,"hasDataAttrs"))){for(i=r.length;i--;)r[i]&&0===(s=r[i].name).indexOf("data-")&&(s=v.camelCase(s.slice(5)),V(n,s,a[s]));$.set(n,"hasDataAttrs",!0)}return a}return"object"==typeof e?this.each(function(){U.set(this,e)}):W(this,function(t){var i;if(n&&void 0===t){if(void 0!==(i=U.get(n,e)))return i;if(void 0!==(i=V(n,e)))return i}else this.each(function(){U.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){U.remove(this,e)})}}),v.extend({queue:function(e,t,i){var s;if(e)return s=$.get(e,t=(t||"fx")+"queue"),i&&(!s||Array.isArray(i)?s=$.access(e,t,v.makeArray(i)):s.push(i)),s||[]},dequeue:function(e,t){var i=v.queue(e,t=t||"fx"),s=i.length,a=i.shift(),n=v._queueHooks(e,t);"inprogress"===a&&(a=i.shift(),s--),a&&("fx"===t&&i.unshift("inprogress"),delete n.stop,a.call(e,function(){v.dequeue(e,t)},n)),!s&&n&&n.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return $.get(e,i)||$.access(e,i,{empty:v.Callbacks("once memory").add(function(){$.remove(e,[t+"queue",i])})})}}),v.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?v.queue(this[0],e):void 0===t?this:this.each(function(){var i=v.queue(this,e,t);v._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,s=1,a=v.Deferred(),n=this,r=this.length,o=function(){--s||a.resolveWith(n,[n])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";r--;)(i=$.get(n[r],e+"queueHooks"))&&i.empty&&(s++,i.empty.add(o));return o(),a.promise(t)}});var K=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Z=new RegExp("^(?:([+-])=|)("+K+")([a-z%]*)$","i"),Q=["Top","Right","Bottom","Left"],ee=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&v.contains(e.ownerDocument,e)&&"none"===v.css(e,"display")},te=function(e,t,i,s){var a,n,r={};for(n in t)r[n]=e.style[n],e.style[n]=t[n];for(n in a=i.apply(e,s||[]),t)e.style[n]=r[n];return a};function ie(e,t,i,s){var a,n=1,r=20,o=s?function(){return s.cur()}:function(){return v.css(e,t,"")},l=o(),c=i&&i[3]||(v.cssNumber[t]?"":"px"),h=(v.cssNumber[t]||"px"!==c&&+l)&&Z.exec(v.css(e,t));if(h&&h[3]!==c){c=c||h[3],i=i||[],h=+l||1;do{v.style(e,t,(h/=n=n||".5")+c)}while(n!==(n=o()/l)&&1!==n&&--r)}return i&&(h=+h||+l||0,a=i[1]?h+(i[1]+1)*i[2]:+i[2],s&&(s.unit=c,s.start=h,s.end=a)),a}var se={};function ae(e){var t,i=e.ownerDocument,s=e.nodeName,a=se[s];return a||(t=i.body.appendChild(i.createElement(s)),a=v.css(t,"display"),t.parentNode.removeChild(t),"none"===a&&(a="block"),se[s]=a,a)}function ne(e,t){for(var i,s,a=[],n=0,r=e.length;n<r;n++)(s=e[n]).style&&(i=s.style.display,t?("none"===i&&(a[n]=$.get(s,"display")||null,a[n]||(s.style.display="")),""===s.style.display&&ee(s)&&(a[n]=ae(s))):"none"!==i&&(a[n]="none",$.set(s,"display",i)));for(n=0;n<r;n++)null!=a[n]&&(e[n].style.display=a[n]);return e}v.fn.extend({show:function(){return ne(this,!0)},hide:function(){return ne(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?v(this).show():v(this).hide()})}});var re=/^(?:checkbox|radio)$/i,oe=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,le=/^$|\/(?:java|ecma)script/i,ce={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function he(e,t){var i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&T(e,t)?v.merge([e],i):i}function ue(e,t){for(var i=0,s=e.length;i<s;i++)$.set(e[i],"globalEval",!t||$.get(t[i],"globalEval"))}ce.optgroup=ce.option,ce.tbody=ce.tfoot=ce.colgroup=ce.caption=ce.thead,ce.th=ce.td;var de=/<|&#?\w+;/;function pe(e,t,i,s,a){for(var n,r,o,l,c,h,u=t.createDocumentFragment(),d=[],p=0,f=e.length;p<f;p++)if((n=e[p])||0===n)if("object"===v.type(n))v.merge(d,n.nodeType?[n]:n);else if(de.test(n)){for(r=r||u.appendChild(t.createElement("div")),o=(oe.exec(n)||["",""])[1].toLowerCase(),r.innerHTML=(l=ce[o]||ce._default)[1]+v.htmlPrefilter(n)+l[2],h=l[0];h--;)r=r.lastChild;v.merge(d,r.childNodes),(r=u.firstChild).textContent=""}else d.push(t.createTextNode(n));for(u.textContent="",p=0;n=d[p++];)if(s&&v.inArray(n,s)>-1)a&&a.push(n);else if(c=v.contains(n.ownerDocument,n),r=he(u.appendChild(n),"script"),c&&ue(r),i)for(h=0;n=r[h++];)le.test(n.type||"")&&i.push(n);return u}!function(){var e=s.createDocumentFragment().appendChild(s.createElement("div")),t=s.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),f.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",f.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var fe=s.documentElement,ge=/^key/,me=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ve=/^([^.]*)(?:\.(.+)|)/;function be(){return!0}function ye(){return!1}function xe(){try{return s.activeElement}catch(e){}}function we(e,t,i,s,a,n){var r,o;if("object"==typeof t){for(o in"string"!=typeof i&&(s=s||i,i=void 0),t)we(e,o,i,s,t[o],n);return e}if(null==s&&null==a?(a=i,s=i=void 0):null==a&&("string"==typeof i?(a=s,s=void 0):(a=s,s=i,i=void 0)),!1===a)a=ye;else if(!a)return e;return 1===n&&(r=a,(a=function(e){return v().off(e),r.apply(this,arguments)}).guid=r.guid||(r.guid=v.guid++)),e.each(function(){v.event.add(this,t,a,s,i)})}v.event={global:{},add:function(e,t,i,s,a){var n,r,o,l,c,h,u,d,p,f,g,m=$.get(e);if(m)for(i.handler&&(i=(n=i).handler,a=n.selector),a&&v.find.matchesSelector(fe,a),i.guid||(i.guid=v.guid++),(l=m.events)||(l=m.events={}),(r=m.handle)||(r=m.handle=function(t){return void 0!==v&&v.event.triggered!==t.type?v.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(j)||[""]).length;c--;)p=g=(o=ve.exec(t[c])||[])[1],f=(o[2]||"").split(".").sort(),p&&(u=v.event.special[p]||{},u=v.event.special[p=(a?u.delegateType:u.bindType)||p]||{},h=v.extend({type:p,origType:g,data:s,handler:i,guid:i.guid,selector:a,needsContext:a&&v.expr.match.needsContext.test(a),namespace:f.join(".")},n),(d=l[p])||((d=l[p]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,s,f,r)||e.addEventListener&&e.addEventListener(p,r)),u.add&&(u.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),a?d.splice(d.delegateCount++,0,h):d.push(h),v.event.global[p]=!0)},remove:function(e,t,i,s,a){var n,r,o,l,c,h,u,d,p,f,g,m=$.hasData(e)&&$.get(e);if(m&&(l=m.events)){for(c=(t=(t||"").match(j)||[""]).length;c--;)if(p=g=(o=ve.exec(t[c])||[])[1],f=(o[2]||"").split(".").sort(),p){for(u=v.event.special[p]||{},d=l[p=(s?u.delegateType:u.bindType)||p]||[],o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),r=n=d.length;n--;)h=d[n],!a&&g!==h.origType||i&&i.guid!==h.guid||o&&!o.test(h.namespace)||s&&s!==h.selector&&("**"!==s||!h.selector)||(d.splice(n,1),h.selector&&d.delegateCount--,u.remove&&u.remove.call(e,h));r&&!d.length&&(u.teardown&&!1!==u.teardown.call(e,f,m.handle)||v.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)v.event.remove(e,p+t[c],i,s,!0);v.isEmptyObject(l)&&$.remove(e,"handle events")}},dispatch:function(e){var t,i,s,a,n,r,o=v.event.fix(e),l=new Array(arguments.length),c=($.get(this,"events")||{})[o.type]||[],h=v.event.special[o.type]||{};for(l[0]=o,t=1;t<arguments.length;t++)l[t]=arguments[t];if(o.delegateTarget=this,!h.preDispatch||!1!==h.preDispatch.call(this,o)){for(r=v.event.handlers.call(this,o,c),t=0;(a=r[t++])&&!o.isPropagationStopped();)for(o.currentTarget=a.elem,i=0;(n=a.handlers[i++])&&!o.isImmediatePropagationStopped();)o.rnamespace&&!o.rnamespace.test(n.namespace)||(o.handleObj=n,o.data=n.data,void 0!==(s=((v.event.special[n.origType]||{}).handle||n.handler).apply(a.elem,l))&&!1===(o.result=s)&&(o.preventDefault(),o.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,o),o.result}},handlers:function(e,t){var i,s,a,n,r,o=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(n=[],r={},i=0;i<l;i++)void 0===r[a=(s=t[i]).selector+" "]&&(r[a]=s.needsContext?v(a,this).index(c)>-1:v.find(a,this,null,[c]).length),r[a]&&n.push(s);n.length&&o.push({elem:c,handlers:n})}return c=this,l<t.length&&o.push({elem:c,handlers:t.slice(l)}),o},addProp:function(e,t){Object.defineProperty(v.Event.prototype,e,{enumerable:!0,configurable:!0,get:v.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[v.expando]?e:new v.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==xe()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===xe()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&T(this,"input"))return this.click(),!1},_default:function(e){return T(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},v.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},v.Event=function(e,t){return this instanceof v.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?be:ye,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),void(this[v.expando]=!0)):new v.Event(e,t)},v.Event.prototype={constructor:v.Event,isDefaultPrevented:ye,isPropagationStopped:ye,isImmediatePropagationStopped:ye,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=be,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=be,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=be,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},v.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&ge.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&me.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},v.event.addProp),v.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,s=e.relatedTarget,a=e.handleObj;return s&&(s===this||v.contains(this,s))||(e.type=a.origType,i=a.handler.apply(this,arguments),e.type=t),i}}}),v.fn.extend({on:function(e,t,i,s){return we(this,e,t,i,s)},one:function(e,t,i,s){return we(this,e,t,i,s,1)},off:function(e,t,i){var s,a;if(e&&e.preventDefault&&e.handleObj)return s=e.handleObj,v(e.delegateTarget).off(s.namespace?s.origType+"."+s.namespace:s.origType,s.selector,s.handler),this;if("object"==typeof e){for(a in e)this.off(a,t,e[a]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=ye),this.each(function(){v.event.remove(this,e,i,t)})}});var Se=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Ce=/<script|<style|<link/i,Ae=/checked\s*(?:[^=]|=\s*.checked.)/i,_e=/^true\/(.*)/,ke=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Te(e,t){return T(e,"table")&&T(11!==t.nodeType?t:t.firstChild,"tr")&&v(">tbody",e)[0]||e}function Ie(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Me(e){var t=_e.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Oe(e,t){var i,s,a,n,r,o,l,c;if(1===t.nodeType){if($.hasData(e)&&(n=$.access(e),r=$.set(t,n),c=n.events))for(a in delete r.handle,r.events={},c)for(i=0,s=c[a].length;i<s;i++)v.event.add(t,a,c[a][i]);U.hasData(e)&&(o=U.access(e),l=v.extend({},o),U.set(t,l))}}function Pe(e,t){var i=t.nodeName.toLowerCase();"input"===i&&re.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function De(e,t,i,s){t=r.apply([],t);var a,n,o,l,c,h,u=0,d=e.length,p=d-1,m=t[0],b=v.isFunction(m);if(b||d>1&&"string"==typeof m&&!f.checkClone&&Ae.test(m))return e.each(function(a){var n=e.eq(a);b&&(t[0]=m.call(this,a,n.html())),De(n,t,i,s)});if(d&&(n=(a=pe(t,e[0].ownerDocument,!1,e,s)).firstChild,1===a.childNodes.length&&(a=n),n||s)){for(l=(o=v.map(he(a,"script"),Ie)).length;u<d;u++)c=a,u!==p&&(c=v.clone(c,!0,!0),l&&v.merge(o,he(c,"script"))),i.call(e[u],c,u);if(l)for(h=o[o.length-1].ownerDocument,v.map(o,Me),u=0;u<l;u++)le.test((c=o[u]).type||"")&&!$.access(c,"globalEval")&&v.contains(h,c)&&(c.src?v._evalUrl&&v._evalUrl(c.src):g(c.textContent.replace(ke,""),h))}return e}function Je(e,t,i){for(var s,a=t?v.filter(t,e):e,n=0;null!=(s=a[n]);n++)i||1!==s.nodeType||v.cleanData(he(s)),s.parentNode&&(i&&v.contains(s.ownerDocument,s)&&ue(he(s,"script")),s.parentNode.removeChild(s));return e}v.extend({htmlPrefilter:function(e){return e.replace(Se,"<$1></$2>")},clone:function(e,t,i){var s,a,n,r,o=e.cloneNode(!0),l=v.contains(e.ownerDocument,e);if(!(f.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||v.isXMLDoc(e)))for(r=he(o),s=0,a=(n=he(e)).length;s<a;s++)Pe(n[s],r[s]);if(t)if(i)for(n=n||he(e),r=r||he(o),s=0,a=n.length;s<a;s++)Oe(n[s],r[s]);else Oe(e,o);return(r=he(o,"script")).length>0&&ue(r,!l&&he(e,"script")),o},cleanData:function(e){for(var t,i,s,a=v.event.special,n=0;void 0!==(i=e[n]);n++)if(q(i)){if(t=i[$.expando]){if(t.events)for(s in t.events)a[s]?v.event.remove(i,s):v.removeEvent(i,s,t.handle);i[$.expando]=void 0}i[U.expando]&&(i[U.expando]=void 0)}}}),v.fn.extend({detach:function(e){return Je(this,e,!0)},remove:function(e){return Je(this,e)},text:function(e){return W(this,function(e){return void 0===e?v.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return De(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Te(this,e).appendChild(e)})},prepend:function(){return De(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Te(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return De(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(v.cleanData(he(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return W(this,function(e){var t=this[0]||{},i=0,s=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ce.test(e)&&!ce[(oe.exec(e)||["",""])[1].toLowerCase()]){e=v.htmlPrefilter(e);try{for(;i<s;i++)1===(t=this[i]||{}).nodeType&&(v.cleanData(he(t,!1)),t.innerHTML=e);t=0}catch(a){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return De(this,arguments,function(t){var i=this.parentNode;v.inArray(this,e)<0&&(v.cleanData(he(this)),i&&i.replaceChild(t,this))},e)}}),v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(e){for(var i,s=[],a=v(e),n=a.length-1,r=0;r<=n;r++)i=r===n?this:this.clone(!0),v(a[r])[t](i),o.apply(s,i.get());return this.pushStack(s)}});var Ee=/^margin/,Le=new RegExp("^("+K+")(?!px)[a-z%]+$","i"),je=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)};function Fe(e,t,i){var s,a,n,r,o=e.style;return(i=i||je(e))&&(""!==(r=i.getPropertyValue(t)||i[t])||v.contains(e.ownerDocument,e)||(r=v.style(e,t)),!f.pixelMarginRight()&&Le.test(r)&&Ee.test(t)&&(s=o.width,a=o.minWidth,n=o.maxWidth,o.minWidth=o.maxWidth=o.width=r,r=i.width,o.width=s,o.minWidth=a,o.maxWidth=n)),void 0!==r?r+"":r}function Re(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}!function(){function t(){if(l){l.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",l.innerHTML="",fe.appendChild(o);var t=e.getComputedStyle(l);i="1%"!==t.top,r="2px"===t.marginLeft,a="4px"===t.width,l.style.marginRight="50%",n="4px"===t.marginRight,fe.removeChild(o),l=null}}var i,a,n,r,o=s.createElement("div"),l=s.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",f.clearCloneStyle="content-box"===l.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(l),v.extend(f,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return t(),a},pixelMarginRight:function(){return t(),n},reliableMarginLeft:function(){return t(),r}}))}();var Ne=/^(none|table(?!-c[ea]).+)/,ze=/^--/,Be={position:"absolute",visibility:"hidden",display:"block"},He={letterSpacing:"0",fontWeight:"400"},We=["Webkit","Moz","ms"],qe=s.createElement("div").style;function Ge(e){var t=v.cssProps[e];return t||(t=v.cssProps[e]=function(e){if(e in qe)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=We.length;i--;)if((e=We[i]+t)in qe)return e}(e)||e),t}function $e(e,t,i){var s=Z.exec(t);return s?Math.max(0,s[2]-(i||0))+(s[3]||"px"):t}function Ue(e,t,i,s,a){var n,r=0;for(n=i===(s?"border":"content")?4:"width"===t?1:0;n<4;n+=2)"margin"===i&&(r+=v.css(e,i+Q[n],!0,a)),s?("content"===i&&(r-=v.css(e,"padding"+Q[n],!0,a)),"margin"!==i&&(r-=v.css(e,"border"+Q[n]+"Width",!0,a))):(r+=v.css(e,"padding"+Q[n],!0,a),"padding"!==i&&(r+=v.css(e,"border"+Q[n]+"Width",!0,a)));return r}function Xe(e,t,i){var s,a=je(e),n=Fe(e,t,a),r="border-box"===v.css(e,"boxSizing",!1,a);return Le.test(n)?n:(s=r&&(f.boxSizingReliable()||n===e.style[t]),"auto"===n&&(n=e["offset"+t[0].toUpperCase()+t.slice(1)]),(n=parseFloat(n)||0)+Ue(e,t,i||(r?"border":"content"),s,a)+"px")}function Ye(e,t,i,s,a){return new Ye.prototype.init(e,t,i,s,a)}v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=Fe(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,i,s){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,n,r,o=v.camelCase(t),l=ze.test(t),c=e.style;return l||(t=Ge(o)),r=v.cssHooks[t]||v.cssHooks[o],void 0===i?r&&"get"in r&&void 0!==(a=r.get(e,!1,s))?a:c[t]:("string"==(n=typeof i)&&(a=Z.exec(i))&&a[1]&&(i=ie(e,t,a),n="number"),void(null!=i&&i==i&&("number"===n&&(i+=a&&a[3]||(v.cssNumber[o]?"":"px")),f.clearCloneStyle||""!==i||0!==t.indexOf("background")||(c[t]="inherit"),r&&"set"in r&&void 0===(i=r.set(e,i,s))||(l?c.setProperty(t,i):c[t]=i))))}},css:function(e,t,i,s){var a,n,r,o=v.camelCase(t);return ze.test(t)||(t=Ge(o)),(r=v.cssHooks[t]||v.cssHooks[o])&&"get"in r&&(a=r.get(e,!0,i)),void 0===a&&(a=Fe(e,t,s)),"normal"===a&&t in He&&(a=He[t]),""===i||i?(n=parseFloat(a),!0===i||isFinite(n)?n||0:a):a}}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,i,s){if(i)return!Ne.test(v.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Xe(e,t,s):te(e,Be,function(){return Xe(e,t,s)})},set:function(e,i,s){var a,n=s&&je(e),r=s&&Ue(e,t,s,"border-box"===v.css(e,"boxSizing",!1,n),n);return r&&(a=Z.exec(i))&&"px"!==(a[3]||"px")&&(e.style[t]=i,i=v.css(e,t)),$e(0,i,r)}}}),v.cssHooks.marginLeft=Re(f.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Fe(e,"marginLeft"))||e.getBoundingClientRect().left-te(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(i){for(var s=0,a={},n="string"==typeof i?i.split(" "):[i];s<4;s++)a[e+Q[s]+t]=n[s]||n[s-2]||n[0];return a}},Ee.test(e)||(v.cssHooks[e+t].set=$e)}),v.fn.extend({css:function(e,t){return W(this,function(e,t,i){var s,a,n={},r=0;if(Array.isArray(t)){for(s=je(e),a=t.length;r<a;r++)n[t[r]]=v.css(e,t[r],!1,s);return n}return void 0!==i?v.style(e,t,i):v.css(e,t)},e,t,arguments.length>1)}}),v.Tween=Ye,(Ye.prototype={constructor:Ye,init:function(e,t,i,s,a,n){this.elem=e,this.prop=i,this.easing=a||v.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=s,this.unit=n||(v.cssNumber[i]?"":"px")},cur:function(){var e=Ye.propHooks[this.prop];return e&&e.get?e.get(this):Ye.propHooks._default.get(this)},run:function(e){var t,i=Ye.propHooks[this.prop];return this.pos=t=this.options.duration?v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Ye.propHooks._default.set(this),this}}).init.prototype=Ye.prototype,(Ye.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=v.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[v.cssProps[e.prop]]&&!v.cssHooks[e.prop]?e.elem[e.prop]=e.now:v.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=Ye.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},v.fx=Ye.prototype.init,v.fx.step={};var Ve,Ke,Ze=/^(?:toggle|show|hide)$/,Qe=/queueHooks$/;function et(){Ke&&(!1===s.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(et):e.setTimeout(et,v.fx.interval),v.fx.tick())}function tt(){return e.setTimeout(function(){Ve=void 0}),Ve=v.now()}function it(e,t){var i,s=0,a={height:e};for(t=t?1:0;s<4;s+=2-t)a["margin"+(i=Q[s])]=a["padding"+i]=e;return t&&(a.opacity=a.width=e),a}function st(e,t,i){for(var s,a=(at.tweeners[t]||[]).concat(at.tweeners["*"]),n=0,r=a.length;n<r;n++)if(s=a[n].call(i,t,e))return s}function at(e,t,i){var s,a,n=0,r=at.prefilters.length,o=v.Deferred().always(function(){delete l.elem}),l=function(){if(a)return!1;for(var t=Ve||tt(),i=Math.max(0,c.startTime+c.duration-t),s=1-(i/c.duration||0),n=0,r=c.tweens.length;n<r;n++)c.tweens[n].run(s);return o.notifyWith(e,[c,s,i]),s<1&&r?i:(r||o.notifyWith(e,[c,1,0]),o.resolveWith(e,[c]),!1)},c=o.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{},easing:v.easing._default},i),originalProperties:t,originalOptions:i,startTime:Ve||tt(),duration:i.duration,tweens:[],createTween:function(t,i){var s=v.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(s),s},stop:function(t){var i=0,s=t?c.tweens.length:0;if(a)return this;for(a=!0;i<s;i++)c.tweens[i].run(1);return t?(o.notifyWith(e,[c,1,0]),o.resolveWith(e,[c,t])):o.rejectWith(e,[c,t]),this}}),h=c.props;for(function(e,t){var i,s,a,n,r;for(i in e)if(a=t[s=v.camelCase(i)],n=e[i],Array.isArray(n)&&(a=n[1],n=e[i]=n[0]),i!==s&&(e[s]=n,delete e[i]),(r=v.cssHooks[s])&&"expand"in r)for(i in n=r.expand(n),delete e[s],n)i in e||(e[i]=n[i],t[i]=a);else t[s]=a}(h,c.opts.specialEasing);n<r;n++)if(s=at.prefilters[n].call(c,e,h,c.opts))return v.isFunction(s.stop)&&(v._queueHooks(c.elem,c.opts.queue).stop=v.proxy(s.stop,s)),s;return v.map(h,st,c),v.isFunction(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),v.fx.timer(v.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c}v.Animation=v.extend(at,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return ie(i.elem,e,Z.exec(t),i),i}]},tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.match(j);for(var i,s=0,a=e.length;s<a;s++)(at.tweeners[i=e[s]]=at.tweeners[i]||[]).unshift(t)},prefilters:[function(e,t,i){var s,a,n,r,o,l,c,h,u="width"in t||"height"in t,d=this,p={},f=e.style,g=e.nodeType&&ee(e),m=$.get(e,"fxshow");for(s in i.queue||(null==(r=v._queueHooks(e,"fx")).unqueued&&(r.unqueued=0,o=r.empty.fire,r.empty.fire=function(){r.unqueued||o()}),r.unqueued++,d.always(function(){d.always(function(){r.unqueued--,v.queue(e,"fx").length||r.empty.fire()})})),t)if(Ze.test(a=t[s])){if(delete t[s],n=n||"toggle"===a,a===(g?"hide":"show")){if("show"!==a||!m||void 0===m[s])continue;g=!0}p[s]=m&&m[s]||v.style(e,s)}if((l=!v.isEmptyObject(t))||!v.isEmptyObject(p))for(s in u&&1===e.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],null==(c=m&&m.display)&&(c=$.get(e,"display")),"none"===(h=v.css(e,"display"))&&(c?h=c:(ne([e],!0),c=e.style.display||c,h=v.css(e,"display"),ne([e]))),("inline"===h||"inline-block"===h&&null!=c)&&"none"===v.css(e,"float")&&(l||(d.done(function(){f.display=c}),null==c&&(c="none"===(h=f.display)?"":h)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",d.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]})),l=!1,p)l||(m?"hidden"in m&&(g=m.hidden):m=$.access(e,"fxshow",{display:c}),n&&(m.hidden=!g),g&&ne([e],!0),d.done(function(){for(s in g||ne([e]),$.remove(e,"fxshow"),p)v.style(e,s,p[s])})),l=st(g?m[s]:0,s,d),s in m||(m[s]=l.start,g&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?at.prefilters.unshift(e):at.prefilters.push(e)}}),v.speed=function(e,t,i){var s=e&&"object"==typeof e?v.extend({},e):{complete:i||!i&&t||v.isFunction(e)&&e,duration:e,easing:i&&t||t&&!v.isFunction(t)&&t};return v.fx.off?s.duration=0:"number"!=typeof s.duration&&(s.duration=s.duration in v.fx.speeds?v.fx.speeds[s.duration]:v.fx.speeds._default),null!=s.queue&&!0!==s.queue||(s.queue="fx"),s.old=s.complete,s.complete=function(){v.isFunction(s.old)&&s.old.call(this),s.queue&&v.dequeue(this,s.queue)},s},v.fn.extend({fadeTo:function(e,t,i,s){return this.filter(ee).css("opacity",0).show().end().animate({opacity:t},e,i,s)},animate:function(e,t,i,s){var a=v.isEmptyObject(e),n=v.speed(t,i,s),r=function(){var t=at(this,v.extend({},e),n);(a||$.get(this,"finish"))&&t.stop(!0)};return r.finish=r,a||!1===n.queue?this.each(r):this.queue(n.queue,r)},stop:function(e,t,i){var s=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,a=null!=e&&e+"queueHooks",n=v.timers,r=$.get(this);if(a)r[a]&&r[a].stop&&s(r[a]);else for(a in r)r[a]&&r[a].stop&&Qe.test(a)&&s(r[a]);for(a=n.length;a--;)n[a].elem!==this||null!=e&&n[a].queue!==e||(n[a].anim.stop(i),t=!1,n.splice(a,1));!t&&i||v.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,i=$.get(this),s=i[e+"queue"],a=i[e+"queueHooks"],n=v.timers,r=s?s.length:0;for(i.finish=!0,v.queue(this,e,[]),a&&a.stop&&a.stop.call(this,!0),t=n.length;t--;)n[t].elem===this&&n[t].queue===e&&(n[t].anim.stop(!0),n.splice(t,1));for(t=0;t<r;t++)s[t]&&s[t].finish&&s[t].finish.call(this);delete i.finish})}}),v.each(["toggle","show","hide"],function(e,t){var i=v.fn[t];v.fn[t]=function(e,s,a){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(it(t,!0),e,s,a)}}),v.each({slideDown:it("show"),slideUp:it("hide"),slideToggle:it("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,i,s){return this.animate(t,e,i,s)}}),v.timers=[],v.fx.tick=function(){var e,t=0,i=v.timers;for(Ve=v.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||v.fx.stop(),Ve=void 0},v.fx.timer=function(e){v.timers.push(e),v.fx.start()},v.fx.interval=13,v.fx.start=function(){Ke||(Ke=!0,et())},v.fx.stop=function(){Ke=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fn.delay=function(t,i){return t=v.fx&&v.fx.speeds[t]||t,this.queue(i=i||"fx",function(i,s){var a=e.setTimeout(i,t);s.stop=function(){e.clearTimeout(a)}})},function(){var e=s.createElement("input"),t=s.createElement("select").appendChild(s.createElement("option"));e.type="checkbox",f.checkOn=""!==e.value,f.optSelected=t.selected,(e=s.createElement("input")).value="t",e.type="radio",f.radioValue="t"===e.value}();var nt,rt=v.expr.attrHandle;v.fn.extend({attr:function(e,t){return W(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})}}),v.extend({attr:function(e,t,i){var s,a,n=e.nodeType;if(3!==n&&8!==n&&2!==n)return void 0===e.getAttribute?v.prop(e,t,i):(1===n&&v.isXMLDoc(e)||(a=v.attrHooks[t.toLowerCase()]||(v.expr.match.bool.test(t)?nt:void 0)),void 0!==i?null===i?void v.removeAttr(e,t):a&&"set"in a&&void 0!==(s=a.set(e,i,t))?s:(e.setAttribute(t,i+""),i):a&&"get"in a&&null!==(s=a.get(e,t))?s:null==(s=v.find.attr(e,t))?void 0:s)},attrHooks:{type:{set:function(e,t){if(!f.radioValue&&"radio"===t&&T(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,s=0,a=t&&t.match(j);if(a&&1===e.nodeType)for(;i=a[s++];)e.removeAttribute(i)}}),nt={set:function(e,t,i){return!1===t?v.removeAttr(e,i):e.setAttribute(i,i),i}},v.each(v.expr.match.bool.source.match(/\w+/g),function(e,t){var i=rt[t]||v.find.attr;rt[t]=function(e,t,s){var a,n,r=t.toLowerCase();return s||(n=rt[r],rt[r]=a,a=null!=i(e,t,s)?r:null,rt[r]=n),a}});var ot=/^(?:input|select|textarea|button)$/i,lt=/^(?:a|area)$/i;function ct(e){return(e.match(j)||[]).join(" ")}function ht(e){return e.getAttribute&&e.getAttribute("class")||""}v.fn.extend({prop:function(e,t){return W(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[v.propFix[e]||e]})}}),v.extend({prop:function(e,t,i){var s,a,n=e.nodeType;if(3!==n&&8!==n&&2!==n)return 1===n&&v.isXMLDoc(e)||(a=v.propHooks[t=v.propFix[t]||t]),void 0!==i?a&&"set"in a&&void 0!==(s=a.set(e,i,t))?s:e[t]=i:a&&"get"in a&&null!==(s=a.get(e,t))?s:e[t]},propHooks:{tabIndex:{get:function(e){var t=v.find.attr(e,"tabindex");return t?parseInt(t,10):ot.test(e.nodeName)||lt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),f.optSelected||(v.propHooks.selected={get:function(e){return null},set:function(e){}}),v.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){v.propFix[this.toLowerCase()]=this}),v.fn.extend({addClass:function(e){var t,i,s,a,n,r,o,l=0;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,ht(this)))});if("string"==typeof e&&e)for(t=e.match(j)||[];i=this[l++];)if(a=ht(i),s=1===i.nodeType&&" "+ct(a)+" "){for(r=0;n=t[r++];)s.indexOf(" "+n+" ")<0&&(s+=n+" ");a!==(o=ct(s))&&i.setAttribute("class",o)}return this},removeClass:function(e){var t,i,s,a,n,r,o,l=0;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,ht(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(j)||[];i=this[l++];)if(a=ht(i),s=1===i.nodeType&&" "+ct(a)+" "){for(r=0;n=t[r++];)for(;s.indexOf(" "+n+" ")>-1;)s=s.replace(" "+n+" "," ");a!==(o=ct(s))&&i.setAttribute("class",o)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):v.isFunction(e)?this.each(function(i){v(this).toggleClass(e.call(this,i,ht(this),t),t)}):this.each(function(){var t,s,a,n;if("string"===i)for(s=0,a=v(this),n=e.match(j)||[];t=n[s++];)a.hasClass(t)?a.removeClass(t):a.addClass(t);else void 0!==e&&"boolean"!==i||((t=ht(this))&&$.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":$.get(this,"__className__")||""))})},hasClass:function(e){var t,i,s=0;for(t=" "+e+" ";i=this[s++];)if(1===i.nodeType&&(" "+ct(ht(i))+" ").indexOf(t)>-1)return!0;return!1}});var ut=/\r/g;v.fn.extend({val:function(e){var t,i,s,a=this[0];return arguments.length?(s=v.isFunction(e),this.each(function(i){var a;1===this.nodeType&&(null==(a=s?e.call(this,i,v(this).val()):e)?a="":"number"==typeof a?a+="":Array.isArray(a)&&(a=v.map(a,function(e){return null==e?"":e+""})),(t=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,a,"value")||(this.value=a))})):a?(t=v.valHooks[a.type]||v.valHooks[a.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(a,"value"))?i:"string"==typeof(i=a.value)?i.replace(ut,""):null==i?"":i:void 0}}),v.extend({valHooks:{option:{get:function(e){var t=v.find.attr(e,"value");return null!=t?t:ct(v.text(e))}},select:{get:function(e){var t,i,s,a=e.options,n=e.selectedIndex,r="select-one"===e.type,o=r?null:[],l=r?n+1:a.length;for(s=n<0?l:r?n:0;s<l;s++)if(((i=a[s]).selected||s===n)&&!i.disabled&&(!i.parentNode.disabled||!T(i.parentNode,"optgroup"))){if(t=v(i).val(),r)return t;o.push(t)}return o},set:function(e,t){for(var i,s,a=e.options,n=v.makeArray(t),r=a.length;r--;)((s=a[r]).selected=v.inArray(v.valHooks.option.get(s),n)>-1)&&(i=!0);return i||(e.selectedIndex=-1),n}}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=v.inArray(v(e).val(),t)>-1}},f.checkOn||(v.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var dt=/^(?:focusinfocus|focusoutblur)$/;v.extend(v.event,{trigger:function(t,i,a,n){var r,o,l,c,h,d,p,f=[a||s],g=u.call(t,"type")?t.type:t,m=u.call(t,"namespace")?t.namespace.split("."):[];if(o=l=a=a||s,3!==a.nodeType&&8!==a.nodeType&&!dt.test(g+v.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),h=g.indexOf(":")<0&&"on"+g,(t=t[v.expando]?t:new v.Event(g,"object"==typeof t&&t)).isTrigger=n?2:3,t.namespace=m.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=a),i=null==i?[t]:v.makeArray(i,[t]),p=v.event.special[g]||{},n||!p.trigger||!1!==p.trigger.apply(a,i))){if(!n&&!p.noBubble&&!v.isWindow(a)){for(dt.test((c=p.delegateType||g)+g)||(o=o.parentNode);o;o=o.parentNode)f.push(o),l=o;l===(a.ownerDocument||s)&&f.push(l.defaultView||l.parentWindow||e)}for(r=0;(o=f[r++])&&!t.isPropagationStopped();)t.type=r>1?c:p.bindType||g,(d=($.get(o,"events")||{})[t.type]&&$.get(o,"handle"))&&d.apply(o,i),(d=h&&o[h])&&d.apply&&q(o)&&(t.result=d.apply(o,i),!1===t.result&&t.preventDefault());return t.type=g,n||t.isDefaultPrevented()||p._default&&!1!==p._default.apply(f.pop(),i)||!q(a)||h&&v.isFunction(a[g])&&!v.isWindow(a)&&((l=a[h])&&(a[h]=null),v.event.triggered=g,a[g](),v.event.triggered=void 0,l&&(a[h]=l)),t.result}},simulate:function(e,t,i){var s=v.extend(new v.Event,i,{type:e,isSimulated:!0});v.event.trigger(s,null,t)}}),v.fn.extend({trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return v.event.trigger(e,t,i,!0)}}),v.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){v.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),v.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),f.focusin="onfocusin"in e,f.focusin||v.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){v.event.simulate(t,e.target,v.event.fix(e))};v.event.special[t]={setup:function(){var s=this.ownerDocument||this,a=$.access(s,t);a||s.addEventListener(e,i,!0),$.access(s,t,(a||0)+1)},teardown:function(){var s=this.ownerDocument||this,a=$.access(s,t)-1;a?$.access(s,t,a):(s.removeEventListener(e,i,!0),$.remove(s,t))}}});var pt=e.location,ft=v.now(),gt=/\?/;v.parseXML=function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new e.DOMParser).parseFromString(t,"text/xml")}catch(s){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||v.error("Invalid XML: "+t),i};var mt=/\[\]$/,vt=/\r?\n/g,bt=/^(?:submit|button|image|reset|file)$/i,yt=/^(?:input|select|textarea|keygen)/i;function xt(e,t,i,s){var a;if(Array.isArray(t))v.each(t,function(t,a){i||mt.test(e)?s(e,a):xt(e+"["+("object"==typeof a&&null!=a?t:"")+"]",a,i,s)});else if(i||"object"!==v.type(t))s(e,t);else for(a in t)xt(e+"["+a+"]",t[a],i,s)}v.param=function(e,t){var i,s=[],a=function(e,t){var i=v.isFunction(t)?t():t;s[s.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(Array.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){a(this.name,this.value)});else for(i in e)xt(i,e[i],t,a);return s.join("&")},v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=v.prop(this,"elements");return e?v.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!v(this).is(":disabled")&&yt.test(this.nodeName)&&!bt.test(e)&&(this.checked||!re.test(e))}).map(function(e,t){var i=v(this).val();return null==i?null:Array.isArray(i)?v.map(i,function(e){return{name:t.name,value:e.replace(vt,"\r\n")}}):{name:t.name,value:i.replace(vt,"\r\n")}}).get()}});var wt=/%20/g,St=/#.*$/,Ct=/([?&])_=[^&]*/,At=/^(.*?):[ \t]*([^\r\n]*)$/gm,_t=/^(?:GET|HEAD)$/,kt=/^\/\//,Tt={},It={},Mt="*/".concat("*"),Ot=s.createElement("a");function Pt(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var s,a=0,n=t.toLowerCase().match(j)||[];if(v.isFunction(i))for(;s=n[a++];)"+"===s[0]?(s=s.slice(1)||"*",(e[s]=e[s]||[]).unshift(i)):(e[s]=e[s]||[]).push(i)}}function Dt(e,t,i,s){var a={},n=e===It;function r(o){var l;return a[o]=!0,v.each(e[o]||[],function(e,o){var c=o(t,i,s);return"string"!=typeof c||n||a[c]?n?!(l=c):void 0:(t.dataTypes.unshift(c),r(c),!1)}),l}return r(t.dataTypes[0])||!a["*"]&&r("*")}function Jt(e,t){var i,s,a=v.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((a[i]?e:s||(s={}))[i]=t[i]);return s&&v.extend(!0,e,s),e}Ot.href=pt.href,v.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:pt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(pt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Mt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":v.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Jt(Jt(e,v.ajaxSettings),t):Jt(v.ajaxSettings,e)},ajaxPrefilter:Pt(Tt),ajaxTransport:Pt(It),ajax:function(t,i){"object"==typeof t&&(i=t,t=void 0);var a,n,r,o,l,c,h,u,d,p,f=v.ajaxSetup({},i=i||{}),g=f.context||f,m=f.context&&(g.nodeType||g.jquery)?v(g):v.event,b=v.Deferred(),y=v.Callbacks("once memory"),x=f.statusCode||{},w={},S={},C="canceled",A={readyState:0,getResponseHeader:function(e){var t;if(h){if(!o)for(o={};t=At.exec(r);)o[t[1].toLowerCase()]=t[2];t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return h?r:null},setRequestHeader:function(e,t){return null==h&&(e=S[e.toLowerCase()]=S[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==h&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)A.always(e[A.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||C;return a&&a.abort(t),k(0,t),this}};if(b.promise(A),f.url=((t||f.url||pt.href)+"").replace(kt,pt.protocol+"//"),f.type=i.method||i.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(j)||[""],null==f.crossDomain){c=s.createElement("a");try{c.href=f.url,c.href=c.href,f.crossDomain=Ot.protocol+"//"+Ot.host!=c.protocol+"//"+c.host}catch(_){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=v.param(f.data,f.traditional)),Dt(Tt,f,i,A),h)return A;for(d in(u=v.event&&f.global)&&0==v.active++&&v.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!_t.test(f.type),n=f.url.replace(St,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(wt,"+")):(p=f.url.slice(n.length),f.data&&(n+=(gt.test(n)?"&":"?")+f.data,delete f.data),!1===f.cache&&(n=n.replace(Ct,"$1"),p=(gt.test(n)?"&":"?")+"_="+ft+++p),f.url=n+p),f.ifModified&&(v.lastModified[n]&&A.setRequestHeader("If-Modified-Since",v.lastModified[n]),v.etag[n]&&A.setRequestHeader("If-None-Match",v.etag[n])),(f.data&&f.hasContent&&!1!==f.contentType||i.contentType)&&A.setRequestHeader("Content-Type",f.contentType),A.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Mt+"; q=0.01":""):f.accepts["*"]),f.headers)A.setRequestHeader(d,f.headers[d]);if(f.beforeSend&&(!1===f.beforeSend.call(g,A,f)||h))return A.abort();if(C="abort",y.add(f.complete),A.done(f.success),A.fail(f.error),a=Dt(It,f,i,A)){if(A.readyState=1,u&&m.trigger("ajaxSend",[A,f]),h)return A;f.async&&f.timeout>0&&(l=e.setTimeout(function(){A.abort("timeout")},f.timeout));try{h=!1,a.send(w,k)}catch(_){if(h)throw _;k(-1,_)}}else k(-1,"No Transport");function k(t,i,s,o){var c,d,p,w,S,C=i;h||(h=!0,l&&e.clearTimeout(l),a=void 0,r=o||"",A.readyState=t>0?4:0,c=t>=200&&t<300||304===t,s&&(w=function(e,t,i){for(var s,a,n,r,o=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===s&&(s=e.mimeType||t.getResponseHeader("Content-Type"));if(s)for(a in o)if(o[a]&&o[a].test(s)){l.unshift(a);break}if(l[0]in i)n=l[0];else{for(a in i){if(!l[0]||e.converters[a+" "+l[0]]){n=a;break}r||(r=a)}n=n||r}if(n)return n!==l[0]&&l.unshift(n),i[n]}(f,A,s)),w=function(e,t,i,s){var a,n,r,o,l,c={},h=e.dataTypes.slice();if(h[1])for(r in e.converters)c[r.toLowerCase()]=e.converters[r];for(n=h.shift();n;)if(e.responseFields[n]&&(i[e.responseFields[n]]=t),!l&&s&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=n,n=h.shift())if("*"===n)n=l;else if("*"!==l&&l!==n){if(!(r=c[l+" "+n]||c["* "+n]))for(a in c)if((o=a.split(" "))[1]===n&&(r=c[l+" "+o[0]]||c["* "+o[0]])){!0===r?r=c[a]:!0!==c[a]&&(n=o[0],h.unshift(o[1]));break}if(!0!==r)if(r&&e.throws)t=r(t);else try{t=r(t)}catch(u){return{state:"parsererror",error:r?u:"No conversion from "+l+" to "+n}}}return{state:"success",data:t}}(f,w,A,c),c?(f.ifModified&&((S=A.getResponseHeader("Last-Modified"))&&(v.lastModified[n]=S),(S=A.getResponseHeader("etag"))&&(v.etag[n]=S)),204===t||"HEAD"===f.type?C="nocontent":304===t?C="notmodified":(C=w.state,d=w.data,c=!(p=w.error))):(p=C,!t&&C||(C="error",t<0&&(t=0))),A.status=t,A.statusText=(i||C)+"",c?b.resolveWith(g,[d,C,A]):b.rejectWith(g,[A,C,p]),A.statusCode(x),x=void 0,u&&m.trigger(c?"ajaxSuccess":"ajaxError",[A,f,c?d:p]),y.fireWith(g,[A,C]),u&&(m.trigger("ajaxComplete",[A,f]),--v.active||v.event.trigger("ajaxStop")))}return A},getJSON:function(e,t,i){return v.get(e,t,i,"json")},getScript:function(e,t){return v.get(e,void 0,t,"script")}}),v.each(["get","post"],function(e,t){v[t]=function(e,i,s,a){return v.isFunction(i)&&(a=a||s,s=i,i=void 0),v.ajax(v.extend({url:e,type:t,dataType:a,data:i,success:s},v.isPlainObject(e)&&e))}}),v._evalUrl=function(e){return v.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},v.fn.extend({wrapAll:function(e){var t;return this[0]&&(v.isFunction(e)&&(e=e.call(this[0])),t=v(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(i){v(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){v(this).replaceWith(this.childNodes)}),this}}),v.expr.pseudos.hidden=function(e){return!v.expr.pseudos.visible(e)},v.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},v.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}};var Et={0:200,1223:204},Lt=v.ajaxSettings.xhr();f.cors=!!Lt&&"withCredentials"in Lt,f.ajax=Lt=!!Lt,v.ajaxTransport(function(t){var i,s;if(f.cors||Lt&&!t.crossDomain)return{send:function(a,n){var r,o=t.xhr();if(o.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(r in t.xhrFields)o[r]=t.xhrFields[r];for(r in t.mimeType&&o.overrideMimeType&&o.overrideMimeType(t.mimeType),t.crossDomain||a["X-Requested-With"]||(a["X-Requested-With"]="XMLHttpRequest"),a)o.setRequestHeader(r,a[r]);i=function(e){return function(){i&&(i=s=o.onload=o.onerror=o.onabort=o.onreadystatechange=null,"abort"===e?o.abort():"error"===e?"number"!=typeof o.status?n(0,"error"):n(o.status,o.statusText):n(Et[o.status]||o.status,o.statusText,"text"!==(o.responseType||"text")||"string"!=typeof o.responseText?{binary:o.response}:{text:o.responseText},o.getAllResponseHeaders()))}},o.onload=i(),s=o.onerror=i("error"),void 0!==o.onabort?o.onabort=s:o.onreadystatechange=function(){4===o.readyState&&e.setTimeout(function(){i&&s()})},i=i("abort");try{o.send(t.hasContent&&t.data||null)}catch(l){if(i)throw l}},abort:function(){i&&i()}}}),v.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),v.ajaxTransport("script",function(e){var t,i;if(e.crossDomain)return{send:function(a,n){t=v("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&n("error"===e.type?404:200,e.type)}),s.head.appendChild(t[0])},abort:function(){i&&i()}}});var jt=[],Ft=/(=)\?(?=&|$)|\?\?/;v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jt.pop()||v.expando+"_"+ft++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(t,i,s){var a,n,r,o=!1!==t.jsonp&&(Ft.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ft.test(t.data)&&"data");if(o||"jsonp"===t.dataTypes[0])return a=t.jsonpCallback=v.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,o?t[o]=t[o].replace(Ft,"$1"+a):!1!==t.jsonp&&(t.url+=(gt.test(t.url)?"&":"?")+t.jsonp+"="+a),t.converters["script json"]=function(){return r||v.error(a+" was not called"),r[0]},t.dataTypes[0]="json",n=e[a],e[a]=function(){r=arguments},s.always(function(){void 0===n?v(e).removeProp(a):e[a]=n,t[a]&&(t.jsonpCallback=i.jsonpCallback,jt.push(a)),r&&v.isFunction(n)&&n(r[0]),r=n=void 0}),"script"}),f.createHTMLDocument=function(){var e=s.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),v.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=!1),t||(f.createHTMLDocument?((a=(t=s.implementation.createHTMLDocument("")).createElement("base")).href=s.location.href,t.head.appendChild(a)):t=s),r=!i&&[],(n=I.exec(e))?[t.createElement(n[1])]:(n=pe([e],t,r),r&&r.length&&v(r).remove(),v.merge([],n.childNodes)));var a,n,r},v.fn.load=function(e,t,i){var s,a,n,r=this,o=e.indexOf(" ");return o>-1&&(s=ct(e.slice(o)),e=e.slice(0,o)),v.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(a="POST"),r.length>0&&v.ajax({url:e,type:a||"GET",dataType:"html",data:t}).done(function(e){n=arguments,r.html(s?v("<div>").append(v.parseHTML(e)).find(s):e)}).always(i&&function(e,t){r.each(function(){i.apply(this,n||[e.responseText,t,e])})}),this},v.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.expr.pseudos.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length},v.offset={setOffset:function(e,t,i){var s,a,n,r,o,l,c=v.css(e,"position"),h=v(e),u={};"static"===c&&(e.style.position="relative"),o=h.offset(),n=v.css(e,"top"),l=v.css(e,"left"),("absolute"===c||"fixed"===c)&&(n+l).indexOf("auto")>-1?(r=(s=h.position()).top,a=s.left):(r=parseFloat(n)||0,a=parseFloat(l)||0),v.isFunction(t)&&(t=t.call(e,i,v.extend({},o))),null!=t.top&&(u.top=t.top-o.top+r),null!=t.left&&(u.left=t.left-o.left+a),"using"in t?t.using.call(e,u):h.css(u)}},v.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){v.offset.setOffset(this,e,t)});var t,i,s,a,n=this[0];return n?n.getClientRects().length?{top:(s=n.getBoundingClientRect()).top+(a=(t=n.ownerDocument).defaultView).pageYOffset-(i=t.documentElement).clientTop,left:s.left+a.pageXOffset-i.clientLeft}:{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i=this[0],s={top:0,left:0};return"fixed"===v.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),T(e[0],"html")||(s=e.offset()),s={top:s.top+v.css(e[0],"borderTopWidth",!0),left:s.left+v.css(e[0],"borderLeftWidth",!0)}),{top:t.top-s.top-v.css(i,"marginTop",!0),left:t.left-s.left-v.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===v.css(e,"position");)e=e.offsetParent;return e||fe})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;v.fn[e]=function(s){return W(this,function(e,s,a){var n;return v.isWindow(e)?n=e:9===e.nodeType&&(n=e.defaultView),void 0===a?n?n[t]:e[s]:void(n?n.scrollTo(i?n.pageXOffset:a,i?a:n.pageYOffset):e[s]=a)},e,s,arguments.length)}}),v.each(["top","left"],function(e,t){v.cssHooks[t]=Re(f.pixelPosition,function(e,i){if(i)return i=Fe(e,t),Le.test(i)?v(e).position()[t]+"px":i})}),v.each({Height:"height",Width:"width"},function(e,t){v.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,s){v.fn[s]=function(a,n){var r=arguments.length&&(i||"boolean"!=typeof a),o=i||(!0===a||!0===n?"margin":"border");return W(this,function(t,i,a){var n;return v.isWindow(t)?0===s.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+e],n["scroll"+e],t.body["offset"+e],n["offset"+e],n["client"+e])):void 0===a?v.css(t,i,o):v.style(t,i,a,o)},t,r?a:void 0,r)}})}),v.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,s){return this.on(t,e,i,s)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}}),v.holdReady=function(e){e?v.readyWait++:v.ready(!0)},v.isArray=Array.isArray,v.parseJSON=JSON.parse,v.nodeName=T,"function"==typeof define&&define.amd&&define("jquery",[],function(){return v});var Rt=e.jQuery,Nt=e.$;return v.noConflict=function(t){return e.$===v&&(e.$=Nt),t&&e.jQuery===v&&(e.jQuery=Rt),v},t||(e.jQuery=e.$=v),v}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=s(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function s(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.on("mouseout",i,function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,a)}function a(){e.datepicker._isDisabledDatepicker(u.inline?u.dpDiv.parent()[0]:u.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function n(t,i){for(var s in e.extend(t,i),i)null==i[s]&&(t[s]=i[s]);return t}function r(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.ui.version="1.12.1";var o=0,l=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,a,r;for(r=0;null!=(a=i[r]);r++)try{(s=e._data(a,"events"))&&s.remove&&e(a).triggerHandler("remove")}catch(n){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var a,n,r,o={},l=t.split(".")[0],c=l+"-"+(t=t.split(".")[1]);return s||(s=i,i=e.Widget),e.isArray(s)&&(s=e.extend.apply(null,[{}].concat(s))),e.expr[":"][c.toLowerCase()]=function(t){return!!e.data(t,c)},e[l]=e[l]||{},a=e[l][t],n=e[l][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new n(e,t)},e.extend(n,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),(r=new i).options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?void(o[t]=function(){function e(){return i.prototype[t].apply(this,arguments)}function a(e){return i.prototype[t].apply(this,e)}return function(){var t,i=this._super,n=this._superApply;return this._super=e,this._superApply=a,t=s.apply(this,arguments),this._super=i,this._superApply=n,t}}()):void(o[t]=s)}),n.prototype=e.widget.extend(r,{widgetEventPrefix:a&&r.widgetEventPrefix||t},o,{constructor:n,namespace:l,widgetName:t,widgetFullName:c}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,n,i._proto)}),delete a._childConstructors):i._childConstructors.push(n),e.widget.bridge(t,n),n},e.widget.extend=function(t){for(var i,s,a=l.call(arguments,1),n=0,r=a.length;r>n;n++)for(i in a[n])s=a[n][i],a[n].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var n="string"==typeof a,r=l.call(arguments,1),o=this;return n?this.length||"instance"!==a?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(o=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r))!==n&&void 0!==i?(o=i&&i.jquery?o.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+a+"'")}):o=void 0:(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),o}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=o++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,function(e,i){t._removeClass(i,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,a,n,r=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(r={},s=t.split("."),t=s.shift(),s.length){for(a=r[t]=e.widget.extend({},this.options[t]),n=0;s.length-1>n;n++)a[s[n]]=a[s[n]]||{},a=a[s[n]];if(t=s.pop(),1===arguments.length)return void 0===a[t]?null:a[t];a[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];r[t]=i}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var i,s,a;for(i in t)a=this.classesElementLookup[i],t[i]!==this.options.classes[i]&&a&&a.length&&(s=e(a.get()),this._removeClass(a,i),s.addClass(this._classes({element:s,keys:i,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){function i(i,n){var r,o;for(o=0;i.length>o;o++)r=a.classesElementLookup[i[o]]||e(),r=e(t.add?e.unique(r.get().concat(t.element.get())):r.not(t.element).get()),a.classesElementLookup[i[o]]=r,s.push(i[o]),n&&t.classes[i[o]]&&s.push(t.classes[i[o]])}var s=[],a=this;return t=e.extend({element:this.element,classes:this.options.classes||{}},t),this._on(t.element,{remove:"_untrackClassesElement"}),t.keys&&i(t.keys.match(/\S+/g)||[],!0),t.extra&&i(t.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(t){var i=this;e.each(i.classesElementLookup,function(s,a){-1!==e.inArray(t.target,a)&&(i.classesElementLookup[s]=e(a.not(t.target).get()))})},_removeClass:function(e,t,i){return this._toggleClass(e,t,i,!1)},_addClass:function(e,t,i){return this._toggleClass(e,t,i,!0)},_toggleClass:function(e,t,i,s){var a="string"==typeof e||null===e,n={extra:a?t:i,keys:a?e:t,element:a?this.element:e,add:s="boolean"==typeof s?s:i};return n.element.toggleClass(this._classes(n),s),this},_on:function(t,i,s){var a,n=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=a=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,a=this.widget()),e.each(s,function(s,r){function o(){return t||!0!==n.options.disabled&&!e(this).hasClass("ui-state-disabled")?("string"==typeof r?n[r]:r).apply(n,arguments):void 0}"string"!=typeof r&&(o.guid=r.guid=r.guid||o.guid||e.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+n.eventNamespace,h=l[2];h?a.on(c,h,o):i.on(c,o)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(i).off(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var i=this;return setTimeout(function(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,i,s){var a,n,r=this.options[t];if(s=s||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(a in n)a in i||(i[a]=n[a]);return this.element.trigger(i,s),!(e.isFunction(r)&&!1===r.apply(this.element[0],[i].concat(s))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,a,n){"string"==typeof a&&(a={effect:a});var r,o=a?!0===a||"number"==typeof a?i:a.effect||i:t;"number"==typeof(a=a||{})&&(a={duration:a}),r=!e.isEmptyObject(a),a.complete=n,a.delay&&s.delay(a.delay),r&&e.effects&&e.effects.effect[o]?s[t](a):o!==t&&s[o]?s[o](a.duration,a.easing,n):s.queue(function(i){e(this)[t](),n&&n.call(s[0]),i()})}}),function(){function t(e,t,i){return[parseFloat(e[0])*(h.test(e[0])?t/100:1),parseFloat(e[1])*(h.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}var s,a=Math.max,n=Math.abs,r=/left|center|right/,o=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,h=/%$/,u=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==s)return s;var t,i,a=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),n=a.children()[0];return e("body").append(a),t=n.offsetWidth,a.css("overflow","scroll"),t===(i=n.offsetWidth)&&(i=a[0].clientWidth),a.remove(),s=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),a="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth;return{width:"scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:a?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),a=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:a,offset:s||a?{left:0,top:0}:e(t).offset(),scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},e.fn.position=function(s){if(!s||!s.of)return u.apply(this,arguments);s=e.extend({},s);var h,d,p,f,g,m,v=e(s.of),b=e.position.getWithinInfo(s.within),y=e.position.getScrollInfo(b),x=(s.collision||"flip").split(" "),w={};return m=function(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}(v),v[0].preventDefault&&(s.at="left top"),d=m.width,p=m.height,g=e.extend({},f=m.offset),e.each(["my","at"],function(){var e,t,i=(s[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):o.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=o.test(i[1])?i[1]:"center",e=l.exec(i[0]),t=l.exec(i[1]),w[this]=[e?e[0]:0,t?t[0]:0],s[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===s.at[0]?g.left+=d:"center"===s.at[0]&&(g.left+=d/2),"bottom"===s.at[1]?g.top+=p:"center"===s.at[1]&&(g.top+=p/2),h=t(w.at,d,p),g.left+=h[0],g.top+=h[1],this.each(function(){var r,o,l=e(this),c=l.outerWidth(),u=l.outerHeight(),m=i(this,"marginLeft"),S=i(this,"marginTop"),C=c+m+i(this,"marginRight")+y.width,A=u+S+i(this,"marginBottom")+y.height,_=e.extend({},g),k=t(w.my,l.outerWidth(),l.outerHeight());"right"===s.my[0]?_.left-=c:"center"===s.my[0]&&(_.left-=c/2),"bottom"===s.my[1]?_.top-=u:"center"===s.my[1]&&(_.top-=u/2),_.left+=k[0],_.top+=k[1],r={marginLeft:m,marginTop:S},e.each(["left","top"],function(t,i){e.ui.position[x[t]]&&e.ui.position[x[t]][i](_,{targetWidth:d,targetHeight:p,elemWidth:c,elemHeight:u,collisionPosition:r,collisionWidth:C,collisionHeight:A,offset:[h[0]+k[0],h[1]+k[1]],my:s.my,at:s.at,within:b,elem:l})}),s.using&&(o=function(e){var t=f.left-_.left,i=t+d-c,r=f.top-_.top,o=r+p-u,h={target:{element:v,left:f.left,top:f.top,width:d,height:p},element:{element:l,left:_.left,top:_.top,width:c,height:u},horizontal:0>i?"left":t>0?"right":"center",vertical:0>o?"top":r>0?"bottom":"middle"};c>d&&d>n(t+i)&&(h.horizontal="center"),u>p&&p>n(r+o)&&(h.vertical="middle"),h.important=a(n(t),n(i))>a(n(r),n(o))?"horizontal":"vertical",s.using.call(this,e,h)}),l.offset(e.extend(_,{using:o}))})},e.ui.position={fit:{left:function(e,t){var i=t.within,s=i.isWindow?i.scrollLeft:i.offset.left,n=i.width,r=e.left-t.collisionPosition.marginLeft,o=s-r,l=r+t.collisionWidth-n-s;t.collisionWidth>n?o>0&&0>=l?e.left+=o-(e.left+o+t.collisionWidth-n-s):e.left=l>0&&0>=o?s:o>l?s+n-t.collisionWidth:s:o>0?e.left+=o:l>0?e.left-=l:e.left=a(e.left-r,e.left)},top:function(e,t){var i=t.within,s=i.isWindow?i.scrollTop:i.offset.top,n=t.within.height,r=e.top-t.collisionPosition.marginTop,o=s-r,l=r+t.collisionHeight-n-s;t.collisionHeight>n?o>0&&0>=l?e.top+=o-(e.top+o+t.collisionHeight-n-s):e.top=l>0&&0>=o?s:o>l?s+n-t.collisionHeight:s:o>0?e.top+=o:l>0?e.top-=l:e.top=a(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,a=t.within,r=a.width,o=a.isWindow?a.scrollLeft:a.offset.left,l=e.left-t.collisionPosition.marginLeft,c=l-o,h=l+t.collisionWidth-r-o,u="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,d="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];0>c?(0>(i=e.left+u+d+p+t.collisionWidth-r-(a.offset.left+a.scrollLeft))||n(c)>i)&&(e.left+=u+d+p):h>0&&((s=e.left-t.collisionPosition.marginLeft+u+d+p-o)>0||h>n(s))&&(e.left+=u+d+p)},top:function(e,t){var i,s,a=t.within,r=a.height,o=a.isWindow?a.scrollTop:a.offset.top,l=e.top-t.collisionPosition.marginTop,c=l-o,h=l+t.collisionHeight-r-o,u="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,d="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,p=-2*t.offset[1];0>c?(0>(s=e.top+u+d+p+t.collisionHeight-r-(a.offset.top+a.scrollTop))||n(c)>s)&&(e.top+=u+d+p):h>0&&((i=e.top-t.collisionPosition.marginTop+u+d+p-o)>0||h>n(i))&&(e.top+=u+d+p)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])}}),e.fn.extend({disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}}),e.ui.focusable=function(t,i){var s,a,n,r,o,l=t.nodeName.toLowerCase();return"area"===l?(a=(s=t.parentNode).name,!(!t.href||!a||"map"!==s.nodeName.toLowerCase())&&(n=e("img[usemap='#"+a+"']")).length>0&&n.is(":visible")):(/^(input|select|textarea|button|object)$/.test(l)?(r=!t.disabled)&&(o=e(t).closest("fieldset")[0])&&(r=!o.disabled):r="a"===l&&t.href||i,r&&e(t).is(":visible")&&function(e){for(var t=e.css("visibility");"inherit"===t;)t=(e=e.parent()).css("visibility");return"hidden"!==t}(e(t)))},e.extend(e.expr[":"],{focusable:function(t){return e.ui.focusable(t,null!=e.attr(t,"tabindex"))}}),e.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):e(this[0].form)},e.ui.formResetMixin={_formResetHandler:function(){var t=e(this);setTimeout(function(){var i=t.data("ui-form-reset-instances");e.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var e=this.form.data("ui-form-reset-instances")||[];e.length||this.form.on("reset.ui-form-reset",this._formResetHandler),e.push(this),this.form.data("ui-form-reset-instances",e)}},_unbindFormResetHandler:function(){if(this.form.length){var t=this.form.data("ui-form-reset-instances");t.splice(e.inArray(this,t),1),t.length?this.form.data("ui-form-reset-instances",t):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===e.fn.jquery.substring(0,3)&&(e.each(["Width","Height"],function(t,i){function s(t,i,s,n){return e.each(a,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),n&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var a="Width"===i?["Left","Right"]:["Top","Bottom"],n=i.toLowerCase(),r={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?r["inner"+i].call(this):this.each(function(){e(this).css(n,s(this,t)+"px")})},e.fn["outer"+i]=function(t,a){return"number"!=typeof t?r["outer"+i].call(this,t):this.each(function(){e(this).css(n,s(this,t,!0,a)+"px")})}}),e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},e.ui.escapeSelector=function(){var e=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(t){return t.replace(e,"\\$1")}}(),e.fn.labels=function(){var t,i,s,a,n;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(a=this.eq(0).parents("label"),(s=this.attr("id"))&&(n=(t=this.eq(0).parents().last()).add(t.length?t.siblings():this.siblings()),i="label[for='"+e.ui.escapeSelector(s)+"']",a=a.add(n.find(i).addBack(i))),this.pushStack(a))},e.fn.scrollParent=function(t){var i=this.css("position"),s="absolute"===i,a=t?/(auto|scroll|hidden)/:/(auto|scroll)/,n=this.parents().filter(function(){var t=e(this);return(!s||"static"!==t.css("position"))&&a.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&n.length?n:e(this[0].ownerDocument||document)},e.extend(e.expr[":"],{tabbable:function(t){var i=e.attr(t,"tabindex"),s=null!=i;return(!s||i>=0)&&e.ui.focusable(t,s)}}),e.fn.extend({uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var c=!1;e(document).on("mouseup",function(){c=!1}),e.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).on("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!c){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,a=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(s&&!a&&this._mouseCapture(t)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),c=!0,0)))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)if(t.originalEvent.altKey||t.originalEvent.ctrlKey||t.originalEvent.metaKey||t.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,c=!1,t.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.ui.plugin={add:function(t,i,s){var a,n=e.ui[t].prototype;for(a in s)n.plugins[a]=n.plugins[a]||[],n.plugins[a].push([i,s[a]])},call:function(e,t,i,s){var a,n=e.plugins[t];if(n&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(a=0;n.length>a;a++)e.options[n[a][0]]&&n[a][1].apply(e.element,i)}},e.ui.safeActiveElement=function(e){var t;try{t=e.activeElement}catch(i){t=e.body}return t||(t=e.body),t.nodeName||(t=e.body),t},e.ui.safeBlur=function(t){t&&"body"!==t.nodeName.toLowerCase()&&e(t).trigger("blur")},e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(t){var i=this.options;return!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(t),!this.handle||(this._blurActiveElement(t),this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),0)))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=e.ui.safeActiveElement(this.document[0]);e(t.target).closest(i).length||e.ui.safeBlur(i)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(!1===this._trigger("drag",t,s))return this._mouseUp(new e.Event("mouseup",t)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",t)&&i._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),a=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return a.parents("body").length||a.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&a[0]===this.element[0]&&this._setPositionRelative(),a[0]===this.element[0]||/(fixed|absolute)/.test(a.css("position"))||a.css("position","absolute"),a},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,a=this.options,n=this.document[0];return this.relativeContainer=null,a.containment?"window"===a.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===a.containment?void(this.containment=[0,0,e(n).width()-this.helperProportions.width-this.margins.left,(e(n).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):a.containment.constructor===Array?void(this.containment=a.containment):("parent"===a.containment&&(a.containment=this.helper[0].parentNode),void((s=(i=e(a.containment))[0])&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,a,n,r=this.options,o=this._isRootNode(this.scrollParent[0]),l=e.pageX,c=e.pageY;return o&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),r.grid&&(a=r.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,c=i?a-this.offset.click.top>=i[1]||a-this.offset.click.top>i[3]?a:a-this.offset.click.top>=i[1]?a-r.grid[1]:a+r.grid[1]:a,n=r.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,l=i?n-this.offset.click.left>=i[0]||n-this.offset.click.left>i[2]?n:n-this.offset.click.left>=i[0]?n-r.grid[0]:n+r.grid[0]:n),"y"===r.axis&&(l=this.originalPageX),"x"===r.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:o?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:o?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var a=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,a))})},stop:function(t,i,s){var a=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,a))})},drag:function(t,i,s){e.each(s.sortables,function(){var a=!1,n=this;n.positionAbs=s.positionAbs,n.helperProportions=s.helperProportions,n.offset.click=s.offset.click,n._intersectsWith(n.containerCache)&&(a=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==n&&this._intersectsWith(this.containerCache)&&e.contains(n.element[0],this.element[0])&&(a=!1),a})),a?(n.isOver||(n.isOver=1,s._parent=i.helper.parent(),n.currentItem=i.helper.appendTo(n.element).data("ui-sortable-item",!0),n.options._helper=n.options.helper,n.options.helper=function(){return i.helper[0]},t.target=n.currentItem[0],n._mouseCapture(t,!0),n._mouseStart(t,!0,!0),n.offset.click.top=s.offset.click.top,n.offset.click.left=s.offset.click.left,n.offset.parent.left-=s.offset.parent.left-n.offset.parent.left,n.offset.parent.top-=s.offset.parent.top-n.offset.parent.top,s._trigger("toSortable",t),s.dropped=n.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,n.fromOutside=s),n.currentItem&&(n._mouseDrag(t),i.position=n.position)):n.isOver&&(n.isOver=0,n.cancelHelperRemoval=!0,n.options._revert=n.options.revert,n.options.revert=!1,n._trigger("out",t,n._uiHash(n)),n._mouseStop(t,!0),n.options.revert=n.options._revert,n.options.helper=n.options._helper,n.placeholder&&n.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var a=e("body"),n=s.options;a.css("cursor")&&(n._cursor=a.css("cursor")),a.css("cursor",n.cursor)},stop:function(t,i,s){var a=s.options;a._cursor&&e("body").css("cursor",a._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var a=e(i.helper),n=s.options;a.css("opacity")&&(n._opacity=a.css("opacity")),a.css("opacity",n.opacity)},stop:function(t,i,s){var a=s.options;a._opacity&&e(i.helper).css("opacity",a._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var a=s.options,n=!1,r=s.scrollParentNotHidden[0],o=s.document[0];r!==o&&"HTML"!==r.tagName?(a.axis&&"x"===a.axis||(s.overflowOffset.top+r.offsetHeight-t.pageY<a.scrollSensitivity?r.scrollTop=n=r.scrollTop+a.scrollSpeed:t.pageY-s.overflowOffset.top<a.scrollSensitivity&&(r.scrollTop=n=r.scrollTop-a.scrollSpeed)),a.axis&&"y"===a.axis||(s.overflowOffset.left+r.offsetWidth-t.pageX<a.scrollSensitivity?r.scrollLeft=n=r.scrollLeft+a.scrollSpeed:t.pageX-s.overflowOffset.left<a.scrollSensitivity&&(r.scrollLeft=n=r.scrollLeft-a.scrollSpeed))):(a.axis&&"x"===a.axis||(t.pageY-e(o).scrollTop()<a.scrollSensitivity?n=e(o).scrollTop(e(o).scrollTop()-a.scrollSpeed):e(window).height()-(t.pageY-e(o).scrollTop())<a.scrollSensitivity&&(n=e(o).scrollTop(e(o).scrollTop()+a.scrollSpeed))),a.axis&&"y"===a.axis||(t.pageX-e(o).scrollLeft()<a.scrollSensitivity?n=e(o).scrollLeft(e(o).scrollLeft()-a.scrollSpeed):e(window).width()-(t.pageX-e(o).scrollLeft())<a.scrollSensitivity&&(n=e(o).scrollLeft(e(o).scrollLeft()+a.scrollSpeed)))),!1!==n&&e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var a=s.options;s.snapElements=[],e(a.snap.constructor!==String?a.snap.items||":data(ui-draggable)":a.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var a,n,r,o,l,c,h,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,v=m+s.helperProportions.width,b=i.offset.top,y=b+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)c=(l=s.snapElements[d].left-s.margins.left)+s.snapElements[d].width,u=(h=s.snapElements[d].top-s.margins.top)+s.snapElements[d].height,l-g>v||m>c+g||h-g>y||b>u+g||!e.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(a=g>=Math.abs(h-y),n=g>=Math.abs(u-b),r=g>=Math.abs(l-v),o=g>=Math.abs(c-m),a&&(i.position.top=s._convertPositionTo("relative",{top:h-s.helperProportions.height,left:0}).top),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:c}).left)),p=a||n||r||o,"outer"!==f.snapMode&&(a=g>=Math.abs(h-b),n=g>=Math.abs(u-y),r=g>=Math.abs(l-m),o=g>=Math.abs(c-v),a&&(i.position.top=s._convertPositionTo("relative",{top:h,left:0}).top),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:c-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(a||n||r||o||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=a||n||r||o||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var a,n=e.makeArray(e(s.options.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});n.length&&(a=parseInt(e(n[0]).css("zIndex"),10)||0,e(n).each(function(t){e(this).css("zIndex",a+t)}),this.css("zIndex",a+n.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var a=e(i.helper),n=s.options;a.css("zIndex")&&(n._zIndex=a.css("zIndex")),a.css("zIndex",n.zIndex)},stop:function(t,i,s){var a=s.options;a._zIndex&&e(i.helper).css("zIndex",a._zIndex)}}),e.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?void(t=arguments[0]):t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight})},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){this._splice(e.ui.ddmanager.droppables[this.options.scope])},_setOption:function(t,i){"accept"===t?this.accept=e.isFunction(i)?i:function(e){return e.is(i)}:"scope"===t&&(this._splice(e.ui.ddmanager.droppables[this.options.scope]),this._addToManager(i)),this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,a=!1;return!(!s||(s.currentItem||s.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&h(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(a=!0,!1):void 0}),!a&&!!this.accept.call(this.element[0],s.currentItem||s.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",t,this.ui(s)),this.element))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var h=e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,a){if(!i.offset)return!1;var n=(t.positionAbs||t.position.absolute).left+t.margins.left,r=(t.positionAbs||t.position.absolute).top+t.margins.top,o=n+t.helperProportions.width,l=r+t.helperProportions.height,c=i.offset.left,h=i.offset.top,u=c+i.proportions().width,d=h+i.proportions().height;switch(s){case"fit":return n>=c&&u>=o&&r>=h&&d>=l;case"intersect":return n+t.helperProportions.width/2>c&&u>o-t.helperProportions.width/2&&r+t.helperProportions.height/2>h&&d>l-t.helperProportions.height/2;case"pointer":return e(a.pageY,h,i.proportions().height)&&e(a.pageX,c,i.proportions().width);case"touch":return(r>=h&&d>=r||l>=h&&d>=l||h>r&&l>d)&&(n>=c&&u>=n||o>=c&&u>=o||c>n&&o>u);default:return!1}}}();e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var s,a,n=e.ui.ddmanager.droppables[t.options.scope]||[],r=i?i.type:null,o=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;n.length>s;s++)if(!(n[s].options.disabled||t&&!n[s].accept.call(n[s].element[0],t.currentItem||t.element))){for(a=0;o.length>a;a++)if(o[a]===n[s].element[0]){n[s].proportions().height=0;continue e}n[s].visible="none"!==n[s].element.css("display"),n[s].visible&&("mousedown"===r&&n[s]._activate.call(n[s],i),n[s].offset=n[s].element.offset(),n[s].proportions({width:n[s].element[0].offsetWidth,height:n[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&h(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").on("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,a,n,r=h(t,this,this.options.tolerance,i),o=!r&&this.isover?"isout":r&&!this.isover?"isover":null;o&&(this.options.greedy&&(a=this.options.scope,(n=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===a})).length&&((s=e(n[0]).droppable("instance")).greedyChild="isover"===o)),s&&"isover"===o&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[o]=!0,this["isout"===o?"isover":"isout"]=!1,this["isover"===o?"_over":"_out"].call(this,i),s&&"isout"===o&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").off("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},!1!==e.uiBackCompat&&e.widget("ui.droppable",e.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),e.widget("ui.resizable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",a=!1;return t[s]>0||(t[s]=1,a=t[s]>0,t[s]=0,a)},_create:function(){var t,i=this.options,s=this;this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,t={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(t),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(t),this._proportionallyResize()),this._setupHandles(),i.autoHide&&e(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),this.originalElement.css({position:(t=this.element).css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var t,i,s,a,n,r=this.options,o=this;if(this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)a="ui-resizable-"+(t=e.trim(s[i])),n=e("<div>"),this._addClass(n,"ui-resizable-handle "+a),n.css({zIndex:r.zIndex}),this.handles[t]=".ui-resizable-"+t,this.element.append(n);this._renderAxis=function(t){var i,s,a,n;for(i in t=t||this.element,this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),n=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),a=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(a,n),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(t){var i,s,a=!1;for(i in this.handles)((s=e(this.handles[i])[0])===t.target||e.contains(s,t.target))&&(a=!0);return!this.options.disabled&&a},_mouseStart:function(t){var i,s,a,n=this.options,r=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),n.containment&&(i+=e(n.containment).scrollLeft()||0,s+=e(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===a?this.axis+"-resize":a),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,a=this.originalMousePosition,n=t.pageX-a.left||0,r=t.pageY-a.top||0,o=this._change[this.axis];return this._updatePrevProperties(),!!o&&(i=o.apply(this,[t,n,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var i,s,a,n,r,o,l,c=this.options,h=this;return this._helper&&(a=(s=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&this._hasScroll(i[0],"left")?0:h.sizeDiff.height,n=s?0:h.sizeDiff.width,r={width:h.helper.width()-n,height:h.helper.height()-a},o=parseFloat(h.element.css("left"))+(h.position.left-h.originalPosition.left)||null,l=parseFloat(h.element.css("top"))+(h.position.top-h.originalPosition.top)||null,c.animate||this.element.css(e.extend(r,{top:l,left:o})),h.helper.height(h.size.height),h.helper.width(h.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,a,n,r=this.options;n={minWidth:this._isNumber(r.minWidth)?r.minWidth:0,maxWidth:this._isNumber(r.maxWidth)?r.maxWidth:1/0,minHeight:this._isNumber(r.minHeight)?r.minHeight:0,maxHeight:this._isNumber(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||e)&&(s=n.minWidth/this.aspectRatio,i=n.maxHeight*this.aspectRatio,a=n.maxWidth/this.aspectRatio,(t=n.minHeight*this.aspectRatio)>n.minWidth&&(n.minWidth=t),s>n.minHeight&&(n.minHeight=s),n.maxWidth>i&&(n.maxWidth=i),n.maxHeight>a&&(n.maxHeight=a)),this._vBoundaries=n},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,a=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,n=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,r=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,o=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,c=/sw|nw|w/.test(i),h=/nw|ne|n/.test(i);return n&&(e.width=t.minWidth),r&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),a&&(e.height=t.maxHeight),n&&c&&(e.left=o-t.minWidth),s&&c&&(e.left=o-t.maxWidth),r&&h&&(e.top=l-t.minHeight),a&&h&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],a=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseFloat(s[t])||0,i[t]+=parseFloat(a[t])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.options;this.elementOffset=this.element.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++t.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){return{left:this.originalPosition.left+t,width:this.originalSize.width-t}},n:function(e,t,i){return{top:this.originalPosition.top+i,height:this.originalSize.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,a=i._proportionallyResizeElements,n=a.length&&/textarea/i.test(a[0].nodeName),r=n&&i._hasScroll(a[0],"left")?0:i.sizeDiff.height,o={width:i.size.width-(n?0:i.sizeDiff.width),height:i.size.height-r},l=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(o,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};a&&a.length&&e(a[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,a,n,r,o,l=e(this).resizable("instance"),c=l.element,h=l.options.containment,u=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;u&&(l.containerElement=e(u),/document/.test(h)||h===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(u),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=l._num(t.css("padding"+s))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=l.containerOffset,a=l.containerSize.height,n=l.containerSize.width,r=l._hasScroll(u,"left")?u.scrollWidth:n,o=l._hasScroll(u)?u.scrollHeight:a,l.parentData={element:u,left:s.left,top:s.top,width:r,height:o}))},resize:function(t){var i,s,a,n,r=e(this).resizable("instance"),o=r.options,l=r.containerOffset,c=r.position,h=r._aspectRatio||t.shiftKey,u={top:0,left:0},d=r.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),c.left<(r._helper?l.left:0)&&(r.size.width=r.size.width+(r._helper?r.position.left-l.left:r.position.left-u.left),h&&(r.size.height=r.size.width/r.aspectRatio,p=!1),r.position.left=o.helper?l.left:0),c.top<(r._helper?l.top:0)&&(r.size.height=r.size.height+(r._helper?r.position.top-l.top:r.position.top),h&&(r.size.width=r.size.height*r.aspectRatio,p=!1),r.position.top=r._helper?l.top:0),a=r.containerElement.get(0)===r.element.parent().get(0),n=/relative|absolute/.test(r.containerElement.css("position")),a&&n?(r.offset.left=r.parentData.left+r.position.left,r.offset.top=r.parentData.top+r.position.top):(r.offset.left=r.element.offset().left,r.offset.top=r.element.offset().top),i=Math.abs(r.sizeDiff.width+(r._helper?r.offset.left-u.left:r.offset.left-l.left)),s=Math.abs(r.sizeDiff.height+(r._helper?r.offset.top-u.top:r.offset.top-l.top)),i+r.size.width>=r.parentData.width&&(r.size.width=r.parentData.width-i,h&&(r.size.height=r.size.width/r.aspectRatio,p=!1)),s+r.size.height>=r.parentData.height&&(r.size.height=r.parentData.height-s,h&&(r.size.width=r.size.height*r.aspectRatio,p=!1)),p||(r.position.left=r.prevPosition.left,r.position.top=r.prevPosition.top,r.size.width=r.prevSize.width,r.size.height=r.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,a=t.containerPosition,n=t.containerElement,r=e(t.helper),o=r.offset(),l=r.outerWidth()-t.sizeDiff.width,c=r.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(n.css("position"))&&e(this).css({left:o.left-a.left-s.left,width:l,height:c}),t._helper&&!i.animate&&/static/.test(n.css("position"))&&e(this).css({left:o.left-a.left-s.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance");e(t.options.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseFloat(t.width()),height:parseFloat(t.height()),left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))})})},resize:function(t,i){var s=e(this).resizable("instance"),a=s.originalSize,n=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-n.top||0,left:s.position.left-n.left||0};e(s.options.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),a={},n=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(n,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(a[t]=i||null)}),t.css(a)})},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),t._addClass(t.ghost,"ui-resizable-ghost"),!1!==e.uiBackCompat&&"string"==typeof t.options.ghost&&t.ghost.addClass(this.options.ghost),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,a=i.size,n=i.originalSize,r=i.originalPosition,o=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,c=l[0]||1,h=l[1]||1,u=Math.round((a.width-n.width)/c)*c,d=Math.round((a.height-n.height)/h)*h,p=n.width+u,f=n.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,b=s.minHeight&&s.minHeight>f;s.grid=l,v&&(p+=c),b&&(f+=h),g&&(p-=c),m&&(f-=h),/^(se|s|e)$/.test(o)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(o)?(i.size.width=p,i.size.height=f,i.position.top=r.top-d):/^(sw)$/.test(o)?(i.size.width=p,i.size.height=f,i.position.left=r.left-u):((0>=f-h||0>=p-c)&&(t=i._getPaddingPlusBorderDimensions(this)),f-h>0?(i.size.height=f,i.position.top=r.top-d):(i.size.height=f=h-t.height,i.position.top=r.top+n.height-f),p-c>0?(i.size.width=p,i.position.left=r.left-u):(i.size.width=p=c-t.width,i.position.left=r.left+n.width-p))}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t.elementPos=e(t.element[0]).offset(),t.selectees=e(t.options.filter,t.element[0]),t._addClass(t.selectees,"ui-selectee"),t.selectees.each(function(){var i=e(this),s=i.offset(),a={left:s.left-t.elementPos.left,top:s.top-t.elementPos.top};e.data(this,"selectable-item",{element:this,$element:i,left:a.left,top:a.top,right:a.left+i.outerWidth(),bottom:a.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=e("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.elementPos=e(this.element[0]).offset(),this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,a=e.data(this,"selectable-item");return a?(s=!t.metaKey&&!t.ctrlKey||!a.$element.hasClass("ui-selected"),i._removeClass(a.$element,s?"ui-unselecting":"ui-selected")._addClass(a.$element,s?"ui-selecting":"ui-unselecting"),a.unselecting=!s,a.selecting=s,a.selected=s,s?i._trigger("selecting",t,{selecting:a.element}):i._trigger("unselecting",t,{unselecting:a.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,a=this.options,n=this.opos[0],r=this.opos[1],o=t.pageX,l=t.pageY;return n>o&&(i=o,o=n,n=i),r>l&&(i=l,l=r,r=i),this.helper.css({left:n,top:r,width:o-n,height:l-r}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),c=!1,h={};i&&i.element!==s.element[0]&&(h.left=i.left+s.elementPos.left,h.right=i.right+s.elementPos.left,h.top=i.top+s.elementPos.top,h.bottom=i.bottom+s.elementPos.top,"touch"===a.tolerance?c=!(h.left>o||n>h.right||h.top>l||r>h.bottom):"fit"===a.tolerance&&(c=h.left>n&&o>h.right&&h.top>r&&l>h.bottom),c?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){var t=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),e.each(this.items,function(){t._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,a=!1,n=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")===n?(s=e(this),!1):void 0}),e.data(t.target,n.widgetName+"-item")===n&&(s=e(t.target)),!s||this.options.handle&&!i&&(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(a=!0)}),!a)||(this.currentItem=s,this._removeCurrentsFromItems(),0)))},_mouseStart:function(t,i,s){var a,n,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",r.cursor),this.storedStylesheet=e("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(n)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(a=this.containers.length-1;a>=0;a--)this.containers[a]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,a,n,r=this.options,o=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(t.pageY-this.document.scrollTop()<r.scrollSensitivity?o=this.document.scrollTop(this.document.scrollTop()-r.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<r.scrollSensitivity&&(o=this.document.scrollTop(this.document.scrollTop()+r.scrollSpeed)),t.pageX-this.document.scrollLeft()<r.scrollSensitivity?o=this.document.scrollLeft(this.document.scrollLeft()-r.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<r.scrollSensitivity&&(o=this.document.scrollLeft(this.document.scrollLeft()+r.scrollSpeed))),!1!==o&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(a=(s=this.items[i]).item[0],(n=this._intersectsWithPointer(s))&&s.instance===this.currentContainer&&a!==this.currentItem[0]&&this.placeholder[1===n?"next":"prev"]()[0]!==a&&!e.contains(this.placeholder[0],a)&&("semi-dynamic"!==this.options.type||!e.contains(this.element[0],a))){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,a=this.placeholder.offset(),n=this.options.axis,r={};n&&"x"!==n||(r.left=a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(r.top=a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(r,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new e.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=this.positionAbs.top,s=e.left,a=s+e.width,n=e.top,r=n+e.height,o=this.offset.click.top,l=this.offset.click.left;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?("x"===this.options.axis||i+o>n&&r>i+o)&&("y"===this.options.axis||t+l>s&&a>t+l):t+this.helperProportions.width/2>s&&a>t+this.helperProportions.width-this.helperProportions.width/2&&i+this.helperProportions.height/2>n&&r>i+this.helperProportions.height-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),a="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width);return!(!s||!a)&&(t=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===t?2:1:t&&("down"===t?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?"right"===a&&i||"left"===a&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){o.push(this)}var s,a,n,r,o=[],l=[],c=this._connectWith();if(c&&t)for(s=c.length-1;s>=0;s--)for(a=(n=e(c[s],this.document[0])).length-1;a>=0;a--)(r=e.data(n[a],this.widgetFullName))&&r!==this&&!r.options.disabled&&l.push([e.isFunction(r.options.items)?r.options.items.call(r.element):e(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r]);for(l.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--)l[s][0].each(i);return e(o)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,a,n,r,o,l,c,h=this.items,u=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(s=(a=e(d[i],this.document[0])).length-1;s>=0;s--)(n=e.data(a[s],this.widgetFullName))&&n!==this&&!n.options.disabled&&(u.push([e.isFunction(n.options.items)?n.options.items.call(n.element[0],t,{item:this.currentItem}):e(n.options.items,n.element),n]),this.containers.push(n));for(i=u.length-1;i>=0;i--)for(r=u[i][1],s=0,c=(o=u[i][0]).length;c>s;s++)(l=e(o[s])).data(this.widgetName+"-item",r),h.push({item:l,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var i,s,a,n;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(s=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(a=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=a.outerWidth(),s.height=a.outerHeight()),n=a.offset(),s.left=n.left,s.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)n=this.containers[i].element.offset(),this.containers[i].containerCache.left=n.left,this.containers[i].containerCache.top=n.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,s=(t=t||this).options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),a=e("<"+s+">",t.document[0]);return t._addClass(a,"ui-sortable-placeholder",i||t.currentItem[0].className)._removeClass(a,"ui-sortable-helper"),"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(a)):"tr"===s?t._createTrPlaceholder(t.currentItem,a):"img"===s&&a.attr("src",t.currentItem.attr("src")),i||a.css("visibility","hidden"),a},update:function(e,a){(!i||s.forcePlaceholderSize)&&(a.height()||a.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,a,n,r,o,l,c,h,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&e.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(a=1e4,n=null,r=(h=d.floating||this._isFloating(this.currentItem))?"left":"top",o=h?"width":"height",u=h?"pageX":"pageY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[r],c=!1,t[u]-l>this.items[s][o]/2&&(c=!0),a>Math.abs(t[u]-l)&&(a=Math.abs(t[u]-l),n=this.items[s],this.direction=c?"up":"down"));if(!n&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));n?this._rearrange(t,n,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,a=this.options;"parent"===a.containment&&(a.containment=this.helper[0].parentNode),("document"===a.containment||"window"===a.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===a.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===a.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(a.containment)||(t=e(a.containment)[0],i=e(a.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:a.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:a.scrollLeft())*s}},_generatePosition:function(t){var i,s,a=this.options,n=t.pageX,r=t.pageY,o="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(o[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),a.grid&&(i=this.originalPageY+Math.round((r-this.originalPageY)/a.grid[1])*a.grid[1],r=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-a.grid[1]:i+a.grid[1]:i,s=this.originalPageX+Math.round((n-this.originalPageX)/a.grid[0])*a.grid[0],n=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-a.grid[0]:s+a.grid[0]:s)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:o.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:o.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay(function(){a===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,a=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&a.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||a.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(a.push(function(e){this._trigger("remove",e,this._uiHash())}),a.push((function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}).call(this,this.currentContainer)),a.push((function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}).call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||a.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(a.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;a.length>s;s++)a[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),t.collapsible||!1!==t.active&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t,i,s=this.options.icons;s&&(t=e("<span>"),this._addClass(t,"ui-accordion-header-icon","ui-icon "+s.header),t.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?void this._activate(t):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),void("icons"===e&&(this._destroyIcons(),t&&this._createIcons())))},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e),this._toggleClass(null,"ui-state-disabled",!!e),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!e)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,a=this.headers.index(t.target),n=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:n=this.headers[(a+1)%s];break;case i.LEFT:case i.UP:n=this.headers[(a-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:n=this.headers[0];break;case i.END:n=this.headers[s-1]}n&&(e(t.target).attr("tabIndex",-1),e(n).attr("tabIndex",0),e(n).trigger("focus"),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().trigger("focus")},refresh:function(){var t=this.options;this._processPanels(),!1===t.active&&!0===t.collapsible||!this.headers.length?(t.active=!1,this.active=e()):!1===t.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,s=i.heightStyle,a=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),s=t.next(),a=s.uniqueId().attr("id");t.attr("aria-controls",a),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(t=a.height(),this.element.siblings(":visible").each(function(){var i=e(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===s&&(t=0,this.headers.next().each(function(){var i=e(this).is(":visible");i||e(this).show(),t=Math.max(t,e(this).css("height","").height()),i||e(this).hide()}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&this._eventHandler({target:i=i||this.active[0],currentTarget:i,preventDefault:e.noop})},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i,s,a=this.options,n=this.active,r=e(t.currentTarget),o=r[0]===n[0],l=o&&a.collapsible,c=l?e():r.next(),h=n.next(),u={oldHeader:n,oldPanel:h,newHeader:l?e():r,newPanel:c};t.preventDefault(),o&&!a.collapsible||!1===this._trigger("beforeActivate",t,u)||(a.active=!l&&this.headers.index(r),this.active=o?e():r,this._toggle(u),this._removeClass(n,"ui-accordion-header-active","ui-state-active"),a.icons&&(i=n.children(".ui-accordion-header-icon"),this._removeClass(i,null,a.icons.activeHeader)._addClass(i,null,a.icons.header)),o||(this._removeClass(r,"ui-accordion-header-collapsed")._addClass(r,"ui-accordion-header-active","ui-state-active"),a.icons&&(s=r.children(".ui-accordion-header-icon"),this._removeClass(s,null,a.icons.header)._addClass(s,null,a.icons.activeHeader)),this._addClass(r.next(),"ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,t,i){var s,a,n,r=this,o=0,l=e.css("box-sizing"),c=e.length&&(!t.length||e.index()<t.index()),h=this.options.animate||{},u=c&&h.down||h,d=function(){r._toggleComplete(i)};return"number"==typeof u&&(n=u),"string"==typeof u&&(a=u),a=a||u.easing||h.easing,n=n||u.duration||h.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:n,easing:a,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(this.showProps,{duration:n,easing:a,complete:d,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===l&&(o+=i.now):"content"!==r.options.heightStyle&&(i.now=Math.round(s-t.outerHeight()-o),o=0)}})):t.animate(this.hideProps,n,a,d):e.animate(this.showProps,n,a,d)},_toggleComplete:function(e){var t=e.oldPanel,i=t.prev();this._removeClass(t,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target),s=e(e.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.target).closest(".ui-menu-item"),s=e(t.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(t,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){!e.contains(this.element[0],e.ui.safeActiveElement(this.document[0]))&&this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){var t=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),t.children().each(function(){var t=e(this);t.data("ui-menu-submenu-caret")&&t.remove()})},_keydown:function(t){var i,s,a,n,r=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:r=!1,s=this.previousFilter||"",n=!1,a=t.keyCode>=96&&105>=t.keyCode?""+(t.keyCode-96):String.fromCharCode(t.keyCode),clearTimeout(this.filterTimer),a===s?n=!0:a=s+a,i=this._filterMenuItems(a),(i=n&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(a=String.fromCharCode(t.keyCode),i=this._filterMenuItems(a)),i.length?(this.focus(t,i),this.previousFilter=a,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}r&&t.preventDefault()},_activate:function(e){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i,s,a,n=this,r=this.options.icons.submenu,o=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),i=o.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.prev(),s=e("<span>").data("ui-menu-submenu-caret",!0);n._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),this._addClass(i,"ui-menu","ui-widget ui-widget-content ui-front"),(t=o.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var t=e(this);n._isDivider(t)&&n._addClass(t,"ui-menu-divider","ui-widget-content")}),a=(s=t.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(s,"ui-menu-item")._addClass(a,"ui-menu-item-wrapper"),t.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){if("icons"===e){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,t.submenu)}this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e+""),this._toggleClass(null,"ui-state-disabled",!!e)},focus:function(e,t){var i,s,a;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),a=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(a,null,"ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,a,n,r,o;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,a=t.offset().top-this.activeMenu.offset().top-i-s,n=this.activeMenu.scrollTop(),r=this.activeMenu.height(),o=t.outerHeight(),0>a?this.activeMenu.scrollTop(n+a):a+o>r&&this.activeMenu.scrollTop(n+a-r+o))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",e,{item:this.active}),this.active=null)},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,a;return this.active?void(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,a=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return 0>(i=e(this)).offset().top-s-a}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var i,s,a;return this.active?void(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,a=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(i=e(this)).offset().top-s+a>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).children(".ui-menu-item-wrapper").text()))})}}),e.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,a=this.element[0].nodeName.toLowerCase(),n="textarea"===a,r="input"===a;this.isMultiLine=n||!r&&this._isContentEditable(this.element),this.valueMethod=this.element[n||r?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(a){if(this.element.prop("readOnly"))return t=!0,s=!0,void(i=!0);t=!1,s=!1,i=!1;var n=e.ui.keyCode;switch(a.keyCode){case n.PAGE_UP:t=!0,this._move("previousPage",a);break;case n.PAGE_DOWN:t=!0,this._move("nextPage",a);break;case n.UP:t=!0,this._keyEvent("previous",a);break;case n.DOWN:t=!0,this._keyEvent("next",a);break;case n.ENTER:this.menu.active&&(t=!0,a.preventDefault(),this.menu.select(a));break;case n.TAB:this.menu.active&&this.menu.select(a);break;case n.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(a),a.preventDefault());break;default:i=!0,this._searchTimeout(a)}},keypress:function(s){if(t)return t=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault());if(!i){var a=e.ui.keyCode;switch(s.keyCode){case a.PAGE_UP:this._move("previousPage",s);break;case a.PAGE_DOWN:this._move("nextPage",s);break;case a.UP:this._keyEvent("previous",s);break;case a.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==e.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(t,i){var s,a;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)})):(a=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:a})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(a.value),void((s=i.item.attr("aria-label")||a.value)&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion))))},menuselect:function(t,i){var s=i.item.data("ui-autocomplete-item"),a=this.previous;this.element[0]!==e.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=a,this._delay(function(){this.previous=a,this.selectedItem=s})),!1!==this._trigger("select",t,{item:s})&&this._value(s.value),this.term=this._value(),this.close(t),this.selectedItem=s}}),this.liveRegion=e("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(t){var i=this.menu.element[0];return t.target===this.element[0]||t.target===i||e.contains(i,t.target)},_closeOnClickOutside:function(e){this._isEventTargetInWidget(e)||this.close()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,a){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){a(e)},error:function(){a([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible");(!t||t&&!i&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<div>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())},_isContentEditable:function(e){if(!e.length)return!1;var t=e.prop("contentEditable");return"inherit"===t?this._isContentEditable(e.parent()):"true"===t}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}});var u,d=/ui-corner-([a-z]){2,6}/g;e.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var t=this,i=[];e.each(this.options.items,function(s,a){var n,r={};return a?"controlgroupLabel"===s?((n=t.element.find(a)).each(function(){var t=e(this);t.children(".ui-controlgroup-label-contents").length||t.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),t._addClass(n,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(n.get()))):void(e.fn[s]&&(r=t["_"+s+"Options"]?t["_"+s+"Options"]("middle"):{classes:{}},t.element.find(a).each(function(){var a=e(this),n=a[s]("instance"),o=e.widget.extend({},r);if("button"!==s||!a.parent(".ui-spinner").length){n||(n=a[s]()[s]("instance")),n&&(o.classes=t._resolveClassesValues(o.classes,n)),a[s](o);var l=a[s]("widget");e.data(l[0],"ui-controlgroup-data",n||a[s]("instance")),i.push(l[0])}}))):void 0}),this.childWidgets=e(e.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(t){this.childWidgets.each(function(){var i=e(this).data("ui-controlgroup-data");i&&i[t]&&i[t]()})},_updateCornerClass:function(e,t){var i=this._buildSimpleOptions(t,"label").classes.label;this._removeClass(e,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(e,null,i)},_buildSimpleOptions:function(e,t){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[t]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[e],s},_spinnerOptions:function(e){var t=this._buildSimpleOptions(e,"ui-spinner");return t.classes["ui-spinner-up"]="",t.classes["ui-spinner-down"]="",t},_buttonOptions:function(e){return this._buildSimpleOptions(e,"ui-button")},_checkboxradioOptions:function(e){return this._buildSimpleOptions(e,"ui-checkboxradio-label")},_selectmenuOptions:function(e){var t="vertical"===this.options.direction;return{width:!!t&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(t?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(t?"top":"left")},last:{"ui-selectmenu-button-open":t?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(t?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[e]}},_resolveClassesValues:function(t,i){var s={};return e.each(t,function(a){var n=i.options.classes[a]||"";n=e.trim(n.replace(d,"")),s[a]=(n+" "+t[a]).replace(/\s+/g," ")}),s},_setOption:function(e,t){return"direction"===e&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(e,t),"disabled"===e?void this._callChildMethod(t?"disable":"enable"):void this.refresh()},refresh:function(){var t,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),t=this.childWidgets,this.options.onlyVisible&&(t=t.filter(":visible")),t.length&&(e.each(["first","last"],function(e,s){var a=t[s]().data("ui-controlgroup-data");if(a&&i["_"+a.widgetName+"Options"]){var n=i["_"+a.widgetName+"Options"](1===t.length?"only":s);n.classes=i._resolveClassesValues(n.classes,a),a.element[a.widgetName](n)}else i._updateCornerClass(t[s](),s)}),this._callChildMethod("refresh"))}}),e.widget("ui.checkboxradio",[e.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var t,i,s=this,a=this._super()||{};return this._readType(),i=this.element.labels(),this.label=e(i[i.length-1]),this.label.length||e.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?e(this).text():this.outerHTML}),this.originalLabel&&(a.label=this.originalLabel),null!=(t=this.element[0].disabled)&&(a.disabled=t),a},_create:function(){var e=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),e&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var t=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===t&&/radio|checkbox/.test(this.type)||e.error("Can't create checkboxradio on element.nodeName="+t+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var t=this.element[0].name,i="input[name='"+e.ui.escapeSelector(t)+"']";return t?(this.form.length?e(this.form[0].elements).filter(i):e(i).filter(function(){return 0===e(this).form().length})).not(this.element):e([])},_toggleClasses:function(){var t=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",t)._toggleClass(this.icon,null,"ui-icon-blank",!t),"radio"===this.type&&this._getRadioGroup().each(function(){var t=e(this).checkboxradio("instance");t&&t._removeClass(t.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(e,t){return"label"!==e||t?(this._super(e,t),"disabled"===e?(this._toggleClass(this.label,null,"ui-state-disabled",t),void(this.element[0].disabled=t)):void this.refresh()):void 0},_updateIcon:function(t){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=e("<span>"),this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=t?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,t?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),t||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var e=this.label.contents().not(this.element[0]);this.icon&&(e=e.not(this.icon[0])),this.iconSpace&&(e=e.not(this.iconSpace[0])),e.remove(),this.label.append(this.options.label)},refresh:function(){var e=this.element[0].checked,t=this.element[0].disabled;this._updateIcon(e),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),null!==this.options.label&&this._updateLabel(),t!==this.options.disabled&&this._setOptions({disabled:t})}}]),e.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var e,t=this._super()||{};return this.isInput=this.element.is("input"),null!=(e=this.element[0].disabled)&&(t.disabled=e),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(t.label=this.originalLabel),t},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(t){t.keyCode===e.ui.keyCode.SPACE&&(t.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(t,i){var s="iconPosition"!==t,a=s?this.options.iconPosition:i,n="top"===a||"bottom"===a;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=e("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(a),n?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(a))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(e){this.icon[/^(?:end|bottom)/.test(e)?"before":"after"](this.iconSpace)},_attachIcon:function(e){this.element[/^(?:end|bottom)/.test(e)?"append":"prepend"](this.icon)},_setOptions:function(e){(void 0===e.showLabel?this.options.showLabel:e.showLabel)||(void 0===e.icon?this.options.icon:e.icon)||(e.showLabel=!0),this._super(e)},_setOption:function(e,t){"icon"===e&&(t?this._updateIcon(e,t):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===e&&this._updateIcon(e,t),"showLabel"===e&&(this._toggleClass("ui-button-icon-only",null,!t),this._updateTooltip()),"label"===e&&(this.isInput?this.element.val(t):(this.element.html(t),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(e,t),"disabled"===e&&(this._toggleClass(null,"ui-state-disabled",t),this.element[0].disabled=t,t&&this.element.blur())},refresh:function(){var e=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOptions({disabled:e}),this._updateTooltip()}}),!1!==e.uiBackCompat&&(e.widget("ui.button",e.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(e,t){return"text"===e?void this._super("showLabel",t):("showLabel"===e&&(this.options.text=t),"icon"===e&&(this.options.icons.primary=t),"icons"===e&&(t.primary?(this._super("icon",t.primary),this._super("iconPosition","beginning")):t.secondary&&(this._super("icon",t.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),e.fn.button=function(t){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?t.apply(this,arguments):(e.ui.checkboxradio||e.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(e.fn.button),e.fn.buttonset=function(){return e.ui.controlgroup||e.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),e.extend(e.ui,{datepicker:{version:"1.12.1"}}),e.extend(t.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return n(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,a,n;a="div"===(s=t.nodeName.toLowerCase())||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(n=this._newInst(e(t),a)).settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,n):a&&this._inlineDatepicker(t,n)},_newInst:function(t,i){return{id:t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?s(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,a,n,r=this._get(i,"appendText"),o=this._get(i,"isRTL");i.append&&i.append.remove(),r&&(i.append=e("<span class='"+this._appendClass+"'>"+r+"</span>"),t[o?"before":"after"](i.append)),t.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),("focus"===(s=this._get(i,"showOn"))||"both"===s)&&t.on("focus",this._showDatepicker),("button"===s||"both"===s)&&(a=this._get(i,"buttonText"),n=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:n,alt:a,title:a}):e("<button type='button'></button>").addClass(this._triggerClass).html(n?e("<img/>").attr({src:n,alt:a,title:a}):a)),t[o?"before":"after"](i.trigger),i.trigger.on("click",function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,a,n=new Date(2009,11,20),r=this._get(e,"dateFormat");r.match(/[DM]/)&&(n.setMonth((t=function(e){for(i=0,s=0,a=0;e.length>a;a++)e[a].length>i&&(i=e[a].length,s=a);return s})(this._get(e,r.match(/MM/)?"monthNames":"monthNamesShort"))),n.setDate(t(this._get(e,r.match(/DD/)?"dayNames":"dayNamesShort"))+20-n.getDay())),e.input.attr("size",this._formatDate(e,n).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,a,r){var o,l,c,h,u=this._dialogInst;return u||(this.uuid+=1,this._dialogInput=e("<input type='text' id='dp"+this.uuid+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),e("body").append(this._dialogInput),(u=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",u)),n(u.settings,a||{}),i=i&&i.constructor===Date?this._formatDate(u,i):i,this._dialogInput.val(i),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,this._pos||(o=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[o/2-100+c,l/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),u.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",u),this},_destroyDatepicker:function(t){var i,s=e(t),a=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(a.append.remove(),a.trigger.remove(),s.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty(),u===a&&(u=null))},_enableDatepicker:function(t){var i,s,a=e(t),n=e.data(t,"datepicker");a.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&((s=a.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,a=e(t),n=e.data(t,"datepicker");a.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&((s=a.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var a,r,o,l,c=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):c?"all"===i?e.extend({},c.settings):this._get(c,i):null:(a=i||{},"string"==typeof i&&((a={})[i]=s),void(c&&(this._curInst===c&&this._hideDatepicker(),r=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(c,"min"),l=this._getMinMaxDate(c,"max"),n(c.settings,a),null!==o&&void 0!==a.dateFormat&&void 0===a.minDate&&(c.settings.minDate=this._formatDate(c,o)),null!==l&&void 0!==a.dateFormat&&void 0===a.maxDate&&(c.settings.maxDate=this._formatDate(c,l)),"disabled"in a&&(a.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),c),this._autoSize(c),this._setDate(c,r),this._updateAlternate(c),this._updateDatepicker(c))))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,a,n=e.datepicker._getInst(t.target),r=!0,o=n.dpDiv.is(".ui-datepicker-rtl");if(n._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),r=!1;break;case 13:return(a=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",n.dpDiv))[0]&&e.datepicker._selectDay(t.target,n.selectedMonth,n.selectedYear,a[0]),(i=e.datepicker._get(n,"onSelect"))?(s=e.datepicker._formatDate(n),i.apply(n.input?n.input[0]:null,[s,n])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(n,"stepBigMonths"):-e.datepicker._get(n,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(n,"stepBigMonths"):+e.datepicker._get(n,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),r=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),r=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,o?1:-1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(n,"stepBigMonths"):-e.datepicker._get(n,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),r=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,o?-1:1,"D"),r=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(n,"stepBigMonths"):+e.datepicker._get(n,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),r=t.ctrlKey||t.metaKey;break;default:r=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):r=!1;r&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,a=e.datepicker._getInst(t.target);return e.datepicker._get(a,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(a,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(s){}return!0},_showDatepicker:function(t){var i,s,a,r,o,l,c;"input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),!1!==(a=(s=e.datepicker._get(i,"beforeShow"))?s.apply(t,[t,i]):{})&&(n(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),r=!1,e(t).parents().each(function(){return!(r|="fixed"===e(this).css("position"))}),o={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),o=e.datepicker._checkOffset(i,o,r),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":r?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),c=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",function(e){for(var t,i;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),c):i.dpDiv[l||"show"](l?c:null),e.datepicker._shouldFocusInput(i)&&i.input.trigger("focus"),e.datepicker._curInst=i)))},_updateDatepicker:function(t){this.maxRows=4,u=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&a.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.trigger("focus"),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var a=t.dpDiv.outerWidth(),n=t.dpDiv.outerHeight(),r=t.input?t.input.outerWidth():0,o=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),c=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?a-r:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+o?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+a>l&&l>a?Math.abs(i.left+a-l):0),i.top-=Math.min(i.top,i.top+n>c&&c>n?Math.abs(n+o):0),i},_findPos:function(t){for(var i,s=this._getInst(t),a=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[a?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,s,a,n,r=this._curInst;!r||t&&r!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(r,"showAnim"),s=this._get(r,"duration"),a=function(){e.datepicker._tidyDialog(r)},e.effects&&(e.effects.effect[i]||e.effects[i])?r.dpDiv.hide(i,e.datepicker._get(r,"showOptions"),s,a):r.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,a),i||a(),this._datepickerShowing=!1,(n=this._get(r,"onClose"))&&n.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==s)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var a=e(t),n=this._getInst(a[0]);this._isDisabledDatepicker(a[0])||(this._adjustInstDate(n,i+("M"===s?this._get(n,"showCurrentAtPos"):0),s),this._updateDatepicker(n))},_gotoToday:function(t){var i,s=e(t),a=this._getInst(s[0]);this._get(a,"gotoCurrent")&&a.currentDay?(a.selectedDay=a.currentDay,a.drawMonth=a.selectedMonth=a.currentMonth,a.drawYear=a.selectedYear=a.currentYear):(i=new Date,a.selectedDay=i.getDate(),a.drawMonth=a.selectedMonth=i.getMonth(),a.drawYear=a.selectedYear=i.getFullYear()),this._notifyChange(a),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var a=e(t),n=this._getInst(a[0]);n["selected"+("M"===s?"Month":"Year")]=n["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(n),this._adjustDate(a)},_selectDay:function(t,i,s,a){var n,r=e(t);e(a).hasClass(this._unselectableClass)||this._isDisabledDatepicker(r[0])||((n=this._getInst(r[0])).selectedDay=n.currentDay=e("a",a).html(),n.selectedMonth=n.currentMonth=i,n.selectedYear=n.currentYear=s,this._selectDate(t,this._formatDate(n,n.currentDay,n.currentMonth,n.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,a=e(t),n=this._getInst(a[0]);i=null!=i?i:this._formatDate(n),n.input&&n.input.val(i),this._updateAlternate(n),(s=this._get(n,"onSelect"))?s.apply(n.input?n.input[0]:null,[i,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],"object"!=typeof n.input[0]&&n.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(t){var i,s,a,n=this._get(t,"altField");n&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),a=this.formatDate(i,s,this._getFormatConfig(t)),e(n).val(a))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(""==(i="object"==typeof i?""+i:i+""))return null;var a,n,r,o,l=0,c=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,h="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),u=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,d=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,v=-1,b=-1,y=!1,x=function(e){var i=t.length>a+1&&t.charAt(a+1)===e;return i&&a++,i},w=function(e){var t=x(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,a=RegExp("^\\d{"+("y"===e?s:1)+","+s+"}"),n=i.substring(l).match(a);if(!n)throw"Missing number at position "+l;return l+=n[0].length,parseInt(n[0],10)},S=function(t,s,a){var n=-1,r=e.map(x(t)?a:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(r,function(e,t){var s=t[1];return i.substr(l,s.length).toLowerCase()===s.toLowerCase()?(n=t[0],l+=s.length,!1):void 0}),-1!==n)return n+1;throw"Unknown name at position "+l},C=function(){if(i.charAt(l)!==t.charAt(a))throw"Unexpected literal at position "+l;l++};for(a=0;t.length>a;a++)if(y)"'"!==t.charAt(a)||x("'")?C():y=!1;else switch(t.charAt(a)){case"d":v=w("d");break;case"D":S("D",u,d);break;case"o":b=w("o");break;case"m":m=w("m");break;case"M":m=S("M",p,f);break;case"y":g=w("y");break;case"@":g=(o=new Date(w("@"))).getFullYear(),m=o.getMonth()+1,v=o.getDate();break;case"!":g=(o=new Date((w("!")-this._ticksTo1970)/1e4)).getFullYear(),m=o.getMonth()+1,v=o.getDate();break;case"'":x("'")?C():y=!0;break;default:C()}if(i.length>l&&(r=i.substr(l),!/^\s+/.test(r)))throw"Extra/unparsed characters found in date: "+r;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(h>=g?0:-100)),b>-1)for(m=1,v=b;!((n=this._getDaysInMonth(g,m-1))>=v);)m++,v-=n;if((o=this._daylightSavingAdjust(new Date(g,m-1,v))).getFullYear()!==g||o.getMonth()+1!==m||o.getDate()!==v)throw"Invalid date";return o},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var s,a=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,n=(i?i.dayNames:null)||this._defaults.dayNames,r=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,o=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=e.length>s+1&&e.charAt(s+1)===t;return i&&s++,i},c=function(e,t,i){var s=""+t;if(l(e))for(;i>s.length;)s="0"+s;return s},h=function(e,t,i,s){return l(e)?s[t]:i[t]},u="",d=!1;if(t)for(s=0;e.length>s;s++)if(d)"'"!==e.charAt(s)||l("'")?u+=e.charAt(s):d=!1;else switch(e.charAt(s)){case"d":u+=c("d",t.getDate(),2);break;case"D":u+=h("D",t.getDay(),a,n);break;case"o":u+=c("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=c("m",t.getMonth()+1,2);break;case"M":u+=h("M",t.getMonth(),r,o);break;case"y":u+=l("y")?t.getFullYear():(10>t.getFullYear()%100?"0":"")+t.getFullYear()%100;break;case"@":u+=t.getTime();break;case"!":u+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?u+="'":d=!0;break;default:u+=e.charAt(s)}return u},_possibleChars:function(e){var t,i="",s=!1,a=function(i){var s=e.length>t+1&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;e.length>t;t++)if(s)"'"!==e.charAt(t)||a("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":a("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,a=this._getDefaultDate(e),n=a,o=this._getFormatConfig(e);try{n=this.parseDate(i,s,o)||a}catch(r){s=t?"":s}e.selectedDay=n.getDate(),e.drawMonth=e.selectedMonth=n.getMonth(),e.drawYear=e.selectedYear=n.getFullYear(),e.currentDay=s?n.getDate():0,e.currentMonth=s?n.getMonth():0,e.currentYear=s?n.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var a=null==i||""===i?s:"string"==typeof i?function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(s){}for(var a=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,n=a.getFullYear(),r=a.getMonth(),o=a.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,c=l.exec(i);c;){switch(c[2]||"d"){case"d":case"D":o+=parseInt(c[1],10);break;case"w":case"W":o+=7*parseInt(c[1],10);break;case"m":case"M":r+=parseInt(c[1],10),o=Math.min(o,e.datepicker._getDaysInMonth(n,r));break;case"y":case"Y":n+=parseInt(c[1],10),o=Math.min(o,e.datepicker._getDaysInMonth(n,r))}c=l.exec(i)}return new Date(n,r,o)}(i):"number"==typeof i?isNaN(i)?s:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}(i):new Date(i.getTime());return(a=a&&"Invalid Date"==""+a?s:a)&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,a=e.selectedMonth,n=e.selectedYear,r=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=r.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=r.getMonth(),e.drawYear=e.selectedYear=e.currentYear=r.getFullYear(),a===e.selectedMonth&&n===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).on(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y,x,w,S,C,A,_,k,T,I,M,O,P,D,J,E,L,j,F,R,N,z=new Date,B=this._daylightSavingAdjust(new Date(z.getFullYear(),z.getMonth(),z.getDate())),H=this._get(e,"isRTL"),W=this._get(e,"showButtonPanel"),q=this._get(e,"hideIfNoPrevNext"),G=this._get(e,"navigationAsDateFormat"),$=this._getNumberOfMonths(e),U=this._get(e,"showCurrentAtPos"),X=this._get(e,"stepMonths"),Y=1!==$[0]||1!==$[1],V=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),K=this._getMinMaxDate(e,"min"),Z=this._getMinMaxDate(e,"max"),Q=e.drawMonth-U,ee=e.drawYear;if(0>Q&&(Q+=12,ee--),Z)for(t=this._daylightSavingAdjust(new Date(Z.getFullYear(),Z.getMonth()-$[0]*$[1]+1,Z.getDate())),t=K&&K>t?K:t;this._daylightSavingAdjust(new Date(ee,Q,1))>t;)0>--Q&&(Q=11,ee--);for(e.drawMonth=Q,e.drawYear=ee,i=this._get(e,"prevText"),i=G?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Q-X,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,ee,Q)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"e":"w")+"'>"+i+"</span></a>":q?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"e":"w")+"'>"+i+"</span></a>",a=this._get(e,"nextText"),a=G?this.formatDate(a,this._daylightSavingAdjust(new Date(ee,Q+X,1)),this._getFormatConfig(e)):a,n=this._canAdjustMonth(e,1,ee,Q)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"w":"e")+"'>"+a+"</span></a>":q?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+a+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"w":"e")+"'>"+a+"</span></a>",r=this._get(e,"currentText"),o=this._get(e,"gotoCurrent")&&e.currentDay?V:B,r=G?this.formatDate(r,o,this._getFormatConfig(e)):r,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",c=W?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(H?l:"")+(this._isInRange(e,o)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+r+"</button>":"")+(H?"":l)+"</div>":"",h=parseInt(this._get(e,"firstDay"),10),h=isNaN(h)?0:h,u=this._get(e,"showWeek"),d=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),g=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),b=this._get(e,"selectOtherMonths"),y=this._getDefaultDate(e),x="",S=0;$[0]>S;S++){for(C="",this.maxRows=4,A=0;$[1]>A;A++){if(_=this._daylightSavingAdjust(new Date(ee,Q,e.selectedDay)),k=" ui-corner-all",T="",Y){if(T+="<div class='ui-datepicker-group",$[1]>1)switch(A){case 0:T+=" ui-datepicker-group-first",k=" ui-corner-"+(H?"right":"left");break;case $[1]-1:T+=" ui-datepicker-group-last",k=" ui-corner-"+(H?"left":"right");break;default:T+=" ui-datepicker-group-middle",k=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+k+"'>"+(/all|left/.test(k)&&0===S?H?n:s:"")+(/all|right/.test(k)&&0===S?H?s:n:"")+this._generateMonthYearHeader(e,Q,ee,K,Z,S>0||A>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",I=u?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",w=0;7>w;w++)I+="<th scope='col'"+((w+h+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[M=(w+h)%7]+"'>"+p[M]+"</span></th>";for(T+=I+"</tr></thead><tbody>",O=this._getDaysInMonth(ee,Q),ee===e.selectedYear&&Q===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,O)),P=(this._getFirstDayOfMonth(ee,Q)-h+7)%7,D=Math.ceil((P+O)/7),this.maxRows=J=Y&&this.maxRows>D?this.maxRows:D,E=this._daylightSavingAdjust(new Date(ee,Q,1-P)),L=0;J>L;L++){for(T+="<tr>",j=u?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(E)+"</td>":"",w=0;7>w;w++)F=m?m.apply(e.input?e.input[0]:null,[E]):[!0,""],N=(R=E.getMonth()!==Q)&&!b||!F[0]||K&&K>E||Z&&E>Z,j+="<td class='"+((w+h+6)%7>=5?" ui-datepicker-week-end":"")+(R?" ui-datepicker-other-month":"")+(E.getTime()===_.getTime()&&Q===e.selectedMonth&&e._keyEvent||y.getTime()===E.getTime()&&y.getTime()===_.getTime()?" "+this._dayOverClass:"")+(N?" "+this._unselectableClass+" ui-state-disabled":"")+(R&&!v?"":" "+F[1]+(E.getTime()===V.getTime()?" "+this._currentClass:"")+(E.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(R&&!v||!F[2]?"":" title='"+F[2].replace(/'/g,"&#39;")+"'")+(N?"":" data-handler='selectDay' data-event='click' data-month='"+E.getMonth()+"' data-year='"+E.getFullYear()+"'")+">"+(R&&!v?"&#xa0;":N?"<span class='ui-state-default'>"+E.getDate()+"</span>":"<a class='ui-state-default"+(E.getTime()===B.getTime()?" ui-state-highlight":"")+(E.getTime()===V.getTime()?" ui-state-active":"")+(R?" ui-priority-secondary":"")+"' href='#'>"+E.getDate()+"</a>")+"</td>",E.setDate(E.getDate()+1),E=this._daylightSavingAdjust(E);T+=j+"</tr>"}++Q>11&&(Q=0,ee++),C+=T+="</tbody></table>"+(Y?"</div>"+($[0]>0&&A===$[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}x+=C}return x+=c,e._keyEvent=!1,x},_generateMonthYearHeader:function(e,t,i,s,a,n,r,o){var l,c,h,u,d,p,f,g,m=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),b=this._get(e,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",x="";if(n||!m)x+="<span class='ui-datepicker-month'>"+r[t]+"</span>";else{for(l=s&&s.getFullYear()===i,c=a&&a.getFullYear()===i,x+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",h=0;12>h;h++)(!l||h>=s.getMonth())&&(!c||a.getMonth()>=h)&&(x+="<option value='"+h+"'"+(h===t?" selected='selected'":"")+">"+o[h]+"</option>");x+="</select>"}if(b||(y+=x+(!n&&m&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",n||!v)y+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(e,"yearRange").split(":"),d=(new Date).getFullYear(),f=(p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(t)?d:t})(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=a?Math.min(g,a.getFullYear()):g,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),b&&(y+=(!n&&m&&v?"":"&#xa0;")+x),y+"</div>"},_adjustInstDate:function(e,t,i){var s=e.selectedYear+("Y"===i?t:0),a=e.selectedMonth+("M"===i?t:0),n=Math.min(e.selectedDay,this._getDaysInMonth(s,a))+("D"===i?t:0),r=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,a,n)));e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),a=i&&i>t?i:t;return s&&a>s?s:a},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var a=this._getNumberOfMonths(e),n=this._daylightSavingAdjust(new Date(i,s+(0>t?t:a[0]*a[1]),1));return 0>t&&n.setDate(this._getDaysInMonth(n.getFullYear(),n.getMonth())),this._isInRange(e,n)},_isInRange:function(e,t){var i,s,a=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=null,o=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),s=(new Date).getFullYear(),r=parseInt(i[0],10),o=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(r+=s),i[1].match(/[+\-].*/)&&(o+=s)),(!a||t.getTime()>=a.getTime())&&(!n||t.getTime()<=n.getTime())&&(!r||t.getFullYear()>=r)&&(!o||o>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var a=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),a,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).on("mousedown",e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new t,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.12.1",e.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i=this;this._isOpen&&!1!==this._trigger("beforeClose",t)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||e.ui.safeBlur(e.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",t)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,a=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),n=Math.max.apply(null,a);return n>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",n+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=e(e.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).trigger("focus")},_keepFocus:function(t){function i(){var t=e.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===t||e.contains(this.uiDialog[0],t)||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),a=i.filter(":last");t.target!==a[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){a.trigger("focus")}),t.preventDefault()):(this._delay(function(){s.trigger("focus")}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:e("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(t,"ui-dialog-title"),this._title(t),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title?e.text(this.options.title):e.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(e.each(i,function(i,s){var a,n;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),a=s.click,n={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,e("<button></button>",s).button(n).appendTo(t.uiButtonSet).on("click",function(){a.apply(t.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,a){i._addClass(e(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,t(a))},drag:function(e,s){i._trigger("drag",e,t(s))},stop:function(a,n){var r=n.offset.left-i.document.scrollLeft(),o=n.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" top"+(o>=0?"+":"")+o,of:i.window},i._removeClass(e(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",a,t(n))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,s=this.options,a=s.resizable,n=this.uiDialog.css("position"),r="string"==typeof a?a:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:r,start:function(s,a){i._addClass(e(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,t(a))},resize:function(e,s){i._trigger("resize",e,t(s))},stop:function(a,n){var r=i.uiDialog.offset(),o=r.left-i.document.scrollLeft(),l=r.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" top"+(l>=0?"+":"")+l,of:i.window},i._removeClass(e(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",a,t(n))}}).css("position",n)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||this.document.data("ui-dialog-instances",e=[]),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,a={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(a[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",a)},_setOption:function(t,i){var s,a,n=this.uiDialog;"disabled"!==t&&(this._super(t,i),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:e("<a>").text(""+this.options.closeText).html()}),"draggable"===t&&((s=n.is(":data(ui-draggable)"))&&!i&&n.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&((a=n.is(":data(ui-resizable)"))&&!i&&n.resizable("destroy"),a&&"string"==typeof i&&n.resizable("option","handles",i),a||!1===i||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!1!==e.uiBackCompat&&e.widget("ui.dialog",e.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(e,t){"dialogClass"===e&&this.uiDialog.removeClass(this.options.dialogClass).addClass(t),this._superApply(arguments)}}),e.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=e("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),void this._refreshValue())},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e),this._toggleClass(null,"ui-state-disabled",!!e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,t===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectmenu",[e.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var t=this.element.uniqueId().attr("id");this.ids={element:t,button:t+"-button",menu:t+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=e()},_drawButton:function(){var t,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),t=e("<span>").appendTo(this.button),this._addClass(t,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),!1!==this.options.width&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var s=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&s.index!==t.focusIndex&&(t._trigger("focus",e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr("aria-activedescendant",t.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var e,t=this.element.find("option");this.menu.empty(),this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,t.length&&(e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e)))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(t){var i=e("<span>");return this._setText(i,t.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(t,i){var s=this,a="";e.each(i,function(i,n){var r;n.optgroup!==a&&(r=e("<li>",{text:n.optgroup}),s._addClass(r,"ui-selectmenu-optgroup","ui-menu-divider"+(n.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),r.appendTo(t),a=n.optgroup),s._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var s=e("<li>"),a=e("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(a,i.label),s.append(a).appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,s,a=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),a+=":not(.ui-state-disabled)"),(s="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](a).eq(-1):i[e+"All"](a).eq(0)).length&&this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?((e=window.getSelection()).removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+e.ui.escapeSelector(this.ids.button)).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection()).rangeCount&&(this.range=e.getRangeAt(0)):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex).parent("li");t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(e)),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){if("icons"===e){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,t.button)}this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"width"===e&&this._resizeButton()},_setOptionDisabled:function(e){this._super(e),this.menuInstance.option("disabled",e),this.button.attr("aria-disabled",e),this._toggleClass(this.button,null,"ui-state-disabled",e),this.element.prop("disabled",e),e?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;return!1===e?void this.button.css("width",""):(null===e&&(e=this.element.show().outerWidth(),this.element.hide()),void this.button.outerWidth(e))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var e=this._super();return e.disabled=this.element.prop("disabled"),e},_parseOptions:function(t){var i=this,s=[];t.each(function(t,a){s.push(i._parseOption(e(a),t))}),this.items=s},_parseOption:function(e,t){var i=e.parent("optgroup");return{element:e,index:t,value:e.val(),label:e.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||e.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),e.widget("ui.slider",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,a=this.element.find(".ui-slider-handle"),n=[];for(a.length>(i=s.values&&s.values.length||1)&&(a.slice(i).remove(),a=a.slice(0,i)),t=a.length;i>t;t++)n.push("<span tabindex='0'></span>");this.handles=a.add(e(n.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t).attr("tabIndex",0)})},_createRange:function(){var t=this.options;t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=e("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===t.range||"max"===t.range)&&this._addClass(this.range,"ui-slider-range-"+t.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(t){var i,s,a,n,r,o,l=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i=this._normValueFromMouse({x:t.pageX,y:t.pageY}),s=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var r=Math.abs(i-l.values(t));(s>r||s===r&&(t===l._lastChangedValue||l.values(t)===c.min))&&(s=r,a=e(this),n=t)}),!1!==this._start(t,n)&&(this._mouseSliding=!0,this._handleIndex=n,this._addClass(a,null,"ui-state-active"),a.trigger("focus"),r=a.offset(),o=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=o?{left:0,top:0}:{left:t.pageX-r.left-a.width()/2,top:t.pageY-r.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,n,i),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t=this._normValueFromMouse({x:e.pageX,y:e.pageY});return this._slide(e,this._handleIndex,t),!1},_mouseStop:function(e){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,a,n;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(s=i/t)>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),a=this._valueMax()-this._valueMin(),n=this._valueMin()+s*a,this._trimAlignValue(n)},_uiHash:function(e,t,i){var s={handle:this.handles[e],handleIndex:e,value:void 0!==t?t:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==t?t:this.values(e),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(e,t){return this._trigger("start",e,this._uiHash(t))},_slide:function(e,t,i){var s,a=this.value(),n=this.values();this._hasMultipleValues()&&(s=this.values(t?0:1),a=this.values(t),2===this.options.values.length&&!0===this.options.range&&(i=0===t?Math.min(s,i):Math.max(s,i)),n[t]=i),i!==a&&!1!==this._trigger("slide",e,this._uiHash(t,i,n))&&(this._hasMultipleValues()?this.values(t,i):this.value(i))},_stop:function(e,t){this._trigger("stop",e,this._uiHash(t))},_change:function(e,t){this._keySliding||this._mouseSliding||(this._lastChangedValue=t,this._trigger("change",e,this._uiHash(t)))},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var s,a,n;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this._hasMultipleValues()?this._values(t):this.value();for(s=this.options.values,a=arguments[0],n=0;s.length>n;n+=1)s[n]=this._trimAlignValue(a[n]),this._change(null,n);this._refreshValue()},_setOption:function(t,i){var s,a=0;switch("range"===t&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(a=this.options.values.length),this._super(t,i),t){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=a-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(e){this._super(e),this._toggleClass(null,"ui-state-disabled",!!e)},_value:function(){return this._trimAlignValue(this.options.value)},_values:function(e){var t,i;if(arguments.length)return this._trimAlignValue(this.options.values[e]);if(this._hasMultipleValues()){for(t=this.options.values.slice(),i=0;t.length>i;i+=1)t[i]=this._trimAlignValue(t[i]);return t}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step;(e=Math.round((e-t)/i)*i+t)>this.options.max&&(e-=i),this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(e){"vertical"===e&&this.range.css({width:"",left:""}),"horizontal"===e&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var t,i,s,a,n,r=this.options.range,o=this.options,l=this,c=!this._animateOff&&o.animate,h={};this._hasMultipleValues()?this.handles.each(function(s){i=(l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())*100,h["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[c?"animate":"css"](h,o.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[c?"animate":"css"]({left:i+"%"},o.animate),1===s&&l.range[c?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:o.animate})):(0===s&&l.range.stop(1,1)[c?"animate":"css"]({bottom:i+"%"},o.animate),1===s&&l.range[c?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:o.animate}))),t=i}):(s=this.value(),a=this._valueMin(),n=this._valueMax(),h["horizontal"===this.orientation?"left":"bottom"]=(i=n!==a?(s-a)/(n-a)*100:0)+"%",this.handle.stop(1,1)[c?"animate":"css"](h,o.animate),"min"===r&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:i+"%"},o.animate),"max"===r&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:100-i+"%"},o.animate),"min"===r&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:i+"%"},o.animate),"max"===r&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:100-i+"%"},o.animate))},_handleEvents:{keydown:function(t){var i,s,a,n=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(e(t.target),null,"ui-state-active"),!1===this._start(t,n)))return}switch(a=this.options.step,i=s=this._hasMultipleValues()?this.values(n):this.value(),t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-a)}this._slide(t,n,s)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),this._removeClass(e(t.target),null,"ui-state-active"))}}}),e.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t=this._super(),i=this.element;return e.each(["min","max","step"],function(e,s){var a=i.attr(s);null!=a&&a.length&&(t[s]=a)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",e)))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){this.element[0]===e.ui.safeActiveElement(this.document[0])||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===e.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e)||(this.counter||(this.counter=1),this.spinning=!0,0))},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return i=e-(t=null!==s.min?s.min:0),e=t+(i=Math.round(i/s.step)*s.step),e=parseFloat(e.toFixed(this._precision())),null!==s.max&&e>s.max?s.max:null!==s.min&&s.min>e?s.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){var i,s,a;return"culture"===e||"numberFormat"===e?(i=this._parse(this.element.val()),this.options[e]=t,void this.element.val(this._format(i))):(("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,t.up),a=this.buttons.last().find(".ui-icon"),this._removeClass(a,null,this.options.icons.down),this._addClass(a,null,t.down)),void this._super(e,t))},_setOptionDisabled:function(e){this._super(e),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable")},_setOptions:r(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:r(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:r(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:r(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:r(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?void r(this._value).call(this,e):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),!1!==e.uiBackCompat&&e.widget("ui.spinner",e.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),e.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,a;i=t.href.replace(e,""),a=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(s){}try{a=decodeURIComponent(a)}catch(s){}return t.hash.length>1&&i===a}}(),_create:function(){var t=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&&(s&&this.tabs.each(function(i,a){return e(a).attr("aria-controls")===s?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!i&&0),!i&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(e.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),a=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:a=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(s);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(s!==this.options.active&&s);default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,a),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){for(var s=this.tabs.length-1;-1!==e.inArray((t>s&&(t=0),0>t&&(t=s),t),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).trigger("focus"),e},_setOption:function(e,t){return"active"===e?void this._activate(t):(this._super(e,t),"collapsible"===e&&(this._toggleClass("ui-tabs-collapsible",null,t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,a=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=e(),this.anchors.each(function(i,s){var a,n,r,o=e(s).uniqueId().attr("id"),l=e(s).closest("li"),c=l.attr("aria-controls");t._isLocal(s)?(r=(a=s.hash).substring(1),n=t.element.find(t._sanitizeSelector(a))):(r=l.attr("aria-controls")||e({}).uniqueId()[0].id,(n=t.element.find(a="#"+r)).length||(n=t._createPanel(r)).insertAfter(t.panels[i-1]||t.tablist),n.attr("aria-live","polite")),n.length&&(t.panels=t.panels.add(n)),c&&l.data("ui-tabs-aria-controls",c),l.attr({"aria-controls":r,"aria-labelledby":o}),n.attr("aria-labelledby",o)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(a.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(t){var i,s,a;for(e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1),a=0;s=this.tabs[a];a++)i=e(s),!0===t||-1!==e.inArray(a,t)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=t,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===t)},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();"fill"===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),s=t.css("position");"absolute"!==s&&"fixed"!==s&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,a=e(t.currentTarget).closest("li"),n=a[0]===s[0],r=n&&i.collapsible,o=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),c={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:o};t.preventDefault(),a.hasClass("ui-state-disabled")||a.hasClass("ui-tabs-loading")||this.running||n&&!i.collapsible||!1===this._trigger("beforeActivate",t,c)||(i.active=!r&&this.tabs.index(a),this.active=n?e():a,this.xhr&&this.xhr.abort(),l.length||o.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),o.length&&this.load(this.tabs.index(a),t),this._toggle(t,c))},_toggle:function(t,i){function s(){n.running=!1,n._trigger("activate",t,i)}function a(){n._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),r.length&&n.options.show?n._show(r,n.options.show,s):(r.show(),s())}var n=this,r=i.newPanel,o=i.oldPanel;this.running=!0,o.length&&this.options.hide?this._hide(o,this.options.hide,function(){n._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),a()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),o.hide(),a()),o.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),r.length&&o.length?i.oldTab.attr("tabIndex",-1):r.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),r.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+e.ui.escapeSelector(t)+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;!1!==i&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setOptionDisabled(i))},disable:function(t){var i=this.options.disabled;if(!0!==i){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setOptionDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,a=this.tabs.eq(t),n=a.find(".ui-tabs-anchor"),r=this._getPanelForTab(a),o={tab:a,panel:r},l=function(e,t){"abort"===t&&s.panels.stop(!1,!0),s._removeClass(a,"ui-tabs-loading"),r.removeAttr("aria-busy"),e===s.xhr&&delete s.xhr};this._isLocal(n[0])||(this.xhr=e.ajax(this._ajaxSettings(n,i,o)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(a,"ui-tabs-loading"),r.attr("aria-busy","true"),this.xhr.done(function(e,t,a){setTimeout(function(){r.html(e),s._trigger("load",i,o),l(a,t)},1)}).fail(function(e,t){setTimeout(function(){l(e,t)},1)})))},_ajaxSettings:function(t,i,s){var a=this;return{url:t.attr("href").replace(/#.*$/,""),beforeSend:function(t,n){return a._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:n},s))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),!1!==e.uiBackCompat&&e.widget("ui.tabs",e.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),e.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr("aria-describedby")||"").split(/\s+/);s.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(s.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),s=(t.attr("aria-describedby")||"").split(/\s+/),a=e.inArray(i,s);-1!==a&&s.splice(a,1),t.removeData("ui-tooltip-id"),(s=e.trim(s.join(" ")))?t.attr("aria-describedby",s):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=e([])},_setOption:function(t,i){var s=this;this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){s._updateContent(t.element)})},_setOptionDisabled:function(e){this[e?"_disable":"_enable"]()},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var a=e.Event("blur");a.target=a.currentTarget=s.element[0],t.close(a,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var t=e(this);return t.is("[title]")?t.data("ui-tooltip-title",t.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))}),this.disabledTitles=e([])},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&s.parents().each(function(){var t,s=e(this);s.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,i.close(t,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(t,s),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,a=this,n=t?t.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(t,e,s):void((i=s.call(e[0],function(i){a._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=n),this._open(t,e,i))})}))&&this._open(t,e,i))},_open:function(t,i,s){function a(e){c.of=e,r.is(":hidden")||r.position(c)}var n,r,o,l,c=e.extend({},this.options.position);if(s){if(n=this._find(i))return void n.tooltip.find(".ui-tooltip-content").html(s);i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),n=this._tooltip(i),this._addDescribedBy(i,(r=n.tooltip).attr("id")),r.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),(l=e("<div>").html(r.find(".ui-tooltip-content").html())).removeAttr("name").find("[name]").removeAttr("name"),l.removeAttr("id").find("[id]").removeAttr("id"),l.appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:a}),a(t)):r.position(e.extend({of:i},this.options.position)),r.hide(),this._show(r,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(o=this.delayedShow=setInterval(function(){r.is(":visible")&&(a(c.of),clearInterval(o))},e.fx.interval)),this._trigger("open",t,{tooltip:r})}},_registerCloseHandlers:function(t,i){var s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&&"mouseover"!==t.type||(s.mouseleave="close"),t&&"focusin"!==t.type||(s.focusout="close"),this._on(!0,i,s)},close:function(t){var i,s=this,a=e(t?t.currentTarget:this.element),n=this._find(a);return n?(i=n.tooltip,void(n.closing||(clearInterval(this.delayedShow),a.data("ui-tooltip-title")&&!a.attr("title")&&a.attr("title",a.data("ui-tooltip-title")),this._removeDescribedBy(a),n.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),a.removeData("ui-tooltip-open"),this._off(a,"mouseleave focusout keyup"),a[0]!==this.element[0]&&this._off(a,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete s.parents[t]}),n.closing=!0,this._trigger("close",t,{tooltip:i}),n.hiding||(n.closing=!1)))):void a.removeData("ui-tooltip-open")},_tooltip:function(t){var i=e("<div>").attr("role","tooltip"),s=e("<div>").appendTo(i),a=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(t)),this.tooltips[a]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_appendTo:function(e){var t=e.closest(".ui-front, dialog");return t.length||(t=this.document[0].body),t},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var a=e.Event("blur"),n=s.element;a.target=a.currentTarget=n[0],t.close(a,!0),e("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title")||n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==e.uiBackCompat&&e.widget("ui.tooltip",e.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var e=this._superApply(arguments);return this.options.tooltipClass&&e.tooltip.addClass(this.options.tooltipClass),e}})}),($jscomp={scope:{},findInternal:function(e,t,i){e instanceof String&&(e=String(e));for(var s=e.length,a=0;a<s;a++){var n=e[a];if(t.call(i,n,a,e))return{i:a,v:n}}return{i:-1,v:void 0}}}).defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){if(i.get||i.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=i.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,i,s){if(t){for(i=$jscomp.global,e=e.split("."),s=0;s<e.length-1;s++){var a=e[s];a in i||(i[a]={}),i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&$jscomp.defineProperty(i,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}},"es6-impl","es3"),function(e,t){function i(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}var s;e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement,e.ui&&e.widget||(e.cleanData=(s=e.cleanData,function(t){var i,a,n;for(n=0;null!=t[n];n++){a=t[n];try{(i=e._data(a,"events"))&&i.remove&&e(a).triggerHandler("remove")}catch(r){}}s(t)}));var a,n=null,r=!1,o=e(window),l=0,c={},h={},u={},d={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,hideOnSecondTrigger:!1,selectableSubMenu:!1,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var i=this.offset();i.top+=this.outerHeight(),i.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(i)}},position:function(e,t,i){if(t||i){t="maintain"===t&&"maintain"===i?e.$menu.position():{top:i-(s=e.$menu.offsetParent().offset()).top,left:t-s.left},i=o.scrollTop()+o.height();var s=o.scrollLeft()+o.width(),a=e.$menu.outerHeight(),n=e.$menu.outerWidth();t.top+a>i&&(t.top-=a),0>t.top&&(t.top=0),t.left+n>s&&(t.left-=n),0>t.left&&(t.left=0),e.$menu.css(t)}else e.determinePosition.call(this,e.$menu)},positionSubmenu:function(t){if(void 0!==t)if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var i={top:-9,left:this.outerWidth()-5};t.css(i)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop,activated:e.noop},callback:null,items:{}},p=null,f=null,g=null,m={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var i=e(this);if("right"===t.data.trigger&&(t.preventDefault(),t.stopImmediatePropagation()),!("right"!==t.data.trigger&&"demand"!==t.data.trigger&&t.originalEvent||void 0!==t.mouseButton&&t.data&&!("left"===t.data.trigger&&0===t.mouseButton||"right"===t.data.trigger&&2===t.mouseButton)||i.hasClass("context-menu-active")||i.hasClass("context-menu-disabled"))){if(n=i,t.data.build){if(!1===(a=t.data.build(n,t)))return;if(t.data=e.extend(!0,{},d,t.data,a||{}),!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),Error("No Items specified");t.data.$trigger=n,v.create(t.data)}var s,a=!1;for(s in t.data.items)t.data.items.hasOwnProperty(s)&&(e.isFunction(t.data.items[s].visible)?t.data.items[s].visible.call(e(t.currentTarget),s,t.data):void 0===t.data.items[s]||!t.data.items[s].visible||!0===t.data.items[s].visible)&&(a=!0);a&&v.show.call(i,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var i=e(this);n&&n.length&&!n.is(i)&&n.data("contextMenu").$menu.trigger("contextmenu:hide"),2===t.button&&(n=i.data("contextMenuActive",!0))},mouseup:function(t){var i=e(this);i.data("contextMenuActive")&&n&&n.length&&n.is(i)&&!i.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),n=i,i.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),i.removeData("contextMenuActive")},mouseenter:function(t){var i=e(this),s=e(t.relatedTarget),r=e(document);s.is(".context-menu-list")||s.closest(".context-menu-list").length||n&&n.length||(f=t.pageX,g=t.pageY,a=t.data,r.on("mousemove.contextMenuShow",m.mousemove),p=setTimeout(function(){p=null,r.off("mousemove.contextMenuShow"),n=i,i.trigger(e.Event("contextmenu",{data:a,pageX:f,pageY:g}))},t.data.delay))},mousemove:function(e){f=e.pageX,g=e.pageY},mouseleave:function(t){if(!(t=e(t.relatedTarget)).is(".context-menu-list")&&!t.closest(".context-menu-list").length){try{clearTimeout(p)}catch(i){}p=null}},layerClick:function(t){var i,s,a=e(this).data("contextMenuRoot"),n=t.button,r=t.pageX,l=t.pageY;t.preventDefault(),setTimeout(function(){var c,h="left"===a.trigger&&0===n||"right"===a.trigger&&2===n;if(document.elementFromPoint&&a.$layer){if(a.$layer.hide(),(i=document.elementFromPoint(r-o.scrollLeft(),l-o.scrollTop())).isContentEditable){c=document.createRange();var u=window.getSelection();c.selectNode(i),c.collapse(!0),u.removeAllRanges(),u.addRange(c)}e(i).trigger(t),a.$layer.show()}if(a.hideOnSecondTrigger&&h&&null!=a.$menu)a.$menu.trigger("contextmenu:hide");else{if(a.reposition&&h)if(document.elementFromPoint){if(a.$trigger.is(i))return void a.position.call(a.$trigger,a,r,l)}else if(s=a.$trigger.offset(),c=e(window),s.top+=c.scrollTop(),s.top<=t.pageY&&(s.left+=c.scrollLeft(),s.left<=t.pageX&&(s.bottom=s.top+a.$trigger.outerHeight(),s.bottom>=t.pageY&&(s.right=s.left+a.$trigger.outerWidth(),s.right>=t.pageX))))return void a.position.call(a.$trigger,a,r,l);i&&h&&a.$trigger.one("contextmenu:hidden",function(){e(i).contextMenu({x:r,y:l,button:n})}),null!=a&&null!=a.$menu&&a.$menu.trigger("contextmenu:hide")}},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t={};n&&(t=n.data("contextMenu")||{}),void 0===t.zIndex&&(t.zIndex=0);var i=0,s=function(e){""!==e.style.zIndex?i=e.style.zIndex:null!=e.offsetParent?s(e.offsetParent):null!=e.parentElement&&s(e.parentElement)};if(s(e.target),!(t.$menu&&parseInt(i,10)>parseInt(t.$menu.css("zIndex"),10))){switch(e.keyCode){case 9:case 38:if(m.keyStop(e,t),t.isInput){if(9===e.keyCode&&e.shiftKey)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!=t.$menu&&t.$menu.trigger("prevcommand"));if(38===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!==e.keyCode||e.shiftKey)return void(null!=t.$menu&&t.$menu.trigger("prevcommand"));break;case 40:if(m.keyStop(e,t),!t.isInput)return void(null!=t.$menu&&t.$menu.trigger("nextcommand"));if(9===e.keyCode)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void(null!=t.$menu&&t.$menu.trigger("nextcommand"));if(40===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(m.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root"))return e=t.$selected.parent().parent(),t.$selected.trigger("contextmenu:blur"),void(t.$selected=e);break;case 39:if(m.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;var a=t.$selected.data("contextMenu")||{};if(a.$menu&&t.$selected.hasClass("context-menu-submenu"))return t.$selected=null,a.$selected=null,void a.$menu.trigger("nextcommand");break;case 35:case 36:return void(t.$selected&&t.$selected.find("input, textarea, select").length||((t.$selected&&t.$selected.parent()||t.$menu).children(":not(."+t.classNames.disabled+", ."+t.classNames.notSelectable+")")[36===e.keyCode?"first":"last"]().trigger("contextmenu:focus"),e.preventDefault()));case 13:if(m.keyStop(e,t),t.isInput){if(t.$selected&&!t.$selected.is("textarea, select"))return void e.preventDefault();break}return void(null!=t.$selected&&t.$selected.trigger("mouseup"));case 32:case 33:case 34:return void m.keyStop(e,t);case 27:return m.keyStop(e,t),void(null!=t.$menu&&t.$menu.trigger("contextmenu:hide"));default:if(a=String.fromCharCode(e.keyCode).toUpperCase(),t.accesskeys&&t.accesskeys[a])return void t.accesskeys[a].$node.trigger(t.accesskeys[a].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),null!=t.$selected&&t.$selected.trigger(e)}},prevItem:function(t){t.stopPropagation();var i=e(this).data("contextMenu")||{},s=e(this).data("contextMenuRoot")||{};if(i.$selected){var a=i.$selected;(i=i.$selected.parent().data("contextMenu")||{}).$selected=a}a=i.$menu.children();for(var n=i.$selected&&i.$selected.prev().length?i.$selected.prev():a.last(),r=n;n.hasClass(s.classNames.disabled)||n.hasClass(s.classNames.notSelectable)||n.is(":hidden");)if((n=n.prev().length?n.prev():a.last()).is(r))return;i.$selected&&m.itemMouseleave.call(i.$selected.get(0),t),m.itemMouseenter.call(n.get(0),t),(t=n.find("input, textarea, select")).length&&t.focus()},nextItem:function(t){t.stopPropagation();var i=e(this).data("contextMenu")||{},s=e(this).data("contextMenuRoot")||{};if(i.$selected){var a=i.$selected;(i=i.$selected.parent().data("contextMenu")||{}).$selected=a}a=i.$menu.children();for(var n=i.$selected&&i.$selected.next().length?i.$selected.next():a.first(),r=n;n.hasClass(s.classNames.disabled)||n.hasClass(s.classNames.notSelectable)||n.is(":hidden");)if((n=n.next().length?n.next():a.first()).is(r))return;i.$selected&&m.itemMouseleave.call(i.$selected.get(0),t),m.itemMouseenter.call(n.get(0),t),(t=n.find("input, textarea, select")).length&&t.focus()},focusInput:function(){var t,i=e(this).closest(".context-menu-item"),s=(t=i.data()).contextMenu;(t=t.contextMenuRoot).$selected=s.$selected=i,t.isInput=s.isInput=!0},blurInput:function(){var t=e(this).closest(".context-menu-item").data();t.contextMenuRoot.isInput=t.contextMenu.isInput=!1},menuMouseenter:function(){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(t){var i=e(this).data().contextMenuRoot;i.$layer&&i.$layer.is(t.relatedTarget)&&(i.hovering=!1)},itemMouseenter:function(t){var i,s=e(this),a=(i=s.data()).contextMenu;(i=i.contextMenuRoot).hovering=!0,t&&i.$layer&&i.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(a.$menu?a:i).$menu.children("."+i.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),s.hasClass(i.classNames.disabled)||s.hasClass(i.classNames.notSelectable)?a.$selected=null:s.trigger("contextmenu:focus")},itemMouseleave:function(t){var i,s=e(this),a=(i=s.data()).contextMenu;(i=i.contextMenuRoot)!==a&&i.$layer&&i.$layer.is(t.relatedTarget)?(null!=i.$selected&&i.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),i.$selected=a.$selected=a.$node):a&&a.$menu&&a.$menu.hasClass("context-menu-visible")||s.trigger("contextmenu:blur")},itemClick:function(t){var i,s=e(this),a=(i=s.data()).contextMenu,n=i.contextMenuRoot;if(!(!a.items[i=i.contextMenuKey]||s.is("."+n.classNames.disabled+", .context-menu-separator, ."+n.classNames.notSelectable)||s.is(".context-menu-submenu")&&!1===n.selectableSubMenu)){if(t.preventDefault(),t.stopImmediatePropagation(),e.isFunction(a.callbacks[i])&&Object.prototype.hasOwnProperty.call(a.callbacks,i))s=a.callbacks[i];else{if(!e.isFunction(n.callback))return;s=n.callback}!1!==s.call(n.$trigger,i,n,t)?n.$menu.trigger("contextmenu:hide"):n.$menu.parent().length&&v.update.call(n.$trigger,n)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,i){var s=e(this).data("contextMenuRoot");v.hide.call(s.$trigger,s,i&&i.force)},focusItem:function(t){t.stopPropagation();var i,s=(i=(t=e(this)).data()).contextMenu;t.hasClass((i=i.contextMenuRoot).classNames.disabled)||t.hasClass(i.classNames.notSelectable)||(t.addClass([i.classNames.hover,i.classNames.visible].join(" ")).parent().find(".context-menu-item").not(t).removeClass(i.classNames.visible).filter("."+i.classNames.hover).trigger("contextmenu:blur"),s.$selected=i.$selected=t,s&&s.$node&&s.$node.hasClass("context-menu-submenu")&&s.$node.addClass(i.classNames.hover),s.$node&&i.positionSubmenu.call(s.$node,s.$menu))},blurItem:function(t){t.stopPropagation();var i=(s=(t=e(this)).data()).contextMenu,s=s.contextMenuRoot;i.autoHide&&t.removeClass(s.classNames.visible),t.removeClass(s.classNames.hover),i.$selected=null}},v={show:function(t,i,s){var a=e(this),r={};e("#context-menu-layer").trigger("mousedown"),t.$trigger=a,!1===t.events.show.call(a,t)?n=null:(v.update.call(a,t),t.position.call(a,t,i,s),t.zIndex&&(i=t.zIndex,"function"==typeof t.zIndex&&(i=t.zIndex.call(a,t)),r.zIndex=function(e){for(var t=0;t=Math.max(t,parseInt(e.css("z-index"),10)||0),(e=e.parent())&&e.length&&!(-1<"html body".indexOf(e.prop("nodeName").toLowerCase())););return t}(a)+i),v.layer.call(t.$menu,t,r.zIndex),t.$menu.find("ul").css("zIndex",r.zIndex+1),t.$menu.css(r)[t.animation.show](t.animation.duration,function(){a.trigger("contextmenu:visible"),v.activated(t),t.events.activated()}),a.data("contextMenu",t).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",m.key),t.autoHide&&e(document).on("mousemove.contextMenuAutoHide",function(e){var i=a.offset();i.right=i.left+a.outerWidth(),i.bottom=i.top+a.outerHeight(),!t.$layer||t.hovering||e.pageX>=i.left&&e.pageX<=i.right&&e.pageY>=i.top&&e.pageY<=i.bottom||setTimeout(function(){t.hovering||null==t.$menu||t.$menu.trigger("contextmenu:hide")},50)}))},hide:function(i,s){var a=e(this);if(i||(i=a.data("contextMenu")||{}),s||!i.events||!1!==i.events.hide.call(a,i)){if(a.removeData("contextMenu").removeClass("context-menu-active"),i.$layer){setTimeout(function(e){return function(){e.remove()}}(i.$layer),10);try{delete i.$layer}catch(r){i.$layer=null}}n=null,i.$menu.find("."+i.classNames.hover).trigger("contextmenu:blur"),i.$selected=null,i.$menu.find("."+i.classNames.visible).removeClass(i.classNames.visible),e(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),i.$menu&&i.$menu[i.animation.hide](i.animation.duration,function(){i.build&&(i.$menu.remove(),e.each(i,function(e){switch(e){case"ns":case"selector":case"build":case"trigger":return!0;default:i[e]=t;try{delete i[e]}catch(s){}return!0}})),setTimeout(function(){a.trigger("contextmenu:hidden")},10)})}},create:function(t,i){function s(t){var i=e("<span></span>");if(t._accesskey)t._beforeAccesskey&&i.append(document.createTextNode(t._beforeAccesskey)),e("<span></span>").addClass("context-menu-accesskey").text(t._accesskey).appendTo(i),t._afterAccesskey&&i.append(document.createTextNode(t._afterAccesskey));else if(t.isHtmlName){if(void 0!==t.accesskey)throw Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");i.html(t.name)}else i.text(t.name);return i}void 0===i&&(i=t),t.$menu=e('<ul class="context-menu-list"></ul>').addClass(t.className||"").data({contextMenu:t,contextMenuRoot:i}),e.each(["callbacks","commands","inputs"],function(e,s){t[s]={},i[s]||(i[s]={})}),i.accesskeys||(i.accesskeys={}),e.each(t.items,function(a,n){var r=e('<li class="context-menu-item"></li>').addClass(n.className||""),o=null,l=null;if(r.on("click",e.noop),"string"!=typeof n&&"cm_separator"!==n.type||(n={type:"cm_seperator"}),n.$node=r.data({contextMenu:t,contextMenuRoot:i,contextMenuKey:a}),void 0!==n.accesskey)for(var c,h=function(e){e=e.split(/\s+/);for(var t,i=[],s=0;t=e[s];s++)t=t.charAt(0).toUpperCase(),i.push(t);return i}(n.accesskey),d=0;c=h[d];d++)if(!i.accesskeys[c]){i.accesskeys[c]=n,(h=n.name.match(new RegExp("^(.*?)("+c+")(.*)$","i")))&&(n._beforeAccesskey=h[1],n._accesskey=h[2],n._afterAccesskey=h[3]);break}if(n.type&&u[n.type])u[n.type].call(r,n,t,i),e.each([t,i],function(i,s){s.commands[a]=n,!e.isFunction(n.callback)||void 0!==s.callbacks[a]&&void 0!==t.type||(s.callbacks[a]=n.callback)});else{switch("cm_seperator"===n.type?r.addClass("context-menu-separator "+i.classNames.notSelectable):"html"===n.type?r.addClass("context-menu-html "+i.classNames.notSelectable):"sub"!==n.type&&(n.type?(o=e("<label></label>").appendTo(r),s(n).appendTo(o),r.addClass("context-menu-input"),t.hasTypes=!0,e.each([t,i],function(e,t){t.commands[a]=n,t.inputs[a]=n})):n.items&&(n.type="sub")),n.type){case"cm_seperator":break;case"text":l=e('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+a).val(n.value||"").appendTo(o);break;case"textarea":l=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+a).val(n.value||"").appendTo(o),n.height&&l.height(n.height);break;case"checkbox":l=e('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+a).val(n.value||"").prop("checked",!!n.selected).prependTo(o);break;case"radio":l=e('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+n.radio).val(n.value||"").prop("checked",!!n.selected).prependTo(o);break;case"select":l=e('<select name=""></select>').attr("name","context-menu-input-"+a).appendTo(o),n.options&&(e.each(n.options,function(t,i){e("<option></option>").val(t).text(i).appendTo(l)}),l.val(n.selected));break;case"sub":s(n).appendTo(r),n.appendTo=n.$node,r.data("contextMenu",n).addClass("context-menu-submenu"),n.callback=null,"function"==typeof n.items.then?v.processPromises(n,i,n.items):v.create(n,i);break;case"html":e(n.html).appendTo(r);break;default:e.each([t,i],function(i,s){s.commands[a]=n,!e.isFunction(n.callback)||void 0!==s.callbacks[a]&&void 0!==t.type||(s.callbacks[a]=n.callback)}),s(n).appendTo(r)}n.type&&"sub"!==n.type&&"html"!==n.type&&"cm_seperator"!==n.type&&(l.on("focus",m.focusInput).on("blur",m.blurInput),n.events)&&l.on(n.events,t),n.icon&&(n._icon=e.isFunction(n.icon)?n.icon.call(this,this,r,a,n):"string"==typeof n.icon&&"fa-"===n.icon.substring(0,3)?i.classNames.icon+" "+i.classNames.icon+"--fa fa "+n.icon:i.classNames.icon+" "+i.classNames.icon+"-"+n.icon,r.addClass(n._icon))}n.$input=l,n.$label=o,r.appendTo(t.$menu),!t.hasTypes&&e.support.eventSelectstart&&r.on("selectstart.disableTextSelect",m.abortevent)}),t.$node||t.$menu.css("display","none").addClass("context-menu-root"),t.$menu.appendTo(t.appendTo||document.body)},resize:function(t,i){var s;t.css({position:"absolute",display:"block"}),t.data("width",(s=t.get(0)).getBoundingClientRect?Math.ceil(s.getBoundingClientRect().width):t.outerWidth()+1),t.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),t.find("> li > ul").each(function(){v.resize(e(this),!0)}),i||t.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return e(this).data("width")})},update:function(t,i){var s=this;void 0===i&&(i=t,v.resize(t.$menu)),t.$menu.children().each(function(){var a=e(this),n=a.data("contextMenuKey"),r=t.items[n],o=e.isFunction(r.disabled)&&r.disabled.call(s,n,i)||!0===r.disabled;if(a[(e.isFunction(r.visible)?r.visible.call(s,n,i):void 0===r.visible||!0===r.visible)?"show":"hide"](),a[o?"addClass":"removeClass"](i.classNames.disabled),e.isFunction(r.icon)&&(a.removeClass(r._icon),r._icon=r.icon.call(this,s,a,n,r),a.addClass(r._icon)),r.type)switch(a.find("input, select, textarea").prop("disabled",o),r.type){case"text":case"textarea":r.$input.val(r.value||"");break;case"checkbox":case"radio":r.$input.val(r.value||"").prop("checked",!!r.selected);break;case"select":r.$input.val((0===r.selected?"0":r.selected)||"")}r.$menu&&v.update.call(s,r,i)})},layer:function(t,i){var s=t.$layer=e('<div id="context-menu-layer"></div>').css({height:o.height(),width:o.width(),display:"block",position:"fixed","z-index":i,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",m.abortevent).on("mousedown",m.layerClick);return void 0===document.body.style.maxWidth&&s.css({position:"absolute",height:e(document).height()}),s},processPromises:function(e,i,s){function a(e,t,i){void 0===i?(i={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}},window.console&&(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')):"string"==typeof i&&(i={error:{name:i}}),n(e,t,i)}function n(e,t,i){void 0!==t.$menu&&t.$menu.is(":visible")&&(e.$node.removeClass(t.classNames.iconLoadingClass),e.items=i,v.create(e,t,!0),v.update(e,t),t.positionSubmenu.call(e.$node,e.$menu))}e.$node.addClass(i.classNames.iconLoadingClass),s.then((function(e,i,s){void 0===s&&a(t),n(e,i,s)}).bind(this,e,i),a.bind(this,e,i))},activated:function(t){var i=(t=t.$menu).offset(),s=e(window).height(),a=e(window).scrollTop(),n=t.height();n>s?t.css({height:s+"px","overflow-x":"hidden","overflow-y":"auto",top:a+"px"}):(i.top<a||i.top+n>a+s)&&t.css({top:"0px"})}};e.fn.contextMenu=function(t){var i=this;if(0<this.length)if(void 0===t)this.first().trigger("contextmenu");else if(void 0!==t.x&&void 0!==t.y)this.first().trigger(e.Event("contextmenu",{pageX:t.x,pageY:t.y,mouseButton:t.button}));else if("hide"===t){var s=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;s&&s.trigger("contextmenu:hide")}else"destroy"===t?e.contextMenu("destroy",{context:this}):e.isPlainObject(t)?(t.context=this,e.contextMenu("create",t)):t?this.removeClass("context-menu-disabled"):t||this.addClass("context-menu-disabled");else e.each(h,function(){this.selector===i.selector&&(t.data=this,e.extend(t.data,{trigger:"demand"}))}),m.contextmenu.call(t.target,t);return this},e.contextMenu=function(t,i){"string"!=typeof t&&(i=t,t="create"),"string"==typeof i?i={selector:i}:void 0===i&&(i={});var s=e.extend(!0,{},d,i||{}),a=e(document),n=a,o=!1;switch(s.context&&s.context.length?(n=e(s.context).first(),s.context=n.get(0),o=!e(s.context).is(document)):s.context=document,t){case"update":if(o)v.update(n);else for(var u in h)h.hasOwnProperty(u)&&v.update(h[u]);break;case"create":if(!s.selector)throw Error("No selector specified");if(s.selector.match(/.context-menu-(list|item|input)($|\s)/))throw Error('Cannot bind to selector "'+s.selector+'" as it contains a reserved className');if(!s.build&&(!s.items||e.isEmptyObject(s.items)))throw Error("No Items specified");switch(s.ns=".contextMenu"+ ++l,o||(c[s.selector]=s.ns),h[s.ns]=s,s.trigger||(s.trigger="right"),r||((u={"contextmenu:focus.contextMenu":m.focusItem,"contextmenu:blur.contextMenu":m.blurItem,"contextmenu.contextMenu":m.abortevent,"mouseenter.contextMenu":m.itemMouseenter,"mouseleave.contextMenu":m.itemMouseleave})["click"===s.itemClickEvent?"click.contextMenu":"mouseup.contextMenu"]=m.itemClick,a.on({"contextmenu:hide.contextMenu":m.hideMenu,"prevcommand.contextMenu":m.prevItem,"nextcommand.contextMenu":m.nextItem,"contextmenu.contextMenu":m.abortevent,"mouseenter.contextMenu":m.menuMouseenter,"mouseleave.contextMenu":m.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",m.inputClick).on(u,".context-menu-item"),r=!0),n.on("contextmenu"+s.ns,s.selector,s,m.contextmenu),o&&n.on("remove"+s.ns,function(){e(this).contextMenu("destroy")}),s.trigger){case"hover":n.on("mouseenter"+s.ns,s.selector,s,m.mouseenter).on("mouseleave"+s.ns,s.selector,s,m.mouseleave);break;case"left":n.on("click"+s.ns,s.selector,s,m.click);break;case"touchstart":n.on("touchstart"+s.ns,s.selector,s,m.click)}s.build||v.create(s);break;case"destroy":var p;if(o){var f=s.context;e.each(h,function(t,i){if(!i||!e(f).is(i.selector))return!0;(p=e(".context-menu-list").filter(":visible")).length&&p.data().contextMenuRoot.$trigger.is(e(i.context).find(i.selector))&&p.trigger("contextmenu:hide",{force:!0});try{h[i.ns].$menu&&h[i.ns].$menu.remove(),delete h[i.ns]}catch(s){h[i.ns]=null}return e(i.context).off(i.ns),!0})}else if(s.selector){if(c[s.selector]){(p=e(".context-menu-list").filter(":visible")).length&&p.data().contextMenuRoot.$trigger.is(s.selector)&&p.trigger("contextmenu:hide",{force:!0});try{h[c[s.selector]].$menu&&h[c[s.selector]].$menu.remove(),delete h[c[s.selector]]}catch(g){h[c[s.selector]]=null}a.off(c[s.selector])}}else a.off(".contextMenu .contextMenuAutoHide"),e.each(h,function(t,i){e(i.context).off(i.ns)}),c={},h={},l=0,r=!1,e("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!e.support.htmlCommand&&!e.support.htmlMenuitem||"boolean"==typeof i&&i)&&e('menu[type="context"]').each(function(){this.id&&e.contextMenu({selector:"[contextmenu="+this.id+"]",items:e.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw Error('Unknown operation "'+t+'"')}return this},e.contextMenu.setInputValues=function(t,i){void 0===i&&(i={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=i[e]||"";break;case"checkbox":t.selected=!!i[e];break;case"radio":t.selected=(i[t.radio]||"")===t.value;break;case"select":t.selected=i[e]||""}})},e.contextMenu.getInputValues=function(t,i){return void 0===i&&(i={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":i[e]=t.$input.val();break;case"checkbox":i[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(i[t.radio]=t.value)}}),i},e.contextMenu.fromMenu=function(s){var a={};return function s(a,n,r){return r||(r=0),n.each(function(){var n,o,l=e(this),c=this,h=this.nodeName.toLowerCase();switch("label"===h&&l.find("input, textarea, select").length&&(n=l.text(),h=(c=(l=l.children().first()).get(0)).nodeName.toLowerCase()),h){case"menu":o={name:l.attr("label"),items:{}},r=s(o.items,l.children(),r);break;case"a":case"button":o={name:l.text(),disabled:!!l.attr("disabled"),callback:function(){l.get(0).click()}};break;case"menuitem":case"command":switch(l.attr("type")){case t:case"command":case"menuitem":o={name:l.attr("label"),disabled:!!l.attr("disabled"),icon:l.attr("icon"),callback:function(){l.get(0).click()}};break;case"checkbox":o={type:"checkbox",disabled:!!l.attr("disabled"),name:l.attr("label"),selected:!!l.attr("checked")};break;case"radio":o={type:"radio",disabled:!!l.attr("disabled"),name:l.attr("label"),radio:l.attr("radiogroup"),value:l.attr("id"),selected:!!l.attr("checked")};break;default:o=t}break;case"hr":o="-------";break;case"input":switch(l.attr("type")){case"text":o={type:"text",name:n||i(c),disabled:!!l.attr("disabled"),value:l.val()};break;case"checkbox":o={type:"checkbox",name:n||i(c),disabled:!!l.attr("disabled"),selected:!!l.attr("checked")};break;case"radio":o={type:"radio",name:n||i(c),disabled:!!l.attr("disabled"),radio:!!l.attr("name"),value:l.val(),selected:!!l.attr("checked")};break;default:o=t}break;case"select":o={type:"select",name:n||i(c),disabled:!!l.attr("disabled"),selected:l.val(),options:{}},l.children().each(function(){o.options[this.value]=e(this).text()});break;case"textarea":o={type:"textarea",name:n||i(c),disabled:!!l.attr("disabled"),value:l.val()};break;case"label":break;default:o={type:"html",html:l.clone(!0)}}o&&(a["key"+ ++r]=o)}),r}(a,(s=e(s)).children()),a},e.contextMenu.defaults=d,e.contextMenu.types=u,e.contextMenu.handle=m,e.contextMenu.op=v,e.contextMenu.menus=h}(jQuery),function(e){e.color={},e.color.make=function(t,i,s,a){var n={};return n.r=t||0,n.g=i||0,n.b=s||0,n.a=null!=a?a:1,n.add=function(e,t){for(var i=0;i<e.length;++i)n[e.charAt(i)]+=t;return n.normalize()},n.scale=function(e,t){for(var i=0;i<e.length;++i)n[e.charAt(i)]*=t;return n.normalize()},n.toString=function(){return 1<=n.a?"rgb("+[n.r,n.g,n.b].join()+")":"rgba("+[n.r,n.g,n.b,n.a].join()+")"},n.normalize=function(){function e(e,t,i){return t<e?e:t>i?i:t}return n.r=e(0,parseInt(n.r),255),n.g=e(0,parseInt(n.g),255),n.b=e(0,parseInt(n.b),255),n.a=e(0,n.a,1),n},n.clone=function(){return e.color.make(n.r,n.b,n.g,n.a)},n.normalize()},e.color.extract=function(t,i){var s;do{if(""!=(s=t.css(i).toLowerCase())&&"transparent"!=s)break;t=t.parent()}while(t.length&&!e.nodeName(t.get(0),"body"));return"rgba(0, 0, 0, 0)"==s&&(s="transparent"),e.color.parse(s)},e.color.parse=function(i){var s,a=e.color.make;return(s=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(i))?a(parseInt(s[1],10),parseInt(s[2],10),parseInt(s[3],10)):(s=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i))?a(parseInt(s[1],10),parseInt(s[2],10),parseInt(s[3],10),parseFloat(s[4])):(s=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(i))?a(2.55*parseFloat(s[1]),2.55*parseFloat(s[2]),2.55*parseFloat(s[3])):(s=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i))?a(2.55*parseFloat(s[1]),2.55*parseFloat(s[2]),2.55*parseFloat(s[3]),parseFloat(s[4])):(s=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(i))?a(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)):(s=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(i))?a(parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)):"transparent"==(i=e.trim(i).toLowerCase())?a(255,255,255,0):a((s=t[i]||[0,0,0])[0],s[1],s[2])};var t={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(e){function t(t,i){var s=i.children("."+t)[0];if(null==s&&((s=document.createElement("canvas")).className=t,e(s).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(i),!s.getContext)){if(!window.G_vmlCanvasManager)throw Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");s=window.G_vmlCanvasManager.initElement(s)}this.element=s,s=this.context=s.getContext("2d"),this.pixelRatio=(window.devicePixelRatio||1)/(s.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1),this.resize(i.width(),i.height()),this.textContainer=null,this.text={},this._textCache={}}function i(i,s,a,n){function r(e,t){t=[U].concat(t);for(var i=0;i<e.length;++i)e[i].apply(this,t)}function o(t){for(var i=[],s=0;s<t.length;++s){var a=e.extend(!0,{},L.series);null!=t[s].data?(a.data=t[s].data,delete t[s].data,e.extend(!0,a,t[s]),t[s].data=a.data):a.data=t[s],i.push(a)}for(s=(E=i).length,i=-1,t=0;t<E.length;++t)null!=(a=E[t].color)&&(s--,"number"==typeof a&&a>i&&(i=a));s<=i&&(s=i+1),i=[];var n=(d=L.colors).length,o=0;for(t=0;t<s;t++)a=e.color.parse(d[t%n]||"#666"),0==t%n&&t&&(o=0<=o?.5>o?-o-.2:0:-o),i[t]=a.scale("rgb",1+o);for(t=s=0;t<E.length;++t){if(null==(a=E[t]).color?(a.color=i[s].toString(),++s):"number"==typeof a.color&&(a.color=i[a.color].toString()),null==a.lines.show){var h,d=!0;for(h in a)if(a[h]&&a[h].show){d=!1;break}d&&(a.lines.show=!0)}null==a.lines.zero&&(a.lines.zero=!!a.lines.fill),a.xaxis=u(B,l(a,"x")),a.yaxis=u(H,l(a,"y"))}h=function(e,t,i){t<e.datamin&&t!=-x&&(e.datamin=t),i>e.datamax&&i!=x&&(e.datamax=i)};var p,f,g,m,v,b=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,x=Number.MAX_VALUE;for(e.each(c(),function(e,t){t.datamin=b,t.datamax=y,t.used=!1}),t=0;t<E.length;++t)(i=E[t]).datapoints={points:[]},r($.processRawData,[i,i.data,i.datapoints]);for(t=0;t<E.length;++t)if(m=(i=E[t]).data,(v=i.datapoints.format)||((v=[]).push({x:!0,number:!0,required:!0}),v.push({y:!0,number:!0,required:!0}),(i.bars.show||i.lines.show&&i.lines.fill)&&(v.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:!!(i.bars.show&&i.bars.zero||i.lines.show&&i.lines.zero)}),i.bars.horizontal&&(delete v[v.length-1].y,v[v.length-1].x=!0)),i.datapoints.format=v),null==i.datapoints.pointsize){i.datapoints.pointsize=v.length,n=i.datapoints.pointsize,d=i.datapoints.points;var w=i.lines.show&&i.lines.steps;for(i.xaxis.used=i.yaxis.used=!0,s=p=0;s<m.length;++s,p+=n){var S=null==(g=m[s]);if(!S)for(a=0;a<n;++a)o=g[a],(f=v[a])&&(f.number&&null!=o&&(o=+o,isNaN(o)?o=null:1/0==o?o=x:-1/0==o&&(o=-x)),null==o&&(f.required&&(S=!0),null!=f.defaultValue&&(o=f.defaultValue))),d[p+a]=o;if(S)for(a=0;a<n;++a)null!=(o=d[p+a])&&!1!==(f=v[a]).autoscale&&(f.x&&h(i.xaxis,o,o),f.y&&h(i.yaxis,o,o)),d[p+a]=null;else if(w&&0<p&&null!=d[p-n]&&d[p-n]!=d[p]&&d[p-n+1]!=d[p+1]){for(a=0;a<n;++a)d[p+n+a]=d[p+a];d[p+1]=d[p-n+1],p+=n}}}for(t=0;t<E.length;++t)r($.processDatapoints,[i=E[t],i.datapoints]);for(t=0;t<E.length;++t){for(d=(i=E[t]).datapoints.points,n=i.datapoints.pointsize,v=i.datapoints.format,g=p=b,w=m=y,s=0;s<d.length;s+=n)if(null!=d[s])for(a=0;a<n;++a)o=d[s+a],(f=v[a])&&!1!==f.autoscale&&o!=x&&o!=-x&&(f.x&&(o<p&&(p=o),o>m&&(m=o)),f.y&&(o<g&&(g=o),o>w&&(w=o)));if(i.bars.show){switch(i.bars.align){case"left":s=0;break;case"right":s=-i.bars.barWidth;break;default:s=-i.bars.barWidth/2}i.bars.horizontal?(g+=s,w+=s+i.bars.barWidth):(p+=s,m+=s+i.bars.barWidth)}h(i.xaxis,p,m),h(i.yaxis,g,w)}e.each(c(),function(e,t){t.datamin==b&&(t.datamin=null),t.datamax==y&&(t.datamax=null)})}function l(e,t){var i=e[t+"axis"];return"object"==typeof i&&(i=i.n),"number"!=typeof i&&(i=1),i}function c(){return e.grep(B.concat(H),function(e){return e})}function h(e){var t,i,s={};for(t=0;t<B.length;++t)(i=B[t])&&i.used&&(s["x"+i.n]=i.c2p(e.left));for(t=0;t<H.length;++t)(i=H[t])&&i.used&&(s["y"+i.n]=i.c2p(e.top));return void 0!==s.x1&&(s.x=s.x1),void 0!==s.y1&&(s.y=s.y1),s}function u(t,i){return t[i-1]||(t[i-1]={n:i,direction:t==B?"x":"y",options:e.extend(!0,{},t==B?L.xaxis:L.yaxis)}),t[i-1]}function d(){Q&&clearTimeout(Q),R.unbind("mousemove",C),R.unbind("mouseleave",A),R.unbind("click",_),r($.shutdown,[R])}function p(t){var i=t.labelWidth,s=t.labelHeight,a=t.options.position,n="x"===t.direction,r=t.options.tickLength,o=L.grid.axisMargin,l=L.grid.labelMargin,c=!0,h=!0,u=!0,d=!1;e.each(n?B:H,function(e,i){i&&(i.show||i.reserveSpace)&&(i===t?d=!0:i.options.position===a&&(d?h=!1:c=!1),d||(u=!1))}),h&&(o=0),null==r&&(r=u?"full":5),isNaN(+r)||(l+=+r),n?(s+=l,"bottom"==a?(W.bottom+=s+o,t.box={top:j.height-W.bottom,height:s}):(t.box={top:W.top+o,height:s},W.top+=s+o)):(i+=l,"left"==a?(t.box={left:W.left+o,width:i},W.left+=i+o):(W.right+=i+o,t.box={left:j.width-W.right,width:i})),t.position=a,t.tickLength=r,t.box.padding=l,t.innermost=c}function f(){var t,s,a=c(),n=L.grid.show;for(s in W)W[s]="number"==typeof(t=L.grid.margin||0)?t:t[s]||0;for(s in r($.processOffset,[W]),W)W[s]="object"==typeof L.grid.borderWidth?W[s]+(n?L.grid.borderWidth[s]:0):W[s]+(n?L.grid.borderWidth:0);if(e.each(a,function(e,t){t.show=null==(i=t.options).show?t.used:i.show,t.reserveSpace=null==i.reserveSpace?t.show:i.reserveSpace;var i,s=+(null!=(i=t.options).min?i.min:t.datamin),a=+(null!=i.max?i.max:t.datamax),n=a-s;if(0==n)n=0==a?1:.01,null==i.min&&(s-=n),(null==i.max||null!=i.min)&&(a+=n);else{var r=i.autoscaleMargin;null!=r&&(null==i.min&&0>(s-=n*r)&&null!=t.datamin&&0<=t.datamin&&(s=0),null==i.max&&0<(a+=n*r)&&null!=t.datamax&&0>=t.datamax&&(a=0))}t.min=s,t.max=a}),n){for(s=e.grep(a,function(e){return e.show||e.reserveSpace}),e.each(s,function(t,i){var s,a=i.options;s="number"==typeof a.ticks&&0<a.ticks?a.ticks:.3*Math.sqrt("x"==i.direction?j.width:j.height),s=(i.max-i.min)/s;var n=-Math.floor(Math.log(s)/Math.LN10),r=a.tickDecimals;null!=r&&n>r&&(n=r);var o,l=Math.pow(10,-n),c=s/l;if(1.5>c?o=1:3>c?(o=2,2.25<c&&(null==r||n+1<=r)&&(o=2.5,++n)):o=7.5>c?5:10,o*=l,null!=a.minTickSize&&o<a.minTickSize&&(o=a.minTickSize),i.delta=s,i.tickDecimals=Math.max(0,null!=r?r:n),i.tickSize=a.tickSize||o,"time"==a.mode&&!i.tickGenerator)throw Error("Time mode requires the flot.time plugin.");if(i.tickGenerator||(i.tickGenerator=function(e){var t,i=[],s=e.tickSize*Math.floor(e.min/e.tickSize),a=0,n=Number.NaN;do{t=n,i.push(n=s+a*e.tickSize),++a}while(n<e.max&&n!=t);return i},i.tickFormatter=function(e,t){var i,s=t.tickDecimals?Math.pow(10,t.tickDecimals):1,a=""+Math.round(e*s)/s;return null!=t.tickDecimals&&(i=-1==(i=a.indexOf("."))?0:a.length-i-1)<t.tickDecimals?(i?a:a+".")+(""+s).substr(1,t.tickDecimals-i):a}),e.isFunction(a.tickFormatter)&&(i.tickFormatter=function(e,t){return""+a.tickFormatter(e,t)}),null!=a.alignTicksWithAxis){var h=("x"==i.direction?B:H)[a.alignTicksWithAxis-1];h&&h.used&&h!=i&&(0<(s=i.tickGenerator(i)).length&&(null==a.min&&(i.min=Math.min(i.min,s[0])),null==a.max&&1<s.length&&(i.max=Math.max(i.max,s[s.length-1]))),i.tickGenerator=function(e){var t,i=[];for(t=0;t<h.ticks.length;++t)i.push(e.min+(h.ticks[t].v-h.min)/(h.max-h.min)*(e.max-e.min));return i},!i.mode&&null==a.tickDecimals&&(s=Math.max(0,1-Math.floor(Math.log(i.delta)/Math.LN10)),1<(n=i.tickGenerator(i)).length&&/\..*0$/.test((n[1]-n[0]).toFixed(s))||(i.tickDecimals=s)))}for(s=[],null==(n=i.options.ticks)||"number"==typeof n&&0<n?s=i.tickGenerator(i):n&&(s=e.isFunction(n)?n(i):n),i.ticks=[],n=0;n<s.length;++n)l=null,"object"==typeof(c=s[n])?(r=+c[0],1<c.length&&(l=c[1])):r=+c,null==l&&(l=i.tickFormatter(r,i)),isNaN(r)||i.ticks.push({v:r,label:l});s=i.ticks,i.options.autoscaleMargin&&0<s.length&&(null==i.options.min&&(i.min=Math.min(i.min,s[0].v)),null==i.options.max&&1<s.length&&(i.max=Math.max(i.max,s[s.length-1].v))),n=i.ticks||[],l=(s=i.options).labelHeight||0,c=(r=s.labelWidth||0)||("x"==i.direction?Math.floor(j.width/(n.length||1)):null),o="flot-"+i.direction+"-axis flot-"+i.direction+i.n+"-axis "+i.direction+"Axis "+i.direction+i.n+"Axis";for(var u=s.font||"flot-tick-label tickLabel",d=0;d<n.length;++d){var p=n[d];p.label&&(p=j.getTextInfo(o,p.label,u,null,c),r=Math.max(r,p.width),l=Math.max(l,p.height))}i.labelWidth=s.labelWidth||r,i.labelHeight=s.labelHeight||l}),t=s.length-1;0<=t;--t)p(s[t]);var o;if(null==(t=L.grid.minBorderMargin))for(o=t=0;o<E.length;++o)t=Math.max(t,2*(E[o].points.radius+E[o].points.lineWidth/2));var l=t,h=t,u=t,d=t;e.each(c(),function(e,t){t.reserveSpace&&t.ticks&&t.ticks.length&&("x"===t.direction?(l=Math.max(l,t.labelWidth/2),h=Math.max(h,t.labelWidth/2)):(d=Math.max(d,t.labelHeight/2),u=Math.max(u,t.labelHeight/2)))}),W.left=Math.ceil(Math.max(l,W.left)),W.right=Math.ceil(Math.max(h,W.right)),W.top=Math.ceil(Math.max(u,W.top)),W.bottom=Math.ceil(Math.max(d,W.bottom)),e.each(s,function(e,t){"x"==t.direction?(t.box.left=W.left-t.labelWidth/2,t.box.width=j.width-W.left-W.right+t.labelWidth):(t.box.top=W.top-t.labelHeight/2,t.box.height=j.height-W.bottom-W.top+t.labelHeight)})}if(q=j.width-W.left-W.right,G=j.height-W.bottom-W.top,e.each(a,function(e,t){var i,s,a=function(e){return e},n=t.options.transform||a,r=t.options.inverseTransform;"x"==t.direction?(i=t.scale=q/Math.abs(n(t.max)-n(t.min)),s=Math.min(n(t.max),n(t.min))):(i=-(i=t.scale=G/Math.abs(n(t.max)-n(t.min))),s=Math.max(n(t.max),n(t.min))),t.p2c=n==a?function(e){return(e-s)*i}:function(e){return(n(e)-s)*i},t.c2p=r?function(e){return r(s+e/i)}:function(e){return s+e/i}}),n&&e.each(c(),function(e,t){var i,s,a,n,r,o=t.box,l="flot-"+t.direction+"-axis flot-"+t.direction+t.n+"-axis "+t.direction+"Axis "+t.direction+t.n+"Axis",c=t.options.font||"flot-tick-label tickLabel";if(j.removeText(l),t.show&&0!=t.ticks.length)for(var h=0;h<t.ticks.length;++h)(i=t.ticks[h]).label&&!(i.v<t.min||i.v>t.max)&&("x"==t.direction?(n="center",s=W.left+t.p2c(i.v),"bottom"==t.position?a=o.top+o.padding:(a=o.top+o.height-o.padding,r="bottom")):(r="middle",a=W.top+t.p2c(i.v),"left"==t.position?(s=o.left+o.width-o.padding,n="right"):s=o.left+o.padding),j.addText(l,s,a,i.label,c,null,null,n,r))}),null!=L.legend.container?e(L.legend.container).html(""):i.find(".legend").remove(),L.legend.show){var f,g;for(a=[],n=[],s=!1,o=L.legend.labelFormatter,t=0;t<E.length;++t)(f=E[t]).label&&(g=o?o(f.label,f):f.label)&&n.push({label:g,color:f.color});if(L.legend.sorted)if(e.isFunction(L.legend.sorted))n.sort(L.legend.sorted);else if("reverse"==L.legend.sorted)n.reverse();else{var m="descending"!=L.legend.sorted;n.sort(function(e,t){return e.label==t.label?0:e.label<t.label!=m?1:-1})}for(t=0;t<n.length;++t)o=n[t],0==t%L.legend.noColumns&&(s&&a.push("</tr>"),a.push("<tr>"),s=!0),a.push('<td class="legendColorBox"><div style="border:1px solid '+L.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+o.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+o.label+"</td>");s&&a.push("</tr>"),0!=a.length&&(n='<table style="font-size:smaller;color:'+L.grid.color+'">'+a.join("")+"</table>",null!=L.legend.container?e(L.legend.container).html(n):(a="",null==(t=L.legend.margin)[0]&&(t=[t,t]),"n"==(s=L.legend.position).charAt(0)?a+="top:"+(t[1]+W.top)+"px;":"s"==s.charAt(0)&&(a+="bottom:"+(t[1]+W.bottom)+"px;"),"e"==s.charAt(1)?a+="right:"+(t[0]+W.right)+"px;":"w"==s.charAt(1)&&(a+="left:"+(t[0]+W.left)+"px;"),n=e('<div class="legend">'+n.replace('style="','style="position:absolute;'+a+";")+"</div>").appendTo(i),0!=L.legend.backgroundOpacity&&(null==(s=L.legend.backgroundColor)&&((s=(s=L.grid.backgroundColor)&&"string"==typeof s?e.color.parse(s):e.color.extract(n,"background-color")).a=1,s=s.toString()),t=n.children(),e('<div style="position:absolute;width:'+t.width()+"px;height:"+t.height()+"px;"+a+"background-color:"+s+';"> </div>').prependTo(n).css("opacity",L.legend.backgroundOpacity))))}}function g(){j.clear(),r($.drawBackground,[N]);var e=L.grid;e.show&&e.backgroundColor&&(N.save(),N.translate(W.left,W.top),N.fillStyle=J(L.grid.backgroundColor,G,0,"rgba(255, 255, 255, 0)"),N.fillRect(0,0,q,G),N.restore()),e.show&&!e.aboveData&&v();for(var t=0;t<E.length;++t){r($.drawSeries,[N,E[t]]);var i=E[t];i.lines.show&&b(i),i.bars.show&&w(i),i.points.show&&y(i)}r($.draw,[N]),e.show&&e.aboveData&&v(),j.render(),T()}function m(e,t){for(var i,s,a,n,r=c(),o=0;o<r.length;++o)if((i=r[o]).direction==t&&(!e[n=t+i.n+"axis"]&&1==i.n&&(n=t+"axis"),e[n])){s=e[n].from,a=e[n].to;break}return e[n]||(i="x"==t?B[0]:H[0],s=e[t+"1"],a=e[t+"2"]),null!=s&&null!=a&&s>a&&(n=s,s=a,a=n),{from:s,to:a,axis:i}}function v(){var t,i,s;if(N.save(),N.translate(W.left,W.top),s=L.grid.markings)for(e.isFunction(s)&&((i=U.getAxes()).xmin=i.xaxis.min,i.xmax=i.xaxis.max,i.ymin=i.yaxis.min,i.ymax=i.yaxis.max,s=s(i)),t=0;t<s.length;++t){var a=m(i=s[t],"x"),n=m(i,"y");if(null==a.from&&(a.from=a.axis.min),null==a.to&&(a.to=a.axis.max),null==n.from&&(n.from=n.axis.min),null==n.to&&(n.to=n.axis.max),!(a.to<a.axis.min||a.from>a.axis.max||n.to<n.axis.min||n.from>n.axis.max)){a.from=Math.max(a.from,a.axis.min),a.to=Math.min(a.to,a.axis.max),n.from=Math.max(n.from,n.axis.min),n.to=Math.min(n.to,n.axis.max);var r=n.from===n.to;if(!(u=a.from===a.to)||!r)if(a.from=Math.floor(a.axis.p2c(a.from)),a.to=Math.floor(a.axis.p2c(a.to)),n.from=Math.floor(n.axis.p2c(n.from)),n.to=Math.floor(n.axis.p2c(n.to)),u||r){var o=(r=i.lineWidth||L.grid.markingsLineWidth)%2?.5:0;N.beginPath(),N.strokeStyle=i.color||L.grid.markingsColor,N.lineWidth=r,u?(N.moveTo(a.to+o,n.from),N.lineTo(a.to+o,n.to)):(N.moveTo(a.from,n.to+o),N.lineTo(a.to,n.to+o)),N.stroke()}else N.fillStyle=i.color||L.grid.markingsColor,N.fillRect(a.from,n.to,a.to-a.from,n.from-n.to)}}for(i=c(),s=L.grid.borderWidth,a=0;a<i.length;++a){t=(n=i[a]).box;var l,h,u=n.tickLength;if(n.show&&0!=n.ticks.length){for(N.lineWidth=1,"x"==n.direction?(r=0,o="full"==u?"top"==n.position?0:G:t.top-W.top+("top"==n.position?t.height:0)):(o=0,r="full"==u?"left"==n.position?0:q:t.left-W.left+("left"==n.position?t.width:0)),n.innermost||(N.strokeStyle=n.options.color,N.beginPath(),l=h=0,"x"==n.direction?l=q+1:h=G+1,1==N.lineWidth&&("x"==n.direction?o=Math.floor(o)+.5:r=Math.floor(r)+.5),N.moveTo(r,o),N.lineTo(r+l,o+h),N.stroke()),N.strokeStyle=n.options.tickColor,N.beginPath(),t=0;t<n.ticks.length;++t){var d=n.ticks[t].v;l=h=0,isNaN(d)||d<n.min||d>n.max||"full"==u&&("object"==typeof s&&0<s[n.position]||0<s)&&(d==n.min||d==n.max)||("x"==n.direction?(r=n.p2c(d),h="full"==u?-G:u,"top"==n.position&&(h=-h)):(o=n.p2c(d),l="full"==u?-q:u,"left"==n.position&&(l=-l)),1==N.lineWidth&&("x"==n.direction?r=Math.floor(r)+.5:o=Math.floor(o)+.5),N.moveTo(r,o),N.lineTo(r+l,o+h))}N.stroke()}}s&&(t=L.grid.borderColor,"object"==typeof s||"object"==typeof t?("object"!=typeof s&&(s={top:s,right:s,bottom:s,left:s}),"object"!=typeof t&&(t={top:t,right:t,bottom:t,left:t}),0<s.top&&(N.strokeStyle=t.top,N.lineWidth=s.top,N.beginPath(),N.moveTo(0-s.left,0-s.top/2),N.lineTo(q,0-s.top/2),N.stroke()),0<s.right&&(N.strokeStyle=t.right,N.lineWidth=s.right,N.beginPath(),N.moveTo(q+s.right/2,0-s.top),N.lineTo(q+s.right/2,G),N.stroke()),0<s.bottom&&(N.strokeStyle=t.bottom,N.lineWidth=s.bottom,N.beginPath(),N.moveTo(q+s.right,G+s.bottom/2),N.lineTo(0,G+s.bottom/2),N.stroke()),0<s.left&&(N.strokeStyle=t.left,N.lineWidth=s.left,N.beginPath(),N.moveTo(0-s.left/2,G+s.bottom),N.lineTo(0-s.left/2,0),N.stroke())):(N.lineWidth=s,N.strokeStyle=L.grid.borderColor,N.strokeRect(-s/2,-s/2,q+s,G+s))),N.restore()}function b(e){function t(e,t,i,s,a){var n=e.points;e=e.pointsize;var r=null,o=null;N.beginPath();for(var l=e;l<n.length;l+=e){var c=n[l-e],h=n[l-e+1],u=n[l],d=n[l+1];if(null!=c&&null!=u){if(h<=d&&h<a.min){if(d<a.min)continue;c=(a.min-h)/(d-h)*(u-c)+c,h=a.min}else if(d<=h&&d<a.min){if(h<a.min)continue;u=(a.min-h)/(d-h)*(u-c)+c,d=a.min}if(h>=d&&h>a.max){if(d>a.max)continue;c=(a.max-h)/(d-h)*(u-c)+c,h=a.max}else if(d>=h&&d>a.max){if(h>a.max)continue;u=(a.max-h)/(d-h)*(u-c)+c,d=a.max}if(c<=u&&c<s.min){if(u<s.min)continue;h=(s.min-c)/(u-c)*(d-h)+h,c=s.min}else if(u<=c&&u<s.min){if(c<s.min)continue;d=(s.min-c)/(u-c)*(d-h)+h,u=s.min}if(c>=u&&c>s.max){if(u>s.max)continue;h=(s.max-c)/(u-c)*(d-h)+h,c=s.max}else if(u>=c&&u>s.max){if(c>s.max)continue;d=(s.max-c)/(u-c)*(d-h)+h,u=s.max}(c!=r||h!=o)&&N.moveTo(s.p2c(c)+t,a.p2c(h)+i),r=u,o=d,N.lineTo(s.p2c(u)+t,a.p2c(d)+i)}}N.stroke()}N.save(),N.translate(W.left,W.top),N.lineJoin="round";var i=e.lines.lineWidth,s=e.shadowSize;if(0<i&&0<s){N.lineWidth=s,N.strokeStyle="rgba(0,0,0,0.1)";var a=Math.PI/18;t(e.datapoints,Math.sin(a)*(i/2+s/2),Math.cos(a)*(i/2+s/2),e.xaxis,e.yaxis),N.lineWidth=s/2,t(e.datapoints,Math.sin(a)*(i/2+s/4),Math.cos(a)*(i/2+s/4),e.xaxis,e.yaxis)}if(N.lineWidth=i,N.strokeStyle=e.color,s=S(e.lines,e.color,0,G)){N.fillStyle=s,s=e.xaxis,a=e.yaxis;for(var n=(r=e.datapoints).points,r=r.pointsize,o=Math.min(Math.max(0,a.min),a.max),l=0,c=!1,h=1,u=0,d=0;!(0<r&&l>n.length+r);){var p=n[(l+=r)-r],f=n[l-r+h],g=n[l],m=n[l+h];if(c){if(0<r&&null!=p&&null==g){d=l,r=-r,h=2;continue}if(0>r&&l==u+r){N.fill(),c=!1,h=1,l=u=d+(r=-r);continue}}if(null!=p&&null!=g){if(p<=g&&p<s.min){if(g<s.min)continue;f=(s.min-p)/(g-p)*(m-f)+f,p=s.min}else if(g<=p&&g<s.min){if(p<s.min)continue;m=(s.min-p)/(g-p)*(m-f)+f,g=s.min}if(p>=g&&p>s.max){if(g>s.max)continue;f=(s.max-p)/(g-p)*(m-f)+f,p=s.max}else if(g>=p&&g>s.max){if(p>s.max)continue;m=(s.max-p)/(g-p)*(m-f)+f,g=s.max}if(c||(N.beginPath(),N.moveTo(s.p2c(p),a.p2c(o)),c=!0),f>=a.max&&m>=a.max)N.lineTo(s.p2c(p),a.p2c(a.max)),N.lineTo(s.p2c(g),a.p2c(a.max));else if(f<=a.min&&m<=a.min)N.lineTo(s.p2c(p),a.p2c(a.min)),N.lineTo(s.p2c(g),a.p2c(a.min));else{var v=p,b=g;f<=m&&f<a.min&&m>=a.min?(p=(a.min-f)/(m-f)*(g-p)+p,f=a.min):m<=f&&m<a.min&&f>=a.min&&(g=(a.min-f)/(m-f)*(g-p)+p,m=a.min),f>=m&&f>a.max&&m<=a.max?(p=(a.max-f)/(m-f)*(g-p)+p,f=a.max):m>=f&&m>a.max&&f<=a.max&&(g=(a.max-f)/(m-f)*(g-p)+p,m=a.max),p!=v&&N.lineTo(s.p2c(v),a.p2c(f)),N.lineTo(s.p2c(p),a.p2c(f)),N.lineTo(s.p2c(g),a.p2c(m)),g!=b&&(N.lineTo(s.p2c(g),a.p2c(m)),N.lineTo(s.p2c(b),a.p2c(m)))}}}}0<i&&t(e.datapoints,0,0,e.xaxis,e.yaxis),N.restore()}function y(e){function t(e,t,i,s,a,n,r,o){var l=e.points;e=e.pointsize;for(var c=0;c<l.length;c+=e){var h=l[c],u=l[c+1];null==h||h<n.min||h>n.max||u<r.min||u>r.max||(N.beginPath(),h=n.p2c(h),u=r.p2c(u)+s,"circle"==o?N.arc(h,u,t,0,a?Math.PI:2*Math.PI,!1):o(N,h,u,t,a),N.closePath(),i&&(N.fillStyle=i,N.fill()),N.stroke())}}N.save(),N.translate(W.left,W.top);var i=e.points.lineWidth,s=e.shadowSize,a=e.points.radius,n=e.points.symbol;0==i&&(i=1e-4),0<i&&0<s&&(N.lineWidth=s/=2,N.strokeStyle="rgba(0,0,0,0.1)",t(e.datapoints,a,null,s+s/2,!0,e.xaxis,e.yaxis,n),N.strokeStyle="rgba(0,0,0,0.2)",t(e.datapoints,a,null,s/2,!0,e.xaxis,e.yaxis,n)),N.lineWidth=i,N.strokeStyle=e.color,t(e.datapoints,a,S(e.points,e.color),0,!1,e.xaxis,e.yaxis,n),N.restore()}function x(e,t,i,s,a,n,r,o,l,c,h){var u,d,p,f;c?(f=d=p=!0,u=!1,c=i,i=t+s,a=t+a,e<c&&(t=e,e=c,c=t,u=!0,d=!1)):(u=d=p=!0,f=!1,c=e+s,e+=a,a=i,(i=t)<a&&(t=i,i=a,a=t,f=!0,p=!1)),e<r.min||c>r.max||i<o.min||a>o.max||(c<r.min&&(c=r.min,u=!1),e>r.max&&(e=r.max,d=!1),a<o.min&&(a=o.min,f=!1),i>o.max&&(i=o.max,p=!1),c=r.p2c(c),a=o.p2c(a),e=r.p2c(e),i=o.p2c(i),n&&(l.fillStyle=n(a,i),l.fillRect(c,i,e-c,a-i)),0<h&&(u||d||p||f)&&(l.beginPath(),l.moveTo(c,a),u?l.lineTo(c,i):l.moveTo(c,i),p?l.lineTo(e,i):l.moveTo(e,i),d?l.lineTo(e,a):l.moveTo(e,a),f?l.lineTo(c,a):l.moveTo(c,a),l.stroke()))}function w(e){var t;switch(N.save(),N.translate(W.left,W.top),N.lineWidth=e.bars.lineWidth,N.strokeStyle=e.color,e.bars.align){case"left":t=0;break;case"right":t=-e.bars.barWidth;break;default:t=-e.bars.barWidth/2}var i=t;t+=e.bars.barWidth;for(var s=e.bars.fill?function(t,i){return S(e.bars,e.color,t,i)}:null,a=e.xaxis,n=e.yaxis,r=(o=e.datapoints).points,o=o.pointsize,l=0;l<r.length;l+=o)null!=r[l]&&x(r[l],r[l+1],r[l+2],i,t,s,a,n,N,e.bars.horizontal,e.bars.lineWidth);N.restore()}function S(t,i,s,a){var n=t.fill;return n?t.fillColor?J(t.fillColor,s,a,i):((t=e.color.parse(i)).a="number"==typeof n?n:.4,t.normalize(),t.toString()):null}function C(e){L.grid.hoverable&&k("plothover",e,function(e){return 0!=e.hoverable})}function A(e){L.grid.hoverable&&k("plothover",e,function(){return!1})}function _(e){k("plotclick",e,function(e){return 0!=e.clickable})}function k(e,t,s){var a=R.offset(),n=t.pageX-a.left-W.left,r=t.pageY-a.top-W.top,o=h({left:n,top:r});o.pageX=t.pageX,o.pageY=t.pageY;var l,c,u,d=(t=L.grid.mouseActiveRadius)*t+1,p=null;for(l=E.length-1;0<=l;--l)if(s(E[l])){var f=E[l],g=f.xaxis,m=f.yaxis,v=f.datapoints.points,b=g.c2p(n),y=m.c2p(r),x=t/g.scale,w=t/m.scale;if(u=f.datapoints.pointsize,g.options.inverseTransform&&(x=Number.MAX_VALUE),m.options.inverseTransform&&(w=Number.MAX_VALUE),f.lines.show||f.points.show)for(c=0;c<v.length;c+=u){var S=v[c],C=v[c+1];null==S||S-b>x||S-b<-x||C-y>w||C-y<-w||(C=(S=Math.abs(g.p2c(S)-n))*S+(C=Math.abs(m.p2c(C)-r))*C)<d&&(d=C,p=[l,c/u])}if(f.bars.show&&!p){switch(f.bars.align){case"left":g=0;break;case"right":g=-f.bars.barWidth;break;default:g=-f.bars.barWidth/2}for(f=g+f.bars.barWidth,c=0;c<v.length;c+=u)C=v[c+1],m=v[c+2],null!=(S=v[c])&&(E[l].bars.horizontal?b<=Math.max(m,S)&&b>=Math.min(m,S)&&y>=C+g&&y<=C+f:b>=S+g&&b<=S+f&&y>=Math.min(m,C)&&y<=Math.max(m,C))&&(p=[l,c/u])}}if((s=p?{datapoint:E[l=p[0]].datapoints.points.slice((c=p[1])*(u=E[l].datapoints.pointsize),(c+1)*u),dataIndex:c,series:E[l],seriesIndex:l}:null)&&(s.pageX=parseInt(s.series.xaxis.p2c(s.datapoint[0])+a.left+W.left,10),s.pageY=parseInt(s.series.yaxis.p2c(s.datapoint[1])+a.top+W.top,10)),L.grid.autoHighlight){for(a=0;a<Z.length;++a)(n=Z[a]).auto==e&&(!s||n.series!=s.series||n.point[0]!=s.datapoint[0]||n.point[1]!=s.datapoint[1])&&O(n.series,n.point);s&&M(s.series,s.datapoint,e)}i.trigger(e,[o,s])}function T(){var e=L.interaction.redrawOverlayInterval;-1==e?I():Q||(Q=setTimeout(I,e))}function I(){var t,i;for(Q=null,z.save(),F.clear(),z.translate(W.left,W.top),t=0;t<Z.length;++t)if((i=Z[t]).series.bars.show)D(i.series,i.point);else{var s=i.series;i=(a=i.point)[0];var a=a[1],n=s.xaxis,o=s.yaxis,l="string"==typeof s.highlightColor?s.highlightColor:e.color.parse(s.color).scale("a",.5).toString();if(!(i<n.min||i>n.max||a<o.min||a>o.max)){var c=s.points.radius+s.points.lineWidth/2;z.lineWidth=c,z.strokeStyle=l,l=1.5*c,i=n.p2c(i),a=o.p2c(a),z.beginPath(),"circle"==s.points.symbol?z.arc(i,a,l,0,2*Math.PI,!1):s.points.symbol(z,i,a,l,!1),z.closePath(),z.stroke()}}z.restore(),r($.drawOverlay,[z])}function M(e,t,i){if("number"==typeof e&&(e=E[e]),"number"==typeof t){var s=e.datapoints.pointsize;t=e.datapoints.points.slice(s*t,s*(t+1))}-1==(s=P(e,t))?(Z.push({series:e,point:t,auto:i}),T()):i||(Z[s].auto=!1)}function O(e,t){if(null==e&&null==t)Z=[],T();else{if("number"==typeof e&&(e=E[e]),"number"==typeof t){var i=e.datapoints.pointsize;t=e.datapoints.points.slice(i*t,i*(t+1))}-1!=(i=P(e,t))&&(Z.splice(i,1),T())}}function P(e,t){for(var i=0;i<Z.length;++i){var s=Z[i];if(s.series==e&&s.point[0]==t[0]&&s.point[1]==t[1])return i}return-1}function D(t,i){var s,a="string"==typeof t.highlightColor?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString();switch(t.bars.align){case"left":s=0;break;case"right":s=-t.bars.barWidth;break;default:s=-t.bars.barWidth/2}z.lineWidth=t.bars.lineWidth,z.strokeStyle=a,x(i[0],i[1],i[2]||0,s,s+t.bars.barWidth,function(){return a},t.xaxis,t.yaxis,z,t.bars.horizontal,t.bars.lineWidth)}function J(t,i,s,a){if("string"==typeof t)return t;i=N.createLinearGradient(0,s,0,i),s=0;for(var n=t.colors.length;s<n;++s){var r=t.colors[s];if("string"!=typeof r){var o=e.color.parse(a);null!=r.brightness&&(o=o.scale("rgb",r.brightness)),null!=r.opacity&&(o.a*=r.opacity),r=o.toString()}i.addColorStop(s/(n-1),r)}return i}var E=[],L={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},j=null,F=null,R=null,N=null,z=null,B=[],H=[],W={left:0,right:0,top:0,bottom:0},q=0,G=0,$={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},U=this;U.setData=o,U.setupGrid=f,U.draw=g,U.getPlaceholder=function(){return i},U.getCanvas=function(){return j.element},U.getPlotOffset=function(){return W},U.width=function(){return q},U.height=function(){return G},U.offset=function(){var e=R.offset();return e.left+=W.left,e.top+=W.top,e},U.getData=function(){return E},U.getAxes=function(){var t={};return e.each(B.concat(H),function(e,i){i&&(t[i.direction+(1!=i.n?i.n:"")+"axis"]=i)}),t},U.getXAxes=function(){return B},U.getYAxes=function(){return H},U.c2p=h,U.p2c=function(e){var t,i,s,a={};for(t=0;t<B.length;++t)if((i=B[t])&&i.used&&(null==e[s="x"+i.n]&&1==i.n&&(s="x"),null!=e[s])){a.left=i.p2c(e[s]);break}for(t=0;t<H.length;++t)if((i=H[t])&&i.used&&(null==e[s="y"+i.n]&&1==i.n&&(s="y"),null!=e[s])){a.top=i.p2c(e[s]);break}return a},U.getOptions=function(){return L},U.highlight=M,U.unhighlight=O,U.triggerRedrawOverlay=T,U.pointOffset=function(e){return{left:parseInt(B[l(e,"x")-1].p2c(+e.x)+W.left,10),top:parseInt(H[l(e,"y")-1].p2c(+e.y)+W.top,10)}},U.shutdown=d,U.destroy=function(){d(),i.removeData("plot").empty(),E=[],z=N=R=F=j=L=null,B=[],H=[],$=null,Z=[],U=null},U.resize=function(){var e=i.width(),t=i.height();j.resize(e,t),F.resize(e,t)},U.hooks=$;for(var X={Canvas:t},Y=0;Y<n.length;++Y){var V=n[Y];V.init(U,X),V.options&&e.extend(!0,L,V.options)}for(e.extend(!0,L,a),a&&a.colors&&(L.colors=a.colors),null==L.xaxis.color&&(L.xaxis.color=e.color.parse(L.grid.color).scale("a",.22).toString()),null==L.yaxis.color&&(L.yaxis.color=e.color.parse(L.grid.color).scale("a",.22).toString()),null==L.xaxis.tickColor&&(L.xaxis.tickColor=L.grid.tickColor||L.xaxis.color),null==L.yaxis.tickColor&&(L.yaxis.tickColor=L.grid.tickColor||L.yaxis.color),null==L.grid.borderColor&&(L.grid.borderColor=L.grid.color),null==L.grid.tickColor&&(L.grid.tickColor=e.color.parse(L.grid.color).scale("a",.22).toString()),a=(a=i.css("font-size"))?+a.replace("px",""):13,Y={style:i.css("font-style"),size:Math.round(.8*a),variant:i.css("font-variant"),weight:i.css("font-weight"),family:i.css("font-family")},X=L.xaxes.length||1,a=0;a<X;++a)(n=L.xaxes[a])&&!n.tickColor&&(n.tickColor=n.color),n=e.extend(!0,{},L.xaxis,n),L.xaxes[a]=n,n.font&&(n.font=e.extend({},Y,n.font),n.font.color||(n.font.color=n.color),n.font.lineHeight||(n.font.lineHeight=Math.round(1.15*n.font.size)));for(X=L.yaxes.length||1,a=0;a<X;++a)(n=L.yaxes[a])&&!n.tickColor&&(n.tickColor=n.color),n=e.extend(!0,{},L.yaxis,n),L.yaxes[a]=n,n.font&&(n.font=e.extend({},Y,n.font),n.font.color||(n.font.color=n.color),n.font.lineHeight||(n.font.lineHeight=Math.round(1.15*n.font.size)));for(L.xaxis.noTicks&&null==L.xaxis.ticks&&(L.xaxis.ticks=L.xaxis.noTicks),L.yaxis.noTicks&&null==L.yaxis.ticks&&(L.yaxis.ticks=L.yaxis.noTicks),L.x2axis&&(L.xaxes[1]=e.extend(!0,{},L.xaxis,L.x2axis),L.xaxes[1].position="top",null==L.x2axis.min&&(L.xaxes[1].min=null),null==L.x2axis.max&&(L.xaxes[1].max=null)),L.y2axis&&(L.yaxes[1]=e.extend(!0,{},L.yaxis,L.y2axis),L.yaxes[1].position="right",null==L.y2axis.min&&(L.yaxes[1].min=null),null==L.y2axis.max&&(L.yaxes[1].max=null)),L.grid.coloredAreas&&(L.grid.markings=L.grid.coloredAreas),L.grid.coloredAreasColor&&(L.grid.markingsColor=L.grid.coloredAreasColor),L.lines&&e.extend(!0,L.series.lines,L.lines),L.points&&e.extend(!0,L.series.points,L.points),L.bars&&e.extend(!0,L.series.bars,L.bars),null!=L.shadowSize&&(L.series.shadowSize=L.shadowSize),null!=L.highlightColor&&(L.series.highlightColor=L.highlightColor),a=0;a<L.xaxes.length;++a)u(B,a+1).options=L.xaxes[a];for(a=0;a<L.yaxes.length;++a)u(H,a+1).options=L.yaxes[a];for(var K in $)L.hooks[K]&&L.hooks[K].length&&($[K]=$[K].concat(L.hooks[K]));r($.processOptions,[L]),i.css("padding",0).children().filter(function(){return!e(this).hasClass("flot-overlay")&&!e(this).hasClass("flot-base")}).remove(),"static"==i.css("position")&&i.css("position","relative"),j=new t("flot-base",i),F=new t("flot-overlay",i),N=j.context,z=F.context,R=e(F.element).unbind(),(K=i.data("plot"))&&(K.shutdown(),F.clear()),i.data("plot",U),o(s),f(),g(),L.grid.hoverable&&(R.mousemove(C),R.bind("mouseleave",A)),L.grid.clickable&&R.click(_),r($.bindEvents,[R]);var Z=[],Q=null}var s=Object.prototype.hasOwnProperty;e.fn.detach||(e.fn.detach=function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)})}),t.prototype.resize=function(e,t){if(0>=e||0>=t)throw Error("Invalid dimensions for plot, width = "+e+", height = "+t);var i=this.element,s=this.context,a=this.pixelRatio;this.width!=e&&(i.width=e*a,i.style.width=e+"px",this.width=e),this.height!=t&&(i.height=t*a,i.style.height=t+"px",this.height=t),s.restore(),s.save(),s.scale(a,a)},t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.render=function(){var e,t=this._textCache;for(e in t)if(s.call(t,e)){var i=this.getTextLayer(e),a=t[e];for(var n in i.hide(),a)if(s.call(a,n)){var r,o=a[n];for(r in o)if(s.call(o,r)){for(var l,c=o[r].positions,h=0;l=c[h];h++)l.active?l.rendered||(i.append(l.element),l.rendered=!0):(c.splice(h--,1),l.rendered&&l.element.detach());0==c.length&&delete o[r]}}i.show()}},t.prototype.getTextLayer=function(t){var i=this.text[t];return null==i&&(null==this.textContainer&&(this.textContainer=e("<div class='flot-text'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),i=this.text[t]=e("<div></div>").addClass(t).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),i},t.prototype.getTextInfo=function(t,i,s,a,n){var r,o;return i=""+i,a="object"==typeof s?s.style+" "+s.variant+" "+s.weight+" "+s.size+"px/"+s.lineHeight+"px "+s.family:s,null==(r=this._textCache[t])&&(r=this._textCache[t]={}),null==(o=r[a])&&(o=r[a]={}),null==(r=o[i])&&(t=e("<div></div>").html(i).css({position:"absolute","max-width":n,top:-9999}).appendTo(this.getTextLayer(t)),"object"==typeof s?t.css({font:a,color:s.color}):"string"==typeof s&&t.addClass(s),r=o[i]={width:t.outerWidth(!0),height:t.outerHeight(!0),element:t,positions:[]},t.detach()),r},t.prototype.addText=function(e,t,i,s,a,n,r,o,l){for(s=(e=this.getTextInfo(e,s,a,n,r)).positions,"center"==o?t-=e.width/2:"right"==o&&(t-=e.width),"middle"==l?i-=e.height/2:"bottom"==l&&(i-=e.height),l=0;a=s[l];l++)if(a.x==t&&a.y==i)return void(a.active=!0);a={active:!0,rendered:!1,element:s.length?e.element.clone():e.element,x:t,y:i},s.push(a),a.element.css({top:Math.round(i),left:Math.round(t),"text-align":o})},t.prototype.removeText=function(e,t,i,a,n,r){if(null==a){if(null!=(t=this._textCache[e]))for(var o in t)if(s.call(t,o))for(var l in i=t[o])if(s.call(i,l))for(e=i[l].positions,a=0;n=e[a];a++)n.active=!1}else for(e=this.getTextInfo(e,a,n,r).positions,a=0;n=e[a];a++)n.x==t&&n.y==i&&(n.active=!1)},e.plot=function(t,s,a){return new i(e(t),s,a,e.plot.plugins)},e.plot.version="0.8.3",e.plot.plugins=[],e.fn.plot=function(t,i){return this.each(function(){e.plot(this,t,i)})}}(jQuery),function(e){function t(e,t,i,s){t.points.errorbars&&(e=[{x:!0,number:!0,required:!0},{y:!0,number:!0,required:!0}],"x"!=(i=t.points.errorbars)&&"xy"!=i||(t.points.xerr.asymmetric&&e.push({x:!0,number:!0,required:!0}),e.push({x:!0,number:!0,required:!0})),"y"!=i&&"xy"!=i||(t.points.yerr.asymmetric&&e.push({y:!0,number:!0,required:!0}),e.push({y:!0,number:!0,required:!0})),s.format=e)}function i(t,i,a,n,r,o,l,c,h,u,d){n+=u,r+=u,o+=u,"x"==i.err?(r>a+h?s(t,[[r,n],[Math.max(a+h,d[0]),n]]):l=!1,o<a-h?s(t,[[Math.min(a-h,d[1]),n],[o,n]]):c=!1):(r<n-h?s(t,[[a,r],[a,Math.min(n-h,d[0])]]):l=!1,o>n+h?s(t,[[a,Math.max(n+h,d[1])],[a,o]]):c=!1),h=null!=i.radius?i.radius:h,l&&("-"==i.upperCap?s(t,"x"==i.err?[[r,n-h],[r,n+h]]:[[a-h,r],[a+h,r]]):e.isFunction(i.upperCap)&&("x"==i.err?i.upperCap(t,r,n,h):i.upperCap(t,a,r,h))),c&&("-"==i.lowerCap?s(t,"x"==i.err?[[o,n-h],[o,n+h]]:[[a-h,o],[a+h,o]]):e.isFunction(i.lowerCap)&&("x"==i.err?i.lowerCap(t,o,n,h):i.lowerCap(t,a,o,h)))}function s(e,t){e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var i=1;i<t.length;i++)e.lineTo(t[i][0],t[i][1]);e.stroke()}function a(t,s){var a=t.getPlotOffset();s.save(),s.translate(a.left,a.top),e.each(t.getData(),function(e,t){if(t.points.errorbars&&(t.points.xerr.show||t.points.yerr.show)){var a=t.datapoints.points,n=t.datapoints.pointsize,r=[t.xaxis,t.yaxis],o=t.points.radius,l=[t.points.xerr,t.points.yerr],c=!1;if(r[0].p2c(r[0].max)<r[0].p2c(r[0].min)){c=!0;var h=l[0].lowerCap;l[0].lowerCap=l[0].upperCap,l[0].upperCap=h}var u=!1;r[1].p2c(r[1].min)<r[1].p2c(r[1].max)&&(u=!0,h=l[1].lowerCap,l[1].lowerCap=l[1].upperCap,l[1].upperCap=h);for(var d=0;d<t.datapoints.points.length;d+=n){var p,f=t.datapoints.points,g=null,m=null,v=null,b=null;p=t.points.xerr;var y=t.points.yerr,x=t.points.errorbars;for("x"==x||"xy"==x?p.asymmetric?(g=f[d+2],m=f[d+3],"xy"==x&&(y.asymmetric?(v=f[d+4],b=f[d+5]):v=f[d+4])):(g=f[d+2],"xy"==x&&(y.asymmetric?(v=f[d+3],b=f[d+4]):v=f[d+3])):"y"==x&&(y.asymmetric?(v=f[d+2],b=f[d+3]):v=f[d+2]),null==m&&(m=g),null==b&&(b=v),f=[g,m,v,b],p.show||(f[0]=null,f[1]=null),y.show||(f[2]=null,f[3]=null),p=f,y=0;y<l.length;y++)if(f=[r[y].min,r[y].max],p[y*l.length]&&(v=[g=a[d],m=a[d+1]][y]+p[y*l.length+1],b=[g,m][y]-p[y*l.length],"x"!=l[y].err||!(m>r[1].max||m<r[1].min||v<r[0].min||b>r[0].max))&&("y"!=l[y].err||!(g>r[0].max||g<r[0].min||v<r[1].min||b>r[1].max))){var w=x=!0;v>f[1]&&(x=!1,v=f[1]),b<f[0]&&(w=!1,b=f[0]),("x"==l[y].err&&c||"y"==l[y].err&&u)&&(h=b,b=v,v=h,h=w,w=x,x=h,h=f[0],f[0]=f[1],f[1]=h),g=r[0].p2c(g),m=r[1].p2c(m),v=r[y].p2c(v),b=r[y].p2c(b),f[0]=r[y].p2c(f[0]),f[1]=r[y].p2c(f[1]);var S=null!=t.points.shadowSize?t.points.shadowSize:t.shadowSize;0<(h=l[y].lineWidth?l[y].lineWidth:t.points.lineWidth)&&0<S&&(s.lineWidth=S/=2,s.strokeStyle="rgba(0,0,0,0.1)",i(s,l[y],g,m,v,b,x,w,o,S+S/2,f),s.strokeStyle="rgba(0,0,0,0.2)",i(s,l[y],g,m,v,b,x,w,o,S/2,f)),s.strokeStyle=l[y].color?l[y].color:t.color,s.lineWidth=h,i(s,l[y],g,m,v,b,x,w,o,0,f)}}}}),s.restore()}e.plot.plugins.push({init:function(e){e.hooks.processRawData.push(t),e.hooks.draw.push(a)},options:{series:{points:{errorbars:null,xerr:{err:"x",show:null,asymmetric:null,upperCap:null,lowerCap:null,color:null,radius:null},yerr:{err:"y",show:null,asymmetric:null,upperCap:null,lowerCap:null,color:null,radius:null}}}},name:"errorbars",version:"1.0"})}(jQuery),function(e){function t(s){var l,c=this,h=s.data||{};if(h.elem)c=s.dragTarget=h.elem,s.dragProxy=o.proxy||c,s.cursorOffsetX=h.pageX-h.left,s.cursorOffsetY=h.pageY-h.top,s.offsetX=s.pageX-s.cursorOffsetX,s.offsetY=s.pageY-s.cursorOffsetY;else if(o.dragging||0<h.which&&s.which!=h.which||e(s.target).is(h.not))return;switch(s.type){case"mousedown":return e.extend(h,e(c).offset(),{elem:c,target:s.target,pageX:s.pageX,pageY:s.pageY}),n.add(document,"mousemove mouseup",t,h),a(c,!1),o.dragging=null,!1;case!o.dragging&&"mousemove":if(Math.pow(s.pageX-h.pageX,2)+Math.pow(s.pageY-h.pageY,2)<h.distance)break;s.target=h.target,!1!==(l=i(s,"dragstart",c))&&(o.dragging=c,o.proxy=s.dragProxy=e(l||c)[0]);case"mousemove":if(o.dragging){if(l=i(s,"drag",c),r.drop&&(r.drop.allowed=!1!==l,r.drop.handler(s)),!1!==l)break;s.type="mouseup"}case"mouseup":n.remove(document,"mousemove mouseup",t),o.dragging&&(r.drop&&r.drop.handler(s),i(s,"dragend",c)),a(c,!0),o.dragging=o.proxy=h.elem=!1}return!0}function i(t,i,s){return t.type=i,!1!==(i=e.event.dispatch.call(s,t))&&(i||t.result)}function s(){return!1===o.dragging}function a(e,t){e&&(e.unselectable=t?"off":"on",e.onselectstart=function(){return t},e.style&&(e.style.MozUserSelect=t?"":"none"))}e.fn.drag=function(e,t,i){return t&&this.bind("dragstart",e),i&&this.bind("dragend",i),e?this.bind("drag",t||e):this.trigger("drag")};var n=e.event,r=n.special,o=r.drag={not:":input",distance:0,which:1,dragging:!1,setup:function(i){(i=e.extend({distance:o.distance,which:o.which,not:o.not},i||{})).distance=Math.pow(i.distance,2),n.add(this,"mousedown",t,i),this.attachEvent&&this.attachEvent("ondragstart",s)},teardown:function(){n.remove(this,"mousedown",t),this===o.dragging&&(o.dragging=o.proxy=!1),a(this,!0),this.detachEvent&&this.detachEvent("ondragstart",s)}};r.dragstart=r.dragend={setup:function(){},teardown:function(){}}}(jQuery),function(e){function t(t){var i=t||window.event,s=[].slice.call(arguments,1),a=0,n=0,r=0;return(t=e.event.fix(i)).type="mousewheel",i.wheelDelta&&(a=i.wheelDelta/120),i.detail&&(a=-i.detail/3),r=a,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(r=0,n=-1*a),void 0!==i.wheelDeltaY&&(r=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(n=-1*i.wheelDeltaX/120),s.unshift(t,a,n,r),(e.event.dispatch||e.event.handle).apply(this,s)}var i=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var s=i.length;s;)e.event.fixHooks[i[--s]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=i.length;e;)this.addEventListener(i[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=i.length;e;)this.removeEventListener(i[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),function(e){e.plot.plugins.push({init:function(t){function i(e,i){var s=t.offset();s.left=e.pageX-s.left,s.top=e.pageY-s.top,i?t.zoomOut({center:s}):t.zoom({center:s})}function s(e,t){return e.preventDefault(),i(e,0>t),!1}function a(e){if(1!=e.which)return!1;var i=t.getPlaceholder().css("cursor");i&&(o=i),t.getPlaceholder().css("cursor",t.getOptions().pan.cursor),l=e.pageX,c=e.pageY}function n(e){var i=t.getOptions().pan.frameRate;!h&&i&&(h=setTimeout(function(){t.pan({left:l-e.pageX,top:c-e.pageY}),l=e.pageX,c=e.pageY,h=null},1/i*1e3))}function r(e){h&&(clearTimeout(h),h=null),t.getPlaceholder().css("cursor",o),t.pan({left:l-e.pageX,top:c-e.pageY})}var o="default",l=0,c=0,h=null;t.zoomOut=function(e){e||(e={}),e.amount||(e.amount=t.getOptions().zoom.amount),e.amount=1/e.amount,t.zoom(e)},t.zoom=function(i){i||(i={});var s=i.center,a=i.amount||t.getOptions().zoom.amount,n=t.width(),r=t.height();s||(s={left:n/2,top:r/2});var o=s.left/n,l=s.top/r,c={x:{min:s.left-o*n/a,max:s.left+(1-o)*n/a},y:{min:s.top-l*r/a,max:s.top+(1-l)*r/a}};e.each(t.getAxes(),function(e,t){var i=t.options,s=c[t.direction].min,n=c[t.direction].max,r=i.zoomRange,o=i.panRange;if(!1!==r){if((s=t.c2p(s))>(n=t.c2p(n))){var l=s;s=n,n=l}o&&(null!=o[0]&&s<o[0]&&(s=o[0]),null!=o[1]&&n>o[1]&&(n=o[1])),o=n-s,r&&(null!=r[0]&&o<r[0]&&1<a||null!=r[1]&&o>r[1]&&1>a)||(i.min=s,i.max=n)}}),t.setupGrid(),t.draw(),i.preventEvent||t.getPlaceholder().trigger("plotzoom",[t,i])},t.pan=function(i){var s={x:+i.left,y:+i.top};isNaN(s.x)&&(s.x=0),isNaN(s.y)&&(s.y=0),e.each(t.getAxes(),function(e,t){var i,a,n=t.options,r=s[t.direction];i=t.c2p(t.p2c(t.min)+r),a=t.c2p(t.p2c(t.max)+r);var o=n.panRange;!1!==o&&(o&&(null!=o[0]&&o[0]>i&&(i+=r=o[0]-i,a+=r),null!=o[1]&&o[1]<a&&(i+=r=o[1]-a,a+=r)),n.min=i,n.max=a)}),t.setupGrid(),t.draw(),i.preventEvent||t.getPlaceholder().trigger("plotpan",[t,i])},t.hooks.bindEvents.push(function(e,t){var o=e.getOptions();o.zoom.interactive&&(t[o.zoom.trigger](i),t.mousewheel(s)),o.pan.interactive&&(t.bind("dragstart",{distance:10},a),t.bind("drag",n),t.bind("dragend",r))}),t.hooks.shutdown.push(function(e,t){t.unbind(e.getOptions().zoom.trigger,i),t.unbind("mousewheel",s),t.unbind("dragstart",a),t.unbind("drag",n),t.unbind("dragend",r),h&&clearTimeout(h)})},options:{xaxis:{zoomRange:null,panRange:null},zoom:{interactive:!1,trigger:"dblclick",amount:1.5},pan:{interactive:!1,cursor:"move",frameRate:20}},name:"navigate",version:"1.3"})}(jQuery),function(e,t,i){function s(i){!0===o&&(o=i||1);for(var u=n.length-1;0<=u;u--){var d=e(n[u]);if(d[0]==t||d.is(":visible")){var p=d.width(),f=d.height(),g=d.data(c);!g||p===g.w&&f===g.h||(d.trigger(l,[g.w=p,g.h=f]),o=i||!0)}else(g=d.data(c)).w=0,g.h=0}null!==a&&(o&&(null==i||1e3>i-o)?a=t.requestAnimationFrame(s):(a=setTimeout(s,r[h]),o=!1))}var a,n=[],r=e.resize=e.extend(e.resize,{}),o=!1,l="resize",c=l+"-special-event",h="pendingDelay";r[h]=200,r.activeDelay=20,r.throttleWindow=!0,e.event.special[l]={setup:function(){if(!r.throttleWindow&&this.setTimeout)return!1;var t=e(this);n.push(this),t.data(c,{w:t.width(),h:t.height()}),1===n.length&&(a=i,s())},teardown:function(){if(!r.throttleWindow&&this.setTimeout)return!1;for(var t=e(this),i=n.length-1;0<=i;i--)if(n[i]==this){n.splice(i,1);break}t.removeData(c),n.length||(o?cancelAnimationFrame(a):clearTimeout(a),a=null)},add:function(t){function s(t,s,n){var r=e(this),o=r.data(c)||{};o.w=s!==i?s:r.width(),o.h=n!==i?n:r.height(),a.apply(this,arguments)}return!(!r.throttleWindow&&this.setTimeout)&&(e.isFunction(t)?(a=t,s):(a=t.handler,void(t.handler=s)));var a}},t.requestAnimationFrame||(t.requestAnimationFrame=t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){return t.setTimeout(function(){e((new Date).getTime())},r.activeDelay)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout)}(jQuery,this),jQuery.plot.plugins.push({init:function(e){function t(){var t=e.getPlaceholder();0==t.width()||0==t.height()||(e.resize(),e.setupGrid(),e.draw())}e.hooks.bindEvents.push(function(e){e.getPlaceholder().resize(t)}),e.hooks.shutdown.push(function(e){e.getPlaceholder().unbind("resize",t)})},options:{},name:"resize",version:"1.0"}),function(e){e.plot.plugins.push({init:function(t){function i(e){u.active&&(o(e),t.getPlaceholder().trigger("plotselecting",[a()]))}function s(i){1==i.which&&(document.body.focus(),void 0!==document.onselectstart&&null==d.onselectstart&&(d.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==d.ondrag&&(d.ondrag=document.ondrag,document.ondrag=function(){return!1}),r(u.first,i),u.active=!0,p=function(e){p=null,void 0!==document.onselectstart&&(document.onselectstart=d.onselectstart),void 0!==document.ondrag&&(document.ondrag=d.ondrag),u.active=!1,o(e),h()?n():(t.getPlaceholder().trigger("plotunselected",[]),t.getPlaceholder().trigger("plotselecting",[null]))},e(document).one("mouseup",p))}function a(){if(!h()||!u.show)return null;var i={},s=u.first,a=u.second;return e.each(t.getAxes(),function(e,t){if(t.used){var n=t.c2p(s[t.direction]),r=t.c2p(a[t.direction]);i[e]={from:Math.min(n,r),to:Math.max(n,r)}}}),i}function n(){var e=a();t.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&t.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function r(e,i){var s=t.getOptions(),a=t.getPlaceholder().offset(),n=t.getPlotOffset(),r=i.pageX-a.left-n.left,o=t.width();e.x=0>r?0:r>o?o:r,a=i.pageY-a.top-n.top,n=t.height(),e.y=0>a?0:a>n?n:a,"y"==s.selection.mode&&(e.x=e==u.first?0:t.width()),"x"==s.selection.mode&&(e.y=e==u.first?0:t.height())}function o(e){null!=e.pageX&&(r(u.second,e),h()?(u.show=!0,t.triggerRedrawOverlay()):l(!0))}function l(e){u.show&&(u.show=!1,t.triggerRedrawOverlay(),e||t.getPlaceholder().trigger("plotunselected",[]))}function c(e,i){var s,a,n,r,o,l=t.getAxes();for(o in l)if((s=l[o]).direction==i&&(!e[r=i+s.n+"axis"]&&1==s.n&&(r=i+"axis"),e[r])){a=e[r].from,n=e[r].to;break}return e[r]||(s="x"==i?t.getXAxes()[0]:t.getYAxes()[0],a=e[i+"1"],n=e[i+"2"]),null!=a&&null!=n&&a>n&&(r=a,a=n,n=r),{from:a,to:n,axis:s}}function h(){var e=t.getOptions().selection.minSize;return Math.abs(u.second.x-u.first.x)>=e&&Math.abs(u.second.y-u.first.y)>=e}var u={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},d={},p=null;t.clearSelection=l,t.setSelection=function(e,i){var s,a=t.getOptions();"y"==a.selection.mode?(u.first.x=0,u.second.x=t.width()):(s=c(e,"x"),u.first.x=s.axis.p2c(s.from),u.second.x=s.axis.p2c(s.to)),"x"==a.selection.mode?(u.first.y=0,u.second.y=t.height()):(s=c(e,"y"),u.first.y=s.axis.p2c(s.from),u.second.y=s.axis.p2c(s.to)),u.show=!0,t.triggerRedrawOverlay(),!i&&h()&&n()},t.getSelection=a,t.hooks.bindEvents.push(function(e,t){null!=e.getOptions().selection.mode&&(t.mousemove(i),t.mousedown(s))}),t.hooks.drawOverlay.push(function(t,i){if(u.show&&h()){var s=t.getPlotOffset(),a=t.getOptions();i.save(),i.translate(s.left,s.top),s=e.color.parse(a.selection.color),i.strokeStyle=s.scale("a",.8).toString(),i.lineWidth=1,i.lineJoin=a.selection.shape,i.fillStyle=s.scale("a",.4).toString(),a=Math.min(u.first.x,u.second.x)+.5,s=Math.min(u.first.y,u.second.y)+.5;var n=Math.abs(u.second.x-u.first.x)-1,r=Math.abs(u.second.y-u.first.y)-1;i.fillRect(a,s,n,r),i.strokeRect(a,s,n,r),i.restore()}}),t.hooks.shutdown.push(function(t,a){a.unbind("mousemove",i),a.unbind("mousedown",s),p&&e(document).unbind("mouseup",p)})},options:{selection:{mode:null,color:"#e8cfac",shape:"round",minSize:5}},name:"selection",version:"1.1"})}(jQuery),function(e){function t(t){if(s){t.stack=[];var i=t.getPlaceholder();e(i).append("<div style='position:relative'><div style='z-index:100;position:absolute;right:12;top:12;z-index:2'>\t\t             <img class='zoomout' width='16' height='16' title='' alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABYlBMVEU9m+Y6l+I8meQ+nehAn+o/nuk8muU3luEujdgsi9Yujdcwj9ogf8ojgs0ce8YYd8IaecQZa7YbbrkabbgWZ7IVZrEIVaAMWqUQYKsCFSgAAAA/nehAn+pAn+o9m+ZVru09m+Y8meQ+neg8meRUruxQquo6l+I/nulVr+44l+JMqOg3luEsi9ZqyfYujdcgf8o2mNpgxPQjgs0ce8YaecQbesUZa7YabbgabLcWZ7IcfcQpq+sVZrEQX6oepuoQYKsMWqUPcrwMWqUIVJ8UcbgKbbcJVqEIVaANb7gFUJsPbLQEPXUDKU8JarQBFCYCTJcCN2wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACZ5f+V5P+U5P+I3/9Qm9GY5f+W5P9Pm9F93P+T4/+R4/+N4f+L4f9k1P9f0v9Tzv9OzP8zisgivf8Xuv8xishAx/8zw/8jvv8Wuv8twf8Uuf////9LFEt0AAAAWnRSTlMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAzzHDM2XAzM3DZ2YXM2XDZzIXzzDPZ88wzzJkzzJkz2fPMhfPMcNnMcNnZhczZzNlwM9lAzIMyLioiGx0mKy/TF9BpAAAAAWJLR0R1qGqY+wAAAPtJREFUGNMVxedfQVEYAOD3cm8iDm84114l2SuyZ5LcjHaKop3R/P9/nft8ecDucAKnUPK8UsGB02EH18jt4bw+nvd5OY975IKt7Vv/jj8gCAHW3a4T1oKh8eQ+rFKFHybjUFCAdXVkOovGNJpYdDaNqDdAG088Jp9SOl3qOfmSiGuBpPeYDCEZ+TQBQvSMgRCDPCGAuMkYEY3yiIDZfSaHmJPPIpjyhdfiW8lsLr0XPwp5E1CxPF9UqhZLtbKYl0UKtFZfrj4botj4Wi3rNQrNg+/WYatNaZv1c9SEzu9x1ypJNpskWbsnfx3o9QfD07Pzi8ur65vhoN/7B9wsL7lanTVQAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDEzLTA0LTAzVDE3OjE4OjAxKzA4OjAw0kcQ3gAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxMS0wNS0xOFQyMzoyNzowMCswODowMPWTeDEAAABNdEVYdHNvZnR3YXJlAEltYWdlTWFnaWNrIDYuOC44LTcgUTE2IHg4Nl82NCAyMDE0LTAyLTI4IGh0dHA6Ly93d3cuaW1hZ2VtYWdpY2sub3JnWaRffwAAABh0RVh0VGh1bWI6OkRvY3VtZW50OjpQYWdlcwAxp/+7LwAAABd0RVh0VGh1bWI6OkltYWdlOjpIZWlnaHQAMTYdr15vAAAAFnRFWHRUaHVtYjo6SW1hZ2U6OldpZHRoADE25QCe4gAAABl0RVh0VGh1bWI6Ok1pbWV0eXBlAGltYWdlL3BuZz+yVk4AAAAXdEVYdFRodW1iOjpNVGltZQAxMzA1NzMyNDIw3zNdNgAAABF0RVh0VGh1bWI6OlNpemUANzcxQkKQmHCaAAAAYHRFWHRUaHVtYjo6VVJJAGZpbGU6Ly8vaG9tZS9mdHAvMTUyMC9lYXN5aWNvbi5jbi9lYXN5aWNvbi5jbi9jZG4taW1nLmVhc3lpY29uLmNuL3BuZy81MTIyLzUxMjIzMy5wbmelXfH0AAAAAElFTkSuQmCC' /></div></div>"),e(i).bind("plotselected",function(i,s){var n=a.zoomFunc,r=t.getAxes(),o=t.getPlaceholder(),l={};l.xmin=r.xaxis.min,l.xmax=r.xaxis.max,l.ymin=r.yaxis.min,l.ymax=r.yaxis.max,t.stack.push(l),r.xaxis.options.min=s.xaxis.from,r.xaxis.options.max=s.xaxis.to,r.yaxis.options.min=s.yaxis.from,r.yaxis.options.max=s.yaxis.to,t.clearSelection(!0),t.setupGrid(),t.draw(),e(o).find(".zoomout").css("visibility","visible"),void 0!==n&&n(t,l)}),e(i).find(".zoomout").click(function(){var i=a.zoomFunc,s=t.stack.pop(),n=t.getPlaceholder();0===t.stack.length&&e(n).find(".zoomout").css("visibility","hidden"),t.getAxes().xaxis.options.min=s.xmin,t.getAxes().xaxis.options.max=s.xmax,t.getAxes().yaxis.options.min=s.ymin,t.getAxes().yaxis.options.max=s.ymax,t.clearSelection(!0),t.setupGrid(),t.draw(),void 0!==i&&i(t,s)}),e(i).find(".zoomout").css("visibility","hidden"),s=0}}function i(e,i){i&&i.zoomStack&&("object"==typeof i.zoomStack?(a.zoomStack=i.zoomStack.enabled,a.zoomFunc=i.zoomStack.func):a.zoomStack=i.zoomStack),a.zoomStack&&(s=1,e.hooks.drawOverlay.push(t))}var s=0,a={zoomStack:0,zoomFunc:void 0};e.plot.plugins.push({init:function(e){e.hooks.processOptions.push(i)},options:a,name:"zoomStack",version:.1})}($);var dhtmlwindow={imagefiles:["windowfiles/min.gif","windowfiles/close.gif","windowfiles/restore.gif","windowfiles/resize.gif"],ajaxbustcache:!0,ajaxloadinghtml:"<b>Loading Page. Please wait...</b>",minimizeorder:0,zIndexvalue:100,tobjects:[],lastactivet:{},init:function(e){var t=document.createElement("div");t.id=e,t.className="dhtmlwindow";var i="";for(i='<div class="drag-handle">',i=navigator.platform.match(/^Win/)?i+'DHTML Window <div class="drag-controls"><img src="'+this.imagefiles[0]+'" title="Minimize" /><img src="'+this.imagefiles[1]+'" title="Close" /></div>':i+'DHTML Window <div class="drag-controls"><div class="osxButtons"><div class="osxClose"><a class="osxA osxClosebutton" href="#"><span class="osxSpan"><strong title="Close">x</strong></span></a></div><div class="osxMinimize"><a class="osxA osxMinimizebutton" href="#"><span class="osxSpan"><strong title="Minimize">&ndash;</strong></span></a></div></div></div>',t.innerHTML=i=(i=(i+='</div><div class="drag-contentarea"></div>')+'<div class="drag-statusarea"><div class="drag-resizearea" style="background: transparent url('+this.imagefiles[3]+') top right no-repeat;">&nbsp;</div></div>')+"</div>",document.getElementById("dhtmlwindowholder").appendChild(t),t=(e=document.getElementById(e)).getElementsByTagName("div"),i=0;i<t.length;i++)/drag-/.test(t[i].className)&&(e[t[i].className.replace(/drag-/,"")]=t[i]);return e.handle._parent=e,e.resizearea._parent=e,e.controls._parent=e,e.onclose=function(){return!0},e.onmousedown=function(){dhtmlwindow.setfocus(this)},e.ontouchstart=function(){dhtmlwindow.setfocus(this)},e.handle.onmousedown=dhtmlwindow.setupdrag,e.handle.ontouchstart=dhtmlwindow.setupdrag,e.resizearea.onmousedown=dhtmlwindow.setupdrag,e.resizearea.ontouchstart=dhtmlwindow.setupdrag,e.controls.onclick=dhtmlwindow.enablecontrols,e.show=function(){dhtmlwindow.show(this)},e.hide=function(){dhtmlwindow.hide(this)},e.close=function(){dhtmlwindow.close(this)},e.setSize=function(e,t){dhtmlwindow.setSize(this,e,t)},e.moveTo=function(e,t){dhtmlwindow.moveTo(this,e,t)},e.isResize=function(e){dhtmlwindow.isResize(this,e)},e.isScrolling=function(e){dhtmlwindow.isScrolling(this,e)},e.load=function(e,t,i){dhtmlwindow.load(this,e,t,i)},this.tobjects[this.tobjects.length]=e},open:function(e,t,i,s,a,n){function r(e){return RegExp(e+"=([^,]+)","i").test(a)?parseInt(RegExp.$1):0}e=null==document.getElementById(e)?this.init(e):document.getElementById(e),this.setfocus(e),e.setSize(r("width"),r("height"));var o=r("center")?"middle":r("left"),l=r("center")?"middle":r("top");return void 0!==n&&"recal"==n&&0==this.scroll_top&&(window.attachEvent&&!window.opera?this.addEvent(window,function(){setTimeout(function(){e.moveTo(o,l)},400)},"load"):this.addEvent(window,function(){e.moveTo(o,l)},"load")),e.isResize(r("resize")),e.isScrolling(r("scrolling")),e.style.visibility="visible",e.style.display="block",e.contentarea.style.display="block",e.moveTo(o,l),e.load(t,i,s),"minimized"==e.state&&"Restore"==e.controls.firstChild.title&&(e.controls.firstChild.setAttribute("src",dhtmlwindow.imagefiles[0]),e.controls.firstChild.setAttribute("title","Minimize"),e.state="fullview"),e},setSize:function(e,t,i){e.style.width=Math.max(parseInt(t),150)+"px",e.contentarea.style.height=Math.max(parseInt(i),20)+"px"},moveTo:function(e,t,i){this.getviewpoint(),e.style.left="middle"==t?this.scroll_left+(this.docwidth-e.offsetWidth)/2+"px":this.scroll_left+parseInt(t)+"px",e.style.top="middle"==i?this.scroll_top+(this.docheight-e.offsetHeight)/2+"px":this.scroll_top+parseInt(i)+"px"},isResize:function(e,t){e.statusarea.style.display=t?"block":"none",e.resizeBool=t?1:0},isScrolling:function(e,t){e.contentarea.style.overflow=t?"auto":"hidden"},load:function(e,t,i,s){e.isClosed?alert("DHTML Window has been closed, so no window to load contents into. Open/Create the window again."):(t=t.toLowerCase(),void 0!==s&&(e.handle.firstChild.nodeValue=s),"inline"==t?e.contentarea.innerHTML=i:"div"==t?(i=document.getElementById(i),e.contentarea.innerHTML=i.defaultHTML||i.innerHTML,i.defaultHTML||(i.defaultHTML=i.innerHTML),i.innerHTML="",i.style.display="none"):"iframe"==t?(e.contentarea.style.overflow="hidden",e.contentarea.firstChild&&"IFRAME"==e.contentarea.firstChild.tagName||(e.contentarea.innerHTML='<iframe src="" style="margin:0; padding:0; width:100%; height: 100%" name="_iframe-'+e.id+'"></iframe>'),window.frames["_iframe-"+e.id].location.replace(i)):"ajax"==t&&this.ajax_connect(i,e),e.contentarea.datatype=t)},setupdrag:function(e){var t=dhtmlwindow,i=this._parent;return t.etarget=this,(e=window.event||e).touches&&e.touches.length?(t.initmousex=e.touches[0].clientX,t.initmousey=e.touches[0].clientY):(t.initmousex=e.clientX,t.initmousey=e.clientY),t.initx=parseInt(i.offsetLeft),t.inity=parseInt(i.offsetTop),t.width=parseInt(i.offsetWidth),t.contentheight=parseInt(i.contentarea.offsetHeight),"iframe"==i.contentarea.datatype&&(i.style.backgroundColor="#F8F8F8",i.contentarea.style.visibility="hidden"),document.onmousemove=t.getdistance,document.ontouchmove=t.getdistance,document.onmouseup=function(){"iframe"==i.contentarea.datatype&&(i.contentarea.style.backgroundColor="white",i.contentarea.style.visibility="visible"),t.stop()},document.ontouchend=function(){"iframe"==i.contentarea.datatype&&(i.contentarea.style.backgroundColor="white",i.contentarea.style.visibility="visible"),t.stop()},!1},getdistance:function(e){var t=dhtmlwindow,i=t.etarget;return(e=window.event||e).touches&&e.touches.length?(t.distancex=e.touches[0].clientX-t.initmousex,t.distancey=e.touches[0].clientY-t.initmousey):(t.distancex=e.clientX-t.initmousex,t.distancey=e.clientY-t.initmousey),"drag-handle"==i.className?t.move(i._parent,e):"drag-resizearea"==i.className&&t.resize(i._parent,e),!1},getviewpoint:function(){var e=document.all&&!window.opera,t=document.documentElement&&parseInt(document.documentElement.clientWidth)||1e5;this.standardbody="CSS1Compat"==document.compatMode?document.documentElement:document.body,this.scroll_top=e?this.standardbody.scrollTop:window.pageYOffset,this.scroll_left=e?this.standardbody.scrollLeft:window.pageXOffset,this.docwidth=e?this.standardbody.clientWidth:/Safari/i.test(navigator.userAgent)?window.innerWidth:Math.min(t,window.innerWidth-16),this.docheight=e?this.standardbody.clientHeight:window.innerHeight},rememberattrs:function(e){this.getviewpoint(),e.lastx=parseInt(e.style.left||e.offsetLeft)-dhtmlwindow.scroll_left,e.lasty=parseInt(e.style.top||e.offsetTop)-dhtmlwindow.scroll_top,e.lastwidth=parseInt(e.style.width)},move:function(e){e.style.left=Math.max(0,dhtmlwindow.distancex+dhtmlwindow.initx)+"px",e.style.top=Math.max(0,dhtmlwindow.distancey+dhtmlwindow.inity)+"px"},resize:function(e){e.style.width=Math.max(dhtmlwindow.width+dhtmlwindow.distancex,150)+"px",e.contentarea.style.height=Math.max(dhtmlwindow.contentheight+dhtmlwindow.distancey,20)+"px"},enablecontrols:function(e){var t=dhtmlwindow;return e=window.event?window.event.srcElement:e.target,/Minimize/i.test(e.getAttribute("title"))?t.minimize(e,this._parent):/Restore/i.test(e.getAttribute("title"))?t.restore(e,this._parent):/Close/i.test(e.getAttribute("title"))&&t.close(this._parent),!1},minimize:function(e,t){dhtmlwindow.rememberattrs(t),e.setAttribute("src",dhtmlwindow.imagefiles[2]),e.setAttribute("title","Restore"),t.state="minimized",t.contentarea.style.display="none",t.statusarea.style.display="none",void 0===t.minimizeorder&&(dhtmlwindow.minimizeorder++,t.minimizeorder=dhtmlwindow.minimizeorder),t.style.left="10px",t.style.width="200px",t.style.top=dhtmlwindow.scroll_top+dhtmlwindow.docheight-t.handle.offsetHeight*t.minimizeorder-10*t.minimizeorder+"px"},restore:function(e,t){dhtmlwindow.getviewpoint(),e.setAttribute("src",dhtmlwindow.imagefiles[0]),e.setAttribute("title","Minimize"),t.state="fullview",t.style.display="block",t.contentarea.style.display="block",t.resizeBool&&(t.statusarea.style.display="block"),t.style.left=parseInt(t.lastx)+dhtmlwindow.scroll_left+"px",t.style.top=parseInt(t.lasty)+dhtmlwindow.scroll_top+"px",t.style.width=parseInt(t.lastwidth)+"px"},close:function(e){try{var t=e.onclose()}catch(i){t=!0}finally{void 0===t&&(alert('An error has occured somwhere inside your "onclose" event handler'),t=!0)}return t&&("minimized"!=e.state&&dhtmlwindow.rememberattrs(e),window.frames["_iframe-"+e.id]?window.frames["_iframe-"+e.id].location.replace("about:blank"):e.contentarea.innerHTML="",e.style.display="none",e.isClosed=!0),t},setopacity:function(e,t){e&&(e.filters&&e.filters[0]?"number"==typeof e.filters[0].opacity?e.filters[0].opacity=100*t:e.style.filter="alpha(opacity="+100*t+")":void 0!==e.style.MozOpacity?e.style.MozOpacity=t:void 0!==e.style.opacity&&(e.style.opacity=t))},setfocus:function(e){this.zIndexvalue++,e.style.zIndex=this.zIndexvalue,e.isClosed=!1,this.setopacity(this.lastactivet.handle,.5),this.setopacity(e.handle,1),this.lastactivet=e},show:function(e){e.isClosed?alert("DHTML Window has been closed, so nothing to show. Open/Create the window again."):(e.lastx?dhtmlwindow.restore(e.controls.firstChild,e):e.style.display="block",this.setfocus(e),e.state="fullview")},hide:function(e){e.style.display="none"},ajax_connect:function(e,t){var i=!1,s="";if(window.XMLHttpRequest)i=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;try{i=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{i=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}}t.contentarea.innerHTML=this.ajaxloadinghtml,i.onreadystatechange=function(){dhtmlwindow.ajax_loadpage(i,t)},this.ajaxbustcache&&(s=-1!=e.indexOf("?")?"&"+(new Date).getTime():"?"+(new Date).getTime()),i.open("GET",e+s,!0),i.send(null)},ajax_loadpage:function(e,t){4!=e.readyState||200!=e.status&&-1!=window.location.href.indexOf("http")||(t.contentarea.innerHTML=e.responseText)},stop:function(){dhtmlwindow.etarget=null,dhtmlwindow.distancex=0,dhtmlwindow.distancey=0,document.onmousemove=null,document.ontouchmove=null,document.onmouseup=null,document.ontouchend=null},addEvent:function(e,t,i){i=window.addEventListener?i:"on"+i,e.addEventListener?e.addEventListener(i,t,!1):e.attachEvent&&e.attachEvent(i,t)},cleanup:function(){for(var e=0;e<dhtmlwindow.tobjects.length;e++)dhtmlwindow.tobjects[e].handle._parent=dhtmlwindow.tobjects[e].resizearea._parent=dhtmlwindow.tobjects[e].controls._parent=null;window.onload=null}};window.onunload=dhtmlwindow.cleanup;var fabric=fabric||{version:"2.7.0"};function resizeCanvasIfNeeded(e){var t=e.targetCanvas,i=e.destinationWidth,s=e.destinationHeight;t.width===i&&t.height===s||(t.width=i,t.height=s)}function copyGLTo2DDrawImage(e,t){var i=e.canvas,s=t.targetCanvas,a=s.getContext("2d");a.translate(0,s.height),a.scale(1,-1),a.drawImage(i,0,i.height-s.height,s.width,s.height,0,0,s.width,s.height)}function copyGLTo2DPutImageData(e,t){var i=t.targetCanvas.getContext("2d"),s=t.destinationWidth,a=t.destinationHeight,n=s*a*4,r=new Uint8Array(this.imageBuffer,0,n),o=new Uint8ClampedArray(this.imageBuffer,0,n);e.readPixels(0,0,s,a,e.RGBA,e.UNSIGNED_BYTE,r);var l=new ImageData(o,s,a);i.putImageData(l,0,0)}function ddtabcontent(e){this.tabinterfaceid=e,this.tabs=document.getElementById(e).getElementsByTagName("a"),this.enabletabpersistence=!0,this.hottabspositions=[],this.currentTabIndex=0,this.subcontentids=[],this.revcontentids=[],this.selectedClassTarget="link"}"undefined"!=typeof exports?exports.fabric=fabric:"function"==typeof define&&define.amd&&define([],function(){return fabric}),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document instanceof HTMLDocument?document:document.implementation.createHTMLDocument(""),fabric.window=window):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=fabric.document.defaultView,DOMParser=require("xmldom").DOMParser),fabric.isTouchSupported="ontouchstart"in fabric.window||"ontouchstart"in fabric.document||fabric.window&&fabric.window.navigator&&0<fabric.window.navigator.maxTouchPoints,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.canvasModule="canvas",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.arcToSegmentsCache={},fabric.boundsOfCurveCache={},fabric.cachesBoundsOfCurve=!0,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0},"undefined"!=typeof document&&"undefined"!=typeof window&&(window.fabric=fabric),function(){function e(e,t){if(this.__eventListeners[e]){var i=this.__eventListeners[e];t?i[i.indexOf(t)]=!1:fabric.util.array.fill(i,!1)}}function t(e,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in e)this.on(i,e[i]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this}function i(t,i){if(this.__eventListeners){if(0===arguments.length)for(t in this.__eventListeners)e.call(this,t);else if(1===arguments.length&&"object"==typeof t)for(var s in t)e.call(this,s,t[s]);else e.call(this,t,i);return this}}function s(e,t){if(this.__eventListeners){var i=this.__eventListeners[e];if(i){for(var s=0,a=i.length;s<a;s++)i[s]&&i[s].call(this,t||{});return this.__eventListeners[e]=i.filter(function(e){return!1!==e}),this}}}fabric.Observable={observe:t,stopObserving:i,fire:s,on:t,off:i,trigger:s}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,i){var s=this._objects;return i?s[t]=e:s.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e,t=this._objects,i=!1,s=0,a=arguments.length;s<a;s++)-1!==(e=t.indexOf(arguments[s]))&&(i=!0,t.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[s]));return this.renderOnAddRemove&&i&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var i=this.getObjects(),s=0,a=i.length;s<a;s++)e.call(t,i[s],s,i);return this},getObjects:function(e){return void 0===e?this._objects.concat():this._objects.filter(function(t){return t.type===e})},item:function(e){return this._objects[e]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(e){return-1<this._objects.indexOf(e)},complexity:function(){return this._objects.reduce(function(e,t){return e+(t.complexity?t.complexity():0)},0)}},fabric.CommonMethods={_setOptions:function(e){for(var t in e)this.set(t,e[t])},_initGradient:function(e,t){!e||!e.colorStops||e instanceof fabric.Gradient||this.set(t,new fabric.Gradient(e))},_initPattern:function(e,t,i){!e||!e.source||e instanceof fabric.Pattern?i&&i():this.set(t,new fabric.Pattern(e,i))},_initClipping:function(e){if(e.clipTo&&"string"==typeof e.clipTo){var t=fabric.util.getFunctionBody(e.clipTo);void 0!==t&&(this.clipTo=new Function("ctx",t))}},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return"object"==typeof e?this._setObject(e):this._set(e,"function"==typeof t&&"clipTo"!==e?t(this.get(e)):t),this},_set:function(e,t){this[e]=t},toggle:function(e){var t=this.get(e);return"boolean"==typeof t&&this.set(e,!t),this},get:function(e){return this[e]}},function(e){var t=Math.sqrt,i=Math.atan2,s=Math.pow,a=Math.abs,n=Math.PI/180,r=Math.PI/2;fabric.util={cos:function(e){if(0===e)return 1;switch(e<0&&(e=-e),e/r){case 1:case 3:return 0;case 2:return-1}return Math.cos(e)},sin:function(e){if(0===e)return 0;var t=1;switch(e<0&&(t=-1),e/r){case 1:return t;case 2:return 0;case 3:return-t}return Math.sin(e)},removeFromArray:function(e,t){var i=e.indexOf(t);return-1!==i&&e.splice(i,1),e},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*n},radiansToDegrees:function(e){return e/n},rotatePoint:function(e,t,i){e.subtractEquals(t);var s=fabric.util.rotateVector(e,i);return new fabric.Point(s.x,s.y).addEquals(t)},rotateVector:function(e,t){var i=fabric.util.sin(t),s=fabric.util.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}},transformPoint:function(e,t,i){return i?new fabric.Point(t[0]*e.x+t[2]*e.y,t[1]*e.x+t[3]*e.y):new fabric.Point(t[0]*e.x+t[2]*e.y+t[4],t[1]*e.x+t[3]*e.y+t[5])},makeBoundingBoxFromPoints:function(e){var t=[e[0].x,e[1].x,e[2].x,e[3].x],i=fabric.util.array.min(t),s=fabric.util.array.max(t)-i,a=[e[0].y,e[1].y,e[2].y,e[3].y],n=fabric.util.array.min(a);return{left:i,top:n,width:s,height:fabric.util.array.max(a)-n}},invertTransform:function(e){var t=1/(e[0]*e[3]-e[1]*e[2]),i=[t*e[3],-t*e[1],-t*e[2],t*e[0]],s=fabric.util.transformPoint({x:e[4],y:e[5]},i,!0);return i[4]=-s.x,i[5]=-s.y,i},toFixed:function(e,t){return parseFloat(Number(e).toFixed(t))},parseUnit:function(e,t){var i=/\D{0,2}$/.exec(e),s=parseFloat(e);switch(t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return s*fabric.DPI/25.4;case"cm":return s*fabric.DPI/2.54;case"in":return s*fabric.DPI;case"pt":return s*fabric.DPI/72;case"pc":return s*fabric.DPI/72*12;case"em":return s*t;default:return s}},falseFunction:function(){return!1},getKlass:function(e,t){return e=fabric.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),fabric.util.resolveNamespace(t)[e]},getSvgAttributes:function(e){var t=["instantiated_by_use","style","id","class"];switch(e){case"linearGradient":t=t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":t=t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":t=t.concat(["offset","stop-color","stop-opacity"])}return t},resolveNamespace:function(t){if(!t)return fabric;var i,s=t.split("."),a=s.length,n=e||fabric.window;for(i=0;i<a;++i)n=n[s[i]];return n},loadImage:function(e,t,i,s){if(e){var a=fabric.util.createImage(),n=function(){t&&t.call(i,a),a=a.onload=a.onerror=null};a.onload=n,a.onerror=function(){fabric.log("Error loading "+a.src),t&&t.call(i,null,!0),a=a.onload=a.onerror=null},0!==e.indexOf("data")&&s&&(a.crossOrigin=s),"data:image/svg"===e.substring(0,14)&&(a.onload=null,fabric.util.loadImageInDom(a,n)),a.src=e}else t&&t.call(i,e)},loadImageInDom:function(e,t){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(e),fabric.document.querySelector("body").appendChild(i),e.onload=function(){t(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(e,t,i,s){function a(){++r===o&&t&&t(n)}var n=[],r=0,o=(e=e||[]).length;o?e.forEach(function(e,t){e&&e.type?fabric.util.getKlass(e.type,i).fromObject(e,function(i,r){r||(n[t]=i),s&&s(e,i,r),a()}):a()}):t&&t(n)},enlivenPatterns:function(e,t){function i(){++a===n&&t&&t(s)}var s=[],a=0,n=(e=e||[]).length;n?e.forEach(function(e,t){e&&e.source?new fabric.Pattern(e,function(e){s[t]=e,i()}):(s[t]=e,i())}):t&&t(s)},groupSVGElements:function(e,t,i){var s;return e&&1===e.length?e[0]:(t&&(t.width&&t.height?t.centerPoint={x:t.width/2,y:t.height/2}:(delete t.width,delete t.height)),s=new fabric.Group(e,t),void 0!==i&&(s.sourcePath=i),s)},populateWithProperties:function(e,t,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var s=0,a=i.length;s<a;s++)i[s]in e&&(t[i[s]]=e[i[s]])},drawDashedLine:function(e,s,a,n,r,o){var l=n-s,c=r-a,h=t(l*l+c*c),u=i(c,l),d=o.length,p=0,f=!0;for(e.save(),e.translate(s,a),e.moveTo(0,0),e.rotate(u),s=0;s<h;)h<(s+=o[p++%d])&&(s=h),e[f?"lineTo":"moveTo"](s,0),f=!f;e.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},copyCanvasElement:function(e){var t=fabric.util.createCanvasElement();return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},toDataURL:function(e,t,i){return e.toDataURL("image/"+t,i)},createImage:function(){return fabric.document.createElement("img")},clipContext:function(e,t){t.save(),t.beginPath(),e.clipTo(t),t.clip()},multiplyTransformMatrices:function(e,t,i){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],i?0:e[0]*t[4]+e[2]*t[5]+e[4],i?0:e[1]*t[4]+e[3]*t[5]+e[5]]},qrDecompose:function(e){var a=i(e[1],e[0]),r=s(e[0],2)+s(e[1],2),o=t(r),l=(e[0]*e[3]-e[2]*e[1])/o,c=i(e[0]*e[2]+e[1]*e[3],r);return{angle:a/n,scaleX:o,scaleY:l,skewX:c/n,skewY:0,translateX:e[4],translateY:e[5]}},customTransformMatrix:function(e,t,i){var s=[1,0,a(Math.tan(i*n)),1],r=[a(e),0,0,a(t)];return fabric.util.multiplyTransformMatrices(r,s,!0)},resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.flipX=!1,e.flipY=!1,e.rotate(0)},saveObjectTransform:function(e){return{scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,angle:e.angle,left:e.left,flipX:e.flipX,flipY:e.flipY,top:e.top}},getFunctionBody:function(e){return(String(e).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(e,t,i,s){0<s&&(s<t?t-=s:t=0,s<i?i-=s:i=0);var a,n=!0,r=e.getImageData(t,i,2*s||1,2*s||1),o=r.data.length;for(a=3;a<o&&0!=(n=r.data[a]<=0);a+=4);return r=null,n},parsePreserveAspectRatioAttribute:function(e){var t,i="meet",s=e.split(" ");return s&&s.length&&("meet"!==(i=s.pop())&&"slice"!==i?(t=i,i="meet"):s.length&&(t=s.pop())),{meetOrSlice:i,alignX:"none"!==t?t.slice(1,4):"none",alignY:"none"!==t?t.slice(5,8):"none"}},clearFabricFontCache:function(e){(e=(e||"").toLowerCase())?fabric.charWidthsCache[e]&&delete fabric.charWidthsCache[e]:fabric.charWidthsCache={}},limitDimsByArea:function(e,t){var i=Math.sqrt(t*e),s=Math.floor(t/i);return{x:Math.floor(i),y:s}},capValue:function(e,t,i){return Math.max(e,Math.min(t,i))},findScaleToFit:function(e,t){return Math.min(t.width/e.width,t.height/e.height)},findScaleToCover:function(e,t){return Math.max(t.width/e.width,t.height/e.height)}}}("undefined"!=typeof exports?exports:this),function(){var e=Array.prototype.join;function t(t,s,a,n,r,o,l){var c=e.call(arguments);if(fabric.arcToSegmentsCache[c])return fabric.arcToSegmentsCache[c];var h=Math.PI,u=l*h/180,d=fabric.util.sin(u),p=fabric.util.cos(u),f=0,g=0,m=-p*t*.5-d*s*.5,v=-p*s*.5+d*t*.5,b=(a=Math.abs(a))*a,y=(n=Math.abs(n))*n,x=v*v,w=m*m,S=b*y-b*x-y*w,C=0;if(S<0){var A=Math.sqrt(1-S/(b*y));a*=A,n*=A}else C=(r===o?-1:1)*Math.sqrt(S/(b*x+y*w));var _=C*a*v/n,k=-C*n*m/a,T=p*_-d*k+.5*t,I=d*_+p*k+.5*s,M=i(1,0,(m-_)/a,(v-k)/n),O=i((m-_)/a,(v-k)/n,(-m-_)/a,(-v-k)/n);0===o&&0<O?O-=2*h:1===o&&O<0&&(O+=2*h);for(var P,D,J,E,L,j,F,R,N,z,B,H,W,q,G,$,U,X=Math.ceil(Math.abs(O/h*2)),Y=[],V=O/X,K=8/3*Math.sin(V/4)*Math.sin(V/4)/Math.sin(V/2),Z=M+V,Q=0;Q<X;Q++)Y[Q]=(D=Z,J=p,E=d,L=a,j=n,F=T,R=I,N=K,z=f,B=g,H=fabric.util.cos(P=M),[z+N*(-J*L*(W=fabric.util.sin(P))-E*j*H),B+N*(-E*L*W+J*j*H),($=J*L*(q=fabric.util.cos(D))-E*j*(G=fabric.util.sin(D))+F)+N*(J*L*G+E*j*q),(U=E*L*q+J*j*G+R)+N*(E*L*G-J*j*q),$,U]),f=Y[Q][4],g=Y[Q][5],M=Z,Z+=V;return fabric.arcToSegmentsCache[c]=Y}function i(e,t,i,s){var a=Math.atan2(t,e),n=Math.atan2(s,i);return a<=n?n-a:2*Math.PI-(a-n)}function s(t,i,s,a,n,r,o,l){var c;if(fabric.cachesBoundsOfCurve&&(c=e.call(arguments),fabric.boundsOfCurveCache[c]))return fabric.boundsOfCurveCache[c];var h,u,d,p,f,g,m,v,b=Math.sqrt,y=Math.min,x=Math.max,w=Math.abs,S=[],C=[[],[]];u=6*t-12*s+6*n,h=-3*t+9*s-9*n+3*o,d=3*s-3*t;for(var A=0;A<2;++A)if(0<A&&(u=6*i-12*a+6*r,h=-3*i+9*a-9*r+3*l,d=3*a-3*i),w(h)<1e-12){if(w(u)<1e-12)continue;0<(p=-d/u)&&p<1&&S.push(p)}else(m=u*u-4*d*h)<0||(0<(f=(-u+(v=b(m)))/(2*h))&&f<1&&S.push(f),0<(g=(-u-v)/(2*h))&&g<1&&S.push(g));for(var _,k,T=S.length,I=T;T--;)_=(k=1-(p=S[T]))*k*k*t+3*k*k*p*s+3*k*p*p*n+p*p*p*o,C[0][T]=_,C[1][T]=k*k*k*i+3*k*k*p*a+3*k*p*p*r+p*p*p*l;C[0][I]=t,C[1][I]=i,C[0][I+1]=o,C[1][I+1]=l;var M=[{x:y.apply(null,C[0]),y:y.apply(null,C[1])},{x:x.apply(null,C[0]),y:x.apply(null,C[1])}];return fabric.cachesBoundsOfCurve&&(fabric.boundsOfCurveCache[c]=M),M}fabric.util.drawArc=function(e,i,s,a){for(var n=[[],[],[],[]],r=t(a[5]-i,a[6]-s,a[0],a[1],a[3],a[4],a[2]),o=0,l=r.length;o<l;o++)n[o][0]=r[o][0]+i,n[o][1]=r[o][1]+s,n[o][2]=r[o][2]+i,n[o][3]=r[o][3]+s,n[o][4]=r[o][4]+i,n[o][5]=r[o][5]+s,e.bezierCurveTo.apply(e,n[o])},fabric.util.getBoundsOfArc=function(e,i,a,n,r,o,l,c,h){for(var u,d=0,p=0,f=[],g=t(c-e,h-i,a,n,o,l,r),m=0,v=g.length;m<v;m++)u=s(d,p,g[m][0],g[m][1],g[m][2],g[m][3],g[m][4],g[m][5]),f.push({x:u[0].x+e,y:u[0].y+i}),f.push({x:u[1].x+e,y:u[1].y+i}),d=g[m][4],p=g[m][5];return f},fabric.util.getBoundsOfCurve=s}(),function(){var e=Array.prototype.slice;function t(e,t,i){if(e&&0!==e.length){var s=e.length-1,a=t?e[s][t]:e[s];if(t)for(;s--;)i(e[s][t],a)&&(a=e[s][t]);else for(;s--;)i(e[s],a)&&(a=e[s]);return a}}fabric.util.array={fill:function(e,t){for(var i=e.length;i--;)e[i]=t;return e},invoke:function(t,i){for(var s=e.call(arguments,2),a=[],n=0,r=t.length;n<r;n++)a[n]=s.length?t[n][i].apply(t[n],s):t[n][i].call(t[n]);return a},min:function(e,i){return t(e,i,function(e,t){return e<t})},max:function(e,i){return t(e,i,function(e,t){return t<=e})}}}(),function(){function e(t,i,s){if(s)if(!fabric.isLikelyNode&&i instanceof Element)t=i;else if(i instanceof Array){t=[];for(var a=0,n=i.length;a<n;a++)t[a]=e({},i[a],s)}else if(i&&"object"==typeof i)for(var r in i)"canvas"===r?t[r]=e({},i[r]):i.hasOwnProperty(r)&&(t[r]=e({},i[r],s));else t=i;else for(var r in i)t[r]=i[r];return t}fabric.util.object={extend:e,clone:function(t,i){return e({},t,i)}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function e(e,t){var i=e.charCodeAt(t);if(isNaN(i))return"";if(i<55296||57343<i)return e.charAt(t);if(55296<=i&&i<=56319){if(e.length<=t+1)throw"High surrogate without following low surrogate";var s=e.charCodeAt(t+1);if(s<56320||57343<s)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(0===t)throw"Low surrogate without preceding high surrogate";var a=e.charCodeAt(t-1);if(a<55296||56319<a)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(t){var i,s=0,a=[];for(s=0;s<t.length;s++)!1!==(i=e(t,s))&&a.push(i);return a}}}(),function(){var e=Array.prototype.slice,t=function(){},i=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}(),s=function(e,t,s){for(var a in t)e.prototype[a]=a in e.prototype&&"function"==typeof e.prototype[a]&&-1<(t[a]+"").indexOf("callSuper")?function(e){return function(){var i=this.constructor.superclass;this.constructor.superclass=s;var a=t[e].apply(this,arguments);if(this.constructor.superclass=i,"initialize"!==e)return a}}(a):t[a],i&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};function a(){}function n(t){for(var i=null,s=this;s.constructor.superclass;){var a=s.constructor.superclass.prototype[t];if(s[t]!==a){i=a;break}s=s.constructor.superclass.prototype}return i?1<arguments.length?i.apply(this,e.call(arguments,1)):i.call(this):console.log("tried to callSuper "+t+", method not found in prototype chain",this)}fabric.util.createClass=function(){var i=null,r=e.call(arguments,0);function o(){this.initialize.apply(this,arguments)}"function"==typeof r[0]&&(i=r.shift()),o.superclass=i,o.subclasses=[],i&&(a.prototype=i.prototype,o.prototype=new a,i.subclasses.push(o));for(var l=0,c=r.length;l<c;l++)s(o,r[l],i);return o.prototype.initialize||(o.prototype.initialize=t),(o.prototype.constructor=o).prototype.callSuper=n,o}}(),function(){function e(e){var t,i=Array.prototype.slice.call(arguments,1),s=i.length;for(t=0;t<s;t++)if(!/^(?:function|object|unknown)$/.test(typeof e[i[t]]))return!1;return!0}var t,i,s,a,n=(s=0,function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+s++)});function r(e,i){return{handler:i,wrappedHandler:(s=e,a=i,function(e){a.call(t(s),e||fabric.window.event)})};var s,a}a={},t=function(e){return a[e]},i=function(e,t){a[e]=t};var o,l,c=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),h=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),u={},d={};c?(o=function(e,t,i,s){e&&e.addEventListener(t,i,!h&&s)},l=function(e,t,i,s){e&&e.removeEventListener(t,i,!h&&s)}):h?(o=function(e,t,s){if(e){var a=n(e);i(a,e),u[a]||(u[a]={}),u[a][t]||(u[a][t]=[]);var o=r(a,s);u[a][t].push(o),e.attachEvent("on"+t,o.wrappedHandler)}},l=function(e,t,i){if(e){var s,a=n(e);if(u[a]&&u[a][t])for(var r=0,o=u[a][t].length;r<o;r++)(s=u[a][t][r])&&s.handler===i&&(e.detachEvent("on"+t,s.wrappedHandler),u[a][t][r]=null)}}):(o=function(e,t,i){if(e){var s,a,r=n(e);if(d[r]||(d[r]={}),!d[r][t]){d[r][t]=[];var o=e["on"+t];o&&d[r][t].push(o),e["on"+t]=(s=r,a=t,function(e){if(d[s]&&d[s][a])for(var t=d[s][a],i=0,n=t.length;i<n;i++)t[i].call(this,e||fabric.window.event)})}d[r][t].push(i)}},l=function(e,t,i){if(e){var s=n(e);if(d[s]&&d[s][t])for(var a=d[s][t],r=0,o=a.length;r<o;r++)a[r]===i&&a.splice(r,1)}}),fabric.util.addListener=o,fabric.util.removeListener=l;var p=function(e){return e.clientX},f=function(e){return e.clientY};function g(e,t,i){var s,a=e["touchend"===e.type?"changedTouches":"touches"];return a&&a[0]&&(s=a[0][i]),void 0===s&&(s=e[i]),s}fabric.isTouchSupported&&(p=function(e){return g(e,0,"clientX")},f=function(e){return g(e,0,"clientY")}),fabric.util.getPointer=function(e){e||(e=fabric.window.event);var t=fabric.util.getScrollLeftTop(e.target||("unknown"!=typeof e.srcElement?e.srcElement:null));return{x:p(e)+t.left,y:f(e)+t.top}}}(),function(){var e=fabric.document.createElement("div"),t=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,i=function(e){return e};"string"==typeof e.style.opacity?i=function(e,t){return e.style.opacity=t,e}:"string"==typeof e.style.filter&&(i=function(e,i){var s=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(s.zoom=1),t.test(s.filter)?s.filter=s.filter.replace(t,i=.9999<=i?"":"alpha(opacity="+100*i+")"):s.filter+=" alpha(opacity="+100*i+")",e}),fabric.util.setStyle=function(e,t){var s=e.style;if(!s)return e;if("string"==typeof t)return e.style.cssText+=";"+t,-1<t.indexOf("opacity")?i(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var a in t)"opacity"===a?i(e,t[a]):s["float"===a||"cssFloat"===a?void 0===s.styleFloat?"cssFloat":"styleFloat":a]=t[a];return e}}(),function(){var e,t,i,s,a=Array.prototype.slice,n=function(e){return a.call(e,0)};try{e=n(fabric.document.childNodes)instanceof Array}catch(e){}function r(e,t){var i=fabric.document.createElement(e);for(var s in t)"class"===s?i.className=t[s]:"for"===s?i.htmlFor=t[s]:i.setAttribute(s,t[s]);return i}function o(e){for(var t=0,i=0,s=fabric.document.documentElement,a=fabric.document.body||{scrollLeft:0,scrollTop:0};e&&(e.parentNode||e.host)&&((e=e.parentNode||e.host)===fabric.document?(t=a.scrollLeft||s.scrollLeft||0,i=a.scrollTop||s.scrollTop||0):(t+=e.scrollLeft||0,i+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:t,top:i}}e||(n=function(e){for(var t=new Array(e.length),i=e.length;i--;)t[i]=e[i];return t}),t=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(e,t){var i=fabric.document.defaultView.getComputedStyle(e,null);return i?i[t]:void 0}:function(e,t){var i=e.style[t];return!i&&e.currentStyle&&(i=e.currentStyle[t]),i},s="userSelect"in(i=fabric.document.documentElement.style)?"userSelect":"MozUserSelect"in i?"MozUserSelect":"WebkitUserSelect"in i?"WebkitUserSelect":"KhtmlUserSelect"in i?"KhtmlUserSelect":"",fabric.util.makeElementUnselectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=fabric.util.falseFunction),s?e.style[s]="none":"string"==typeof e.unselectable&&(e.unselectable="on"),e},fabric.util.makeElementSelectable=function(e){return void 0!==e.onselectstart&&(e.onselectstart=null),s?e.style[s]="":"string"==typeof e.unselectable&&(e.unselectable=""),e},fabric.util.getScript=function(e,t){var i=fabric.document.getElementsByTagName("head")[0],s=fabric.document.createElement("script"),a=!0;s.onload=s.onreadystatechange=function(e){if(a){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;a=!1,t(e||fabric.window.event),s=s.onload=s.onreadystatechange=null}},s.src=e,i.appendChild(s)},fabric.util.getById=function(e){return"string"==typeof e?fabric.document.getElementById(e):e},fabric.util.toArray=n,fabric.util.makeElement=r,fabric.util.addClass=function(e,t){e&&-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=(e.className?" ":"")+t)},fabric.util.wrapElement=function(e,t,i){return"string"==typeof t&&(t=r(t,i)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t},fabric.util.getScrollLeftTop=o,fabric.util.getElementOffset=function(e){var i,s,a=e&&e.ownerDocument,n={left:0,top:0},r={left:0,top:0},l={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!a)return r;for(var c in l)r[l[c]]+=parseInt(t(e,c),10)||0;return i=a.documentElement,void 0!==e.getBoundingClientRect&&(n=e.getBoundingClientRect()),s=o(e),{left:n.left+s.left-(i.clientLeft||0)+r.left,top:n.top+s.top-(i.clientTop||0)+r.top}},fabric.util.getElementStyle=t,fabric.util.getNodeCanvas=function(e){var t=fabric.jsdomImplForWrapper(e);return t._canvas||t._image},fabric.util.cleanUpJsdomNode=function(e){if(fabric.isLikelyNode){var t=fabric.jsdomImplForWrapper(e);t&&(t._image=null,t._canvas=null,t._currentSrc=null,t._attributes=null,t._classList=null)}}}(),function(){function e(){}fabric.util.request=function(t,i){i||(i={});var s,a,n=i.method?i.method.toUpperCase():"GET",r=i.onComplete||function(){},o=new fabric.window.XMLHttpRequest,l=i.body||i.parameters;return o.onreadystatechange=function(){4===o.readyState&&(r(o),o.onreadystatechange=e)},"GET"===n&&(l=null,"string"==typeof i.parameters&&(a=i.parameters,t=(s=t)+(/\?/.test(s)?"&":"?")+a)),o.open(n,t,!0),"POST"!==n&&"PUT"!==n||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(l),o}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(e){void 0!==console[e]&&"function"==typeof console[e].apply&&(fabric[e]=function(){return console[e].apply(console,arguments)})}),function(){function e(){return!1}var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(e){return fabric.window.setTimeout(e,1e3/60)},i=fabric.window.cancelAnimationFrame||fabric.window.clearTimeout;function s(){return t.apply(fabric.window,arguments)}fabric.util.animate=function(t){s(function(i){t||(t={});var a,n=i||+new Date,r=t.duration||500,o=n+r,l=t.onChange||e,c=t.abort||e,h=t.onComplete||e,u=t.easing||function(e,t,i,s){return-i*Math.cos(e/s*(Math.PI/2))+i+t},d="startValue"in t?t.startValue:0,p="endValue"in t?t.endValue:100,f=t.byValue||p-d;t.onStart&&t.onStart(),function e(i){if(c())h(p,1,1);else{a=i||+new Date;var g=o<a?r:a-n,m=g/r,v=u(g,d,f,r),b=Math.abs((v-d)/f);l(v,b,m),o<a?t.onComplete&&t.onComplete():s(e)}}(n)})},fabric.util.requestAnimFrame=s,fabric.util.cancelAnimFrame=function(){return i.apply(fabric.window,arguments)}}(),fabric.util.animateColor=function(e,t,i,s){var a=new fabric.Color(e).getSource(),n=new fabric.Color(t).getSource();fabric.util.animate(fabric.util.object.extend(s=s||{},{duration:i||500,startValue:a,endValue:n,byValue:n,easing:function(e,t,i,a){var n,r,o,l;return n=t,r=i,o=s.colorEasing?s.colorEasing(e,a):1-Math.cos(e/a*(Math.PI/2)),l="rgba("+parseInt(n[0]+o*(r[0]-n[0]),10)+","+parseInt(n[1]+o*(r[1]-n[1]),10)+","+parseInt(n[2]+o*(r[2]-n[2]),10),(l+=","+(n&&r?parseFloat(n[3]+o*(r[3]-n[3])):1))+")"}}))},function(){function e(e,t,i,s){return e<Math.abs(t)?(e=t,s=i/4):s=0===t&&0===e?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(t/e),{a:e,c:t,p:i,s:s}}function t(e,t,i){return e.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-e.s)*(2*Math.PI)/e.p)}function i(e,t,i,a){return i-s(a-e,0,i,a)+t}function s(e,t,i,s){return(e/=s)<1/2.75?i*(7.5625*e*e)+t:e<2/2.75?i*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?i*(7.5625*(e-=2.25/2.75)*e+.9375)+t:i*(7.5625*(e-=2.625/2.75)*e+.984375)+t}fabric.util.ease={easeInQuad:function(e,t,i,s){return i*(e/=s)*e+t},easeOutQuad:function(e,t,i,s){return-i*(e/=s)*(e-2)+t},easeInOutQuad:function(e,t,i,s){return(e/=s/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,i,s){return i*(e/=s)*e*e+t},easeOutCubic:function(e,t,i,s){return i*((e=e/s-1)*e*e+1)+t},easeInOutCubic:function(e,t,i,s){return(e/=s/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},easeInQuart:function(e,t,i,s){return i*(e/=s)*e*e*e+t},easeOutQuart:function(e,t,i,s){return-i*((e=e/s-1)*e*e*e-1)+t},easeInOutQuart:function(e,t,i,s){return(e/=s/2)<1?i/2*e*e*e*e+t:-i/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(e,t,i,s){return i*(e/=s)*e*e*e*e+t},easeOutQuint:function(e,t,i,s){return i*((e=e/s-1)*e*e*e*e+1)+t},easeInOutQuint:function(e,t,i,s){return(e/=s/2)<1?i/2*e*e*e*e*e+t:i/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(e,t,i,s){return-i*Math.cos(e/s*(Math.PI/2))+i+t},easeOutSine:function(e,t,i,s){return i*Math.sin(e/s*(Math.PI/2))+t},easeInOutSine:function(e,t,i,s){return-i/2*(Math.cos(Math.PI*e/s)-1)+t},easeInExpo:function(e,t,i,s){return 0===e?t:i*Math.pow(2,10*(e/s-1))+t},easeOutExpo:function(e,t,i,s){return e===s?t+i:i*(1-Math.pow(2,-10*e/s))+t},easeInOutExpo:function(e,t,i,s){return 0===e?t:e===s?t+i:(e/=s/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(2-Math.pow(2,-10*--e))+t},easeInCirc:function(e,t,i,s){return-i*(Math.sqrt(1-(e/=s)*e)-1)+t},easeOutCirc:function(e,t,i,s){return i*Math.sqrt(1-(e=e/s-1)*e)+t},easeInOutCirc:function(e,t,i,s){return(e/=s/2)<1?-i/2*(Math.sqrt(1-e*e)-1)+t:i/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(i,s,a,n){var r=0;return 0===i?s:1==(i/=n)?s+a:(r||(r=.3*n),-t(e(a,a,r,1.70158),i,n)+s)},easeOutElastic:function(t,i,s,a){var n=0;if(0===t)return i;if(1==(t/=a))return i+s;n||(n=.3*a);var r=e(s,s,n,1.70158);return r.a*Math.pow(2,-10*t)*Math.sin((t*a-r.s)*(2*Math.PI)/r.p)+r.c+i},easeInOutElastic:function(i,s,a,n){var r=0;if(0===i)return s;if(2==(i/=n/2))return s+a;r||(r=n*(.3*1.5));var o=e(a,a,r,1.70158);return i<1?-.5*t(o,i,n)+s:o.a*Math.pow(2,-10*(i-=1))*Math.sin((i*n-o.s)*(2*Math.PI)/o.p)*.5+o.c+s},easeInBack:function(e,t,i,s,a){return void 0===a&&(a=1.70158),i*(e/=s)*e*((a+1)*e-a)+t},easeOutBack:function(e,t,i,s,a){return void 0===a&&(a=1.70158),i*((e=e/s-1)*e*((a+1)*e+a)+1)+t},easeInOutBack:function(e,t,i,s,a){return void 0===a&&(a=1.70158),(e/=s/2)<1?i/2*(e*e*((1+(a*=1.525))*e-a))+t:i/2*((e-=2)*e*((1+(a*=1.525))*e+a)+2)+t},easeInBounce:i,easeOutBounce:s,easeInOutBounce:function(e,t,a,n){return e<n/2?.5*i(2*e,0,a,n)+t:.5*s(2*e-n,0,a,n)+.5*a+t}}}(),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,s=t.util.object.clone,a=t.util.toFixed,n=t.util.parseUnit,r=t.util.multiplyTransformMatrices,o={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},l={stroke:"strokeOpacity",fill:"fillOpacity"};function c(e,i,s,a){var o,l="[object Array]"===Object.prototype.toString.call(i);if("fill"!==e&&"stroke"!==e||"none"!==i)if("vector-effect"===e)i="non-scaling-stroke"===i;else if("strokeDashArray"===e)i="none"===i?null:i.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===e)i=s&&s.transformMatrix?r(s.transformMatrix,t.parseTransformAttribute(i)):t.parseTransformAttribute(i);else if("visible"===e)i="none"!==i&&"hidden"!==i,s&&!1===s.visible&&(i=!1);else if("opacity"===e)i=parseFloat(i),s&&void 0!==s.opacity&&(i*=s.opacity);else if("textAnchor"===e)i="start"===i?"left":"end"===i?"right":"center";else if("charSpacing"===e)o=n(i,a)/a*1e3;else if("paintFirst"===e){var c=i.indexOf("fill"),h=i.indexOf("stroke");i="fill",-1<c&&-1<h&&h<c?i="stroke":-1===c&&-1<h&&(i="stroke")}else{if("href"===e||"xlink:href"===e)return i;o=l?i.map(n):n(i,a)}else i="";return!l&&isNaN(o)?i:o}function h(e){return new RegExp("^("+e.join("|")+")\\b","i")}function u(e,t){var i,s,a,n=[];for(s=0,a=t.length;s<a;s++)i=e.getElementsByTagName(t[s]),n=n.concat(Array.prototype.slice.call(i));return n}function d(e,t){var i,s=!0;return(i=p(e,t.pop()))&&t.length&&(s=function(e,t){for(var i,s=!0;e.parentNode&&1===e.parentNode.nodeType&&t.length;)s&&(i=t.pop()),s=p(e=e.parentNode,i);return 0===t.length}(e,t)),i&&s&&0===t.length}function p(e,t){var i,s,a=e.nodeName,n=e.getAttribute("class"),r=e.getAttribute("id");if(i=new RegExp("^"+a,"i"),t=t.replace(i,""),r&&t.length&&(i=new RegExp("#"+r+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),n&&t.length)for(s=(n=n.split(" ")).length;s--;)i=new RegExp("\\."+n[s]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return 0===t.length}function f(e,t){var i;if(e.getElementById&&(i=e.getElementById(t)),i)return i;var s,a,n,r=e.getElementsByTagName("*");for(a=0,n=r.length;a<n;a++)if(t===(s=r[a]).getAttribute("id"))return s}t.svgValidTagNamesRegEx=h(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),t.svgViewBoxElementsRegEx=h(["symbol","image","marker","pattern","view","svg"]),t.svgInvalidAncestorsRegEx=h(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),t.svgValidParentsRegEx=h(["symbol","g","a","svg","clipPath","defs"]),t.cssRules={},t.gradientDefs={},t.clipPaths={},t.parseTransformAttribute=function(){function e(e,i,s){e[s]=Math.tan(t.util.degreesToRadians(i[0]))}var i=t.iMatrix,s=t.reNum,a="(?:\\s+,?\\s*|,\\s*)",n="(?:(?:(matrix)\\s*\\(\\s*("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")"+a+"("+s+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+s+")(?:"+a+"("+s+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+s+")(?:"+a+"("+s+")"+a+"("+s+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+s+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+s+")\\s*\\)))",r=new RegExp("^\\s*(?:(?:"+n+"(?:"+a+"*"+n+")*)?)\\s*$"),o=new RegExp(n,"g");return function(s){var a=i.concat(),l=[];if(!s||s&&!r.test(s))return a;s.replace(o,function(s){var r,o,c,h,u,d,p,f,g,m,v,b,y=new RegExp(n).exec(s).filter(function(e){return!!e}),x=y[1],w=y.slice(2).map(parseFloat);switch(x){case"translate":(v=a)[4]=(b=w)[0],2===b.length&&(v[5]=b[1]);break;case"rotate":w[0]=t.util.degreesToRadians(w[0]),u=a,p=t.util.cos((d=w)[0]),f=t.util.sin(d[0]),m=g=0,3===d.length&&(g=d[1],m=d[2]),u[0]=p,u[1]=f,u[2]=-f,u[3]=p,u[4]=g-(p*g-f*m),u[5]=m-(f*g+p*m);break;case"scale":c=(o=w)[0],h=2===o.length?o[1]:o[0],(r=a)[0]=c,r[3]=h;break;case"skewX":e(a,w,2);break;case"skewY":e(a,w,1);break;case"matrix":a=w}l.push(a.concat()),a=i.concat()});for(var c=l[0];1<l.length;)l.shift(),c=t.util.multiplyTransformMatrices(c,l[0]);return c}}();var g=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");function m(e){var i,s,a,r,o,l,c=e.getAttribute("viewBox"),h=1,u=1,d=e.getAttribute("width"),p=e.getAttribute("height"),f=e.getAttribute("x")||0,m=e.getAttribute("y")||0,v=e.getAttribute("preserveAspectRatio")||"",b=!c||!t.svgViewBoxElementsRegEx.test(e.nodeName)||!(c=c.match(g)),y=!d||!p||"100%"===d||"100%"===p,x=b&&y,w={},S="",C=0,A=0;if(w.width=0,w.height=0,w.toBeParsed=x)return w;if(b)return w.width=n(d),w.height=n(p),w;if(i=-parseFloat(c[1]),s=-parseFloat(c[2]),a=parseFloat(c[3]),r=parseFloat(c[4]),y?(w.width=a,w.height=r):(w.width=n(d),w.height=n(p),h=w.width/a,u=w.height/r),"none"!==(v=t.util.parsePreserveAspectRatioAttribute(v)).alignX&&("meet"===v.meetOrSlice&&(u=h=u<h?u:h),"slice"===v.meetOrSlice&&(u=h=u<h?h:u),C=w.width-a*h,A=w.height-r*h,"Mid"===v.alignX&&(C/=2),"Mid"===v.alignY&&(A/=2),"Min"===v.alignX&&(C=0),"Min"===v.alignY&&(A=0)),1===h&&1===u&&0===i&&0===s&&0===f&&0===m)return w;if((f||m)&&(S=" translate("+n(f)+" "+n(m)+") "),w.viewboxTransform=t.parseTransformAttribute(o=S+" matrix("+h+" 0 0 "+u+" "+(i*h+C)+" "+(s*u+A)+") "),"svg"===e.nodeName){for(l=e.ownerDocument.createElement("g");e.firstChild;)l.appendChild(e.firstChild);e.appendChild(l)}else o=(l=e).getAttribute("transform")+o;return l.setAttribute("transform",o),w}function v(e,t){var i="xlink:href",s=f(e,t.getAttribute(i).substr(1));if(s&&s.getAttribute(i)&&v(e,s),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(e){t.hasAttribute(e)||t.setAttribute(e,s.getAttribute(e))}),!t.children.length)for(var a=s.cloneNode(!0);a.firstChild;)t.appendChild(a.firstChild);t.removeAttribute(i)}t.parseSVGDocument=function(e,i,a,n){if(e){!function(e){for(var t=u(e,["use","svg:use"]),i=0;t.length&&i<t.length;){var s,a,n,r,o=t[i],l=(o.getAttribute("xlink:href")||o.getAttribute("href")).substr(1),c=o.getAttribute("x")||0,h=o.getAttribute("y")||0,d=f(e,l).cloneNode(!0),p=(d.getAttribute("transform")||"")+" translate("+c+", "+h+")",g=t.length;if(m(d),/^svg$/i.test(d.nodeName)){var v=d.ownerDocument.createElement("g");for(a=0,r=(n=d.attributes).length;a<r;a++)s=n.item(a),v.setAttribute(s.nodeName,s.nodeValue);for(;d.firstChild;)v.appendChild(d.firstChild);d=v}for(a=0,r=(n=o.attributes).length;a<r;a++)"x"!==(s=n.item(a)).nodeName&&"y"!==s.nodeName&&"xlink:href"!==s.nodeName&&"href"!==s.nodeName&&("transform"===s.nodeName?p=s.nodeValue+" "+p:d.setAttribute(s.nodeName,s.nodeValue));d.setAttribute("transform",p),d.setAttribute("instantiated_by_use","1"),d.removeAttribute("id"),o.parentNode.replaceChild(d,o),t.length===g&&i++}}(e);var r,o,l=t.Object.__uid++,c=m(e),h=t.util.toArray(e.getElementsByTagName("*"));if(c.crossOrigin=n&&n.crossOrigin,c.svgUid=l,0===h.length&&t.isLikelyNode){var d=[];for(r=0,o=(h=e.selectNodes('//*[name(.)!="svg"]')).length;r<o;r++)d[r]=h[r];h=d}var p=h.filter(function(e){return m(e),t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))&&!function(e,t){for(;e&&(e=e.parentNode);)if(e.nodeName&&t.test(e.nodeName.replace("svg:",""))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(e,t.svgInvalidAncestorsRegEx)});if(!p||p&&!p.length)i&&i([],{});else{var g={};h.filter(function(e){return"clipPath"===e.nodeName.replace("svg:","")}).forEach(function(e){var i=e.getAttribute("id");g[i]=t.util.toArray(e.getElementsByTagName("*")).filter(function(e){return t.svgValidTagNamesRegEx.test(e.nodeName.replace("svg:",""))})}),t.gradientDefs[l]=t.getGradientDefs(e),t.cssRules[l]=t.getCSSRules(e),t.clipPaths[l]=g,t.parseElements(p,function(e,s){i&&(i(e,c,s,h),delete t.gradientDefs[l],delete t.cssRules[l],delete t.clipPaths[l])},s(c),a,n)}}};var b=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");i(t,{parseFontDeclaration:function(e,t){var i=e.match(b);if(i){var s=i[1],a=i[3],r=i[4],o=i[5],l=i[6];s&&(t.fontStyle=s),a&&(t.fontWeight=isNaN(parseFloat(a))?a:parseFloat(a)),r&&(t.fontSize=n(r)),l&&(t.fontFamily=l),o&&(t.lineHeight="normal"===o?1:o)}},getGradientDefs:function(e){var t,i=u(e,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),s=0,a={};for(s=i.length;s--;)(t=i[s]).getAttribute("xlink:href")&&v(e,t),a[t.getAttribute("id")]=t;return a},parseAttributes:function(e,s,r){if(e){var h,u,p,f={};void 0===r&&(r=e.getAttribute("svgUid")),e.parentNode&&t.svgValidParentsRegEx.test(e.parentNode.nodeName)&&(f=t.parseAttributes(e.parentNode,s,r));var g=s.reduce(function(t,i){return(h=e.getAttribute(i))&&(t[i]=h),t},{});g=i(g,i(function(e,i){var s={};for(var a in t.cssRules[i])if(d(e,a.split(" ")))for(var n in t.cssRules[i][a])s[n]=t.cssRules[i][a][n];return s}(e,r),t.parseStyleAttribute(e))),u=p=f.fontSize||t.Text.DEFAULT_SVG_FONT_SIZE,g["font-size"]&&(g["font-size"]=u=n(g["font-size"],p));var m,v,b,y={};for(var x in g)v=c(m=(b=x)in o?o[b]:b,g[x],f,u),y[m]=v;y&&y.font&&t.parseFontDeclaration(y.font,y);var w=i(f,y);return t.svgValidParentsRegEx.test(e.nodeName)?w:function(e){for(var i in l)if(void 0!==e[l[i]]&&""!==e[i]){if(void 0===e[i]){if(!t.Object.prototype[i])continue;e[i]=t.Object.prototype[i]}if(0!==e[i].indexOf("url(")){var s=new t.Color(e[i]);e[i]=s.setAlpha(a(s.getAlpha()*e[l[i]],2)).toRgba()}}return e}(w)}},parseElements:function(e,i,s,a,n){new t.ElementsParser(e,i,s,a,n).parse()},parseStyleAttribute:function(e){var t,i,s,a={},n=e.getAttribute("style");return n&&("string"==typeof n?(t=a,n.replace(/;\s*$/,"").split(";").forEach(function(e){var a=e.split(":");i=a[0].trim().toLowerCase(),s=a[1].trim(),t[i]=s})):function(e,t){for(var i in e)void 0!==e[i]&&(t[i.toLowerCase()]=e[i])}(n,a)),a},parsePointsAttribute:function(e){if(!e)return null;var t,i,s=[];for(t=0,i=(e=(e=e.replace(/,/g," ").trim()).split(/\s+/)).length;t<i;t+=2)s.push({x:parseFloat(e[t]),y:parseFloat(e[t+1])});return s},getCSSRules:function(e){var i,s,a=e.getElementsByTagName("style"),n={};for(i=0,s=a.length;i<s;i++){var r=a[i].textContent||a[i].text;""!==(r=r.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&r.match(/[^{]*\{[\s\S]*?\}/g).map(function(e){return e.trim()}).forEach(function(e){var a=e.match(/([\s\S]*?)\s*\{([^}]*)\}/),r={},o=a[2].trim().replace(/;$/,"").split(/\s*;\s*/);for(i=0,s=o.length;i<s;i++){var l=o[i].split(/\s*:\s*/);r[l[0]]=l[1]}(e=a[1]).split(",").forEach(function(e){""!==(e=e.replace(/^svg/i,"").trim())&&(n[e]?t.util.object.extend(n[e],r):n[e]=t.util.object.clone(r))})})}return n},loadSVGFromURL:function(e,i,s,a){e=e.replace(/^\n\s*/,"").trim(),new t.util.request(e,{method:"get",onComplete:function(e){var n=e.responseXML;if(n&&!n.documentElement&&t.window.ActiveXObject&&e.responseText&&((n=new ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),!n||!n.documentElement)return i&&i(null),!1;t.parseSVGDocument(n.documentElement,function(e,t,s,a){i&&i(e,t,s,a)},s,a)}})},loadSVGFromString:function(e,i,s,a){var n;if(e=e.trim(),"undefined"!=typeof DOMParser){var r=new DOMParser;r&&r.parseFromString&&(n=r.parseFromString(e,"text/xml"))}else t.window.ActiveXObject&&((n=new ActiveXObject("Microsoft.XMLDOM")).async="false",n.loadXML(e.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(n.documentElement,function(e,t,s,a){i(e,t,s,a)},s,a)}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(e,t,i,s,a){this.elements=e,this.callback=t,this.options=i,this.reviver=s,this.svgUid=i&&i.svgUid||0,this.parsingOptions=a,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g},function(e){e.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},e.createObjects=function(){var e=this;this.elements.forEach(function(t,i){t.setAttribute("svgUid",e.svgUid),e.createObject(t,i)})},e.findTag=function(e){return fabric[fabric.util.string.capitalize(e.tagName.replace("svg:",""))]},e.createObject=function(e,t){var i=this.findTag(e);if(i&&i.fromElement)try{i.fromElement(e,this.createCallback(t,e),this.options)}catch(e){fabric.log(e)}else this.checkIfDone()},e.createCallback=function(e,t){var i=this;return function(s){var a;i.resolveGradient(s,"fill"),i.resolveGradient(s,"stroke"),s instanceof fabric.Image&&s._originalElement&&(a=s.parsePreserveAspectRatioAttribute(t)),s._removeTransformMatrix(a),i.resolveClipPath(s),i.reviver&&i.reviver(t,s),i.instances[e]=s,i.checkIfDone()}},e.extractPropertyDefinition=function(e,t,i){var s=e[t];if(/^url\(/.test(s)){var a=this.regexUrl.exec(s)[1];return this.regexUrl.lastIndex=0,fabric[i][this.svgUid][a]}},e.resolveGradient=function(e,t){var i=this.extractPropertyDefinition(e,t,"gradientDefs");i&&e.set(t,fabric.Gradient.fromElement(i,e))},e.createClipPathCallback=function(e,t){return function(e){e._removeTransformMatrix(),e.fillRule=e.clipRule,t.push(e)}},e.resolveClipPath=function(e){var t,i,s,a,n=this.extractPropertyDefinition(e,"clipPath","clipPaths");if(n){s=[],i=fabric.util.invertTransform(e.calcTransformMatrix());for(var r=0;r<n.length;r++)this.findTag(t=n[r]).fromElement(t,this.createClipPathCallback(e,s),this.options);n=1===s.length?s[0]:new fabric.Group(s),a=fabric.util.multiplyTransformMatrices(i,n.calcTransformMatrix());var o=fabric.util.qrDecompose(a);n.flipX=!1,n.flipY=!1,n.set("scaleX",o.scaleX),n.set("scaleY",o.scaleY),n.angle=o.angle,n.skewX=o.skewX,n.skewY=0,n.setPositionByOrigin({x:o.translateX,y:o.translateY},"center","center"),e.clipPath=n}},e.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(e){return null!=e}),this.callback(this.instances,this.elements))}}(fabric.ElementsParser.prototype),function(e){"use strict";var t=e.fabric||(e.fabric={});function i(e,t){this.x=e,this.y=t}t.Point?t.warn("fabric.Point is already defined"):(t.Point=i).prototype={type:"point",constructor:i,add:function(e){return new i(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new i(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new i(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new i(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new i(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new i(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return void 0===t&&(t=.5),t=Math.max(Math.min(1,t),0),new i(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new i(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new i(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(e){var t=this.x,i=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=i},clone:function(){return new i(this.x,this.y)}}}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});function i(e){this.status=e,this.points=[]}t.Intersection?t.warn("fabric.Intersection is already defined"):(t.Intersection=i,t.Intersection.prototype={constructor:i,appendPoint:function(e){return this.points.push(e),this},appendPoints:function(e){return this.points=this.points.concat(e),this}},t.Intersection.intersectLineLine=function(e,s,a,n){var r,o=(n.x-a.x)*(e.y-a.y)-(n.y-a.y)*(e.x-a.x),l=(s.x-e.x)*(e.y-a.y)-(s.y-e.y)*(e.x-a.x),c=(n.y-a.y)*(s.x-e.x)-(n.x-a.x)*(s.y-e.y);if(0!==c){var h=o/c,u=l/c;0<=h&&h<=1&&0<=u&&u<=1?(r=new i("Intersection")).appendPoint(new t.Point(e.x+h*(s.x-e.x),e.y+h*(s.y-e.y))):r=new i}else r=new i(0===o||0===l?"Coincident":"Parallel");return r},t.Intersection.intersectLinePolygon=function(e,t,s){var a,n,r=new i,o=s.length;for(n=0;n<o;n++)a=i.intersectLineLine(e,t,s[n],s[(n+1)%o]),r.appendPoints(a.points);return 0<r.points.length&&(r.status="Intersection"),r},t.Intersection.intersectPolygonPolygon=function(e,t){var s,a=new i,n=e.length;for(s=0;s<n;s++){var r=i.intersectLinePolygon(e[s],e[(s+1)%n],t);a.appendPoints(r.points)}return 0<a.points.length&&(a.status="Intersection"),a},t.Intersection.intersectPolygonRectangle=function(e,s,a){var n=s.min(a),r=s.max(a),o=new t.Point(r.x,n.y),l=new t.Point(n.x,r.y),c=i.intersectLinePolygon(n,o,e),h=i.intersectLinePolygon(o,r,e),u=i.intersectLinePolygon(r,l,e),d=i.intersectLinePolygon(l,n,e),p=new i;return p.appendPoints(c.points),p.appendPoints(h.points),p.appendPoints(u.points),p.appendPoints(d.points),0<p.points.length&&(p.status="Intersection"),p})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});function i(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function s(e,t,i){return i<0&&(i+=1),1<i&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}t.Color?t.warn("fabric.Color is already defined."):(t.Color=i,t.Color.prototype={_tryParsingColor:function(e){var t;e in i.colorNameMap&&(e=i.colorNameMap[e]),"transparent"===e&&(t=[255,255,255,0]),t||(t=i.sourceFromHex(e)),t||(t=i.sourceFromRgb(e)),t||(t=i.sourceFromHsl(e)),t||(t=[0,0,0,1]),t&&this.setSource(t)},_rgbToHsl:function(e,i,s){var a,n,r,o=t.util.array.max([e/=255,i/=255,s/=255]),l=t.util.array.min([e,i,s]);if(r=(o+l)/2,o===l)a=n=0;else{var c=o-l;switch(n=.5<r?c/(2-o-l):c/(o+l),o){case e:a=(i-s)/c+(i<s?6:0);break;case i:a=(s-e)/c+2;break;case s:a=(e-i)/c+4}a/=6}return[Math.round(360*a),Math.round(100*n),Math.round(100*r)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e,t,i,s=this.getSource();return e=1===(e=s[0].toString(16)).length?"0"+e:e,t=1===(t=s[1].toString(16)).length?"0"+t:t,i=1===(i=s[2].toString(16)).length?"0"+i:i,e.toUpperCase()+t.toUpperCase()+i.toUpperCase()},toHexa:function(){var e,t=this.getSource();return e=1===(e=(e=Math.round(255*t[3])).toString(16)).length?"0"+e:e,this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),10);return this.setSource([t,t,t,e[3]]),this},toBlackWhite:function(e){var t=this.getSource(),i=(.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),s=t[3];return e=e||127,i=Number(i)<Number(e)?0:255,this.setSource([i,i,i,s]),this},overlayWith:function(e){e instanceof i||(e=new i(e));var t,s=[],a=this.getAlpha(),n=this.getSource(),r=e.getSource();for(t=0;t<3;t++)s.push(Math.round(.5*n[t]+.5*r[t]));return s[3]=a,this.setSource(s),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,t.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},t.Color.fromRgb=function(e){return i.fromSource(i.sourceFromRgb(e))},t.Color.sourceFromRgb=function(e){var t=e.match(i.reRGBa);if(t){var s=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),a=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),n=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1);return[parseInt(s,10),parseInt(a,10),parseInt(n,10),t[4]?parseFloat(t[4]):1]}},t.Color.fromRgba=i.fromRgb,t.Color.fromHsl=function(e){return i.fromSource(i.sourceFromHsl(e))},t.Color.sourceFromHsl=function(e){var t=e.match(i.reHSLa);if(t){var a,n,r,o=(parseFloat(t[1])%360+360)%360/360,l=parseFloat(t[2])/(/%$/.test(t[2])?100:1),c=parseFloat(t[3])/(/%$/.test(t[3])?100:1);if(0===l)a=n=r=c;else{var h=c<=.5?c*(l+1):c+l-c*l,u=2*c-h;a=s(u,h,o+1/3),n=s(u,h,o),r=s(u,h,o-1/3)}return[Math.round(255*a),Math.round(255*n),Math.round(255*r),t[4]?parseFloat(t[4]):1]}},t.Color.fromHsla=i.fromHsl,t.Color.fromHex=function(e){return i.fromSource(i.sourceFromHex(e))},t.Color.sourceFromHex=function(e){if(e.match(i.reHex)){var t=e.slice(e.indexOf("#")+1),s=3===t.length||4===t.length,a=8===t.length||4===t.length,n=s?t.charAt(0)+t.charAt(0):t.substring(0,2),r=s?t.charAt(1)+t.charAt(1):t.substring(2,4),o=s?t.charAt(2)+t.charAt(2):t.substring(4,6),l=a?s?t.charAt(3)+t.charAt(3):t.substring(6,8):"FF";return[parseInt(n,16),parseInt(r,16),parseInt(o,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},t.Color.fromSource=function(e){var t=new i;return t.setSource(e),t})}("undefined"!=typeof exports?exports:this),function(){function e(e){var t,i,s,a,n=e.getAttribute("style"),r=e.getAttribute("offset")||0;if(r=(r=parseFloat(r)/(/%$/.test(r)?100:1))<0?0:1<r?1:r,n){var o=n.split(/\s*;\s*/);for(""===o[o.length-1]&&o.pop(),a=o.length;a--;){var l=o[a].split(/\s*:\s*/),c=l[0].trim(),h=l[1].trim();"stop-color"===c?t=h:"stop-opacity"===c&&(s=h)}}return t||(t=e.getAttribute("stop-color")||"rgb(0,0,0)"),s||(s=e.getAttribute("stop-opacity")),i=(t=new fabric.Color(t)).getAlpha(),s=isNaN(parseFloat(s))?1:parseFloat(s),s*=i,{offset:r,color:t.toRgb(),opacity:s}}var t=fabric.util.object.clone;function i(e,t,i){var s,a=0,n=1,r="";for(var o in t)"Infinity"===t[o]?t[o]=1:"-Infinity"===t[o]&&(t[o]=0),s=parseFloat(t[o],10),n="string"==typeof t[o]&&/^(\d+\.\d+)%|(\d+)%$/.test(t[o])?.01:1,"x1"===o||"x2"===o||"r2"===o?(n*="objectBoundingBox"===i?e.width:1,a="objectBoundingBox"===i&&e.left||0):"y1"!==o&&"y2"!==o||(n*="objectBoundingBox"===i?e.height:1,a="objectBoundingBox"===i&&e.top||0),t[o]=s*n+a;if("ellipse"===e.type&&null!==t.r2&&"objectBoundingBox"===i&&e.rx!==e.ry){var l=e.ry/e.rx;r=" scale(1, "+l+")",t.y1&&(t.y1/=l),t.y2&&(t.y2/=l)}return r}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(e){e||(e={});var t={};this.id=fabric.Object.__uid++,this.type=e.type||"linear",t={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},"radial"===this.type&&(t.r1=e.coords.r1||0,t.r2=e.coords.r2||0),this.coords=t,this.colorStops=e.colorStops.slice(),e.gradientTransform&&(this.gradientTransform=e.gradientTransform),this.offsetX=e.offsetX||this.offsetX,this.offsetY=e.offsetY||this.offsetY},addColorStop:function(e){for(var t in e){var i=new fabric.Color(e[t]);this.colorStops.push({offset:parseFloat(t),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(e){var t={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,t,e),t},toSVG:function(e){var i,s,a,n,r=t(this.coords,!0),o=t(this.colorStops,!0),l=r.r1>r.r2,c=this.gradientTransform?this.gradientTransform.concat():fabric.iMatrix.concat(),h=e.width/2-this.offsetX,u=e.height/2-this.offsetY;if(o.sort(function(e,t){return e.offset-t.offset}),"path"===e.type&&(h-=e.pathOffset.x,u-=e.pathOffset.y),c[4]-=h,c[5]-=u,n='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',n+=' gradientTransform="matrix('+c.join(" ")+')" ',"linear"===this.type?a=["<linearGradient ",n,' x1="',r.x1,'" y1="',r.y1,'" x2="',r.x2,'" y2="',r.y2,'">\n']:"radial"===this.type&&(a=["<radialGradient ",n,' cx="',l?r.x1:r.x2,'" cy="',l?r.y1:r.y2,'" r="',l?r.r1:r.r2,'" fx="',l?r.x2:r.x1,'" fy="',l?r.y2:r.y1,'">\n']),"radial"===this.type){if(l)for((o=o.concat()).reverse(),i=0,s=o.length;i<s;i++)o[i].offset=1-o[i].offset;var d=Math.min(r.r1,r.r2);if(0<d){var p=d/Math.max(r.r1,r.r2);for(i=0,s=o.length;i<s;i++)o[i].offset+=p*(1-o[i].offset)}}for(i=0,s=o.length;i<s;i++){var f=o[i];a.push("<stop ",'offset="',100*f.offset+"%",'" style="stop-color:',f.color,void 0!==f.opacity?";stop-opacity: "+f.opacity:";",'"/>\n')}return a.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),a.join("")},toLive:function(e){var t,i,s,a=fabric.util.object.clone(this.coords);if(this.type){for("linear"===this.type?t=e.createLinearGradient(a.x1,a.y1,a.x2,a.y2):"radial"===this.type&&(t=e.createRadialGradient(a.x1,a.y1,a.r1,a.x2,a.y2,a.r2)),i=0,s=this.colorStops.length;i<s;i++){var n=this.colorStops[i].color,r=this.colorStops[i].opacity,o=this.colorStops[i].offset;void 0!==r&&(n=new fabric.Color(n).setAlpha(r).toRgba()),t.addColorStop(o,n)}return t}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(t,s){var a,n,r,o,l,c,h=t.getElementsByTagName("stop"),u=t.getAttribute("gradientUnits")||"objectBoundingBox",d=t.getAttribute("gradientTransform"),p=[];for("linear"==(a="linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial")?n={x1:(c=t).getAttribute("x1")||0,y1:c.getAttribute("y1")||0,x2:c.getAttribute("x2")||"100%",y2:c.getAttribute("y2")||0}:"radial"===a&&(n={x1:(l=t).getAttribute("fx")||l.getAttribute("cx")||"50%",y1:l.getAttribute("fy")||l.getAttribute("cy")||"50%",r1:0,x2:l.getAttribute("cx")||"50%",y2:l.getAttribute("cy")||"50%",r2:l.getAttribute("r")||"50%"}),o=h.length;o--;)p.push(e(h[o]));r=i(s,n,u);var f=new fabric.Gradient({type:a,coords:n,colorStops:p,offsetX:-s.left,offsetY:-s.top});return(d||""!==r)&&(f.gradientTransform=fabric.parseTransformAttribute((d||"")+r)),f},forObject:function(e,t){return t||(t={}),i(e,t.coords,"userSpaceOnUse"),new fabric.Gradient(t)}})}(),function(){"use strict";var e=fabric.util.toFixed;fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,t){if(e||(e={}),this.id=fabric.Object.__uid++,this.setOptions(e),!e.source||e.source&&"string"!=typeof e.source)t&&t(this);else if(void 0!==fabric.util.getFunctionBody(e.source))this.source=new Function(fabric.util.getFunctionBody(e.source)),t&&t(this);else{var i=this;this.source=fabric.util.createImage(),fabric.util.loadImage(e.source,function(e){i.source=e,t&&t(i)},null,this.crossOrigin)}},toObject:function(t){var i,s,a=fabric.Object.NUM_FRACTION_DIGITS;return"function"==typeof this.source?i=String(this.source):"string"==typeof this.source.src?i=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(i=this.source.toDataURL()),s={type:"pattern",source:i,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:e(this.offsetX,a),offsetY:e(this.offsetY,a),patternTransform:this.patternTransform?this.patternTransform.concat():null},fabric.util.populateWithProperties(this,s,t),s},toSVG:function(e){var t="function"==typeof this.source?this.source():this.source,i=t.width/e.width,s=t.height/e.height,a=this.offsetX/e.width,n=this.offsetY/e.height,r="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(s=1,n&&(s+=Math.abs(n))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1,a&&(i+=Math.abs(a))),t.src?r=t.src:t.toDataURL&&(r=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+n+'" width="'+i+'" height="'+s+'">\n<image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+r+'"></image>\n</pattern>\n'},setOptions:function(e){for(var t in e)this[t]=e[t]},toLive:function(e){var t="function"==typeof this.source?this.source():this.source;if(!t)return"";if(void 0!==t.src){if(!t.complete)return"";if(0===t.naturalWidth||0===t.naturalHeight)return""}return e.createPattern(t,this.repeat)}})}(),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.toFixed;t.Shadow?t.warn("fabric.Shadow is already defined."):(t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(e){for(var i in"string"==typeof e&&(e=this._parseShadow(e)),e)this[i]=e[i];this.id=t.Object.__uid++},_parseShadow:function(e){var i=e.trim(),s=t.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(s[1],10)||0,offsetY:parseInt(s[2],10)||0,blur:parseInt(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var s=40,a=40,n=t.Object.NUM_FRACTION_DIGITS,r=t.util.rotateVector({x:this.offsetX,y:this.offsetY},t.util.degreesToRadians(-e.angle)),o=new t.Color(this.color);return e.width&&e.height&&(s=100*i((Math.abs(r.x)+this.blur)/e.width,n)+20,a=100*i((Math.abs(r.y)+this.blur)/e.height,n)+20),e.flipX&&(r.x*=-1),e.flipY&&(r.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+s+'%" width="'+(100+2*s)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+i(this.blur?this.blur/2:0,n)+'"></feGaussianBlur>\n\t<feOffset dx="'+i(r.x,n)+'" dy="'+i(r.y,n)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+o.toRgb()+'" flood-opacity="'+o.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var e={},i=t.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(t){this[t]!==i[t]&&(e[t]=this[t])},this),e}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var e=fabric.util.object.extend,t=fabric.util.getElementOffset,i=fabric.util.removeFromArray,s=fabric.util.toFixed,a=fabric.util.transformPoint,n=fabric.util.invertTransform,r=fabric.util.getNodeCanvas,o=fabric.util.createCanvasElement,l=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(e,t){var i=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,i),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,i),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,i),t.overlayColor&&this.setOverlayColor(t.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,i){return this.__setBgOverlayImage("overlayImage",e,t,i)},setBackgroundImage:function(e,t,i){return this.__setBgOverlayImage("backgroundImage",e,t,i)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,i,s){return"string"==typeof t?fabric.util.loadImage(t,function(t){if(t){var a=new fabric.Image(t,s);(this[e]=a).canvas=this}i&&i(t)},this,s&&s.crossOrigin):(s&&t.setOptions(s),(this[e]=t)&&(t.canvas=this),i&&i(t)),this},__setBgOverlayColor:function(e,t,i){return this[e]=t,this._initGradient(t,e),this._initPattern(t,e,i),this},_createCanvasElement:function(){var e=o();if(!e)throw l;if(e.style||(e.style={}),void 0===e.getContext)throw l;return e},_initOptions:function(e){var t=this.lowerCanvasEl;this._setOptions(e),this.width=this.width||parseInt(t.width,10)||0,this.height=this.height||parseInt(t.height,10)||0,this.lowerCanvasEl.style&&(t.width=this.width,t.height=this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){this.lowerCanvasEl=e&&e.getContext?e:fabric.util.getById(e)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var i;for(var s in t=t||{},e)i=e[s],t.cssOnly||(this._setBackstoreDimension(s,e[s]),i+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(s,i);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(e){var t,i,s,a=this._activeObject;for(this.viewportTransform=e,i=0,s=this._objects.length;i<s;i++)(t=this._objects[i]).group||t.setCoords(!1,!0);return a&&"activeSelection"===a.type&&a.setCoords(!1,!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(e,t){var i=e,s=this.viewportTransform.slice(0);e=a(e,n(this.viewportTransform)),s[0]=t,s[3]=t;var r=a(e,s);return s[4]+=i.x-r.x,s[5]+=i.y-r.y,this.setViewportTransform(s)},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(e){var t=this.viewportTransform.slice(0);return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var e={},t=this.width,i=this.height,s=n(this.viewportTransform);return e.tl=a({x:0,y:0},s),e.br=a({x:t,y:i},s),e.tr=new fabric.Point(e.br.x,e.tl.y),e.bl=new fabric.Point(e.tl.x,e.br.y),this.vptCoords=e},cancelRequestedRender:function(){this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(e,t){var i=this.viewportTransform,s=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(e),this.fire("before:render",{ctx:e}),this.clipTo&&fabric.util.clipContext(this,e),this._renderBackground(e),e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this._renderObjects(e,t),e.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.clipTo&&e.restore(),s&&(s.canvas=this,s.shouldCache(),s._transformDone=!0,s.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(e)),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render",{ctx:e})},drawClipPathOnCanvas:function(e){var t=this.viewportTransform,i=this.clipPath;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.globalCompositeOperation="destination-in",i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},_renderObjects:function(e,t){var i,s;for(i=0,s=t.length;i<s;++i)t[i]&&t[i].render(e)},_renderBackgroundOrOverlay:function(e,t){var i,s=this[t+"Color"];s&&(e.fillStyle=s.toLive?s.toLive(e,this):s,e.fillRect(s.offsetX||0,s.offsetY||0,this.width,this.height)),(s=this[t+"Image"])&&(this[t+"Vpt"]&&(i=this.viewportTransform,e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5])),s.render(e),this[t+"Vpt"]&&e.restore())},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top))},centerObject:function(e){var t=this.getCenter();return this._centerObject(e,new fabric.Point(t.left,t.top))},viewportCenterObject:function(e){var t=this.getVpCenter();return this._centerObject(e,t)},viewportCenterObjectH:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(t.x,e.getCenterPoint().y)),this},viewportCenterObjectV:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,t.y))},getVpCenter:function(){var e=this.getCenter(),t=n(this.viewportTransform);return a({x:e.left,y:e.top},t)},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,i){var s=this.clipPath,a={version:fabric.version,objects:this._toObjects(t,i)};return s&&(a.clipPath=this._toObjectMethod(s,t,i)),e(a,this.__serializeBgOverlay(t,i)),fabric.util.populateWithProperties(this,a,i),a},_toObjects:function(e,t){return this._objects.filter(function(e){return!e.excludeFromExport}).map(function(i){return this._toObject(i,e,t)},this)},_toObject:function(e,t,i){var s;this.includeDefaultValues||(s=e.includeDefaultValues,e.includeDefaultValues=!1);var a=e[t](i);return this.includeDefaultValues||(e.includeDefaultValues=s),a},__serializeBgOverlay:function(e,t){var i={},s=this.backgroundImage,a=this.overlayImage;return this.backgroundColor&&(i.background=this.backgroundColor.toObject?this.backgroundColor.toObject(t):this.backgroundColor),this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(t):this.overlayColor),s&&!s.excludeFromExport&&(i.backgroundImage=this._toObject(s,e,t)),a&&!a.excludeFromExport&&(i.overlayImage=this._toObject(a,e,t)),i},svgViewportTransformation:!0,toSVG:function(e,t){e||(e={}),e.reviver=t;var i=[];return this._setSVGPreamble(i,e),this._setSVGHeader(i,e),this.clipPath&&i.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",t),this._setSVGObjects(i,t),this.clipPath&&i.push("</g>\n"),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",t),i.push("</svg>"),i.join("")},_setSVGPreamble:function(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(e,t){var i,a=t.width||this.width,n=t.height||this.height,r='viewBox="0 0 '+this.width+" "+this.height+'" ',o=fabric.Object.NUM_FRACTION_DIGITS;t.viewBox?r='viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':this.svgViewportTransformation&&(r='viewBox="'+s(-(i=this.viewportTransform)[4]/i[0],o)+" "+s(-i[5]/i[3],o)+" "+s(this.width/i[0],o)+" "+s(this.height/i[3],o)+'" '),e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',a,'" ','height="',n,'" ',r,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(t),"</defs>\n")},createSVGClipPathMarkup:function(e){var t=this.clipPath;return t?(t.clipPathId="CLIPPATH_"+fabric.Object.__uid++,'<clipPath id="'+t.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(e.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var e=this;return["backgroundColor","overlayColor"].map(function(t){var i=e[t];if(i&&i.toLive)return i.toSVG(e,!1)}).join("")},createSVGFontFacesMarkup:function(){var e,t,i,s,a,n,r,o,l="",c={},h=fabric.fontPaths,u=this._objects;for(r=0,o=u.length;r<o;r++)if(t=(e=u[r]).fontFamily,-1!==e.type.indexOf("text")&&!c[t]&&h[t]&&(c[t]=!0,e.styles))for(a in i=e.styles)for(n in s=i[a])!c[t=s[n].fontFamily]&&h[t]&&(c[t]=!0);for(var d in c)l+=["\t\t@font-face {\n","\t\t\tfont-family: '",d,"';\n","\t\t\tsrc: url('",h[d],"');\n","\t\t}\n"].join("");return l&&(l=['\t<style type="text/css">',"<![CDATA[\n",l,"]]>","</style>\n"].join("")),l},_setSVGObjects:function(e,t){var i,s,a,n=this._objects;for(s=0,a=n.length;s<a;s++)(i=n[s]).excludeFromExport||this._setSVGObject(e,i,t)},_setSVGObject:function(e,t,i){e.push(t.toSVG(i))},_setSVGBgOverlayImage:function(e,t,i){this[t]&&!this[t].excludeFromExport&&this[t].toSVG&&e.push(this[t].toSVG(i))},_setSVGBgOverlayColor:function(e,t){var i=this[t],s=this.viewportTransform,a=this.width/s[0],n=this.height/s[3];if(i)if(i.toLive){var r=i.repeat;e.push('<rect transform="translate(',a/2,",",n/2,')"',' x="',i.offsetX-a/2,'" y="',i.offsetY-n/2,'" ','width="',"repeat-y"===r||"no-repeat"===r?i.source.width:a,'" height="',"repeat-x"===r||"no-repeat"===r?i.source.height:n,'" fill="url(#SVGID_'+i.id+')"',"></rect>\n")}else e.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',this[t],'"',"></rect>\n")},sendToBack:function(e){if(!e)return this;var t,s,a,n=this._activeObject;if(e===n&&"activeSelection"===e.type)for(t=(a=n._objects).length;t--;)i(this._objects,s=a[t]),this._objects.unshift(s);else i(this._objects,e),this._objects.unshift(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(e){if(!e)return this;var t,s,a,n=this._activeObject;if(e===n&&"activeSelection"===e.type)for(a=n._objects,t=0;t<a.length;t++)i(this._objects,s=a[t]),this._objects.push(s);else i(this._objects,e),this._objects.push(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(e,t){if(!e)return this;var s,a,n,r,o,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(o=l._objects,s=0;s<o.length;s++)0+c<(n=this._objects.indexOf(a=o[s]))&&(r=n-1,i(this._objects,a),this._objects.splice(r,0,a)),c++;else 0!==(n=this._objects.indexOf(e))&&(r=this._findNewLowerIndex(e,n,t),i(this._objects,e),this._objects.splice(r,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(e,t,i){var s,a;if(i){for(a=(s=t)-1;0<=a;--a)if(e.intersectsWithObject(this._objects[a])||e.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(e)){s=a;break}}else s=t-1;return s},bringForward:function(e,t){if(!e)return this;var s,a,n,r,o,l=this._activeObject,c=0;if(e===l&&"activeSelection"===e.type)for(s=(o=l._objects).length;s--;)(n=this._objects.indexOf(a=o[s]))<this._objects.length-1-c&&(r=n+1,i(this._objects,a),this._objects.splice(r,0,a)),c++;else(n=this._objects.indexOf(e))!==this._objects.length-1&&(r=this._findNewUpperIndex(e,n,t),i(this._objects,e),this._objects.splice(r,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(e,t,i){var s,a,n;if(i){for(a=(s=t)+1,n=this._objects.length;a<n;++a)if(e.intersectsWithObject(this._objects[a])||e.isContainedWithinObject(this._objects[a])||this._objects[a].isContainedWithinObject(e)){s=a;break}}else s=t+1;return s},moveTo:function(e,t){return i(this._objects,e),this._objects.splice(t,0,e),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(e){e.dispose&&e.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,fabric.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,fabric.Collection),e(fabric.StaticCanvas.prototype,fabric.DataURLExporter),e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=o();if(!t||!t.getContext)return null;var i=t.getContext("2d");if(!i)return null;switch(e){case"setLineDash":return void 0!==i.setLineDash;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var e=r(this.lowerCanvasEl);return e&&e.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(e){var t=r(this.lowerCanvasEl);return t&&t.createJPEGStream(e)})}}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(e){return this.shadow=new fabric.Shadow(e),this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,fabric.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(this.shadow){var e=this.canvas.contextTop,t=this.canvas.getZoom();e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur*t,e.shadowOffsetX=this.shadow.offsetX*t,e.shadowOffsetY=this.shadow.offsetY*t}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(e){this.canvas=e,this._points=[]},_drawSegment:function(e,t,i){var s=t.midPointFrom(i);return e.quadraticCurveTo(t.x,t.y,s.x,s.y),s},onMouseDown:function(e){this._prepareForDrawing(e),this._captureDrawingPath(e),this._render()},onMouseMove:function(e){if(this._captureDrawingPath(e)&&1<this._points.length)if(this.needsFullRender)this.canvas.clearContext(this.canvas.contextTop),this._render();else{var t=this._points,i=t.length,s=this.canvas.contextTop;this._saveAndTransform(s),this.oldEnd&&(s.beginPath(),s.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(s,t[i-2],t[i-1],!0),s.stroke(),s.restore()}},onMouseUp:function(){this.oldEnd=void 0,this._finalizeAndAddPath()},_prepareForDrawing:function(e){var t=new fabric.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){return!(1<this._points.length&&e.eq(this._points[this._points.length-1])||(this._points.push(e),0))},_reset:function(){this._points.length=0,this._setBrushStyles();var e=new fabric.Color(this.color);this.needsFullRender=e.getAlpha()<1,this._setShadow()},_captureDrawingPath:function(e){var t=new fabric.Point(e.x,e.y);return this._addPoint(t)},_render:function(){var e,t,i=this.canvas.contextTop,s=this._points[0],a=this._points[1];if(this._saveAndTransform(i),i.beginPath(),2===this._points.length&&s.x===a.x&&s.y===a.y){var n=this.width/1e3;s=new fabric.Point(s.x,s.y),a=new fabric.Point(a.x,a.y),s.x-=n,a.x+=n}for(i.moveTo(s.x,s.y),e=1,t=this._points.length;e<t;e++)this._drawSegment(i,s,a),s=this._points[e],a=this._points[e+1];i.lineTo(s.x,s.y),i.stroke(),i.restore()},convertPointsToSVGPath:function(e){var t,i=[],s=this.width/1e3,a=new fabric.Point(e[0].x,e[0].y),n=new fabric.Point(e[1].x,e[1].y),r=e.length,o=1,l=1,c=2<r;for(c&&(o=e[2].x<n.x?-1:e[2].x===n.x?0:1,l=e[2].y<n.y?-1:e[2].y===n.y?0:1),i.push("M ",a.x-o*s," ",a.y-l*s," "),t=1;t<r;t++){if(!a.eq(n)){var h=a.midPointFrom(n);i.push("Q ",a.x," ",a.y," ",h.x," ",h.y," ")}a=e[t],t+1<e.length&&(n=e[t+1])}return c&&(o=a.x>e[t-2].x?1:a.x===e[t-2].x?0:-1,l=a.y>e[t-2].y?1:a.y===e[t-2].y?0:-1),i.push("L ",a.x+o*s," ",a.y+l*s),i},createPath:function(e){var t=new fabric.Path(e,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray}),i=new fabric.Point(t.left+t.width/2,t.top+t.height/2);return i=t.translateToGivenOrigin(i,"center","center",t.originX,t.originY),t.top=i.y,t.left=i.x,this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var e=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"!==e){var t=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(t),this.canvas.renderAll(),t.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:t})}else this.canvas.requestRenderAll()}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),i=this.canvas.contextTop;this._saveAndTransform(i),i.fillStyle=t.fill,i.beginPath(),i.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},_render:function(){var e,t,i,s=this.canvas.contextTop,a=this.points;for(this._saveAndTransform(s),e=0,t=a.length;e<t;e++)s.fillStyle=(i=a[e]).fill,s.beginPath(),s.arc(i.x,i.y,i.radius,0,2*Math.PI,!1),s.closePath(),s.fill();s.restore()},onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e,t,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var s=[];for(e=0,t=this.points.length;e<t;e++){var a=this.points[e],n=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&n.setShadow(this.shadow),s.push(n)}var r=new fabric.Group(s);r.canvas=this.canvas,this.canvas.add(r),this.canvas.fire("path:created",{path:r}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(e){var t=new fabric.Point(e.x,e.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,s=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=s,this.points.push(t),t}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseMove:function(e){this.addSprayChunk(e),this.render(this.sprayChunkPoints)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var t=[],i=0,s=this.sprayChunks.length;i<s;i++)for(var a=this.sprayChunks[i],n=0,r=a.length;n<r;n++){var o=new fabric.Rect({width:a[n].width,height:a[n].width,left:a[n].x+1,top:a[n].y+1,originX:"center",originY:"center",fill:this.color});t.push(o)}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var l=new fabric.Group(t);this.shadow&&l.setShadow(this.shadow),this.canvas.add(l),this.canvas.fire("path:created",{path:l}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.requestRenderAll()},_getOptimizedRects:function(e){var t,i,s,a={};for(i=0,s=e.length;i<s;i++)a[t=e[i].left+""+e[i].top]||(a[t]=e[i]);var n=[];for(t in a)n.push(a[t]);return n},render:function(e){var t,i,s=this.canvas.contextTop;for(s.fillStyle=this.color,this._saveAndTransform(s),t=0,i=e.length;t<i;t++){var a=e[t];void 0!==a.opacity&&(s.globalAlpha=a.opacity),s.fillRect(a.x,a.y,a.width,a.width)}s.restore()},_render:function(){var e,t,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),e=0,t=this.sprayChunks.length;e<t;e++)this.render(this.sprayChunks[e]);i.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,i,s,a,n=this.width/2;for(a=0;a<this.density;a++){t=fabric.util.getRandomInt(e.x-n,e.x+n),i=fabric.util.getRandomInt(e.y-n,e.y+n),s=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var r=new fabric.Point(t,i);r.width=s,this.randomOpacity&&(r.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(r)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=fabric.util.createCanvasElement(),t=e.getContext("2d");return e.width=e.height=25,t.fillStyle=this.color,t.beginPath(),t.arc(10,10,10,0,2*Math.PI,!1),t.closePath(),t.fill(),e},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e),i=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-i.x,offsetY:-i.y}),t}}),function(){var e=fabric.util.getPointer,t=fabric.util.degreesToRadians,i=fabric.util.radiansToDegrees,s=Math.atan2,a=Math.abs,n=fabric.StaticCanvas.supports("setLineDash");for(var r in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e,t,i,s=this.getActiveObjects();if(0<s.length&&!this.preserveObjectStacking){t=[],i=[];for(var a=0,n=this._objects.length;a<n;a++)-1===s.indexOf(e=this._objects[a])?t.push(e):i.push(e);1<s.length&&(this._activeObject._objects=i),t.push.apply(t,i)}else t=this._objects;return t},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(e){e.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(e),this.contextTopDirty=!0),e.restore()},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this},_resetCurrentTransform:function(){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,skewX:e.original.skewX,skewY:e.original.skewY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(e.target)?("center"!==e.originX&&(e.mouseXSign="right"===e.originX?-1:1),"center"!==e.originY&&(e.mouseYSign="bottom"===e.originY?-1:1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(e,t,i){var s,a=i||this.getPointer(e,!0);return s=t.group&&t.group===this._activeObject&&"activeSelection"===t.group.type?this._normalizePointer(t.group,a):{x:a.x,y:a.y},t.containsPoint(s)||t._findTargetCorner(a)},_normalizePointer:function(e,t){var i=e.calcTransformMatrix(),s=fabric.util.invertTransform(i),a=this.restorePointerVpt(t);return fabric.util.transformPoint(a,s)},isTargetTransparent:function(e,t,i){if(e.shouldCache()&&e._cacheCanvas&&e!==this._activeObject){var s=this._normalizePointer(e,{x:t,y:i}),a=Math.max(e.cacheTranslationX+s.x*e.zoomX,0),n=Math.max(e.cacheTranslationY+s.y*e.zoomY,0);return fabric.util.isTransparent(e._cacheContext,Math.round(a),Math.round(n),this.targetFindTolerance)}var r=this.contextCache,o=e.selectionBackgroundColor,l=this.viewportTransform;return e.selectionBackgroundColor="",this.clearContext(r),r.save(),r.transform(l[0],l[1],l[2],l[3],l[4],l[5]),e.render(r),r.restore(),e===this._activeObject&&e._renderControls(r,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),e.selectionBackgroundColor=o,fabric.util.isTransparent(r,t,i,this.targetFindTolerance)},_isSelectionKeyPressed:function(e){return"[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(t){return!0===e[t]}):e[this.selectionKey]},_shouldClearSelection:function(e,t){var i=this.getActiveObjects(),s=this._activeObject;return!t||t&&s&&1<i.length&&-1===i.indexOf(t)&&s!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&s&&s!==t},_shouldCenterTransform:function(e){if(e){var t,i=this._currentTransform;return"scale"===i.action||"scaleX"===i.action||"scaleY"===i.action?t=this.centeredScaling||e.centeredScaling:"rotate"===i.action&&(t=this.centeredRotation||e.centeredRotation),t?!i.altKey:i.altKey}},_getOriginFromCorner:function(e,t){var i={x:e.originX,y:e.originY};return"ml"===t||"tl"===t||"bl"===t?i.x="right":"mr"!==t&&"tr"!==t&&"br"!==t||(i.x="left"),"tl"===t||"mt"===t||"tr"===t?i.y="bottom":"bl"!==t&&"mb"!==t&&"br"!==t||(i.y="top"),i},_getActionFromCorner:function(e,t,i){if(!t||!e)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(e,i,s){if(i){var a=this.getPointer(e),n=i._findTargetCorner(this.getPointer(e,!0)),r=this._getActionFromCorner(s,n,e,i),o=this._getOriginFromCorner(i,n);this._currentTransform={target:i,action:r,corner:n,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:a.x-i.left,offsetY:a.y-i.top,originX:o.x,originY:o.y,ex:a.x,ey:a.y,lastX:a.x,lastY:a.y,theta:t(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e[this.centeredKey],original:fabric.util.saveObjectTransform(i)},this._currentTransform.original.originX=o.x,this._currentTransform.original.originY=o.y,this._resetCurrentTransform(),this._beforeTransform(e)}},_translateObject:function(e,t){var i=this._currentTransform,s=i.target,a=e-i.offsetX,n=t-i.offsetY,r=!s.get("lockMovementX")&&s.left!==a,o=!s.get("lockMovementY")&&s.top!==n;return r&&s.set("left",a),o&&s.set("top",n),r||o},_changeSkewTransformOrigin:function(e,t,i){var s="originX",a={0:"center"},n=t.target.skewX,r="left",o="right",l="mt"===t.corner||"ml"===t.corner?1:-1,c=1;e=0<e?1:-1,"y"===i&&(n=t.target.skewY,r="top",o="bottom",s="originY"),a[-1]=r,a[1]=o,t.target.flipX&&(c*=-1),t.target.flipY&&(c*=-1),0===n?(t.skewSign=-l*e*c,t[s]=a[-e]):(t.skewSign=n=0<n?1:-1,t[s]=a[n*l*c])},_skewObject:function(e,t,i){var s,a=this._currentTransform,n=a.target,r=n.get("lockSkewingX"),o=n.get("lockSkewingY");if(r&&"x"===i||o&&"y"===i)return!1;var l,c,h=n.getCenterPoint(),u=n.toLocalPoint(new fabric.Point(e,t),"center","center")[i],d=n.toLocalPoint(new fabric.Point(a.lastX,a.lastY),"center","center")[i],p=n._getTransformedDimensions();return this._changeSkewTransformOrigin(u-d,a,i),l=n.toLocalPoint(new fabric.Point(e,t),a.originX,a.originY)[i],c=n.translateToOriginPoint(h,a.originX,a.originY),s=this._setObjectSkew(l,a,i,p),a.lastX=e,a.lastY=t,n.setPositionByOrigin(c,a.originX,a.originY),s},_setObjectSkew:function(e,t,i,s){var a,n,r,o,l,c,h,u,d,p,f=t.target,g=t.skewSign;return"x"===i?(l="y",c="Y",h="X",d=0,p=f.skewY):(l="x",c="X",h="Y",d=f.skewX,p=0),o=f._getTransformedDimensions(d,p),(u=2*Math.abs(e)-o[i])<=2?a=0:(a=g*Math.atan(u/f["scale"+h]/(o[l]/f["scale"+c])),a=fabric.util.radiansToDegrees(a)),n=f["skew"+h]!==a,f.set("skew"+h,a),0!==f["skew"+c]&&(r=f._getTransformedDimensions(),f.set("scale"+c,a=s[l]/r[l]*f["scale"+c])),n},_scaleObject:function(e,t,i){var s=this._currentTransform,a=s.target,n=a.lockScalingX,r=a.lockScalingY,o=a.lockScalingFlip;if(n&&r)return!1;var l,c=a.translateToOriginPoint(a.getCenterPoint(),s.originX,s.originY),h=a.toLocalPoint(new fabric.Point(e,t),s.originX,s.originY),u=a._getTransformedDimensions();return this._setLocalMouse(h,s),l=this._setObjectScale(h,s,n,r,i,o,u),a.setPositionByOrigin(c,s.originX,s.originY),l},_setObjectScale:function(e,t,i,s,a,n,r){var o=t.target,l=!1,c=!1,h=!1,u=e.x*o.scaleX/r.x,d=e.y*o.scaleY/r.y,p=o.scaleX!==u,f=o.scaleY!==d;return n&&u<=0&&u<o.scaleX&&(l=!0,e.x=0),n&&d<=0&&d<o.scaleY&&(c=!0,e.y=0),"equally"!==a||i||s?a?"x"!==a||o.get("lockUniScaling")?"y"!==a||o.get("lockUniScaling")||c||s||o.set("scaleY",d)&&(h=f):l||i||o.set("scaleX",u)&&(h=p):(l||i||o.set("scaleX",u)&&(h=h||p),c||s||o.set("scaleY",d)&&(h=h||f)):h=this._scaleObjectEqually(e,o,t,r),t.newScaleX=u,t.newScaleY=d,l||c||this._flipObject(t,a),h},_scaleObjectEqually:function(e,t,i,s){var a,n,r,o=e.y+e.x,l=s.y*i.original.scaleY/t.scaleY+s.x*i.original.scaleX/t.scaleX,c=e.y<0?-1:1;return n=(e.x<0?-1:1)*Math.abs(i.original.scaleX*o/l),r=c*Math.abs(i.original.scaleY*o/l),a=n!==t.scaleX||r!==t.scaleY,t.set("scaleX",n),t.set("scaleY",r),a},_flipObject:function(e,t){e.newScaleX<0&&"y"!==t&&("left"===e.originX?e.originX="right":"right"===e.originX&&(e.originX="left")),e.newScaleY<0&&"x"!==t&&("top"===e.originY?e.originY="bottom":"bottom"===e.originY&&(e.originY="top"))},_setLocalMouse:function(e,t){var i=t.target,s=this.getZoom(),n=i.padding/s;"right"===t.originX?e.x*=-1:"center"===t.originX&&(e.x*=2*t.mouseXSign,e.x<0&&(t.mouseXSign=-t.mouseXSign)),"bottom"===t.originY?e.y*=-1:"center"===t.originY&&(e.y*=2*t.mouseYSign,e.y<0&&(t.mouseYSign=-t.mouseYSign)),a(e.x)>n?e.x<0?e.x+=n:e.x-=n:e.x=0,a(e.y)>n?e.y<0?e.y+=n:e.y-=n:e.y=0},_rotateObject:function(e,t){var a=this._currentTransform,n=a.target,r=n.translateToOriginPoint(n.getCenterPoint(),a.originX,a.originY);if(n.lockRotation)return!1;var o=s(a.ey-r.y,a.ex-r.x),l=s(t-r.y,e-r.x),c=i(l-o+a.theta),h=!0;if(0<n.snapAngle){var u=n.snapAngle,d=n.snapThreshold||u,p=Math.ceil(c/u)*u,f=Math.floor(c/u)*u;Math.abs(c-f)<d?c=f:Math.abs(c-p)<d&&(c=p)}return c<0&&(c=360+c),n.angle===(c%=360)?h=!1:(n.angle=c,n.setPositionByOrigin(r,a.originX,a.originY)),h},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_drawSelection:function(e){var t=this._groupSelector,i=t.left,s=t.top,r=a(i),o=a(s);if(this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(t.ex-(0<i?0:-i),t.ey-(0<s?0:-s),r,o)),this.selectionLineWidth&&this.selectionBorderColor)if(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!n){var l=t.ex+.5-(0<i?0:r),c=t.ey+.5-(0<s?0:o);e.beginPath(),fabric.util.drawDashedLine(e,l,c,l+r,c,this.selectionDashArray),fabric.util.drawDashedLine(e,l,c+o-1,l+r,c+o-1,this.selectionDashArray),fabric.util.drawDashedLine(e,l,c,l,c+o,this.selectionDashArray),fabric.util.drawDashedLine(e,l+r-1,c,l+r-1,c+o,this.selectionDashArray),e.closePath(),e.stroke()}else fabric.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(t.ex+.5-(0<i?0:r),t.ey+.5-(0<s?0:o),r,o)},findTarget:function(e,t){if(!this.skipTargetFind){var i,s,a=this.getPointer(e,!0),n=this._activeObject,r=this.getActiveObjects();if(this.targets=[],1<r.length&&!t&&n===this._searchPossibleTargets([n],a))return n;if(1===r.length&&n._findTargetCorner(a))return n;if(1===r.length&&n===this._searchPossibleTargets([n],a)){if(!this.preserveObjectStacking)return n;i=n,s=this.targets,this.targets=[]}var o=this._searchPossibleTargets(this._objects,a);return e[this.altSelectionKey]&&o&&i&&o!==i&&(o=i,this.targets=s),o}},_checkTarget:function(e,t,i){if(t&&t.visible&&t.evented&&this.containsPoint(null,t,e)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,i.x,i.y))return!0}},_searchPossibleTargets:function(e,t){for(var i,s,a=e.length;a--;){var n=e[a],r=n.group&&"activeSelection"!==n.group.type?this._normalizePointer(n.group,t):t;if(this._checkTarget(r,n,t)){(i=e[a]).subTargetCheck&&i instanceof fabric.Group&&(s=this._searchPossibleTargets(i._objects,t))&&this.targets.push(s);break}}return i},restorePointerVpt:function(e){return fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(t,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var s,a=e(t),n=this.upperCanvasEl,r=n.getBoundingClientRect(),o=r.width||0,l=r.height||0;return o&&l||("top"in r&&"bottom"in r&&(l=Math.abs(r.top-r.bottom)),"right"in r&&"left"in r&&(o=Math.abs(r.right-r.left))),this.calcOffset(),a.x=a.x-this._offset.left,a.y=a.y-this._offset.top,i||(a=this.restorePointerVpt(a)),{x:a.x*(s=0===o||0===l?{width:1,height:1}:{width:n.width/o,height:n.height/l}).width,y:a.y*s.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+e),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.width||e.width,i=this.height||e.height;fabric.util.setStyle(e,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=t,e.height=i,fabric.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?"activeSelection"===e.type&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),this._hoveredTarget===e&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,t){var i=!1,s=this.getActiveObjects(),a=[],n=[],r={e:t};e.forEach(function(e){-1===s.indexOf(e)&&(i=!0,e.fire("deselected",r),n.push(e))}),s.forEach(function(t){-1===e.indexOf(t)&&(i=!0,t.fire("selected",r),a.push(t))}),0<e.length&&0<s.length?(r.selected=a,r.deselected=n,r.updated=a[0]||n[0],r.target=this._activeObject,i&&this.fire("selection:updated",r)):0<s.length?(1===s.length&&(r.target=a[0],this.fire("object:selected",r)),r.selected=a,r.target=this._activeObject,this.fire("selection:created",r)):0<e.length&&(r.deselected=n,this.fire("selection:cleared",r))},setActiveObject:function(e,t){var i=this.getActiveObjects();return this._setActiveObject(e,t),this._fireSelectionEvents(i,t),this},_setActiveObject:function(e,t){return this._activeObject!==e&&!!this._discardActiveObject(t,e)&&!e.onSelect({e:t})&&(this._activeObject=e,!0)},_discardActiveObject:function(e,t){var i=this._activeObject;if(i){if(i.onDeselect({e:e,object:t}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var t=this.getActiveObjects();return t.length&&this.fire("before:selection:cleared",{target:t[0],e:e}),this._discardActiveObject(e),this._fireSelectionEvents(t,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(e){fabric.util.cleanUpJsdomNode(this[e]),this[e]=void 0}).bind(this)),e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var t=this._activeObject;t&&t._renderControls(e)},_toObject:function(e,t,i){var s=this._realizeGroupTransformOnObject(e),a=this.callSuper("_toObject",e,t,i);return this._unwindGroupTransformOnObject(e,s),a},_realizeGroupTransformOnObject:function(e){if(e.group&&"activeSelection"===e.group.type&&this._activeObject===e.group){var t={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(i){t[i]=e[i]}),this._activeObject.realizeTransform(e),t}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},_setSVGObject:function(e,t,i){var s=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",e,t,i),this._unwindGroupTransformOnObject(t,s)},setViewportTransform:function(e){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),fabric.StaticCanvas.prototype.setViewportTransform.call(this,e)}}),fabric.StaticCanvas)"prototype"!==r&&(fabric.Canvas[r]=fabric.StaticCanvas[r]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}(),function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},t=fabric.util.addListener,i=fabric.util.removeListener,s={passive:!1};function a(e,t){return"which"in e?e.which===t:e.button===t-1}fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(t,"add")},addOrRemove:function(e,t){e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove,s),e(this.upperCanvasEl,"mouseout",this._onMouseOut),e(this.upperCanvasEl,"mouseenter",this._onMouseEnter),e(this.upperCanvasEl,"wheel",this._onMouseWheel),e(this.upperCanvasEl,"contextmenu",this._onContextMenu),e(this.upperCanvasEl,"dblclick",this._onDoubleClick),e(this.upperCanvasEl,"touchstart",this._onMouseDown,s),e(this.upperCanvasEl,"touchmove",this._onMouseMove,s),e(this.upperCanvasEl,"dragover",this._onDragOver),e(this.upperCanvasEl,"dragenter",this._onDragEnter),e(this.upperCanvasEl,"dragleave",this._onDragLeave),e(this.upperCanvasEl,"drop",this._onDrop),"undefined"!=typeof eventjs&&t in eventjs&&(eventjs[t](this.upperCanvasEl,"gesture",this._onGesture),eventjs[t](this.upperCanvasEl,"drag",this._onDrag),eventjs[t](this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs[t](this.upperCanvasEl,"shake",this._onShake),eventjs[t](this.upperCanvasEl,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(i,"remove"),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp,s),i(fabric.document,"mousemove",this._onMouseMove,s),i(fabric.document,"touchmove",this._onMouseMove,s)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(e){var t=this._hoveredTarget;this.fire("mouse:out",{target:t,e:e}),this._hoveredTarget=null,t&&t.fire("mouseout",{e:e}),this._iTextInstances&&this._iTextInstances.forEach(function(e){e.isEditing&&e.hiddenTextarea.focus()})},_onMouseEnter:function(e){this.findTarget(e)||(this.fire("mouse:over",{target:null,e:e}),this._hoveredTarget=null)},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onLongPress:function(e,t){this.__onLongPress&&this.__onLongPress(e,t)},_onDragOver:function(e){e.preventDefault();var t=this._simpleEventHandler("dragover",e);this._fireEnterLeaveEvents(t,e)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"dblclick"),this._resetTransformEventData(e)},_onMouseDown:function(e){this.__onMouseDown(e),this._resetTransformEventData(),t(fabric.document,"touchend",this._onMouseUp,s),t(fabric.document,"touchmove",this._onMouseMove,s),i(this.upperCanvasEl,"mousemove",this._onMouseMove,s),i(this.upperCanvasEl,"touchmove",this._onMouseMove,s),"touchstart"===e.type?i(this.upperCanvasEl,"mousedown",this._onMouseDown):(t(fabric.document,"mouseup",this._onMouseUp),t(fabric.document,"mousemove",this._onMouseMove,s))},_onMouseUp:function(e){if(this.__onMouseUp(e),this._resetTransformEventData(),i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"touchend",this._onMouseUp,s),i(fabric.document,"mousemove",this._onMouseMove,s),i(fabric.document,"touchmove",this._onMouseMove,s),t(this.upperCanvasEl,"mousemove",this._onMouseMove,s),t(this.upperCanvasEl,"touchmove",this._onMouseMove,s),"touchend"===e.type){var a=this;setTimeout(function(){t(a.upperCanvasEl,"mousedown",a._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e){var t=this._activeObject;return!!(!!t!=!!e||t&&e&&t!==e)||!1},__onMouseUp:function(e){var t,i=this._currentTransform,s=this._groupSelector,n=!1,r=!s||0===s.left&&0===s.top;if(this._cacheTransformEventData(e),t=this._target,this._handleEvent(e,"up:before"),!a(e,3))return a(e,2)?(this.fireMiddleClick&&this._handleEvent(e,"up",2,r),void this._resetTransformEventData()):void(this.isDrawingMode&&this._isCurrentlyDrawing?this._onMouseUpInDrawingMode(e):(i&&(this._finalizeCurrentTransform(e),n=i.actionPerformed),r||(this._maybeGroupObjects(e),n||(n=this._shouldRender(t))),t&&(t.isMoving=!1),this._setCursorFromEvent(e,t),this._handleEvent(e,"up",1,r),this._groupSelector=null,this._currentTransform=null,t&&(t.__corner=0),n?this.requestRenderAll():r||this.renderTop()));this.fireRightClick&&this._handleEvent(e,"up",3,r)},_simpleEventHandler:function(e,t){var i=this.findTarget(t),s=this.targets,a={e:t,target:i,subTargets:s};if(this.fire(e,a),i&&i.fire(e,a),!s)return i;for(var n=0;n<s.length;n++)s[n].fire(e,a);return i},_handleEvent:function(e,t,i,s){var a=this._target,n=this.targets||[],r={e:e,target:a,subTargets:n,button:i||1,isClick:s||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+t,r),a&&a.fire("mouse"+t,r);for(var o=0;o<n.length;o++)n[o].fire("mouse"+t,r)},_finalizeCurrentTransform:function(e){var t,i=this._currentTransform,s=i.target,a={e:e,target:s,transform:i};s._scaling&&(s._scaling=!1),s.setCoords(),(i.actionPerformed||this.stateful&&s.hasStateChanged())&&(i.actionPerformed&&(t=this._addEventOptions(a,i),this._fire(t,a)),this._fire("modified",a))},_addEventOptions:function(e,t){var i,s;switch(t.action){case"scaleX":i="scaled",s="x";break;case"scaleY":i="scaled",s="y";break;case"skewX":i="skewed",s="x";break;case"skewY":i="skewed",s="y";break;case"scale":i="scaled",s="equally";break;case"rotate":i="rotated";break;case"drag":i="moved"}return e.by=s,i},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(e).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=this.getPointer(e);this.freeDrawingBrush.onMouseDown(t),this._handleEvent(e,"down")},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=this.getPointer(e);this.freeDrawingBrush.onMouseMove(t)}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(e,"up")},__onMouseDown:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"down:before");var t=this._target;if(a(e,3))this.fireRightClick&&this._handleEvent(e,"down",3);else if(a(e,2))this.fireMiddleClick&&this._handleEvent(e,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(e);else if(!this._currentTransform){var i=this._pointer;this._previousPointer=i;var s=this._shouldRender(t),n=this._shouldGroup(e,t);if(this._shouldClearSelection(e,t)?this.discardActiveObject(e):n&&(this._handleGrouping(e,t),t=this._activeObject),!this.selection||t&&(t.selectable||t.isEditing||t===this._activeObject)||(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0}),t){var r=t===this._activeObject;t.selectable&&this.setActiveObject(t,e),t!==this._activeObject||!t.__corner&&n||this._setupCurrentTransform(e,t,r)}this._handleEvent(e,"down"),(s||n)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(e){this._resetTransformEventData(),this._pointer=this.getPointer(e,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState(),this.fire("before:transform",{e:e,transform:t}),t.corner&&this.onBeforeScaleRotate(t.target)},__onMouseMove:function(e){var t,i;if(this._handleEvent(e,"move:before"),this._cacheTransformEventData(e),this.isDrawingMode)this._onMouseMoveInDrawingMode(e);else if(!(void 0!==e.touches&&1<e.touches.length)){var s=this._groupSelector;s?(s.left=(i=this._pointer).x-s.ex,s.top=i.y-s.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e)||null,this._setCursorFromEvent(e,t),this._fireOverOutEvents(t,e)),this._handleEvent(e,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(e,t){this.fireSynteticInOutEvents(e,t,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(e,t){this.fireSynteticInOutEvents(e,t,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSynteticInOutEvents:function(e,t,i){var s,a,n,r=this[i.targetName],o=r!==e,l=i.canvasEvtIn,c=i.canvasEvtOut;o&&(s={e:t,target:e,previousTarget:r},a={e:t,target:r,nextTarget:e},this[i.targetName]=e),n=e&&o,r&&o&&(c&&this.fire(c,a),r.fire(i.evtOut,a)),n&&(l&&this.fire(l,s),e.fire(i.evtIn,s))},__onMouseWheel:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()},_transformObject:function(e){var t=this.getPointer(e),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,i.shiftKey=e.shiftKey,i.altKey=e[this.centeredKey],this._beforeScaleTransform(e,i),this._performTransformAction(e,i,t),i.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(e,t,i){var s=i.x,a=i.y,n=t.action,r=!1,o={target:t.target,e:e,transform:t,pointer:i};"rotate"===n?(r=this._rotateObject(s,a))&&this._fire("rotating",o):"scale"===n?(r=this._onScale(e,t,s,a))&&this._fire("scaling",o):"scaleX"===n?(r=this._scaleObject(s,a,"x"))&&this._fire("scaling",o):"scaleY"===n?(r=this._scaleObject(s,a,"y"))&&this._fire("scaling",o):"skewX"===n?(r=this._skewObject(s,a,"x"))&&this._fire("skewing",o):"skewY"===n?(r=this._skewObject(s,a,"y"))&&this._fire("skewing",o):(r=this._translateObject(s,a))&&(this._fire("moving",o),this.setCursor(o.target.moveCursor||this.moveCursor)),t.actionPerformed=t.actionPerformed||r},_fire:function(e,t){this.fire("object:"+e,t),t.target.fire(e,t)},_beforeScaleTransform:function(e,t){if("scale"===t.action||"scaleX"===t.action||"scaleY"===t.action){var i=this._shouldCenterTransform(t.target);(i&&("center"!==t.originX||"center"!==t.originY)||!i&&"center"===t.originX&&"center"===t.originY)&&(this._resetCurrentTransform(),t.reset=!0)}},_onScale:function(e,t,i,s){return this._isUniscalePossible(e,t.target)?(t.currentAction="scale",this._scaleObject(i,s)):(t.reset||"scale"!==t.currentAction||this._resetCurrentTransform(),t.currentAction="scaleEqually",this._scaleObject(i,s,"equally"))},_isUniscalePossible:function(e,t){return(e[this.uniScaleKey]||this.uniScaleTransform)&&!t.get("lockUniScaling")},_setCursorFromEvent:function(e,t){if(!t)return this.setCursor(this.defaultCursor),!1;var i=t.hoverCursor||this.hoverCursor,s=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,a=(!s||!s.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));this.setCursor(a?this.getCornerCursor(a,t,e):i)},getCornerCursor:function(t,i,s){return this.actionIsDisabled(t,i,s)?this.notAllowedCursor:t in e?this._getRotatedCornerCursor(t,i,s):"mtr"===t&&i.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(e,t,i){return"mt"===e||"mb"===e?i[this.altActionKey]?t.lockSkewingX:t.lockScalingY:"ml"===e||"mr"===e?i[this.altActionKey]?t.lockSkewingY:t.lockScalingX:"mtr"===e?t.lockRotation:this._isUniscalePossible(i,t)?t.lockScalingX&&t.lockScalingY:t.lockScalingX||t.lockScalingY},_getRotatedCornerCursor:function(t,i,s){var a=Math.round(i.angle%360/45);return a<0&&(a+=8),a+=e[t],s[this.altActionKey]&&e[t]%2==0&&(a+=2),this.cursorMap[a%=8]}})}(),function(){var e=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,t){var i=this._activeObject;return i&&this._isSelectionKeyPressed(e)&&t&&t.selectable&&this.selection&&(i!==t||"activeSelection"===i.type)&&!t.onSelect({e:e})},_handleGrouping:function(e,t){var i=this._activeObject;i.__corner||(t!==i||(t=this.findTarget(e,!0))&&t.selectable)&&(i&&"activeSelection"===i.type?this._updateActiveSelection(t,e):this._createActiveSelection(t,e))},_updateActiveSelection:function(e,t){var i=this._activeObject,s=i._objects.slice(0);i.contains(e)?(i.removeWithUpdate(e),this._hoveredTarget=e,1===i.size()&&this._setActiveObject(i.item(0),t)):(i.addWithUpdate(e),this._hoveredTarget=i),this._fireSelectionEvents(s,t)},_createActiveSelection:function(e,t){var i=this.getActiveObjects(),s=this._createGroup(e);this._hoveredTarget=s,this._setActiveObject(s,t),this._fireSelectionEvents(i,t)},_createGroup:function(e){var t=this._objects,i=t.indexOf(this._activeObject)<t.indexOf(e)?[this._activeObject,e]:[e,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(i,{canvas:this})},_groupSelectedObjects:function(e){var t,i=this._collectObjects(e);1===i.length?this.setActiveObject(i[0],e):1<i.length&&(t=new fabric.ActiveSelection(i.reverse(),{canvas:this}),this.setActiveObject(t,e))},_collectObjects:function(i){for(var s,a=[],n=this._groupSelector.ex,r=this._groupSelector.ey,o=n+this._groupSelector.left,l=r+this._groupSelector.top,c=new fabric.Point(e(n,o),e(r,l)),h=new fabric.Point(t(n,o),t(r,l)),u=!this.selectionFullyContained,d=n===o&&r===l,p=this._objects.length;p--&&!((s=this._objects[p])&&s.selectable&&s.visible&&!s.onSelect({e:i})&&(u&&s.intersectsWithRect(c,h)||s.isContainedWithinRect(c,h)||u&&s.containsPoint(c)||u&&s.containsPoint(h))&&(a.push(s),d)););return a},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",i=e.quality||1,s=(e.multiplier||1)*(e.enableRetinaScaling?this.getRetinaScaling():1),a=this.toCanvasElement(s,e);return fabric.util.toDataURL(a,t,i)},toCanvasElement:function(e,t){var i=((t=t||{}).width||this.width)*(e=e||1),s=(t.height||this.height)*e,a=this.getZoom(),n=this.width,r=this.height,o=a*e,l=this.viewportTransform,c=this.interactive,h=this.contextContainer,u=[o,0,0,o,(l[4]-(t.left||0))*e,(l[5]-(t.top||0))*e],d=fabric.util.createCanvasElement();return d.width=i,d.height=s,this.interactive=!1,this.viewportTransform=u,this.width=i,this.height=s,this.calcViewportBoundaries(),this.contextContainer=d.getContext("2d"),this.renderAll(),this.viewportTransform=l,this.width=n,this.height=r,this.calcViewportBoundaries(),this.contextContainer=h,this.interactive=c,d}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,t,i){return this.loadFromJSON(e,t,i)},loadFromJSON:function(e,t,i){if(e){var s="string"==typeof e?JSON.parse(e):fabric.util.object.clone(e),a=this,n=this.renderOnAddRemove;return this.renderOnAddRemove=!1,this._enlivenObjects(s.objects,function(e){a.clear(),a._setBgOverlay(s,function(){e.forEach(function(e,t){a.insertAt(e,t)}),a.renderOnAddRemove=n,delete s.objects,delete s.backgroundImage,delete s.overlayImage,delete s.background,delete s.overlay,a._setOptions(s),a.renderAll(),t&&t()})},i),this}},_setBgOverlay:function(e,t){var i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(e.backgroundImage||e.overlayImage||e.background||e.overlay){var s=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&t&&t()};this.__setBgOverlay("backgroundImage",e.backgroundImage,i,s),this.__setBgOverlay("overlayImage",e.overlayImage,i,s),this.__setBgOverlay("backgroundColor",e.background,i,s),this.__setBgOverlay("overlayColor",e.overlay,i,s)}else t&&t()},__setBgOverlay:function(e,t,i,s){var a=this;if(!t)return i[e]=!0,void(s&&s());"backgroundImage"===e||"overlayImage"===e?fabric.util.enlivenObjects([t],function(t){a[e]=t[0],i[e]=!0,s&&s()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){i[e]=!0,s&&s()})},_enlivenObjects:function(e,t,i){e&&0!==e.length?fabric.util.enlivenObjects(e,function(e){t&&t(e)},null,i):t&&t([])},_toDataURL:function(e,t){this.clone(function(i){t(i.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,i){this.clone(function(s){i(s.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){e&&e(t)})})},cloneWithoutData:function(e){var t=fabric.util.createCanvasElement();t.width=this.width,t.height=this.height;var i=new fabric.Canvas(t);i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),e&&e(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):e&&e(i)}}),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,s=t.util.object.clone,a=t.util.toFixed,n=t.util.string.capitalize,r=t.util.degreesToRadians,o=t.StaticCanvas.supports("setLineDash");t.Object||(t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!t.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(e){var i=t.perfLimitSizeTotal,s=e.width,a=e.height,n=t.maxCacheSideLimit,r=t.minCacheSideLimit;if(s<=n&&a<=n&&s*a<=i)return s<r&&(e.width=r),a<r&&(e.height=r),e;var o=t.util.limitDimsByArea(s/a,i),l=t.util.capValue,c=l(r,o.x,n),h=l(r,o.y,n);return c<s&&(e.zoomX/=s/c,e.width=c,e.capped=!0),h<a&&(e.zoomY/=a/h,e.height=h,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.getTotalObjectScaling(),t=this._getNonTransformedDimensions(),i=e.scaleX,s=e.scaleY;return{width:t.x*i+2,height:t.y*s+2,zoomX:i,zoomY:s,x:t.x,y:t.y}},_updateCacheCanvas:function(){var e=this.canvas;if(this.noScaleCache&&e&&e._currentTransform){var i=e._currentTransform.action;if(this===e._currentTransform.target&&i.slice&&"scale"===i.slice(0,5))return!1}var s,a,n=this._cacheCanvas,r=this._limitCacheSize(this._getCacheCanvasDimensions()),o=t.minCacheSideLimit,l=r.width,c=r.height,h=r.zoomX,u=r.zoomY,d=l!==this.cacheWidth||c!==this.cacheHeight,p=0,f=0,g=!1;if(d){var m=this._cacheCanvas.width,v=this._cacheCanvas.height,b=m<l||v<c;g=b||(l<.9*m||c<.9*v)&&o<m&&o<v,b&&!r.capped&&(o<l||o<c)&&(p=.1*l,f=.1*c)}return!(!d&&this.zoomX===h&&this.zoomY===u||(g?(n.width=Math.ceil(l+p),n.height=Math.ceil(c+f)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,n.width,n.height)),s=r.x*h/2,a=r.y*u/2,this.cacheTranslationX=Math.round(n.width/2-s)+s,this.cacheTranslationY=Math.round(n.height/2-a)+a,this.cacheWidth=l,this.cacheHeight=c,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(h,u),this.zoomX=h,this.zoomY=u,0))},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initClipping(e),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(e){var t;t=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},toObject:function(e){var i=t.Object.NUM_FRACTION_DIGITS,s={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:a(this.left,i),top:a(this.top,i),width:a(this.width,i),height:a(this.height,i),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,i),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,i),scaleX:a(this.scaleX,i),scaleY:a(this.scaleY,i),angle:a(this.angle,i),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,i),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:a(this.skewX,i),skewY:a(this.skewY,i)};return this.clipPath&&(s.clipPath=this.clipPath.toObject(e),s.clipPath.inverted=this.clipPath.inverted,s.clipPath.absolutePositioned=this.clipPath.absolutePositioned),t.util.populateWithProperties(this,s,e),this.includeDefaultValues||(s=this._removeDefaultValues(s)),s},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var i=t.util.getKlass(e.type).prototype;return i.stateProperties.forEach(function(t){e[t]===i[t]&&delete e[t],"[object Array]"===Object.prototype.toString.call(e[t])&&"[object Array]"===Object.prototype.toString.call(i[t])&&0===e[t].length&&0===i[t].length&&delete e[t]}),e},toString:function(){return"#<fabric."+n(this.type)+">"},getObjectScaling:function(){var e=this.scaleX,t=this.scaleY;if(this.group){var i=this.group.getObjectScaling();e*=i.scaleX,t*=i.scaleY}return{scaleX:e,scaleY:t}},getTotalObjectScaling:function(){var e=this.getObjectScaling(),t=e.scaleX,i=e.scaleY;if(this.canvas){var s=this.canvas.getZoom(),a=this.canvas.getRetinaScaling();t*=s*a,i*=s*a}return{scaleX:t,scaleY:i}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,i){var s=this[e]!==i,a=!1;return("scaleX"===e||"scaleY"===e)&&(i=this._constrainScale(i)),"scaleX"===e&&i<0?(this.flipX=!this.flipX,i*=-1):"scaleY"===e&&i<0?(this.flipY=!this.flipY,i*=-1):"shadow"!==e||!i||i instanceof t.Shadow?"dirty"===e&&this.group&&this.group.set("dirty",i):i=new t.Shadow(i),this[e]=i,s&&(a=this.group&&this.group.isOnACache(),-1<this.cacheProperties.indexOf(e)?(this.dirty=!0,a&&this.group.set("dirty",!0)):a&&-1<this.stateProperties.indexOf(e)&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height&&0===this.strokeWidth||!this.visible},render:function(e){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this.clipTo&&t.util.clipContext(this,e),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&e.restore(),e.restore())},renderCache:function(e){e=e||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,e.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"==typeof this.shadow||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(e){var i=this.clipPath;if(e.save(),e.globalCompositeOperation=i.inverted?"destination-out":"destination-in",i.absolutePositioned){var s=t.util.invertTransform(this.calcTransformMatrix());e.transform(s[0],s[1],s[2],s[3],s[4],s[5])}i.transform(e),e.scale(1/i.zoomX,1/i.zoomY),e.drawImage(i._cacheCanvas,-i.cacheTranslationX,-i.cacheTranslationY),e.restore()},drawObject:function(e,t){var i=this.fill,s=this.stroke;t?(this.fill="black",this.stroke="",this._setClippingProperties(e)):(this._renderBackground(e),this._setStrokeStyles(e,this),this._setFillStyles(e,this)),this._render(e),this._drawClipPath(e),this.fill=i,this.stroke=s},_drawClipPath:function(e){var t=this.clipPath;t&&(t.canvas=this.canvas,t.shouldCache(),t._transformDone=!0,t.renderCache({forClipping:!0}),this.drawClipPathOnCache(e))},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(e){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!e&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!e){var t=this.cacheWidth/this.zoomX,i=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-i/2,t,i)}return!0}return!1},_renderBackground:function(e){if(this.backgroundColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(e,t){t.stroke&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineDashOffset=t.strokeDashOffset,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,e.strokeStyle=t.stroke.toLive?t.stroke.toLive(e,this):t.stroke)},_setFillStyles:function(e,t){t.fill&&(e.fillStyle=t.fill.toLive?t.fill.toLive(e,this):t.fill)},_setClippingProperties:function(e){e.globalAlpha=1,e.strokeStyle="transparent",e.fillStyle="#000000"},_setLineDash:function(e,t,i){t&&(1&t.length&&t.push.apply(t,t),o?e.setLineDash(t):i&&i(e),this.strokeUniform&&e.setLineDash(e.getLineDash().map(function(t){return t*e.lineWidth})))},_renderControls:function(e,i){var s,a,n,o=this.getViewportTransform(),l=this.calcTransformMatrix();a=void 0!==(i=i||{}).hasBorders?i.hasBorders:this.hasBorders,n=void 0!==i.hasControls?i.hasControls:this.hasControls,l=t.util.multiplyTransformMatrices(o,l),s=t.util.qrDecompose(l),e.save(),e.translate(s.translateX,s.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),i.forActiveSelection?(e.rotate(r(s.angle)),a&&this.drawBordersInGroup(e,s,i)):(e.rotate(r(this.angle)),a&&this.drawBorders(e,i)),n&&this.drawControls(e,i),e.restore()},_setShadow:function(e){if(this.shadow){var i=this.shadow,s=this.canvas,a=s&&s.viewportTransform[0]||1,n=s&&s.viewportTransform[3]||1,r=this.getObjectScaling();s&&s._isRetinaScaling()&&(a*=t.devicePixelRatio,n*=t.devicePixelRatio),e.shadowColor=i.color,e.shadowBlur=i.blur*t.browserShadowBlurConstant*(a+n)*(r.scaleX+r.scaleY)/4,e.shadowOffsetX=i.offsetX*a*r.scaleX,e.shadowOffsetY=i.offsetY*n*r.scaleY}},_removeShadow:function(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)},_applyPatternGradientTransform:function(e,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var i=t.gradientTransform||t.patternTransform,s=-this.width/2+t.offsetX||0,a=-this.height/2+t.offsetY||0;return e.translate(s,a),i&&e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),{offsetX:s,offsetY:a}},_renderPaintInOrder:function(e){"stroke"===this.paintFirst?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_renderFill:function(e){this.fill&&(e.save(),this._applyPatternGradientTransform(e,this.fill),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())},_renderStroke:function(e){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this.strokeUniform&&e.scale(1/this.scaleX,1/this.scaleY),this._setLineDash(e,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(e,this.stroke),e.stroke(),e.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var i=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),i=t.util.transformPoint(i,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,i.x+=e.offsetLeft,i.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(i,"center","center")},clone:function(e,i){var s=this.toObject(i);this.constructor.fromObject?this.constructor.fromObject(s,e):t.Object._fromObject("Object",s,e)},cloneAsImage:function(e,i){var s=this.toCanvasElement(i);return e&&e(new t.Image(s)),this},toCanvasElement:function(e){e||(e={});var i=t.util,s=i.saveObjectTransform(this),a=this.shadow,n=Math.abs,r=(e.multiplier||1)*(e.enableRetinaScaling?t.devicePixelRatio:1);e.withoutTransform&&i.resetObjectTransform(this),e.withoutShadow&&(this.shadow=null);var o,l,c=t.util.createCanvasElement(),h=this.getBoundingRect(!0,!0),u=this.shadow,d={x:0,y:0};u&&(l=u.blur,o=this.getObjectScaling(),d.x=2*Math.round((n(u.offsetX)+l)*n(o.scaleX)),d.y=2*Math.round((n(u.offsetY)+l)*n(o.scaleY))),c.width=h.width+d.x,c.height=h.height+d.y,c.width+=c.width%2?2-c.width%2:0,c.height+=c.height%2?2-c.height%2:0;var p=new t.StaticCanvas(c,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===e.format&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new t.Point(p.width/2,p.height/2),"center","center");var f=this.canvas;p.add(this);var g=p.toCanvasElement(r||1,e);return this.shadow=a,this.canvas=f,this.set(s).setCoords(),p._objects=[],p.dispose(),p=null,g},toDataURL:function(e){return e||(e={}),t.util.toDataURL(this.toCanvasElement(e),e.format||"png",e.quality||1)},isType:function(e){return this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},setGradient:function(e,i){i||(i={});var s={colorStops:[]};return s.type=i.type||(i.r1||i.r2?"radial":"linear"),s.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},(i.r1||i.r2)&&(s.coords.r1=i.r1,s.coords.r2=i.r2),s.gradientTransform=i.gradientTransform,t.Gradient.prototype.addColorStop.call(s,i.colorStops),this.set(e,t.Gradient.forObject(this,s))},setPatternFill:function(e,i){return this.set("fill",new t.Pattern(e,i))},setShadow:function(e){return this.set("shadow",e?new t.Shadow(e):null)},setColor:function(e){return this.set("fill",e),this},rotate:function(e){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(e,i){i=i||this.canvas.getPointer(e);var s=new t.Point(i.x,i.y),a=this._getLeftTopCoords();return this.angle&&(s=t.util.rotatePoint(s,a,r(-this.angle))),{x:s.x-a.x,y:s.y-a.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),i(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object._fromObject=function(e,i,a,n){var r=t[e];i=s(i,!0),t.util.enlivenPatterns([i.fill,i.stroke],function(e){void 0!==e[0]&&(i.fill=e[0]),void 0!==e[1]&&(i.stroke=e[1]),t.util.enlivenObjects([i.clipPath],function(e){i.clipPath=e[0];var t=n?new r(i[n],i):new r(i);a&&a(t)})})},t.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var e=fabric.util.degreesToRadians,t={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(e,s,a,n,r){var o,l,c,h=e.x,u=e.y;return"string"==typeof s?s=t[s]:s-=.5,"string"==typeof n?n=t[n]:n-=.5,"string"==typeof a?a=i[a]:a-=.5,"string"==typeof r?r=i[r]:r-=.5,l=r-a,((o=n-s)||l)&&(c=this._getTransformedDimensions(),h=e.x+o*c.x,u=e.y+l*c.y),new fabric.Point(h,u)},translateToCenterPoint:function(t,i,s){var a=this.translateToGivenOrigin(t,i,s,"center","center");return this.angle?fabric.util.rotatePoint(a,t,e(this.angle)):a},translateToOriginPoint:function(t,i,s){var a=this.translateToGivenOrigin(t,"center","center",i,s);return this.angle?fabric.util.rotatePoint(a,t,e(this.angle)):a},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,e,t)},toLocalPoint:function(t,i,s){var a,n,r=this.getCenterPoint();return a=void 0!==i&&void 0!==s?this.translateToGivenOrigin(r,"center","center",i,s):new fabric.Point(this.left,this.top),n=new fabric.Point(t.x,t.y),this.angle&&(n=fabric.util.rotatePoint(n,r,-e(this.angle))),n.subtractEquals(a)},setPositionByOrigin:function(e,t,i){var s=this.translateToCenterPoint(e,t,i),a=this.translateToOriginPoint(s,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(i){var s,a,n=e(this.angle),r=this.getScaledWidth(),o=fabric.util.cos(n)*r,l=fabric.util.sin(n)*r;this.left+=o*((a="string"==typeof i?t[i]:i-.5)-(s="string"==typeof this.originX?t[this.originX]:this.originX-.5)),this.top+=l*(a-s),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){var e=fabric.util.degreesToRadians,t=fabric.util.multiplyTransformMatrices,i=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(e,t){this.oCoords||this.setCoords();var i,s=e?this.aCoords:this.oCoords;return i=t?this.calcCoords(e):s,[new fabric.Point(i.tl.x,i.tl.y),new fabric.Point(i.tr.x,i.tr.y),new fabric.Point(i.br.x,i.br.y),new fabric.Point(i.bl.x,i.bl.y)]},intersectsWithRect:function(e,t,i,s){var a=this.getCoords(i,s);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(a,e,t).status},intersectsWithObject:function(e,t,i){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(this.getCoords(t,i),e.getCoords(t,i)).status||e.isContainedWithinObject(this,t,i)||this.isContainedWithinObject(e,t,i)},isContainedWithinObject:function(e,t,i){for(var s=this.getCoords(t,i),a=0,n=e._getImageLines(i?e.calcCoords(t):t?e.aCoords:e.oCoords);a<4;a++)if(!e.containsPoint(s[a],n))return!1;return!0},isContainedWithinRect:function(e,t,i,s){var a=this.getBoundingRect(i,s);return a.left>=e.x&&a.left+a.width<=t.x&&a.top>=e.y&&a.top+a.height<=t.y},containsPoint:function(e,t,i,s){t=t||this._getImageLines(s?this.calcCoords(i):i?this.aCoords:this.oCoords);var a=this._findCrossPoints(e,t);return 0!==a&&a%2==1},isOnScreen:function(e){if(!this.canvas)return!1;for(var t,i=this.canvas.vptCoords.tl,s=this.canvas.vptCoords.br,a=this.getCoords(!0,e),n=0;n<4;n++)if((t=a[n]).x<=s.x&&t.x>=i.x&&t.y<=s.y&&t.y>=i.y)return!0;return!!this.intersectsWithRect(i,s,!0,e)||this._containsCenterOfCanvas(i,s,e)},_containsCenterOfCanvas:function(e,t,i){return!!this.containsPoint({x:(e.x+t.x)/2,y:(e.y+t.y)/2},null,!0,i)},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return!!this.intersectsWithRect(t,i,!0,e)||this._containsCenterOfCanvas(t,i,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var i,s,a,n=0;for(var r in t)if(!((a=t[r]).o.y<e.y&&a.d.y<e.y||a.o.y>=e.y&&a.d.y>=e.y||(a.o.x===a.d.x&&a.o.x>=e.x?s=a.o.x:(i=(a.d.y-a.o.y)/(a.d.x-a.o.x),s=-(e.y-0*e.x-(a.o.y-i*a.o.x))/(0-i)),s>=e.x&&(n+=1),2!==n)))break;return n},getBoundingRect:function(e,t){var i=this.getCoords(e,t);return fabric.util.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:0===e?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,t){var i=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(e/this.width/i)},scaleToHeight:function(e,t){var i=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(e/this.height/i)},calcCoords:function(s){var a=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),r=t(n,a),o=this.getViewportTransform(),l=s?r:t(o,r),c=this._getTransformedDimensions(),h=c.x/2,u=c.y/2,d=i({x:-h,y:-u},l),p=i({x:h,y:-u},l),f=i({x:-h,y:u},l),g=i({x:h,y:u},l);if(!s){var m=this.padding,v=e(this.angle),b=fabric.util.cos(v),y=fabric.util.sin(v),x=b*m,w=y*m,S=x+w,C=x-w;m&&(d.x-=C,d.y-=S,p.x+=S,p.y-=C,f.x-=S,f.y+=C,g.x+=C,g.y+=S);var A=new fabric.Point((d.x+f.x)/2,(d.y+f.y)/2),_=new fabric.Point((p.x+d.x)/2,(p.y+d.y)/2),k=new fabric.Point((g.x+p.x)/2,(g.y+p.y)/2),T=new fabric.Point((g.x+f.x)/2,(g.y+f.y)/2),I=new fabric.Point(_.x+y*this.rotatingPointOffset,_.y-b*this.rotatingPointOffset)}var M={tl:d,tr:p,br:g,bl:f};return s||(M.ml=A,M.mt=_,M.mr=k,M.mb=T,M.mtr=I),M},setCoords:function(e,t){return this.oCoords=this.calcCoords(e),t||(this.aCoords=this.calcCoords(!0)),e||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var t=e(this.angle),i=fabric.util.cos(t),s=fabric.util.sin(t);return[i,s,-s,i,0,0]}return fabric.iMatrix.concat()},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var t="_",i="";return!e&&this.group&&(i=this.group.transformMatrixKey(e)+t),i+this.top+t+this.left+t+this.scaleX+t+this.scaleY+t+this.skewX+t+this.skewY+t+this.angle+t+this.originX+t+this.originY+t+this.width+t+this.height+t+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){if(e)return this.calcOwnMatrix();var i=this.transformMatrixKey(),s=this.matrixCache||(this.matrixCache={});if(s.key===i)return s.value;var a=this.calcOwnMatrix();return this.group&&(a=t(this.group.calcTransformMatrix(),a)),s.key=i,s.value=a},calcOwnMatrix:function(){var e=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===e)return i.value;var s,a=this._calcTranslateMatrix(),n=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return this.angle&&(s=this._calcRotateMatrix(),a=t(a,s)),a=t(a,n),i.key=e,i.value=a},_calcDimensionsTransformMatrix:function(i,s,a){var n,r=[this.scaleX*(a&&this.flipX?-1:1),0,0,this.scaleY*(a&&this.flipY?-1:1),0,0];return i&&(n=[1,0,Math.tan(e(i)),1],r=t(r,n,!0)),s&&(n=[1,Math.tan(e(s)),0,1],r=t(r,n,!0)),r},_getNonTransformedDimensions:function(){var e=this.strokeWidth;return{x:this.width+e,y:this.height+e}},_getTransformedDimensions:function(e,t){void 0===e&&(e=this.skewX),void 0===t&&(t=this.skewY);var i,s,a=this._getNonTransformedDimensions();if(this.strokeUniform?(i=this.width,s=this.height):(i=a.x,s=a.y),0===e&&0===t)return this._finalizeDiemensions(i*this.scaleX,s*this.scaleY);var n,r,o=[{x:-(i/=2),y:-(s/=2)},{x:i,y:-s},{x:-i,y:s},{x:i,y:s}],l=this._calcDimensionsTransformMatrix(e,t,!1);for(n=0;n<o.length;n++)o[n]=fabric.util.transformPoint(o[n],l);return r=fabric.util.makeBoundingBoxFromPoints(o),this._finalizeDiemensions(r.width,r.height)},_finalizeDiemensions:function(e,t){return this.strokeUniform?{x:e+this.strokeWidth,y:t+this.strokeWidth}:{x:e,y:t}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),t=this._getTransformedDimensions();return fabric.util.transformPoint(t,e,!0).scalarAdd(2*this.padding)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e),this}}),function(){function e(e,t){if(t){if(t.toLive)return e+": url(#SVGID_"+t.id+"); ";var i=new fabric.Color(t),s=e+": "+i.toRgb()+"; ",a=i.getAlpha();return 1!==a&&(s+=e+"-opacity: "+a.toString()+"; "),s}return e+": none; "}var t=fabric.util.toFixed;fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(t){var i=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",n=this.strokeDashOffset?this.strokeDashOffset:"0",r=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",c=void 0!==this.opacity?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=t?"":this.getSvgFilter(),d=e("fill",this.fill);return[e("stroke",this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",r,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",l,"; ",d,"fill-rule: ",i,"; ","opacity: ",c,";",u,h].join("")},getSvgSpanStyles:function(t,i){var s="; ",a=t.fontFamily?"font-family: "+(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?"'"+t.fontFamily+"'":t.fontFamily)+s:"",n=t.strokeWidth?"stroke-width: "+t.strokeWidth+s:"",r=(a=a,t.fontSize?"font-size: "+t.fontSize+"px"+s:""),o=t.fontStyle?"font-style: "+t.fontStyle+s:"",l=t.fontWeight?"font-weight: "+t.fontWeight+s:"",c=t.fill?e("fill",t.fill):"",h=t.stroke?e("stroke",t.stroke):"",u=this.getSvgTextDecoration(t);return u&&(u="text-decoration: "+u+s),[h,n,a,r,o,l,u,c,t.deltaY?"baseline-shift: "+-t.deltaY+"; ":"",i?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(e){return"overline"in e||"underline"in e||"linethrough"in e?(e.overline?"overline ":"")+(e.underline?"underline ":"")+(e.linethrough?"line-through ":""):""},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(e,i){return'transform="matrix('+(e?this.calcTransformMatrix():this.calcOwnMatrix()).map(function(e){return t(e,fabric.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"+(i||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_setSVGBg:function(e){if(this.backgroundColor){var i=fabric.Object.NUM_FRACTION_DIGITS;e.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',t(-this.width/2,i),'" y="',t(-this.height/2,i),'" width="',t(this.width,i),'" height="',t(this.height,i),'"></rect>\n')}},toSVG:function(e){return this._createBaseSVGMarkup(this._toSVG(),{reviver:e})},toClipPathSVG:function(e){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e})},_createBaseClipPathSVGMarkup:function(e,t){var i=(t=t||{}).reviver,s=[this.getSvgTransform(!0,t.additionalTransform||""),this.getSvgCommons()].join(""),a=e.indexOf("COMMON_PARTS");return e[a]=s,i?i(e.join("")):e.join("")},_createBaseSVGMarkup:function(e,t){var i,s,a=(t=t||{}).noStyle,n=t.withShadow,r=t.reviver,o=a?"":'style="'+this.getSvgStyles()+'" ',l=n?'style="'+this.getSvgFilter()+'" ':"",c=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",u=this.clipPath&&this.clipPath.absolutePositioned,d=[],p=e.indexOf("COMMON_PARTS"),f=t.additionalTransform;return c&&(c.clipPathId="CLIPPATH_"+fabric.Object.__uid++,s='<clipPath id="'+c.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(r)+"</clipPath>\n"),u&&d.push("<g ",l,this.getSvgCommons()," >\n"),d.push("<g ",this.getSvgTransform(!1),u?"":l+this.getSvgCommons()," >\n"),i=[o,h,a?"":this.addPaintOrder()," ",f?'transform="'+f+'" ':""].join(""),e[p]=i,this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1)),this.shadow&&d.push(this.shadow.toSVG(this)),c&&d.push(s),d.push(e.join("")),d.push("</g>\n"),u&&d.push("</g>\n"),r?r(d.join("")):d.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var e=fabric.util.object.extend,t="stateProperties";function i(t,i,s){var a={};s.forEach(function(e){a[e]=t[e]}),e(t[i],a,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(e){var i="_"+(e=e||t);return Object.keys(this[i]).length<this[e].length||!function e(t,i,s){if(t===i)return!0;if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(var a=0,n=t.length;a<n;a++)if(!e(t[a],i[a]))return!1;return!0}if(t&&"object"==typeof t){var r,o=Object.keys(t);if(!i||"object"!=typeof i||!s&&o.length!==Object.keys(i).length)return!1;for(a=0,n=o.length;a<n;a++)if("canvas"!==(r=o[a])&&!e(t[r],i[r]))return!1;return!0}}(this[i],this,!0)},saveState:function(e){var s=e&&e.propertySet||t,a="_"+s;return this[a]?(i(this,a,this[s]),e&&e.stateProperties&&i(this,a,e.stateProperties),this):this.setupState(e)},setupState:function(e){var i=(e=e||{}).propertySet||t;return this["_"+(e.propertySet=i)]={},this.saveState(e),this}})}(),function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var t,i,s=e.x,a=e.y;for(var n in this.__corner=0,this.oCoords)if(this.isControlVisible(n)&&("mtr"!==n||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==n&&"mr"!==n&&"mb"!==n&&"ml"!==n)&&(i=this._getImageLines(this.oCoords[n].corner),0!==(t=this._findCrossPoints({x:s,y:a},i))&&t%2==1))return this.__corner=n;return!1},_setCornerCoords:function(){var t,i,s=this.oCoords,a=e(45-this.angle),n=.707106*this.cornerSize,r=n*fabric.util.cos(a),o=n*fabric.util.sin(a);for(var l in s)s[l].corner={tl:{x:(t=s[l].x)-o,y:(i=s[l].y)-r},tr:{x:t+r,y:i-o},bl:{x:t-r,y:i+o},br:{x:t+o,y:i+r}}},drawSelectionBackground:function(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;t.save();var i=this.getCenterPoint(),s=this._calculateCurrentDimensions(),a=this.canvas.viewportTransform;return t.translate(i.x,i.y),t.scale(1/a[0],1/a[3]),t.rotate(e(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-s.x/2,-s.y/2,s.x,s.y),t.restore(),this},drawBorders:function(e,t){t=t||{};var i=this._calculateCurrentDimensions(),s=1/this.borderScaleFactor,a=i.x+s,n=i.y+s,r=void 0!==t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,o=void 0!==t.hasControls?t.hasControls:this.hasControls,l=void 0!==t.rotatingPointOffset?t.rotatingPointOffset:this.rotatingPointOffset;if(e.save(),e.strokeStyle=t.borderColor||this.borderColor,this._setLineDash(e,t.borderDashArray||this.borderDashArray,null),e.strokeRect(-a/2,-n/2,a,n),r&&this.isControlVisible("mtr")&&o){var c=-n/2;e.beginPath(),e.moveTo(0,c),e.lineTo(0,c-l),e.stroke()}return e.restore(),this},drawBordersInGroup:function(e,t,i){i=i||{};var s=this._getNonTransformedDimensions(),a=fabric.util.customTransformMatrix(t.scaleX,t.scaleY,t.skewX),n=fabric.util.transformPoint(s,a),r=1/this.borderScaleFactor,o=n.x+r,l=n.y+r;return e.save(),this._setLineDash(e,i.borderDashArray||this.borderDashArray,null),e.strokeStyle=i.borderColor||this.borderColor,e.strokeRect(-o/2,-l/2,o,l),e.restore(),this},drawControls:function(e,t){t=t||{};var i=this._calculateCurrentDimensions(),s=i.x,a=i.y,n=t.cornerSize||this.cornerSize,r=-(s+n)/2,o=-(a+n)/2,l=void 0!==t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,c=(void 0!==t.transparentCorners?t.transparentCorners:this.transparentCorners)?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,c,r,o,t),this._drawControl("tr",e,c,r+s,o,t),this._drawControl("bl",e,c,r,o+a,t),this._drawControl("br",e,c,r+s,o+a,t),this.get("lockUniScaling")||(this._drawControl("mt",e,c,r+s/2,o,t),this._drawControl("mb",e,c,r+s/2,o+a,t),this._drawControl("mr",e,c,r+s,o+a/2,t),this._drawControl("ml",e,c,r,o+a/2,t)),l&&this._drawControl("mtr",e,c,r+s/2,o-this.rotatingPointOffset,t),e.restore(),this},_drawControl:function(e,t,i,s,a,n){if(n=n||{},this.isControlVisible(e)){var r=this.cornerSize,o=!this.transparentCorners&&this.cornerStrokeColor;switch(n.cornerStyle||this.cornerStyle){case"circle":t.beginPath(),t.arc(s+r/2,a+r/2,r/2,0,2*Math.PI,!1),t[i](),o&&t.stroke();break;default:this.transparentCorners||t.clearRect(s,a,r,r),t[i+"Rect"](s,a,r,r),o&&t.strokeRect(s,a,r,r)}}},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,t){return this._getControlsVisibility()[e]=t,this},setControlsVisibility:function(e){for(var t in e||(e={}),e)this.setControlVisible(t,e[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){var i=function(){},s=(t=t||{}).onComplete||i,a=t.onChange||i,n=this;return fabric.util.animate({startValue:e.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),n.requestRenderAll(),a()},onComplete:function(){e.setCoords(),s()}}),this},fxCenterObjectV:function(e,t){var i=function(){},s=(t=t||{}).onComplete||i,a=t.onChange||i,n=this;return fabric.util.animate({startValue:e.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),n.requestRenderAll(),a()},onComplete:function(){e.setCoords(),s()}}),this},fxRemove:function(e,t){var i=function(){},s=(t=t||{}).onComplete||i,a=t.onChange||i,n=this;return fabric.util.animate({startValue:e.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(t){e.set("opacity",t),n.requestRenderAll(),a()},onComplete:function(){n.remove(e),s()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var e,t=[];for(e in arguments[0])t.push(e);for(var i=0,s=t.length;i<s;i++)this._animate(e=t[i],arguments[0][e],arguments[1],i!==s-1)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,i,s){var a,n=this;t=t.toString(),i=i?fabric.util.object.clone(i):{},~e.indexOf(".")&&(a=e.split("."));var r=a?this.get(a[0])[a[1]]:this.get(e);"from"in i||(i.from=r),t=~t.indexOf("=")?r+parseFloat(t.replace("=","")):parseFloat(t),fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(n)},onChange:function(t,r,o){a?n[a[0]][a[1]]=t:n.set(e,t),s||i.onChange&&i.onChange(t,r,o)},onComplete:function(e,t,a){s||(n.setCoords(),i.onComplete&&i.onComplete(e,t,a))}})}}),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,s=t.util.object.clone,a={x1:1,x2:1,y1:1,y2:1},n=t.StaticCanvas.supports("setLineDash");function r(e,t){var i=e.origin,s=e.axis1,a=e.axis2,n=e.dimension,r=t.nearest,o=t.center,l=t.farthest;return function(){switch(this.get(i)){case r:return Math.min(this.get(s),this.get(a));case o:return Math.min(this.get(s),this.get(a))+.5*this.get(n);case l:return Math.max(this.get(s),this.get(a))}}}t.Line?t.warn("fabric.Line is already defined"):(t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:t.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(e,t){e||(e=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,t){return this.callSuper("_set",e,t),void 0!==a[e]&&this._setWidthHeight(),this},_getLeftToOriginX:r({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:r({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){if(e.beginPath(),!this.strokeDashArray||this.strokeDashArray&&n){var t=this.calcLinePoints();e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2)}e.lineWidth=this.strokeWidth;var i=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=i},_renderDashedStroke:function(e){var i=this.calcLinePoints();e.beginPath(),t.util.drawDashedLine(e,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray),e.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(e){return i(this.callSuper("toObject",e),this.calcLinePoints())},_getNonTransformedDimensions:function(){var e=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(e.y-=this.strokeWidth),0===this.height&&(e.x-=this.strokeWidth)),e},calcLinePoints:function(){var e=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1;return{x1:e*this.width*.5,x2:e*this.width*-.5,y1:t*this.height*.5,y2:t*this.height*-.5}},_toSVG:function(){var e=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',e.x1,'" y1="',e.y1,'" x2="',e.x2,'" y2="',e.y2,'" />\n']}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(e,s,a){a=a||{};var n=t.parseAttributes(e,t.Line.ATTRIBUTE_NAMES);s(new t.Line([n.x1||0,n.y1||0,n.x2||0,n.y2||0],i(n,a)))},t.Line.fromObject=function(e,i){var a=s(e,!0);a.points=[e.x1,e.y1,e.x2,e.y2],t.Object._fromObject("Line",a,function(e){delete e.points,i&&i(e)},"points")})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=Math.PI;t.Circle?t.warn("fabric.Circle is already defined."):(t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*i,cacheProperties:t.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(e,t){return this.callSuper("_set",e,t),"radius"===e&&this.setRadius(t),this},toObject:function(e){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(e))},_toSVG:function(){var e,s=(this.endAngle-this.startAngle)%(2*i);if(0===s)e=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var a=t.util.cos(this.startAngle)*this.radius,n=t.util.sin(this.startAngle)*this.radius,r=t.util.cos(this.endAngle)*this.radius,o=t.util.sin(this.endAngle)*this.radius;e=['<path d="M '+a+" "+n," A "+this.radius+" "+this.radius," 0 ",+(i<s?"1":"0")+" 1"," "+r+" "+o,'" ',"COMMON_PARTS"," />\n"]}return e},_render:function(e){e.beginPath(),e.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){return this.radius=e,this.set("width",2*e).set("height",2*e)}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(e,i){var s,a=t.parseAttributes(e,t.Circle.ATTRIBUTE_NAMES);if(!("radius"in(s=a)&&0<=s.radius))throw new Error("value of `r` attribute is required and can not be negative");a.left=(a.left||0)-a.radius,a.top=(a.top||0)-a.radius,i(new t.Circle(a))},t.Circle.fromObject=function(e,i){return t.Object._fromObject("Circle",e,i)})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Triangle?t.warn("fabric.Triangle is already defined"):(t.Triangle=t.util.createClass(t.Object,{type:"triangle",width:100,height:100,_render:function(e){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,i),e.lineTo(0,-i),e.lineTo(t,i),e.closePath(),this._renderPaintInOrder(e)},_renderDashedStroke:function(e){var i=this.width/2,s=this.height/2;e.beginPath(),t.util.drawDashedLine(e,-i,s,0,-s,this.strokeDashArray),t.util.drawDashedLine(e,0,-s,i,s,this.strokeDashArray),t.util.drawDashedLine(e,i,s,-i,s,this.strokeDashArray),e.closePath()},_toSVG:function(){var e=this.width/2,t=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-e+" "+t,"0 "+-t,e+" "+t].join(","),'" />']}}),t.Triangle.fromObject=function(e,i){return t.Object._fromObject("Triangle",e,i)})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=2*Math.PI;t.Ellipse?t.warn("fabric.Ellipse is already defined."):(t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this.set("rx",e&&e.rx||0),this.set("ry",e&&e.ry||0)},_set:function(e,t){switch(this.callSuper("_set",e,t),e){case"rx":this.rx=t,this.set("width",2*t);break;case"ry":this.ry=t,this.set("height",2*t)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(e){e.beginPath(),e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(0,0,this.rx,0,i,!1),e.restore(),this._renderPaintInOrder(e)}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(e,i){var s=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,i(new t.Ellipse(s))},t.Ellipse.fromObject=function(e,i){return t.Object._fromObject("Ellipse",e,i)})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend;t.Rect?t.warn("fabric.Rect is already defined"):(t.Rect=t.util.createClass(t.Object,{stateProperties:t.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:t.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(e){this.callSuper("initialize",e),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(e){var t=this.rx?Math.min(this.rx,this.width/2):0,i=this.ry?Math.min(this.ry,this.height/2):0,s=this.width,a=this.height,n=-this.width/2,r=-this.height/2,o=0!==t||0!==i,l=.4477152502;e.beginPath(),e.moveTo(n+t,r),e.lineTo(n+s-t,r),o&&e.bezierCurveTo(n+s-l*t,r,n+s,r+l*i,n+s,r+i),e.lineTo(n+s,r+a-i),o&&e.bezierCurveTo(n+s,r+a-l*i,n+s-l*t,r+a,n+s-t,r+a),e.lineTo(n+t,r+a),o&&e.bezierCurveTo(n+l*t,r+a,n,r+a-l*i,n,r+a-i),e.lineTo(n,r+i),o&&e.bezierCurveTo(n,r+l*i,n+l*t,r,n+t,r),e.closePath(),this._renderPaintInOrder(e)},_renderDashedStroke:function(e){var i=-this.width/2,s=-this.height/2,a=this.width,n=this.height;e.beginPath(),t.util.drawDashedLine(e,i,s,i+a,s,this.strokeDashArray),t.util.drawDashedLine(e,i+a,s,i+a,s+n,this.strokeDashArray),t.util.drawDashedLine(e,i+a,s+n,i,s+n,this.strokeDashArray),t.util.drawDashedLine(e,i,s+n,i,s,this.strokeDashArray),e.closePath()},toObject:function(e){return this.callSuper("toObject",["rx","ry"].concat(e))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(e,s,a){if(!e)return s(null);a=a||{};var n=t.parseAttributes(e,t.Rect.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0;var r=new t.Rect(i(a?t.util.object.clone(a):{},n));r.visible=r.visible&&0<r.width&&0<r.height,s(r)},t.Rect.fromObject=function(e,i){return t.Object._fromObject("Rect",e,i)})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,s=t.util.array.min,a=t.util.array.max,n=t.util.toFixed;t.Polyline?t.warn("fabric.Polyline is already defined"):(t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,cacheProperties:t.Object.prototype.cacheProperties.concat("points"),initialize:function(e,t){t=t||{},this.points=e||[],this.callSuper("initialize",t);var i=this._calcDimensions();void 0===t.left&&(this.left=i.left),void 0===t.top&&(this.top=i.top),this.width=i.width,this.height=i.height,this.pathOffset={x:i.left+this.width/2,y:i.top+this.height/2}},_calcDimensions:function(){var e=this.points,t=s(e,"x")||0,i=s(e,"y")||0;return{left:t,top:i,width:(a(e,"x")||0)-t,height:(a(e,"y")||0)-i}},toObject:function(e){return i(this.callSuper("toObject",e),{points:this.points.concat()})},_toSVG:function(){for(var e=[],i=this.pathOffset.x,s=this.pathOffset.y,a=t.Object.NUM_FRACTION_DIGITS,r=0,o=this.points.length;r<o;r++)e.push(n(this.points[r].x-i,a),",",n(this.points[r].y-s,a)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',e.join(""),'" />\n']},commonRender:function(e){var t,i=this.points.length,s=this.pathOffset.x,a=this.pathOffset.y;if(!i||isNaN(this.points[i-1].y))return!1;e.beginPath(),e.moveTo(this.points[0].x-s,this.points[0].y-a);for(var n=0;n<i;n++)e.lineTo((t=this.points[n]).x-s,t.y-a);return!0},_render:function(e){this.commonRender(e)&&this._renderPaintInOrder(e)},_renderDashedStroke:function(e){var i,s;e.beginPath();for(var a=0,n=this.points.length;a<n;a++)t.util.drawDashedLine(e,(i=this.points[a]).x,i.y,(s=this.points[a+1]||i).x,s.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElement=function(e,i,s){if(!e)return i(null);s||(s={});var a=t.parsePointsAttribute(e.getAttribute("points")),n=t.parseAttributes(e,t.Polyline.ATTRIBUTE_NAMES);i(new t.Polyline(a,t.util.object.extend(n,s)))},t.Polyline.fromObject=function(e,i){return t.Object._fromObject("Polyline",e,i,"points")})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend;t.Polygon?t.warn("fabric.Polygon is already defined"):(t.Polygon=t.util.createClass(t.Polyline,{type:"polygon",_render:function(e){this.commonRender(e)&&(e.closePath(),this._renderPaintInOrder(e))},_renderDashedStroke:function(e){this.callSuper("_renderDashedStroke",e),e.closePath()}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=function(e,s,a){if(!e)return s(null);a||(a={});var n=t.parsePointsAttribute(e.getAttribute("points")),r=t.parseAttributes(e,t.Polygon.ATTRIBUTE_NAMES);s(new t.Polygon(n,i(r,a)))},t.Polygon.fromObject=function(e,i){return t.Object._fromObject("Polygon",e,i,"points")})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.array.min,s=t.util.array.max,a=t.util.object.extend,n=Object.prototype.toString,r=t.util.drawArc,o=t.util.toFixed,l={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},c={m:"l",M:"L"};t.Path?t.warn("fabric.Path is already defined"):(t.Path=t.util.createClass(t.Object,{type:"path",path:null,cacheProperties:t.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:t.Object.prototype.stateProperties.concat("path"),initialize:function(e,t){this.callSuper("initialize",t=t||{}),e||(e=[]);var i="[object Array]"===n.call(e);this.path=i?e:e.match&&e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(t))},_setPositionDimensions:function(e){var t=this._parseDimensions();this.width=t.width,this.height=t.height,void 0===e.left&&(this.left=t.left),void 0===e.top&&(this.top=t.top),this.pathOffset=this.pathOffset||{x:t.left+this.width/2,y:t.top+this.height/2}},_renderPathCommands:function(e){var t,i,s,a=null,n=0,o=0,l=0,c=0,h=0,u=0,d=-this.pathOffset.x,p=-this.pathOffset.y;e.beginPath();for(var f=0,g=this.path.length;f<g;++f){switch((t=this.path[f])[0]){case"l":e.lineTo((l+=t[1])+d,(c+=t[2])+p);break;case"L":e.lineTo((l=t[1])+d,(c=t[2])+p);break;case"h":e.lineTo((l+=t[1])+d,c+p);break;case"H":e.lineTo((l=t[1])+d,c+p);break;case"v":e.lineTo(l+d,(c+=t[1])+p);break;case"V":e.lineTo(l+d,(c=t[1])+p);break;case"m":n=l+=t[1],o=c+=t[2],e.moveTo(l+d,c+p);break;case"M":n=l=t[1],o=c=t[2],e.moveTo(l+d,c+p);break;case"c":e.bezierCurveTo(l+t[1]+d,c+t[2]+p,(h=l+t[3])+d,(u=c+t[4])+p,(i=l+t[5])+d,(s=c+t[6])+p),l=i,c=s;break;case"C":e.bezierCurveTo(t[1]+d,t[2]+p,(h=t[3])+d,(u=t[4])+p,(l=t[5])+d,(c=t[6])+p);break;case"s":i=l+t[3],s=c+t[4],null===a[0].match(/[CcSs]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),e.bezierCurveTo(h+d,u+p,l+t[1]+d,c+t[2]+p,i+d,s+p),h=l+t[1],u=c+t[2],l=i,c=s;break;case"S":i=t[3],s=t[4],null===a[0].match(/[CcSs]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),e.bezierCurveTo(h+d,u+p,t[1]+d,t[2]+p,i+d,s+p),l=i,c=s,h=t[1],u=t[2];break;case"q":e.quadraticCurveTo((h=l+t[1])+d,(u=c+t[2])+p,(i=l+t[3])+d,(s=c+t[4])+p),l=i,c=s;break;case"Q":e.quadraticCurveTo(t[1]+d,t[2]+p,(i=t[3])+d,(s=t[4])+p),l=i,c=s,h=t[1],u=t[2];break;case"t":i=l+t[1],s=c+t[2],null===a[0].match(/[QqTt]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),e.quadraticCurveTo(h+d,u+p,i+d,s+p),l=i,c=s;break;case"T":i=t[1],s=t[2],null===a[0].match(/[QqTt]/)?(h=l,u=c):(h=2*l-h,u=2*c-u),e.quadraticCurveTo(h+d,u+p,i+d,s+p),l=i,c=s;break;case"a":r(e,l+d,c+p,[t[1],t[2],t[3],t[4],t[5],t[6]+l+d,t[7]+c+p]),l+=t[6],c+=t[7];break;case"A":r(e,l+d,c+p,[t[1],t[2],t[3],t[4],t[5],t[6]+d,t[7]+p]),l=t[6],c=t[7];break;case"z":case"Z":l=n,c=o,e.closePath()}a=t}},_render:function(e){this._renderPathCommands(e),this._renderPaintInOrder(e)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){return a(this.callSuper("toObject",e),{path:this.path.map(function(e){return e.slice()}),top:this.top,left:this.left})},toDatalessObject:function(e){var t=this.toObject(["sourcePath"].concat(e));return t.sourcePath&&delete t.path,t},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',this.path.map(function(e){return e.join(" ")}).join(" "),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var e=t.Object.NUM_FRACTION_DIGITS;return" translate("+o(-this.pathOffset.x,e)+", "+o(-this.pathOffset.y,e)+")"},toClipPathSVG:function(e){var t=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},toSVG:function(e){var t=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:e,additionalTransform:t})},complexity:function(){return this.path.length},_parsePath:function(){for(var e,t,i,s,a,n=[],r=[],o=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,h=0,u=this.path.length;h<u;h++){for(s=(e=this.path[h]).slice(1).trim(),r.length=0;i=o.exec(s);)r.push(i[0]);a=[e.charAt(0)];for(var d=0,p=r.length;d<p;d++)t=parseFloat(r[d]),isNaN(t)||a.push(t);var f=a[0],g=l[f.toLowerCase()],m=c[f]||f;if(a.length-1>g)for(var v=1,b=a.length;v<b;v+=g)n.push([f].concat(a.slice(v,v+g))),f=m;else n.push(a)}return n},_parseDimensions:function(){for(var e,a,n,r,o=[],l=[],c=null,h=0,u=0,d=0,p=0,f=0,g=0,m=0,v=this.path.length;m<v;++m){switch((e=this.path[m])[0]){case"l":d+=e[1],p+=e[2],r=[];break;case"L":d=e[1],p=e[2],r=[];break;case"h":d+=e[1],r=[];break;case"H":d=e[1],r=[];break;case"v":p+=e[1],r=[];break;case"V":p=e[1],r=[];break;case"m":h=d+=e[1],u=p+=e[2],r=[];break;case"M":h=d=e[1],u=p=e[2],r=[];break;case"c":r=t.util.getBoundsOfCurve(d,p,d+e[1],p+e[2],f=d+e[3],g=p+e[4],a=d+e[5],n=p+e[6]),d=a,p=n;break;case"C":r=t.util.getBoundsOfCurve(d,p,e[1],e[2],f=e[3],g=e[4],e[5],e[6]),d=e[5],p=e[6];break;case"s":a=d+e[3],n=p+e[4],null===c[0].match(/[CcSs]/)?(f=d,g=p):(f=2*d-f,g=2*p-g),r=t.util.getBoundsOfCurve(d,p,f,g,d+e[1],p+e[2],a,n),f=d+e[1],g=p+e[2],d=a,p=n;break;case"S":a=e[3],n=e[4],null===c[0].match(/[CcSs]/)?(f=d,g=p):(f=2*d-f,g=2*p-g),r=t.util.getBoundsOfCurve(d,p,f,g,e[1],e[2],a,n),d=a,p=n,f=e[1],g=e[2];break;case"q":r=t.util.getBoundsOfCurve(d,p,f=d+e[1],g=p+e[2],f,g,a=d+e[3],n=p+e[4]),d=a,p=n;break;case"Q":r=t.util.getBoundsOfCurve(d,p,f=e[1],g=e[2],f,g,e[3],e[4]),d=e[3],p=e[4];break;case"t":a=d+e[1],n=p+e[2],null===c[0].match(/[QqTt]/)?(f=d,g=p):(f=2*d-f,g=2*p-g),r=t.util.getBoundsOfCurve(d,p,f,g,f,g,a,n),d=a,p=n;break;case"T":a=e[1],n=e[2],null===c[0].match(/[QqTt]/)?(f=d,g=p):(f=2*d-f,g=2*p-g),r=t.util.getBoundsOfCurve(d,p,f,g,f,g,a,n),d=a,p=n;break;case"a":r=t.util.getBoundsOfArc(d,p,e[1],e[2],e[3],e[4],e[5],e[6]+d,e[7]+p),d+=e[6],p+=e[7];break;case"A":r=t.util.getBoundsOfArc(d,p,e[1],e[2],e[3],e[4],e[5],e[6],e[7]),d=e[6],p=e[7];break;case"z":case"Z":d=h,p=u}c=e,r.forEach(function(e){o.push(e.x),l.push(e.y)}),o.push(d),l.push(p)}var b=i(o)||0,y=i(l)||0;return{left:b,top:y,width:(s(o)||0)-b,height:(s(l)||0)-y}}}),t.Path.fromObject=function(e,i){"string"==typeof e.sourcePath?t.loadSVGFromURL(e.sourcePath,function(t){var s=t[0];s.setOptions(e),i&&i(s)}):t.Object._fromObject("Path",e,i,"path")},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(e,i,s){var n=t.parseAttributes(e,t.Path.ATTRIBUTE_NAMES);i(new t.Path(n.d,a(n,s)))})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.array.min,s=t.util.array.max;t.Group||(t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(e,t,i){t=t||{},this._objects=[],i&&this.callSuper("initialize",t),this._objects=e||[];for(var s=this._objects.length;s--;)this._objects[s].group=this;if(i)this._updateObjectsACoords();else{var a=t&&t.centerPoint;void 0!==t.originX&&(this.originX=t.originX),void 0!==t.originY&&(this.originY=t.originY),a||this._calcBounds(),this._updateObjectsCoords(a),delete t.centerPoint,this.callSuper("initialize",t)}this.setCoords()},_updateObjectsACoords:function(){for(var e=this._objects.length;e--;)this._objects[e].setCoords(!0,!0)},_updateObjectsCoords:function(e){e=e||this.getCenterPoint();for(var t=this._objects.length;t--;)this._updateObjectCoords(this._objects[t],e)},_updateObjectCoords:function(e,t){e.set({left:e.left-t.x,top:e.top-t.y}),e.group=this,e.setCoords(!0,!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){return this._restoreObjectsState(),t.util.resetObjectTransform(this),e&&(this._objects.push(e),e.group=this,e._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(e){return this._restoreObjectsState(),t.util.resetObjectTransform(this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(e){this.dirty=!0,e.group=this,e._set("canvas",this.canvas)},_onObjectRemoved:function(e){this.dirty=!0,delete e.group},_set:function(e,i){var s=this._objects.length;if(this.useSetOnGroup)for(;s--;)this._objects[s].setOnGroup(e,i);if("canvas"===e)for(;s--;)this._objects[s]._set(e,i);t.Object.prototype._set.call(this,e,i)},toObject:function(e){var i=this.includeDefaultValues,s=this._objects.map(function(t){var s=t.includeDefaultValues;t.includeDefaultValues=i;var a=t.toObject(e);return t.includeDefaultValues=s,a}),a=t.Object.prototype.toObject.call(this,e);return a.objects=s,a},toDatalessObject:function(e){var i,s=this.sourcePath;if(s)i=s;else{var a=this.includeDefaultValues;i=this._objects.map(function(t){var i=t.includeDefaultValues;t.includeDefaultValues=a;var s=t.toDatalessObject(e);return t.includeDefaultValues=i,s})}var n=t.Object.prototype.toDatalessObject.call(this,e);return n.objects=i,n},render:function(e){this._transformDone=!0,this.callSuper("render",e),this._transformDone=!1},shouldCache:function(){var e=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=e)for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].willDrawShadow())return this.ownCaching=!1;return e},willDrawShadow:function(){if(this.shadow)return t.Object.prototype.willDrawShadow.call(this);for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(e){for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].render(e);this._drawClipPath(e)},isCacheDirty:function(e){if(this.callSuper("isCacheDirty",e))return!0;if(!this.statefullCache)return!1;for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var s=this.cacheWidth/this.zoomX,a=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-s/2,-a/2,s,a)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(e){var i=e.calcTransformMatrix(),s=t.util.qrDecompose(i),a=new t.Point(s.translateX,s.translateY);return e.flipX=!1,e.flipY=!1,e.set("scaleX",s.scaleX),e.set("scaleY",s.scaleY),e.skewX=s.skewX,e.skewY=s.skewY,e.angle=s.angle,e.setPositionByOrigin(a,"center","center"),e},_restoreObjectState:function(e){return this.realizeTransform(e),e.setCoords(),delete e.group,this},destroy:function(){return this._objects.forEach(function(e){e.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var e=this._objects,i=this.canvas;this._objects=[];var s=this.toObject();delete s.objects;var a=new t.ActiveSelection([]);return a.set(s),a.type="activeSelection",i.remove(this),e.forEach(function(e){e.group=a,e.dirty=!0,i.add(e)}),a.canvas=i,a._objects=e,(i._activeObject=a).setCoords(),a}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(e){e.setCoords(!0,!0)}),this},_calcBounds:function(e){for(var t,i,s,a=[],n=[],r=["tr","br","bl","tl"],o=0,l=this._objects.length,c=r.length;o<l;++o)for((t=this._objects[o]).setCoords(!0),s=0;s<c;s++)a.push(t.oCoords[i=r[s]].x),n.push(t.oCoords[i].y);this._getBounds(a,n,e)},_getBounds:function(e,a,n){var r=new t.Point(i(e),i(a)),o=new t.Point(s(e),s(a)),l=r.y||0,c=r.x||0,h=o.y-r.y||0;this.width=o.x-r.x||0,this.height=h,n||this.setPositionByOrigin({x:c,y:l},"left","top")},toSVG:function(e){for(var t=[],i=0,s=this._objects.length;i<s;i++)t.push("\t",this._objects[i].toSVG(e));return this._createBaseSVGMarkup(t,{reviver:e,noStyle:!0,withShadow:!0})},toClipPathSVG:function(e){for(var t=[],i=0,s=this._objects.length;i<s;i++)t.push("\t",this._objects[i].toClipPathSVG(e));return this._createBaseClipPathSVGMarkup(t,{reviver:e})}}),t.Group.fromObject=function(e,i){t.util.enlivenObjects(e.objects,function(s){t.util.enlivenObjects([e.clipPath],function(a){var n=t.util.object.clone(e,!0);n.clipPath=a[0],delete n.objects,i&&i(new t.Group(s,n,!0))})})})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={});t.ActiveSelection||(t.ActiveSelection=t.util.createClass(t.Group,{type:"activeSelection",initialize:function(e,i){i=i||{},this._objects=e||[];for(var s=this._objects.length;s--;)this._objects[s].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),t.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var e=this._objects.concat();this._objects=[];var i=t.Object.prototype.toObject.call(this),s=new t.Group([]);if(delete i.type,s.set(i),e.forEach(function(e){e.canvas.remove(e),e.group=s}),s._objects=e,!this.canvas)return s;var a=this.canvas;return a.add(s),(a._activeObject=s).setCoords(),s},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(e,t,i){e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",e,t),void 0===(i=i||{}).hasControls&&(i.hasControls=!1),void 0===i.hasRotatingPoint&&(i.hasRotatingPoint=!1),i.forActiveSelection=!0;for(var s=0,a=this._objects.length;s<a;s++)this._objects[s]._renderControls(e,i);e.restore()}}),t.ActiveSelection.fromObject=function(e,i){t.util.enlivenObjects(e.objects,function(s){delete e.objects,i&&i(new t.ActiveSelection(s,e,!0))})})}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=fabric.util.object.extend;e.fabric||(e.fabric={}),e.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:fabric.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(e,t){t||(t={}),this.filters=[],this.cacheKey="texture"+fabric.Object.__uid++,this.callSuper("initialize",t),this._initElement(e,t)},getElement:function(){return this._element||{}},setElement:function(e,t){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=e,this._originalElement=e,this._initConfig(t),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(e){var t=fabric.filterBackend;t&&t.evictCachesForKey&&t.evictCachesForKey(e)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(e){fabric.util.cleanUpJsdomNode(this[e]),this[e]=void 0}).bind(this))},setCrossOrigin:function(e){return this.crossOrigin=e,this._element.crossOrigin=e,this},getOriginalSize:function(){var e=this.getElement();return{width:e.naturalWidth||e.width,height:e.naturalHeight||e.height}},_stroke:function(e){if(this.stroke&&0!==this.strokeWidth){var t=this.width/2,i=this.height/2;e.beginPath(),e.moveTo(-t,-i),e.lineTo(t,-i),e.lineTo(t,i),e.lineTo(-t,i),e.lineTo(-t,-i),e.closePath()}},_renderDashedStroke:function(e){var t=-this.width/2,i=-this.height/2,s=this.width,a=this.height;e.save(),this._setStrokeStyles(e,this),e.beginPath(),fabric.util.drawDashedLine(e,t,i,t+s,i,this.strokeDashArray),fabric.util.drawDashedLine(e,t+s,i,t+s,i+a,this.strokeDashArray),fabric.util.drawDashedLine(e,t+s,i+a,t,i+a,this.strokeDashArray),fabric.util.drawDashedLine(e,t,i+a,t,i,this.strokeDashArray),e.closePath(),e.restore()},toObject:function(e){var i=[];this.filters.forEach(function(e){e&&i.push(e.toObject())});var s=t(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(e)),{src:this.getSrc(),filters:i});return this.resizeFilter&&(s.resizeFilter=this.resizeFilter.toObject()),s},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var e,t=[],i=[],s=-this.width/2,a=-this.height/2,n="";if(this.hasCrop()){var r=fabric.Object.__uid++;t.push('<clipPath id="imageCrop_'+r+'">\n','\t<rect x="'+s+'" y="'+a+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),n=' clip-path="url(#imageCrop_'+r+')" '}if(i.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',s-this.cropX,'" y="',a-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',n,"></image>\n"),this.stroke||this.strokeDashArray){var o=this.fill;this.fill=null,e=["\t<rect ",'x="',s,'" y="',a,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=o}return"fill"!==this.paintFirst?t.concat(e,i):t.concat(i,e)},getSrc:function(e){var t=e?this._element:this._originalElement;return t?t.toDataURL?t.toDataURL():this.srcFromAttribute?t.getAttribute("src"):t.src:this.src||""},setSrc:function(e,t,i){return fabric.util.loadImage(e,function(e){this.setElement(e,i),this._setWidthHeight(),t&&t(this)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var e=this.resizeFilter,t=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),s=i.scaleX,a=i.scaleY,n=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!e||t<s&&t<a)return this._element=n,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=a);fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend());var r=fabric.util.createCanvasElement(),o=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,l=n.width,c=n.height;r.width=l,r.height=c,this._element=r,this._lastScaleX=e.scaleX=s,this._lastScaleY=e.scaleY=a,fabric.filterBackend.applyFilters([e],n,l,c,this._element,o),this._filterScalingX=r.width/this._originalElement.width,this._filterScalingY=r.height/this._originalElement.height},applyFilters:function(e){if(e=(e=e||this.filters||[]).filter(function(e){return e&&!e.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===e.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var t=this._originalElement,i=t.naturalWidth||t.width,s=t.naturalHeight||t.height;if(this._element===this._originalElement){var a=fabric.util.createCanvasElement();a.width=i,a.height=s,this._element=a,this._filteredEl=a}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,s),this._lastScaleX=1,this._lastScaleY=1;return fabric.filterBackend||(fabric.filterBackend=fabric.initFilterBackend()),fabric.filterBackend.applyFilters(e,this._originalElement,i,s,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(e){!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(e),this._renderPaintInOrder(e)},shouldCache:function(){return this.ownCaching=this.objectCaching&&this.needsItsOwnCache(),this.ownCaching},_renderFill:function(e){var t=this._element,i=this.width,s=this.height,a=Math.min(t.naturalWidth||t.width,i*this._filterScalingX),n=Math.min(t.naturalHeight||t.height,s*this._filterScalingY),r=-i/2,o=-s/2,l=Math.max(0,this.cropX*this._filterScalingX),c=Math.max(0,this.cropY*this._filterScalingY);t&&e.drawImage(t,l,c,a,n,r,o,i,s)},_needsResize:function(){var e=this.getTotalObjectScaling();return e.scaleX!==this._lastScaleX||e.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(e,t){this.setElement(fabric.util.getById(e),t),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(e,t){e&&e.length?fabric.util.enlivenObjects(e,function(e){t&&t(e)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){e||(e={});var t=this.getElement();this.width=e.width||t.naturalWidth||t.width||0,this.height=e.height||t.naturalHeight||t.height||0},parsePreserveAspectRatioAttribute:function(){var e,t=fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,s=this._element.height,a=1,n=1,r=0,o=0,l=0,c=0,h=this.width,u=this.height,d={width:h,height:u};return!t||"none"===t.alignX&&"none"===t.alignY?(a=h/i,n=u/s):("meet"===t.meetOrSlice&&(e=(h-i*(a=n=fabric.util.findScaleToFit(this._element,d)))/2,"Min"===t.alignX&&(r=-e),"Max"===t.alignX&&(r=e),e=(u-s*n)/2,"Min"===t.alignY&&(o=-e),"Max"===t.alignY&&(o=e)),"slice"===t.meetOrSlice&&(e=i-h/(a=n=fabric.util.findScaleToCover(this._element,d)),"Mid"===t.alignX&&(l=e/2),"Max"===t.alignX&&(l=e),e=s-u/n,"Mid"===t.alignY&&(c=e/2),"Max"===t.alignY&&(c=e),i=h/a,s=u/n)),{width:i,height:s,scaleX:a,scaleY:n,offsetLeft:r,offsetTop:o,cropX:l,cropY:c}}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(e,t){var i=fabric.util.object.clone(e);fabric.util.loadImage(i.src,function(e,s){s?t&&t(null,s):fabric.Image.prototype._initFilters.call(i,i.filters,function(s){i.filters=s||[],fabric.Image.prototype._initFilters.call(i,[i.resizeFilter],function(s){i.resizeFilter=s[0],fabric.util.enlivenObjects([i.clipPath],function(s){i.clipPath=s[0];var a=new fabric.Image(e,i);t(a)})})})},null,i.crossOrigin)},fabric.Image.fromURL=function(e,t,i){fabric.util.loadImage(e,function(e){t&&t(new fabric.Image(e,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),fabric.Image.fromElement=function(e,i,s){var a=fabric.parseAttributes(e,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(a["xlink:href"],i,t(s?fabric.util.object.clone(s):{},a))})}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.angle%360;return 0<e?90*Math.round((e-1)/90):90*Math.round(e/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(e){var t=function(){},i=(e=e||{}).onComplete||t,s=e.onChange||t,a=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){a.rotate(e),s()},onComplete:function(){a.setCoords(),i()}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){"use strict";fabric.isWebglSupported=function(e){if(fabric.isLikelyNode)return!1;e=e||fabric.WebglFilterBackend.prototype.tileSize;var t,i,s,a=document.createElement("canvas"),n=a.getContext("webgl")||a.getContext("experimental-webgl"),r=!1;if(n){fabric.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),r=fabric.maxTextureSize>=e;for(var o=["highp","mediump","lowp"],l=0;l<3;l++)if(i="precision "+o[l]+" float;\nvoid main(){}",s=(t=n).createShader(t.FRAGMENT_SHADER),t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)){fabric.webGlPrecision=o[l];break}}return this.isSupported=r},(fabric.WebglFilterBackend=function(e){e&&e.tileSize&&(this.tileSize=e.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}).prototype={tileSize:2048,resources:{},setupGLContext:function(e,t){this.dispose(),this.createWebGLCanvas(e,t),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(e,t)},chooseFastestCopyGLTo2DMethod:function(e,t){var i,s=void 0!==window.performance;try{new ImageData(1,1),i=!0}catch(e){i=!1}var a="undefined"!=typeof ArrayBuffer,n="undefined"!=typeof Uint8ClampedArray;if(s&&i&&a&&n){var r,o,l=fabric.util.createCanvasElement(),c=new ArrayBuffer(e*t*4),h={imageBuffer:c,destinationWidth:e,destinationHeight:t,targetCanvas:l};l.width=e,l.height=t,r=window.performance.now(),copyGLTo2DDrawImage.call(h,this.gl,h),o=window.performance.now()-r,r=window.performance.now(),copyGLTo2DPutImageData.call(h,this.gl,h),window.performance.now()-r<o?(this.imageBuffer=c,this.copyGLTo2D=copyGLTo2DPutImageData):this.copyGLTo2D=copyGLTo2DDrawImage}},createWebGLCanvas:function(e,t){var i=fabric.util.createCanvasElement();i.width=e,i.height=t;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},a=i.getContext("webgl",s);a||(a=i.getContext("experimental-webgl",s)),a&&(a.clearColor(0,0,0,0),this.canvas=i,this.gl=a)},applyFilters:function(e,t,i,s,a,n){var r,o=this.gl;n&&(r=this.getCachedTexture(n,t));var l={originalWidth:t.width||t.originalWidth,originalHeight:t.height||t.originalHeight,sourceWidth:i,sourceHeight:s,destinationWidth:i,destinationHeight:s,context:o,sourceTexture:this.createTexture(o,i,s,!r&&t),targetTexture:this.createTexture(o,i,s),originalTexture:r||this.createTexture(o,i,s,!r&&t),passes:e.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:a},c=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,c),e.forEach(function(e){e&&e.applyTo(l)}),resizeCanvasIfNeeded(l),this.copyGLTo2D(o,l),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(l.sourceTexture),o.deleteTexture(l.targetTexture),o.deleteFramebuffer(c),a.getContext("2d").setTransform(1,0,0,1,0,0),l},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(e,t,i,s){var a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),a},getCachedTexture:function(e,t){if(this.textureCache[e])return this.textureCache[e];var i=this.createTexture(this.gl,t.width,t.height,t);return this.textureCache[e]=i},evictCachesForKey:function(e){this.textureCache[e]&&(this.gl.deleteTexture(this.textureCache[e]),delete this.textureCache[e])},copyGLTo2D:copyGLTo2DDrawImage,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var e=this.gl,t={renderer:"",vendor:""};if(!e)return t;var i=e.getExtension("WEBGL_debug_renderer_info");if(i){var s=e.getParameter(i.UNMASKED_RENDERER_WEBGL),a=e.getParameter(i.UNMASKED_VENDOR_WEBGL);s&&(t.renderer=s.toLowerCase()),a&&(t.vendor=a.toLowerCase())}return this.gpuInfo=t}}}(),function(){"use strict";var e=function(){};(fabric.Canvas2dFilterBackend=function(){}).prototype={evictCachesForKey:e,dispose:e,clearWebGLCaches:e,resources:{},applyFilters:function(e,t,i,s,a){var n=a.getContext("2d");n.drawImage(t,0,0,i,s);var r={sourceWidth:i,sourceHeight:s,imageData:n.getImageData(0,0,i,s),originalEl:t,originalImageData:n.getImageData(0,0,i,s),canvasEl:a,ctx:n,filterBackend:this};return e.forEach(function(e){e.applyTo(r)}),r.imageData.width===i&&r.imageData.height===s||(a.width=r.imageData.width,a.height=r.imageData.height),n.putImageData(r.imageData,0,0),r}}}(),fabric.Image=fabric.Image||{},fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(e){e&&this.setOptions(e)},setOptions:function(e){for(var t in e)this[t]=e[t]},createProgram:function(e,t,i){t=t||this.fragmentSource,i=i||this.vertexSource,"highp"!==fabric.webGlPrecision&&(t=t.replace(/precision highp float/g,"precision "+fabric.webGlPrecision+" float"));var s=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+e.getShaderInfoLog(s));var a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+e.getShaderInfoLog(a));var n=e.createProgram();if(e.attachShader(n,s),e.attachShader(n,a),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+e.getProgramInfoLog(n));var r=this.getAttributeLocations(e,n),o=this.getUniformLocations(e,n)||{};return o.uStepW=e.getUniformLocation(n,"uStepW"),o.uStepH=e.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:r,uniformLocations:o}},getAttributeLocations:function(e,t){return{aPosition:e.getAttribLocation(t,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(e,t,i){var s=t.aPosition,a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW)},_setupFrameBuffer:function(e){var t,i,s=e.context;1<e.passes?(i=e.destinationHeight,e.sourceWidth===(t=e.destinationWidth)&&e.sourceHeight===i||(s.deleteTexture(e.targetTexture),e.targetTexture=e.filterBackend.createTexture(s,t,i)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(e){e.passes--,e.pass++;var t=e.targetTexture;e.targetTexture=e.sourceTexture,e.sourceTexture=t},isNeutralState:function(){var e=this.mainParameter,t=fabric.Image.filters[this.type].prototype;if(e){if(Array.isArray(t[e])){for(var i=t[e].length;i--;)if(this[e][i]!==t[e][i])return!1;return!0}return t[e]===this[e]}return!1},applyTo:function(e){e.webgl?(this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},retrieveShader:function(e){return e.programCache.hasOwnProperty(this.type)||(e.programCache[this.type]=this.createProgram(e.context)),e.programCache[this.type]},applyToWebGL:function(e){var t=e.context,i=this.retrieveShader(e);t.bindTexture(t.TEXTURE_2D,0===e.pass&&e.originalTexture?e.originalTexture:e.sourceTexture),t.useProgram(i.program),this.sendAttributeData(t,i.attributeLocations,e.aPosition),t.uniform1f(i.uniformLocations.uStepW,1/e.sourceWidth),t.uniform1f(i.uniformLocations.uStepH,1/e.sourceHeight),this.sendUniformData(t,i.uniformLocations),t.viewport(0,0,e.destinationWidth,e.destinationHeight),t.drawArrays(t.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(e,t,i){e.activeTexture(i),e.bindTexture(e.TEXTURE_2D,t),e.activeTexture(e.TEXTURE0)},unbindAdditionalTexture:function(e,t){e.activeTexture(t),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(e){this[this.mainParameter]=e},sendUniformData:function(){},createHelpLayer:function(e){if(!e.helpLayer){var t=document.createElement("canvas");t.width=e.sourceWidth,t.height=e.sourceHeight,e.helpLayer=t}},toObject:function(){var e={type:this.type},t=this.mainParameter;return t&&(e[t]=this[t]),e},toJSON:function(){return this.toObject()}}),fabric.Image.filters.BaseFilter.fromObject=function(e,t){var i=new fabric.Image.filters[e.type](e);return t&&t(i),i},function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.ColorMatrix=(0,t.util.createClass)(i.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(e){this.callSuper("initialize",e),this.matrix=this.matrix.slice(0)},applyTo2d:function(e){var t,i,s,a,n,r=e.imageData.data,o=r.length,l=this.matrix,c=this.colorsOnly;for(n=0;n<o;n+=4)t=r[n],i=r[n+1],s=r[n+2],c?(r[n]=t*l[0]+i*l[1]+s*l[2]+255*l[4],r[n+1]=t*l[5]+i*l[6]+s*l[7]+255*l[9],r[n+2]=t*l[10]+i*l[11]+s*l[12]+255*l[14]):(r[n]=t*l[0]+i*l[1]+s*l[2]+(a=r[n+3])*l[3]+255*l[4],r[n+1]=t*l[5]+i*l[6]+s*l[7]+a*l[8]+255*l[9],r[n+2]=t*l[10]+i*l[11]+s*l[12]+a*l[13]+255*l[14],r[n+3]=t*l[15]+i*l[16]+s*l[17]+a*l[18]+255*l[19])},getUniformLocations:function(e,t){return{uColorMatrix:e.getUniformLocation(t,"uColorMatrix"),uConstants:e.getUniformLocation(t,"uConstants")}},sendUniformData:function(e,t){var i=this.matrix,s=[i[4],i[9],i[14],i[19]];e.uniformMatrix4fv(t.uColorMatrix,!1,[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]]),e.uniform4fv(t.uConstants,s)}}),t.Image.filters.ColorMatrix.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Brightness=(0,t.util.createClass)(i.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(e){if(0!==this.brightness){var t,i=e.imageData.data,s=i.length,a=Math.round(255*this.brightness);for(t=0;t<s;t+=4)i[t]=i[t]+a,i[t+1]=i[t+1]+a,i[t+2]=i[t+2]+a}},getUniformLocations:function(e,t){return{uBrightness:e.getUniformLocation(t,"uBrightness")}},sendUniformData:function(e,t){e.uniform1f(t.uBrightness,this.brightness)}}),t.Image.filters.Brightness.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,s=t.Image.filters;s.Convolute=(0,t.util.createClass)(s.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(e){var t=Math.sqrt(this.matrix.length),i=this.type+"_"+t+"_"+(this.opaque?1:0),s=this.fragmentSource[i];return e.programCache.hasOwnProperty(i)||(e.programCache[i]=this.createProgram(e.context,s)),e.programCache[i]},applyTo2d:function(e){var t,i,s,a,n,r,o,l,c,h,u,d,p,f=e.imageData,g=f.data,m=this.matrix,v=Math.round(Math.sqrt(m.length)),b=Math.floor(v/2),y=f.width,x=f.height,w=e.ctx.createImageData(y,x),S=w.data,C=this.opaque?1:0;for(u=0;u<x;u++)for(h=0;h<y;h++){for(n=4*(u*y+h),p=a=s=i=t=0;p<v;p++)for(d=0;d<v;d++)r=h+d-b,(o=u+p-b)<0||x<o||r<0||y<r||(t+=g[l=4*(o*y+r)]*(c=m[p*v+d]),i+=g[l+1]*c,s+=g[l+2]*c,C||(a+=g[l+3]*c));S[n]=t,S[n+1]=i,S[n+2]=s,S[n+3]=C?g[n+3]:a}e.imageData=w},getUniformLocations:function(e,t){return{uMatrix:e.getUniformLocation(t,"uMatrix"),uOpaque:e.getUniformLocation(t,"uOpaque"),uHalfSize:e.getUniformLocation(t,"uHalfSize"),uSize:e.getUniformLocation(t,"uSize")}},sendUniformData:function(e,t){e.uniform1fv(t.uMatrix,this.matrix)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Grayscale=(0,t.util.createClass)(i.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(e){var t,i,s=e.imageData.data,a=s.length,n=this.mode;for(t=0;t<a;t+=4)"average"===n?i=(s[t]+s[t+1]+s[t+2])/3:"lightness"===n?i=(Math.min(s[t],s[t+1],s[t+2])+Math.max(s[t],s[t+1],s[t+2]))/2:"luminosity"===n&&(i=.21*s[t]+.72*s[t+1]+.07*s[t+2]),s[t]=i,s[t+1]=i,s[t+2]=i},retrieveShader:function(e){var t=this.type+"_"+this.mode;return e.programCache.hasOwnProperty(t)||(e.programCache[t]=this.createProgram(e.context,this.fragmentSource[this.mode])),e.programCache[t]},getUniformLocations:function(e,t){return{uMode:e.getUniformLocation(t,"uMode")}},sendUniformData:function(e,t){e.uniform1i(t.uMode,1)},isNeutralState:function(){return!1}}),t.Image.filters.Grayscale.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Invert=(0,t.util.createClass)(i.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(e){var t,i=e.imageData.data,s=i.length;for(t=0;t<s;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(e,t){return{uInvert:e.getUniformLocation(t,"uInvert")}},sendUniformData:function(e,t){e.uniform1i(t.uInvert,this.invert)}}),t.Image.filters.Invert.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,s=t.Image.filters;s.Noise=(0,t.util.createClass)(s.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(e){if(0!==this.noise){var t,i,s,a=e.imageData.data,n=this.noise;for(t=0,s=a.length;t<s;t+=4)i=(.5-Math.random())*n,a[t]+=i,a[t+1]+=i,a[t+2]+=i}},getUniformLocations:function(e,t){return{uNoise:e.getUniformLocation(t,"uNoise"),uSeed:e.getUniformLocation(t,"uSeed")}},sendUniformData:function(e,t){e.uniform1f(t.uNoise,this.noise/255),e.uniform1f(t.uSeed,Math.random())},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Pixelate=(0,t.util.createClass)(i.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(e){var t,i,s,a,n,r,o,l,c,h,u,d=e.imageData,p=d.data,f=d.height,g=d.width;for(i=0;i<f;i+=this.blocksize)for(s=0;s<g;s+=this.blocksize)for(a=p[t=4*i*g+4*s],n=p[t+1],r=p[t+2],o=p[t+3],h=Math.min(i+this.blocksize,f),u=Math.min(s+this.blocksize,g),l=i;l<h;l++)for(c=s;c<u;c++)p[t=4*l*g+4*c]=a,p[t+1]=n,p[t+2]=r,p[t+3]=o},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(e,t){return{uBlocksize:e.getUniformLocation(t,"uBlocksize"),uStepW:e.getUniformLocation(t,"uStepW"),uStepH:e.getUniformLocation(t,"uStepH")}},sendUniformData:function(e,t){e.uniform1f(t.uBlocksize,this.blocksize)}}),t.Image.filters.Pixelate.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.extend,s=t.Image.filters;s.RemoveColor=(0,t.util.createClass)(s.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(e){var i,s,a,n,r=e.imageData.data,o=255*this.distance,l=new t.Color(this.color).getSource(),c=[l[0]-o,l[1]-o,l[2]-o],h=[l[0]+o,l[1]+o,l[2]+o];for(i=0;i<r.length;i+=4)a=r[i+1],n=r[i+2],c[0]<(s=r[i])&&c[1]<a&&c[2]<n&&s<h[0]&&a<h[1]&&n<h[2]&&(r[i+3]=0)},getUniformLocations:function(e,t){return{uLow:e.getUniformLocation(t,"uLow"),uHigh:e.getUniformLocation(t,"uHigh")}},sendUniformData:function(e,i){var s=new t.Color(this.color).getSource(),a=parseFloat(this.distance),n=[s[0]/255+a,s[1]/255+a,s[2]/255+a,1];e.uniform4fv(i.uLow,[0+s[0]/255-a,0+s[1]/255-a,0+s[2]/255-a,1]),e.uniform4fv(i.uHigh,n)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),t.Image.filters.RemoveColor.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters,s=t.util.createClass,a={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in a)i[n]=s(i.ColorMatrix,{type:n,matrix:a[n],mainParameter:!1,colorsOnly:!0}),t.Image.filters[n].fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric,i=t.Image.filters;i.BlendColor=(0,t.util.createClass)(i.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(e){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[e]+"}\n}"},retrieveShader:function(e){var t,i=this.type+"_"+this.mode;return e.programCache.hasOwnProperty(i)||(t=this.buildSource(this.mode),e.programCache[i]=this.createProgram(e.context,t)),e.programCache[i]},applyTo2d:function(e){var i,s,a,n,r,o,l,c=e.imageData.data,h=c.length,u=1-this.alpha;i=(l=new t.Color(this.color).getSource())[0]*this.alpha,s=l[1]*this.alpha,a=l[2]*this.alpha;for(var d=0;d<h;d+=4)switch(n=c[d],r=c[d+1],o=c[d+2],this.mode){case"multiply":c[d]=n*i/255,c[d+1]=r*s/255,c[d+2]=o*a/255;break;case"screen":c[d]=255-(255-n)*(255-i)/255,c[d+1]=255-(255-r)*(255-s)/255,c[d+2]=255-(255-o)*(255-a)/255;break;case"add":c[d]=n+i,c[d+1]=r+s,c[d+2]=o+a;break;case"diff":case"difference":c[d]=Math.abs(n-i),c[d+1]=Math.abs(r-s),c[d+2]=Math.abs(o-a);break;case"subtract":c[d]=n-i,c[d+1]=r-s,c[d+2]=o-a;break;case"darken":c[d]=Math.min(n,i),c[d+1]=Math.min(r,s),c[d+2]=Math.min(o,a);break;case"lighten":c[d]=Math.max(n,i),c[d+1]=Math.max(r,s),c[d+2]=Math.max(o,a);break;case"overlay":c[d]=i<128?2*n*i/255:255-2*(255-n)*(255-i)/255,c[d+1]=s<128?2*r*s/255:255-2*(255-r)*(255-s)/255,c[d+2]=a<128?2*o*a/255:255-2*(255-o)*(255-a)/255;break;case"exclusion":c[d]=i+n-2*i*n/255,c[d+1]=s+r-2*s*r/255,c[d+2]=a+o-2*a*o/255;break;case"tint":c[d]=i+n*u,c[d+1]=s+r*u,c[d+2]=a+o*u}},getUniformLocations:function(e,t){return{uColor:e.getUniformLocation(t,"uColor")}},sendUniformData:function(e,i){var s=new t.Color(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,e.uniform4fv(i.uColor,s)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendColor.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric,i=t.Image.filters;i.BlendImage=(0,t.util.createClass)(i.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(e){var t=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return e.programCache.hasOwnProperty(t)||(e.programCache[t]=this.createProgram(e.context,i)),e.programCache[t]},applyToWebGL:function(e){var t=e.context,i=this.createTexture(e.filterBackend,this.image);this.bindAdditionalTexture(t,i,t.TEXTURE1),this.callSuper("applyToWebGL",e),this.unbindAdditionalTexture(t,t.TEXTURE1)},createTexture:function(e,t){return e.getCachedTexture(t.cacheKey,t._element)},calculateMatrix:function(){var e=this.image;return[1/e.scaleX,0,0,0,1/e.scaleY,0,-e.left/e._element.width,-e.top/e._element.height,1]},applyTo2d:function(e){var i,s,a,n,r,o,l,c,h,u,d,p=e.imageData,f=e.filterBackend.resources,g=p.data,m=g.length,v=p.width,b=p.height,y=this.image;f.blendImage||(f.blendImage=t.util.createCanvasElement()),u=(h=f.blendImage).getContext("2d"),h.width!==v||h.height!==b?(h.width=v,h.height=b):u.clearRect(0,0,v,b),u.setTransform(y.scaleX,0,0,y.scaleY,y.left,y.top),u.drawImage(y._element,0,0,v,b),d=u.getImageData(0,0,v,b).data;for(var x=0;x<m;x+=4)switch(r=g[x],o=g[x+1],l=g[x+2],c=g[x+3],i=d[x],s=d[x+1],a=d[x+2],n=d[x+3],this.mode){case"multiply":g[x]=r*i/255,g[x+1]=o*s/255,g[x+2]=l*a/255,g[x+3]=c*n/255;break;case"mask":g[x+3]=n}},getUniformLocations:function(e,t){return{uTransformMatrix:e.getUniformLocation(t,"uTransformMatrix"),uImage:e.getUniformLocation(t,"uImage")}},sendUniformData:function(e,t){var i=this.calculateMatrix();e.uniform1i(t.uImage,1),e.uniformMatrix3fv(t.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),t.Image.filters.BlendImage.fromObject=function(e,i){t.Image.fromObject(e.image,function(s){var a=t.util.object.clone(e);a.image=s,i(new t.Image.filters.BlendImage(a))})}}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=Math.pow,s=Math.floor,a=Math.sqrt,n=Math.abs,r=Math.round,o=Math.sin,l=Math.ceil,c=t.Image.filters;c.Resize=(0,t.util.createClass)(c.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(e,t){return{uDelta:e.getUniformLocation(t,"uDelta"),uTaps:e.getUniformLocation(t,"uTaps")}},sendUniformData:function(e,t){e.uniform2fv(t.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),e.uniform1fv(t.uTaps,this.taps)},retrieveShader:function(e){var t=this.getFilterWindow(),i=this.type+"_"+t;if(!e.programCache.hasOwnProperty(i)){var s=this.generateShader(t);e.programCache[i]=this.createProgram(e.context,s)}return e.programCache[i]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var e=this.lanczosCreate(this.lanczosLobes),t=this.tempScale,i=this.getFilterWindow(),s=new Array(i),a=1;a<=i;a++)s[a-1]=e(a*t);return s},generateShader:function(e){for(var t=new Array(e),i=this.fragmentSourceTOP,s=1;s<=e;s++)t[s-1]=s+".0 * uDelta";return i+="uniform float uTaps["+e+"];\n",i+="void main() {\n",i+="  vec4 color = texture2D(uTexture, vTexCoord);\n",i+="  float sum = 1.0;\n",t.forEach(function(e,t){i+="  color += texture2D(uTexture, vTexCoord + "+e+") * uTaps["+t+"];\n",i+="  color += texture2D(uTexture, vTexCoord - "+e+") * uTaps["+t+"];\n",i+="  sum += 2.0 * uTaps["+t+"];\n"}),i+="  gl_FragColor = color / sum;\n",i+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(e){e.webgl?(e.passes++,this.width=e.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=e.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),e.destinationWidth=this.dW,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceWidth=e.destinationWidth,this.height=e.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),e.destinationHeight=this.dH,this._setupFrameBuffer(e),this.applyToWebGL(e),this._swapTextures(e),e.sourceHeight=e.destinationHeight):this.applyTo2d(e)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(e){return function(t){if(e<=t||t<=-e)return 0;if(t<1.1920929e-7&&-1.1920929e-7<t)return 1;var i=(t*=Math.PI)/e;return o(t)/t*o(i)/i}},applyTo2d:function(e){var t=e.imageData,i=this.scaleX,s=this.scaleY;this.rcpScaleX=1/i,this.rcpScaleY=1/s;var a,n=t.width,o=t.height,l=r(n*i),c=r(o*s);"sliceHack"===this.resizeType?a=this.sliceByTwo(e,n,o,l,c):"hermite"===this.resizeType?a=this.hermiteFastResize(e,n,o,l,c):"bilinear"===this.resizeType?a=this.bilinearFiltering(e,n,o,l,c):"lanczos"===this.resizeType&&(a=this.lanczosResize(e,n,o,l,c)),e.imageData=a},sliceByTwo:function(e,i,a,n,r){var o,l,c=e.imageData,h=!1,u=!1,d=.5*i,p=.5*a,f=t.filterBackend.resources,g=0,m=0,v=i,b=0;for(f.sliceByTwo||(f.sliceByTwo=document.createElement("canvas")),((o=f.sliceByTwo).width<1.5*i||o.height<a)&&(o.width=1.5*i,o.height=a),(l=o.getContext("2d")).clearRect(0,0,1.5*i,a),l.putImageData(c,0,0),n=s(n),r=s(r);!h||!u;)a=p,n<s(.5*(i=d))?d=s(.5*d):(d=n,h=!0),r<s(.5*p)?p=s(.5*p):(p=r,u=!0),l.drawImage(o,g,m,i,a,v,b,d,p),g=v,m=b,b+=p;return l.getImageData(g,m,n,r)},lanczosResize:function(e,t,r,o,c){var h=e.imageData.data,u=e.ctx.createImageData(o,c),d=u.data,p=this.lanczosCreate(this.lanczosLobes),f=this.rcpScaleX,g=this.rcpScaleY,m=2/this.rcpScaleX,v=2/this.rcpScaleY,b=l(f*this.lanczosLobes/2),y=l(g*this.lanczosLobes/2),x={},w={},S={};return function e(l){var C,A,_,k,T,I,M,O,P,D,J;for(w.x=(l+.5)*f,S.x=s(w.x),C=0;C<c;C++){for(w.y=(C+.5)*g,S.y=s(w.y),P=O=M=I=T=0,A=S.x-b;A<=S.x+b;A++)if(!(A<0||t<=A)){D=s(1e3*n(A-w.x)),x[D]||(x[D]={});for(var E=S.y-y;E<=S.y+y;E++)E<0||r<=E||(J=s(1e3*n(E-w.y)),x[D][J]||(x[D][J]=p(a(i(D*m,2)+i(J*v,2))/1e3)),0<(_=x[D][J])&&(T+=_,I+=_*h[k=4*(E*t+A)],M+=_*h[k+1],O+=_*h[k+2],P+=_*h[k+3]))}d[k=4*(C*o+l)]=I/T,d[k+1]=M/T,d[k+2]=O/T,d[k+3]=P/T}return++l<o?e(l):u}(0)},bilinearFiltering:function(e,t,i,a,n){var r,o,l,c,h,u,d,p,f=0,g=this.rcpScaleX,m=this.rcpScaleY,v=4*(t-1),b=e.imageData.data,y=e.ctx.createImageData(a,n),x=y.data;for(l=0;l<n;l++)for(c=0;c<a;c++)for(h=g*c-(r=s(g*c)),u=m*l-(o=s(m*l)),p=4*(o*t+r),d=0;d<4;d++)x[f++]=b[p+d]*(1-h)*(1-u)+b[p+4+d]*h*(1-u)+b[p+v+d]*u*(1-h)+b[p+v+4+d]*h*u;return y},hermiteFastResize:function(e,t,i,r,o){for(var c=this.rcpScaleX,h=this.rcpScaleY,u=l(c/2),d=l(h/2),p=e.imageData.data,f=e.ctx.createImageData(r,o),g=f.data,m=0;m<o;m++)for(var v=0;v<r;v++){for(var b=4*(v+m*r),y=0,x=0,w=0,S=0,C=0,A=0,_=0,k=(m+.5)*h,T=s(m*h);T<(m+1)*h;T++)for(var I=n(k-(T+.5))/d,M=(v+.5)*c,O=I*I,P=s(v*c);P<(v+1)*c;P++){var D=n(M-(P+.5))/u,J=a(O+D*D);1<J&&J<-1||0<(y=2*J*J*J-3*J*J+1)&&(_+=y*p[3+(D=4*(P+T*t))],w+=y,p[D+3]<255&&(y=y*p[D+3]/250),S+=y*p[D],C+=y*p[D+1],A+=y*p[D+2],x+=y)}g[b]=S/x,g[b+1]=C/x,g[b+2]=A/x,g[b+3]=_/w}return f},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),t.Image.filters.Resize.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Contrast=(0,t.util.createClass)(i.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(e){if(0!==this.contrast){var t,i=e.imageData.data,s=i.length,a=Math.floor(255*this.contrast),n=259*(a+255)/(255*(259-a));for(t=0;t<s;t+=4)i[t]=n*(i[t]-128)+128,i[t+1]=n*(i[t+1]-128)+128,i[t+2]=n*(i[t+2]-128)+128}},getUniformLocations:function(e,t){return{uContrast:e.getUniformLocation(t,"uContrast")}},sendUniformData:function(e,t){e.uniform1f(t.uContrast,this.contrast)}}),t.Image.filters.Contrast.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Saturation=(0,t.util.createClass)(i.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(e){if(0!==this.saturation){var t,i,s=e.imageData.data,a=s.length,n=-this.saturation;for(t=0;t<a;t+=4)i=Math.max(s[t],s[t+1],s[t+2]),s[t]+=i!==s[t]?(i-s[t])*n:0,s[t+1]+=i!==s[t+1]?(i-s[t+1])*n:0,s[t+2]+=i!==s[t+2]?(i-s[t+2])*n:0}},getUniformLocations:function(e,t){return{uSaturation:e.getUniformLocation(t,"uSaturation")}},sendUniformData:function(e,t){e.uniform1f(t.uSaturation,-this.saturation)}}),t.Image.filters.Saturation.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Blur=(0,t.util.createClass)(i.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(e){e.webgl?(this.aspectRatio=e.sourceWidth/e.sourceHeight,e.passes++,this._setupFrameBuffer(e),this.horizontal=!0,this.applyToWebGL(e),this._swapTextures(e),this._setupFrameBuffer(e),this.horizontal=!1,this.applyToWebGL(e),this._swapTextures(e)):this.applyTo2d(e)},applyTo2d:function(e){e.imageData=this.simpleBlur(e)},simpleBlur:function(e){var i,s,a=e.filterBackend.resources,n=e.imageData.width,r=e.imageData.height;a.blurLayer1||(a.blurLayer1=t.util.createCanvasElement(),a.blurLayer2=t.util.createCanvasElement()),s=a.blurLayer2,(i=a.blurLayer1).width===n&&i.height===r||(s.width=i.width=n,s.height=i.height=r);var o,l,c,h,u=i.getContext("2d"),d=s.getContext("2d"),p=.06*this.blur*.5;for(u.putImageData(e.imageData,0,0),d.clearRect(0,0,n,r),h=-15;h<=15;h++)c=p*(l=h/15)*n+(o=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,c,o),u.drawImage(s,0,0),d.globalAlpha=1,d.clearRect(0,0,s.width,s.height);for(h=-15;h<=15;h++)c=p*(l=h/15)*r+(o=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(l),d.drawImage(i,o,c),u.drawImage(s,0,0),d.globalAlpha=1,d.clearRect(0,0,s.width,s.height);e.ctx.drawImage(i,0,0);var f=e.ctx.getImageData(0,0,i.width,i.height);return u.globalAlpha=1,u.clearRect(0,0,i.width,i.height),f},getUniformLocations:function(e,t){return{delta:e.getUniformLocation(t,"uDelta")}},sendUniformData:function(e,t){var i=this.chooseRightDelta();e.uniform2fv(t.delta,i)},chooseRightDelta:function(){var e,t=1,i=[0,0];return this.horizontal?1<this.aspectRatio&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio),e=t*this.blur*.12,this.horizontal?i[0]=e:i[1]=e,i}}),i.Blur.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Gamma=(0,t.util.createClass)(i.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(e){this.gamma=[1,1,1],i.BaseFilter.prototype.initialize.call(this,e)},applyTo2d:function(e){var t,i=e.imageData.data,s=this.gamma,a=i.length,n=1/s[0],r=1/s[1],o=1/s[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),t=0,a=256;t<a;t++)this.rVals[t]=255*Math.pow(t/255,n),this.gVals[t]=255*Math.pow(t/255,r),this.bVals[t]=255*Math.pow(t/255,o);for(t=0,a=i.length;t<a;t+=4)i[t]=this.rVals[i[t]],i[t+1]=this.gVals[i[t+1]],i[t+2]=this.bVals[i[t+2]]},getUniformLocations:function(e,t){return{uGamma:e.getUniformLocation(t,"uGamma")}},sendUniformData:function(e,t){e.uniform3fv(t.uGamma,this.gamma)}}),t.Image.filters.Gamma.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.Composed=(0,t.util.createClass)(i.BaseFilter,{type:"Composed",subFilters:[],initialize:function(e){this.callSuper("initialize",e),this.subFilters=this.subFilters.slice(0)},applyTo:function(e){e.passes+=this.subFilters.length-1,this.subFilters.forEach(function(t){t.applyTo(e)})},toObject:function(){return t.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(e){return e.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(e){return!e.isNeutralState()})}}),t.Image.filters.Composed.fromObject=function(e,i){var s=(e.subFilters||[]).map(function(e){return new t.Image.filters[e.type](e)}),a=new t.Image.filters.Composed({subFilters:s});return i&&i(a),a}}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.Image.filters;i.HueRotation=(0,t.util.createClass)(i.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var e=this.rotation*Math.PI,i=t.util.cos(e),s=t.util.sin(e),a=Math.sqrt(1/3)*s,n=1-i;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=i+n/3,this.matrix[1]=1/3*n-a,this.matrix[2]=1/3*n+a,this.matrix[5]=1/3*n+a,this.matrix[6]=i+1/3*n,this.matrix[7]=1/3*n-a,this.matrix[10]=1/3*n-a,this.matrix[11]=1/3*n+a,this.matrix[12]=i+1/3*n},isNeutralState:function(e){return this.calculateMatrix(),i.BaseFilter.prototype.isNeutralState.call(this,e)},applyTo:function(e){this.calculateMatrix(),i.BaseFilter.prototype.applyTo.call(this,e)}}),t.Image.filters.HueRotation.fromObject=t.Image.filters.BaseFilter.fromObject}("undefined"!=typeof exports?exports:this),function(e){"use strict";var t=e.fabric||(e.fabric={}),i=t.util.object.clone;t.Text?t.warn("fabric.Text is already defined"):(t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:t.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:t.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(e,t){this.styles=t&&t.styles||{},this.text=e,this.__skipDimension=!0,this.callSuper("initialize",t),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return t._measuringContext||(t._measuringContext=this.canvas&&this.canvas.contextCache||t.util.createCanvasElement().getContext("2d")),t._measuringContext},_splitText:function(){var e=this._splitTextIntoLines(this.text);return this.textLines=e.lines,this._textLines=e.graphemeLines,this._unwrappedTextLines=e._unwrappedLines,this._text=e.graphemeText,e},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var e,t,i,s,a,n,r=0,o=this._textLines.length;r<o;r++)if(("justify"===this.textAlign||r!==o-1&&!this.isEndOfWrapping(r))&&(i=0,s=this._textLines[r],(t=this.getLineWidth(r))<this.width&&(n=this.textLines[r].match(this._reSpacesAndTabs)))){e=(this.width-t)/n.length;for(var l=0,c=s.length;l<=c;l++)a=this.__charBounds[r][l],this._reSpaceAndTab.test(s[l])?(a.width+=e,a.kernedWidth+=e,a.left+=i,i+=e):a.left+=i}},isEndOfWrapping:function(e){return e===this._textLines.length-1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var e=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return e.width+=t*e.zoomX,e.height+=t*e.zoomY,e},_render:function(e){this._setTextStyles(e),this._renderTextLinesBackground(e),this._renderTextDecoration(e,"underline"),this._renderText(e),this._renderTextDecoration(e,"overline"),this._renderTextDecoration(e,"linethrough")},_renderText:function(e){"stroke"===this.paintFirst?(this._renderTextStroke(e),this._renderTextFill(e)):(this._renderTextFill(e),this._renderTextStroke(e))},_setTextStyles:function(e,t,i){e.textBaseline="alphabetic",e.font=this._getFontDeclaration(t,i)},calcTextWidth:function(){for(var e=this.getLineWidth(0),t=1,i=this._textLines.length;t<i;t++){var s=this.getLineWidth(t);e<s&&(e=s)}return e},_renderTextLine:function(e,t,i,s,a,n){this._renderChars(e,t,i,s,a,n)},_renderTextLinesBackground:function(e){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var t,i,s,a,n,r,o=0,l=e.fillStyle,c=this._getLeftOffset(),h=this._getTopOffset(),u=0,d=0,p=0,f=this._textLines.length;p<f;p++)if(t=this.getHeightOfLine(p),this.textBackgroundColor||this.styleHas("textBackgroundColor",p)){s=this._textLines[p],i=this._getLineLeftOffset(p),u=d=0,a=this.getValueOfPropertyAt(p,0,"textBackgroundColor");for(var g=0,m=s.length;g<m;g++)n=this.__charBounds[p][g],(r=this.getValueOfPropertyAt(p,g,"textBackgroundColor"))!==a?((e.fillStyle=a)&&e.fillRect(c+i+u,h+o,d,t/this.lineHeight),u=n.left,d=n.width,a=r):d+=n.kernedWidth;r&&(e.fillStyle=r,e.fillRect(c+i+u,h+o,d,t/this.lineHeight)),o+=t}else o+=t;e.fillStyle=l,this._removeShadow(e)}},getFontCache:function(e){var i=e.fontFamily.toLowerCase();t.charWidthsCache[i]||(t.charWidthsCache[i]={});var s=t.charWidthsCache[i],a=e.fontStyle.toLowerCase()+"_"+(e.fontWeight+"").toLowerCase();return s[a]||(s[a]={}),s[a]},_applyCharStyles:function(e,t,i,s,a){this._setFillStyles(t,a),this._setStrokeStyles(t,a),t.font=this._getFontDeclaration(a)},_measureChar:function(e,t,i,s){var a,n,r,o,l=this.getFontCache(t),c=i+e,h=this._getFontDeclaration(t)===this._getFontDeclaration(s),u=t.fontSize/this.CACHE_FONT_SIZE;if(i&&void 0!==l[i]&&(r=l[i]),void 0!==l[e]&&(o=a=l[e]),h&&void 0!==l[c]&&(o=(n=l[c])-r),void 0===a||void 0===r||void 0===n){var d=this.getMeasuringContext();this._setTextStyles(d,t,!0)}return void 0===a&&(o=a=d.measureText(e).width,l[e]=a),void 0===r&&h&&i&&(r=d.measureText(i).width,l[i]=r),h&&void 0===n&&(n=d.measureText(c).width,o=(l[c]=n)-r),{width:a*u,kernedWidth:o*u}},getHeightOfChar:function(e,t){return this.getValueOfPropertyAt(e,t,"fontSize")},measureLine:function(e){var t=this._measureLine(e);return 0!==this.charSpacing&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(e){var t,i,s,a,n=0,r=this._textLines[e],o=new Array(r.length);for(this.__charBounds[e]=o,t=0;t<r.length;t++)a=this._getGraphemeBox(i=r[t],e,t,s),n+=(o[t]=a).kernedWidth,s=i;return o[t]={left:a?a.left+a.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:n,numOfSpaces:0}},_getGraphemeBox:function(e,t,i,s,a){var n,r=this.getCompleteStyleDeclaration(t,i),o=s?this.getCompleteStyleDeclaration(t,i-1):{},l=this._measureChar(e,r,s,o),c=l.kernedWidth,h=l.width;0!==this.charSpacing&&(h+=n=this._getWidthOfCharSpacing(),c+=n);var u={width:h,left:0,height:r.fontSize,kernedWidth:c,deltaY:r.deltaY};if(0<i&&!a){var d=this.__charBounds[t][i-1];u.left=d.left+d.width+l.kernedWidth-l.width}return u},getHeightOfLine:function(e){if(this.__lineHeights[e])return this.__lineHeights[e];for(var t=this._textLines[e],i=this.getHeightOfChar(e,0),s=1,a=t.length;s<a;s++)i=Math.max(this.getHeightOfChar(e,s),i);return this.__lineHeights[e]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var e,t=0,i=0,s=this._textLines.length;i<s;i++)e=this.getHeightOfLine(i),t+=i===s-1?e/this.lineHeight:e;return t},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(e,t){e.save();for(var i=0,s=this._getLeftOffset(),a=this._getTopOffset(),n=this._applyPatternGradientTransform(e,"fillText"===t?this.fill:this.stroke),r=0,o=this._textLines.length;r<o;r++){var l=this.getHeightOfLine(r),c=l/this.lineHeight,h=this._getLineLeftOffset(r);this._renderTextLine(t,e,this._textLines[r],s+h-n.offsetX,a+i+c-n.offsetY,r),i+=l}e.restore()},_renderTextFill:function(e){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(e,"fillText")},_renderTextStroke:function(e){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray),e.beginPath(),this._renderTextCommon(e,"strokeText"),e.closePath(),e.restore())},_renderChars:function(e,t,i,s,a,n){var r,o,l,c,h=this.getHeightOfLine(n),u=-1!==this.textAlign.indexOf("justify"),d="",p=0,f=!u&&0===this.charSpacing&&this.isEmptyStyles(n);if(t.save(),a-=h*this._fontSizeFraction/this.lineHeight,f)return this._renderChar(e,t,n,0,this.textLines[n],s,a,h),void t.restore();for(var g=0,m=i.length-1;g<=m;g++)c=g===m||this.charSpacing,d+=i[g],l=this.__charBounds[n][g],0===p?(s+=l.kernedWidth-l.width,p+=l.width):p+=l.kernedWidth,u&&!c&&this._reSpaceAndTab.test(i[g])&&(c=!0),c||(r=r||this.getCompleteStyleDeclaration(n,g),o=this.getCompleteStyleDeclaration(n,g+1),c=this._hasStyleChanged(r,o)),c&&(this._renderChar(e,t,n,g,d,s,a,h),d="",r=o,s+=p,p=0);t.restore()},_renderChar:function(e,t,i,s,a,n,r){var o=this._getStyleDeclaration(i,s),l=this.getCompleteStyleDeclaration(i,s),c="fillText"===e&&l.fill,h="strokeText"===e&&l.stroke&&l.strokeWidth;(h||c)&&(o&&t.save(),this._applyCharStyles(e,t,i,s,l),o&&o.textBackgroundColor&&this._removeShadow(t),o&&o.deltaY&&(r+=o.deltaY),c&&t.fillText(a,n,r),h&&t.strokeText(a,n,r),o&&t.restore())},setSuperscript:function(e,t){return this._setScript(e,t,this.superscript)},setSubscript:function(e,t){return this._setScript(e,t,this.subscript)},_setScript:function(e,t,i){var s=this.get2DCursorLocation(e,!0),a=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"fontSize"),n=this.getValueOfPropertyAt(s.lineIndex,s.charIndex,"deltaY");return this.setSelectionStyles({fontSize:a*i.size,deltaY:n+a*i.baseline},e,t),this},_hasStyleChanged:function(e,t){return e.fill!==t.fill||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth||e.fontSize!==t.fontSize||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(e,t){return this._hasStyleChanged(e,t)||e.overline!==t.overline||e.underline!==t.underline||e.linethrough!==t.linethrough},_getLineLeftOffset:function(e){var t=this.getLineWidth(e);return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:"justify-center"===this.textAlign&&this.isEndOfWrapping(e)?(this.width-t)/2:"justify-right"===this.textAlign&&this.isEndOfWrapping(e)?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var e=this._forceClearCache;return e||(e=this.hasStateChanged("_dimensionAffectingProps")),e&&(this.dirty=!0,this._forceClearCache=!1),e},getLineWidth:function(e){return this.__lineWidths[e]?this.__lineWidths[e]:(t=""===this._textLines[e]?0:this.measureLine(e).width,this.__lineWidths[e]=t);var t},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(e,t,i){var s=this._getStyleDeclaration(e,t);return s&&void 0!==s[i]?s[i]:this[i]},_renderTextDecoration:function(e,t){if(this[t]||this.styleHas(t)){for(var i,s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b=this._getLeftOffset(),y=this._getTopOffset(),x=this._getWidthOfCharSpacing(),w=0,S=this._textLines.length;w<S;w++)if(i=this.getHeightOfLine(w),this[t]||this.styleHas(t,w)){l=this._textLines[w],g=i/this.lineHeight,n=this._getLineLeftOffset(w),d=u=0,c=this.getValueOfPropertyAt(w,0,t),v=this.getValueOfPropertyAt(w,0,"fill"),h=y+g*(1-this._fontSizeFraction),s=this.getHeightOfChar(w,0),r=this.getValueOfPropertyAt(w,0,"deltaY");for(var C=0,A=l.length;C<A;C++)p=this.__charBounds[w][C],f=this.getValueOfPropertyAt(w,C,t),m=this.getValueOfPropertyAt(w,C,"fill"),a=this.getHeightOfChar(w,C),o=this.getValueOfPropertyAt(w,C,"deltaY"),(f!==c||m!==v||a!==s||o!==r)&&0<d?(e.fillStyle=v,c&&v&&e.fillRect(b+n+u,h+this.offsets[t]*s+r,d,this.fontSize/15),u=p.left,d=p.width,c=f,v=m,s=a,r=o):d+=p.kernedWidth;e.fillStyle=m,f&&m&&e.fillRect(b+n+u,h+this.offsets[t]*s+r,d-x,this.fontSize/15),y+=i}else y+=i;this._removeShadow(e)}},_getFontDeclaration:function(e,i){var s=e||this,a=this.fontFamily,n=-1<t.Text.genericFonts.indexOf(a.toLowerCase()),r=void 0===a||-1<a.indexOf("'")||-1<a.indexOf('"')||n?s.fontFamily:'"'+s.fontFamily+'"';return[t.isLikelyNode?s.fontWeight:s.fontStyle,t.isLikelyNode?s.fontStyle:s.fontWeight,i?this.CACHE_FONT_SIZE+"px":s.fontSize+"px",r].join(" ")},render:function(e){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",e)))},_splitTextIntoLines:function(e){for(var i=e.split(this._reNewline),s=new Array(i.length),a=["\n"],n=[],r=0;r<i.length;r++)s[r]=t.util.string.graphemeSplit(i[r]),n=n.concat(s[r],a);return n.pop(),{_unwrappedLines:s,lines:i,graphemeText:n,graphemeLines:s}},toObject:function(e){var t=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(e),s=this.callSuper("toObject",t);return s.styles=i(this.styles,!0),s},set:function(e,t){this.callSuper("set",e,t);var i=!1;if("object"==typeof e)for(var s in e)i=i||-1!==this._dimensionAffectingProps.indexOf(s);else i=-1!==this._dimensionAffectingProps.indexOf(e);return i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(e,s,a){if(!e)return s(null);var n=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES),r=n.textAnchor||"left";if((a=t.util.object.extend(a?i(a):{},n)).top=a.top||0,a.left=a.left||0,n.textDecoration){var o=n.textDecoration;-1!==o.indexOf("underline")&&(a.underline=!0),-1!==o.indexOf("overline")&&(a.overline=!0),-1!==o.indexOf("line-through")&&(a.linethrough=!0),delete a.textDecoration}"dx"in n&&(a.left+=n.dx),"dy"in n&&(a.top+=n.dy),"fontSize"in a||(a.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);var l="";"textContent"in e?l=e.textContent:"firstChild"in e&&null!==e.firstChild&&"data"in e.firstChild&&null!==e.firstChild.data&&(l=e.firstChild.data),l=l.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var c=a.strokeWidth;a.strokeWidth=0;var h=new t.Text(l,a),u=h.getScaledHeight()/h.height,d=((h.height+h.strokeWidth)*h.lineHeight-h.height)*u,p=h.getScaledHeight()+d,f=0;"center"===r&&(f=h.getScaledWidth()/2),"right"===r&&(f=h.getScaledWidth()),h.set({left:h.left-f,top:h.top-(p-h.fontSize*(.07+h._fontSizeFraction))/h.lineHeight,strokeWidth:void 0!==c?c:1}),s(h)},t.Text.fromObject=function(e,i){return t.Object._fromObject("Text",e,i,"text")},t.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],t.util.createAccessors&&t.util.createAccessors(t.Text))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Text.prototype,{isEmptyStyles:function(e){if(!this.styles)return!0;if(void 0!==e&&!this.styles[e])return!0;var t=void 0===e?this.styles:{line:this.styles[e]};for(var i in t)for(var s in t[i])for(var a in t[i][s])return!1;return!0},styleHas:function(e,t){if(!this.styles||!e||""===e)return!1;if(void 0!==t&&!this.styles[t])return!1;var i=void 0===t?this.styles:{line:this.styles[t]};for(var s in i)for(var a in i[s])if(void 0!==i[s][a][e])return!0;return!1},cleanStyle:function(e){if(!this.styles||!e||""===e)return!1;var t,i,s=this.styles,a=0,n=!0,r=0;for(var o in s){for(var l in t=0,s[o]){var c;a++,(c=s[o][l]).hasOwnProperty(e)?(i?c[e]!==i&&(n=!1):i=c[e],c[e]===this[e]&&delete c[e]):n=!1,0!==Object.keys(c).length?t++:delete s[o][l]}0===t&&delete s[o]}for(var h=0;h<this._textLines.length;h++)r+=this._textLines[h].length;n&&a===r&&(this[e]=i,this.removeStyle(e))},removeStyle:function(e){if(this.styles&&e&&""!==e){var t,i,s,a=this.styles;for(i in a){for(s in t=a[i])delete t[s][e],0===Object.keys(t[s]).length&&delete t[s];0===Object.keys(t).length&&delete a[i]}}},_extendStyles:function(e,t){var i=this.get2DCursorLocation(e);this._getLineStyle(i.lineIndex)||this._setLineStyle(i.lineIndex,{}),this._getStyleDeclaration(i.lineIndex,i.charIndex)||this._setStyleDeclaration(i.lineIndex,i.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(i.lineIndex,i.charIndex),t)},get2DCursorLocation:function(e,t){void 0===e&&(e=this.selectionStart);for(var i=t?this._unwrappedTextLines:this._textLines,s=i.length,a=0;a<s;a++){if(e<=i[a].length)return{lineIndex:a,charIndex:e};e-=i[a].length+1}return{lineIndex:a-1,charIndex:i[a-1].length<e?i[a-1].length:e}},getSelectionStyles:function(e,t,i){void 0===e&&(e=this.selectionStart||0),void 0===t&&(t=this.selectionEnd||e);for(var s=[],a=e;a<t;a++)s.push(this.getStyleAtPosition(a,i));return s},getStyleAtPosition:function(e,t){var i=this.get2DCursorLocation(e);return(t?this.getCompleteStyleDeclaration(i.lineIndex,i.charIndex):this._getStyleDeclaration(i.lineIndex,i.charIndex))||{}},setSelectionStyles:function(e,t,i){void 0===t&&(t=this.selectionStart||0),void 0===i&&(i=this.selectionEnd||t);for(var s=t;s<i;s++)this._extendStyles(s,e);return this._forceClearCache=!0,this},_getStyleDeclaration:function(e,t){var i=this.styles&&this.styles[e];return i?i[t]:null},getCompleteStyleDeclaration:function(e,t){for(var i,s=this._getStyleDeclaration(e,t)||{},a={},n=0;n<this._styleProperties.length;n++)a[i=this._styleProperties[n]]=void 0===s[i]?this[i]:s[i];return a},_setStyleDeclaration:function(e,t,i){this.styles[e][t]=i},_deleteStyleDeclaration:function(e,t){delete this.styles[e][t]},_getLineStyle:function(e){return this.styles[e]},_setLineStyle:function(e,t){this.styles[e]=t},_deleteLineStyle:function(e){delete this.styles[e]}}),function(){function e(e){e.textDecoration&&(-1<e.textDecoration.indexOf("underline")&&(e.underline=!0),-1<e.textDecoration.indexOf("line-through")&&(e.linethrough=!0),-1<e.textDecoration.indexOf("overline")&&(e.overline=!0),delete e.textDecoration)}fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,t){this.callSuper("initialize",e,t),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,t){this[e]!==t&&(this._fireSelectionChanged(),this[e]=t),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),e||t.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas){var e,t=this._getCursorBoundaries();this.canvas&&this.canvas.contextTop?(e=this.canvas.contextTop,this.clearContextTop(!0)):(e=this.canvas.contextContainer).save(),this.selectionStart===this.selectionEnd?this.renderCursor(t,e):this.renderSelection(t,e),e.restore()}},_clearTextArea:function(e){var t=this.width+4,i=this.height+4;e.clearRect(-t/2,-i/2,t,i)},_getCursorBoundaries:function(e){void 0===e&&(e=this.selectionStart);var t=this._getLeftOffset(),i=this._getTopOffset(),s=this._getCursorBoundariesOffsets(e);return{left:t,top:i,leftOffset:s.left,topOffset:s.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var t,i,s,a=0,n=0,r=this.get2DCursorLocation(e);s=r.charIndex,i=r.lineIndex;for(var o=0;o<i;o++)a+=this.getHeightOfLine(o);t=this._getLineLeftOffset(i);var l=this.__charBounds[i][s];return l&&(n=l.left),0!==this.charSpacing&&s===this._textLines[i].length&&(n-=this._getWidthOfCharSpacing()),this.cursorOffsetCache={top:a,left:t+(0<n?n:0)},this.cursorOffsetCache},renderCursor:function(e,t){var i=this.get2DCursorLocation(),s=i.lineIndex,a=0<i.charIndex?i.charIndex-1:0,n=this.getValueOfPropertyAt(s,a,"fontSize"),r=this.scaleX*this.canvas.getZoom(),o=this.cursorWidth/r,l=e.topOffset,c=this.getValueOfPropertyAt(s,a,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(s)/this.lineHeight-n*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,t),t.fillStyle=this.getValueOfPropertyAt(s,a,"fill"),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-o/2,l+e.top+c,o,n)},renderSelection:function(e,t){for(var i=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,s=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=-1!==this.textAlign.indexOf("justify"),n=this.get2DCursorLocation(i),r=this.get2DCursorLocation(s),o=n.lineIndex,l=r.lineIndex,c=n.charIndex<0?0:n.charIndex,h=r.charIndex<0?0:r.charIndex,u=o;u<=l;u++){var d,p=this._getLineLeftOffset(u)||0,f=this.getHeightOfLine(u),g=0,m=0;if(u===o&&(g=this.__charBounds[o][c].left),o<=u&&u<l)m=a&&!this.isEndOfWrapping(u)?this.width:this.getLineWidth(u)||5;else if(u===l)if(0===h)m=this.__charBounds[l][h].left;else{var v=this._getWidthOfCharSpacing();m=this.__charBounds[l][h-1].left+this.__charBounds[l][h-1].width-v}d=f,(this.lineHeight<1||u===l&&1<this.lineHeight)&&(f/=this.lineHeight),this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",t.fillRect(e.left+p+g,e.top+e.topOffset+f,m-g,1)):(t.fillStyle=this.selectionColor,t.fillRect(e.left+p+g,e.top+e.topOffset,m-g,f)),e.topOffset+=d}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0);return{l:e.lineIndex,c:0<e.charIndex?e.charIndex-1:0}}}),fabric.IText.fromObject=function(t,i){if(e(t),t.styles)for(var s in t.styles)for(var a in t.styles[s])e(t.styles[s][a]);fabric.Object._fromObject("IText",t,i,"text")}}(),function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var t=e.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,e._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var t=e.canvas;t&&(t._iTextInstances=t._iTextInstances||[],fabric.util.removeFromArray(t._iTextInstances,e),0===t._iTextInstances.length&&(t._hasITextHandlers=!1,e._removeCanvasHandlers(t)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(e){e.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,t,i,s){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",t,{duration:i,onComplete:function(){a.isAborted||e[s]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var t=this,i=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){t._tick()},i)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,t=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&t&&t.clearContext(t.contextTop||t.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var t=0,i=e-1;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i--;for(;/\S/.test(this._text[i])&&-1<i;)t++,i--;return e-t},findWordBoundaryRight:function(e){var t=0,i=e;if(this._reSpace.test(this._text[i]))for(;this._reSpace.test(this._text[i]);)t++,i++;for(;/\S/.test(this._text[i])&&i<this.text.length;)t++,i++;return e+t},findLineBoundaryLeft:function(e){for(var t=0,i=e-1;!/\n/.test(this._text[i])&&-1<i;)t++,i--;return e-t},findLineBoundaryRight:function(e){for(var t=0,i=e;!/\n/.test(this._text[i])&&i<this.text.length;)t++,i++;return e+t},searchWordBoundary:function(e,t){for(var i=this._reSpace.test(this.text.charAt(e))?e-1:e,s=this.text.charAt(i),a=/[ \n\.,;!\?\-]/;!a.test(s)&&0<i&&i<this.text.length;)s=this.text.charAt(i+=t);return a.test(s)&&"\n"!==s&&(i+=1===t?0:1),i},selectWord:function(e){var t=this.searchWordBoundary(e=e||this.selectionStart,-1),i=this.searchWordBoundary(e,1);this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){var t=this.findLineBoundaryLeft(e=e||this.selectionStart),i=this.findLineBoundaryRight(e);return this.selectionStart=t,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll()),this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(e){e.selected=!1,e.isEditing&&e.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(this.__isMousedown&&this.isEditing){var t=this.getSelectionStartFromPointer(e.e),i=this.selectionStart,s=this.selectionEnd;(t===this.__selectionStartOnMouseDown&&i!==s||i!==t&&s!==t)&&(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===s||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,t,i){var s=i.slice(0,e),a=fabric.util.string.graphemeSplit(s).length;if(e===t)return{selectionStart:a,selectionEnd:a};var n=i.slice(e,t);return{selectionStart:a,selectionEnd:a+fabric.util.string.graphemeSplit(n).length}},fromGraphemeToStringSelection:function(e,t,i){var s=i.slice(0,e).join("").length;return e===t?{selectionStart:s,selectionEnd:s}:{selectionStart:s,selectionEnd:s+i.slice(e,t).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,t=this._getCursorBoundaries(e),i=this.get2DCursorLocation(e),s=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize")*this.lineHeight,a=t.leftOffset,n=this.calcTransformMatrix(),r={x:t.left+a,y:t.top+t.topOffset+s},o=this.canvas.upperCanvasEl,l=o.width,c=o.height,h=l-s,u=c-s,d=o.clientWidth/l,p=o.clientHeight/c;return r=fabric.util.transformPoint(r,n),(r=fabric.util.transformPoint(r,this.canvas.viewportTransform)).x*=d,r.y*=p,r.x<0&&(r.x=0),r.x>h&&(r.x=h),r.y<0&&(r.y=0),r.y>u&&(r.y=u),r.x+=this.canvas._offset.left,r.y+=this.canvas._offset.top,{left:r.x+"px",top:r.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&(this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null),this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,t){var i,s,a=this.get2DCursorLocation(e,!0),n=this.get2DCursorLocation(t,!0),r=a.lineIndex,o=a.charIndex,l=n.lineIndex,c=n.charIndex;if(r!==l){if(this.styles[r])for(i=o;i<this._unwrappedTextLines[r].length;i++)delete this.styles[r][i];if(this.styles[l])for(i=c;i<this._unwrappedTextLines[l].length;i++)(s=this.styles[l][i])&&(this.styles[r]||(this.styles[r]={}),this.styles[r][o+i-c]=s);for(i=r+1;i<=l;i++)delete this.styles[i];this.shiftLineStyles(l,r-l)}else if(this.styles[r]){s=this.styles[r];var h,u,d=c-o;for(i=o;i<c;i++)delete s[i];for(u in this.styles[r])c<=(h=parseInt(u,10))&&(s[h-d]=s[u],delete s[u])}},shiftLineStyles:function(t,i){var s=e(this.styles);for(var a in this.styles){var n=parseInt(a,10);t<n&&(this.styles[n+i]=s[n],s[n-i]||delete this.styles[n])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(t,i,s,a){var n,r={},o=!1;for(var l in s||(s=1),this.shiftLineStyles(t,s),this.styles[t]&&(n=this.styles[t][0===i?i:i-1]),this.styles[t]){var c=parseInt(l,10);i<=c&&(o=!0,r[c-i]=this.styles[t][l],delete this.styles[t][l])}for(o?this.styles[t+s]=r:delete this.styles[t+s];1<s;)s--,a&&a[s]?this.styles[t+s]={0:e(a[s])}:n?this.styles[t+s]={0:e(n)}:delete this.styles[t+s];this._forceClearCache=!0},insertCharStyleObject:function(t,i,s,a){this.styles||(this.styles={});var n=this.styles[t],r=n?e(n):{};for(var o in s||(s=1),r){var l=parseInt(o,10);i<=l&&(n[l+s]=r[l],r[l-s]||delete n[l])}if(this._forceClearCache=!0,a)for(;s--;)Object.keys(a[s]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][i+s]=e(a[s]));else if(n)for(var c=n[i?i-1:1];c&&s--;)this.styles[t][i+s]=e(c)},insertNewStyleBlock:function(e,t,i){for(var s=this.get2DCursorLocation(t,!0),a=[0],n=0,r=0;r<e.length;r++)"\n"===e[r]?a[++n]=0:a[n]++;for(0<a[0]&&(this.insertCharStyleObject(s.lineIndex,s.charIndex,a[0],i),i=i&&i.slice(a[0]+1)),n&&this.insertNewlineStyleObject(s.lineIndex,s.charIndex+a[0],n),r=1;r<n;r++)0<a[r]?this.insertCharStyleObject(s.lineIndex+r,0,a[r],i):i&&(this.styles[s.lineIndex+r][0]=i[0]),i=i&&i.slice(a[r]+1);0<a[r]&&this.insertCharStyleObject(s.lineIndex+r,0,a[r],i)},setSelectionStartEndWithShift:function(e,t,i){i<=e?(t===e?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=i):e<i&&i<t?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(t===e?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=t),this.selectionEnd=i)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(e){if(this.canvas){this.__newClickTime=+new Date;var t=e.pointer;this.isTripleClick(t)&&(this.fire("tripleclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("mousedblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))}),this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},_mouseDownHandler:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(e.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(e){!this.canvas||!this.editable||e.e.button&&1!==e.e.button||this===this.canvas._activeObject&&(this.selected=!0)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(e){if(this.__isMousedown=!1,!(!this.editable||this.group||e.transform&&e.transform.actionPerformed||e.e.button&&1!==e.e.button)){if(this.canvas){var t=this.canvas._activeObject;if(t&&t!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e);e.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,t):(this.selectionStart=t,this.selectionEnd=t),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(e){for(var t=this.getLocalPointer(e),i=0,s=0,a=0,n=0,r=0,o=0,l=this._textLines.length;o<l&&a<=t.y;o++)a+=this.getHeightOfLine(o)*this.scaleY,0<(r=o)&&(n+=this._textLines[o-1].length+1);s=this._getLineLeftOffset(r)*this.scaleX;for(var c=0,h=this._textLines[r].length;c<h&&(i=s,(s+=this.__charBounds[r][c].kernedWidth*this.scaleX)<=t.x);c++)n++;return this._getNewSelectionStartFromOffset(t,i,s,n,h)},_getNewSelectionStartFromOffset:function(e,t,i,s,a){var n=i-e.x,r=s+(e.x-t<n||n<0?0:1);return this.flipX&&(r=a-r),r>this._text.length&&(r=this._text.length),r}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var e=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+e.top+"; left: "+e.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+e.fontSize+";",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(this.isEditing&&!this.inCompositionMode){if(e.keyCode in this.keysMap)this[this.keysMap[e.keyCode]](e);else{if(!(e.keyCode in this.ctrlKeysMapDown&&(e.ctrlKey||e.metaKey)))return;this[this.ctrlKeysMapDown[e.keyCode]](e)}e.stopImmediatePropagation(),e.preventDefault(),33<=e.keyCode&&e.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(e){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:e.keyCode in this.ctrlKeysMapUp&&(e.ctrlKey||e.metaKey)&&(this[this.ctrlKeysMapUp[e.keyCode]](e),e.stopImmediatePropagation(),e.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(e){var t=this.fromPaste;if(this.fromPaste=!1,e&&e.stopPropagation(),this.isEditing){var i,s,a=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,n=this._text.length,r=a.length,o=r-n;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var l=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),c=this.selectionStart>l.selectionStart;this.selectionStart!==this.selectionEnd?(i=this._text.slice(this.selectionStart,this.selectionEnd),o+=this.selectionEnd-this.selectionStart):r<n&&(i=c?this._text.slice(this.selectionEnd+o,this.selectionEnd):this._text.slice(this.selectionStart,this.selectionStart-o)),s=a.slice(l.selectionEnd-o,l.selectionEnd),i&&i.length&&(this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):c?this.removeStyleFromTo(this.selectionEnd-i.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+i.length)),s.length&&(t&&s.join("")===fabric.copiedText?this.insertNewStyleBlock(s,this.selectionStart,fabric.copiedTextStyle):this.insertNewStyleBlock(s,this.selectionStart)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(e){this.compositionStart=e.target.selectionStart,this.compositionEnd=e.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(fabric.copiedText=this.getSelectedText(),fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(e){return e&&e.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(e,t){var i,s=this._getLineLeftOffset(e);return 0<t&&(s+=(i=this.__charBounds[e][t-1]).left+i.width),s},getDownCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),s=this.get2DCursorLocation(i),a=s.lineIndex;if(a===this._textLines.length-1||e.metaKey||34===e.keyCode)return this._text.length-i;var n=s.charIndex,r=this._getWidthBeforeCursor(a,n),o=this._getIndexOnLine(a+1,r);return this._textLines[a].slice(n).length+o+2},_getSelectionForOffset:function(e,t){return e.shiftKey&&this.selectionStart!==this.selectionEnd&&t?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(e,t){var i=this._getSelectionForOffset(e,t),s=this.get2DCursorLocation(i),a=s.lineIndex;if(0===a||e.metaKey||33===e.keyCode)return-i;var n=s.charIndex,r=this._getWidthBeforeCursor(a,n),o=this._getIndexOnLine(a-1,r),l=this._textLines[a].slice(0,n);return-this._textLines[a-1].length+o-l.length},_getIndexOnLine:function(e,t){for(var i,s,a=this._textLines[e],n=this._getLineLeftOffset(e),r=0,o=0,l=a.length;o<l;o++)if(t<(n+=i=this.__charBounds[e][o].width)){s=!0;var c=n,h=Math.abs(n-i-t);r=Math.abs(c-t)<h?o:o-1;break}return s||(r=a.length-1),r},moveCursorDown:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",e)},moveCursorUp:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",e)},_moveCursorUpOrDown:function(e,t){var i=this["get"+e+"CursorOffset"](t,"right"===this._selectionDirection);t.shiftKey?this.moveCursorWithShift(i):this.moveCursorWithoutShift(i),0!==i&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(e){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+e:this.selectionEnd+e),0!==e},moveCursorWithoutShift:function(e){return e<0?(this.selectionStart+=e,this.selectionEnd=this.selectionStart):(this.selectionEnd+=e,this.selectionStart=this.selectionEnd),0!==e},moveCursorLeft:function(e){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",e)},_move:function(e,t,i){var s;if(e.altKey)s=this["findWordBoundary"+i](this[t]);else{if(!e.metaKey&&35!==e.keyCode&&36!==e.keyCode)return this[t]+="Left"===i?-1:1,!0;s=this["findLineBoundary"+i](this[t])}if(void 0!==typeof s&&this[t]!==s)return this[t]=s,!0},_moveLeft:function(e,t){return this._move(e,t,"Left")},_moveRight:function(e,t){return this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){var t=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(t=this._moveLeft(e,"selectionStart")),this.selectionEnd=this.selectionStart,t},moveCursorLeftWithShift:function(e){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(e,"selectionStart")):void 0},moveCursorRight:function(e){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",e)},_moveCursorLeftOrRight:function(e,t){var i="moveCursor"+e+"With";this._currentCursorOpacity=1,this[i+=t.shiftKey?"Shift":"outShift"](t)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(e){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(e,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(e){var t=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(t=this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,t},removeChars:function(e,t){void 0===t&&(t=e+1),this.removeStyleFromTo(e,t),this._text.splice(e,t-e),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(e,t,i,s){void 0===s&&(s=i),i<s&&this.removeStyleFromTo(i,s);var a=fabric.util.string.graphemeSplit(e);this.insertNewStyleBlock(a,i,t),this._text=[].concat(this._text.slice(0,i),a,this._text.slice(s)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var e=fabric.util.toFixed,t=/  +/g;fabric.util.object.extend(fabric.Text.prototype,{toSVG:function(e){var t=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(t.textTop,t.textLeft),s=this._wrapSVGTextAndBg(i);return this._createBaseSVGMarkup(s,{reviver:e,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(e){var t=this.getSvgTextDecoration(this);return[e.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(e,t){var i,s=[],a=[],n=e;this._setSVGBg(a);for(var r=0,o=this._textLines.length;r<o;r++)i=this._getLineLeftOffset(r),(this.textBackgroundColor||this.styleHas("textBackgroundColor",r))&&this._setSVGTextLineBg(a,r,t+i,n),this._setSVGTextLineText(s,r,t+i,n),n+=this.getHeightOfLine(r);return{textSpans:s,textBgRects:a}},_createTextCharSpan:function(i,s,a,n){var r=i!==i.trim()||i.match(t),o=this.getSvgSpanStyles(s,r),l=o?'style="'+o+'"':"",c=s.deltaY,h="",u=fabric.Object.NUM_FRACTION_DIGITS;return c&&(h=' dy="'+e(c,u)+'" '),['<tspan x="',e(a,u),'" y="',e(n,u),'" ',h,l,">",fabric.util.string.escapeXml(i),"</tspan>"].join("")},_setSVGTextLineText:function(e,t,i,s){var a,n,r,o,l,c=this.getHeightOfLine(t),h=-1!==this.textAlign.indexOf("justify"),u="",d=0,p=this._textLines[t];s+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var f=0,g=p.length-1;f<=g;f++)l=f===g||this.charSpacing,u+=p[f],r=this.__charBounds[t][f],0===d?(i+=r.kernedWidth-r.width,d+=r.width):d+=r.kernedWidth,h&&!l&&this._reSpaceAndTab.test(p[f])&&(l=!0),l||(a=a||this.getCompleteStyleDeclaration(t,f),n=this.getCompleteStyleDeclaration(t,f+1),l=this._hasStyleChangedForSvg(a,n)),l&&(o=this._getStyleDeclaration(t,f)||{},e.push(this._createTextCharSpan(u,o,i,s)),u="",a=n,i+=d,d=0)},_pushTextBgRect:function(t,i,s,a,n,r){var o=fabric.Object.NUM_FRACTION_DIGITS;t.push("\t\t<rect ",this._getFillAttributes(i),' x="',e(s,o),'" y="',e(a,o),'" width="',e(n,o),'" height="',e(r,o),'"></rect>\n')},_setSVGTextLineBg:function(e,t,i,s){for(var a,n,r=this._textLines[t],o=this.getHeightOfLine(t)/this.lineHeight,l=0,c=0,h=this.getValueOfPropertyAt(t,0,"textBackgroundColor"),u=0,d=r.length;u<d;u++)a=this.__charBounds[t][u],(n=this.getValueOfPropertyAt(t,u,"textBackgroundColor"))!==h?(h&&this._pushTextBgRect(e,h,i+c,s,l,o),c=a.left,l=a.width,h=n):l+=a.kernedWidth;n&&this._pushTextBgRect(e,n,i+c,s,l,o)},_getFillAttributes:function(e){var t=e&&"string"==typeof e?new fabric.Color(e):"";return t&&t.getSource()&&1!==t.getAlpha()?'opacity="'+t.getAlpha()+'" fill="'+t.setAlpha(1).toRgb()+'"':'fill="'+e+'"'},_getSVGLineTopOffset:function(e){for(var t,i=0,s=0;s<e;s++)i+=this.getHeightOfLine(s);return t=this.getHeightOfLine(s),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*t/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(e){return fabric.Object.prototype.getSvgStyles.call(this,e)+" white-space: pre;"}})}(),function(e){"use strict";var t=e.fabric||(e.fabric={});t.Textbox=t.util.createClass(t.IText,t.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:t.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(e){for(var t=0,i=0,s=0,a={},n=0;n<e.graphemeLines.length;n++)"\n"===e.graphemeText[s]&&0<n?(i=0,s++,t++):!this.graphemeSplit&&this._reSpaceAndTab.test(e.graphemeText[s])&&0<n&&(i++,s++),a[n]={line:t,offset:i},s+=e.graphemeLines[n].length,i+=e.graphemeLines[n].length;return a},styleHas:function(e,i){if(this._styleMap&&!this.isWrapping){var s=this._styleMap[i];s&&(i=s.line)}return t.Text.prototype.styleHas.call(this,e,i)},isEmptyStyles:function(e){var t,i,s=0,a=!1,n=this._styleMap[e],r=this._styleMap[e+1];for(var o in n&&(e=n.line,s=n.offset),r&&(a=r.line===e,t=r.offset),i=void 0===e?this.styles:{line:this.styles[e]})for(var l in i[o])if(s<=l&&(!a||l<t))for(var c in i[o][l])return!1;return!0},_getStyleDeclaration:function(e,t){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[e];if(!i)return null;e=i.line,t=i.offset+t}return this.callSuper("_getStyleDeclaration",e,t)},_setStyleDeclaration:function(e,t,i){var s=this._styleMap[e];this.styles[e=s.line][t=s.offset+t]=i},_deleteStyleDeclaration:function(e,t){var i=this._styleMap[e];delete this.styles[e=i.line][t=i.offset+t]},_getLineStyle:function(e){return this.styles[this._styleMap[e].line]},_setLineStyle:function(e,t){this.styles[this._styleMap[e].line]=t},_deleteLineStyle:function(e){delete this.styles[this._styleMap[e].line]},_wrapText:function(e,t){var i,s=[];for(this.isWrapping=!0,i=0;i<e.length;i++)s=s.concat(this._wrapLine(e[i],i,t));return this.isWrapping=!1,s},_measureWord:function(e,t,i){var s,a=0;i=i||0;for(var n=0,r=e.length;n<r;n++)a+=this._getGraphemeBox(e[n],t,n+i,s,!0).kernedWidth,s=e[n];return a},_wrapLine:function(e,i,s,a){var n=0,r=this.splitByGrapheme,o=[],l=[],c=r?t.util.string.graphemeSplit(e):e.split(this._wordJoiners),h="",u=0,d=r?"":" ",p=0,f=0,g=0,m=!0,v=r?0:this._getWidthOfCharSpacing();s-=a=a||0;for(var b=0;b<c.length;b++)h=t.util.string.graphemeSplit(c[b]),p=this._measureWord(h,i,u),u+=h.length,s<=(n+=f+p-v)&&!m?(o.push(l),l=[],n=p,m=!0):n+=v,m||r||l.push(d),l=l.concat(h),f=this._measureWord([d],i,u),u++,m=!1,g<p&&(g=p);return b&&o.push(l),g+a>this.dynamicMinWidth&&(this.dynamicMinWidth=g-v+a),o},isEndOfWrapping:function(e){return!this._styleMap[e+1]||this._styleMap[e+1].line!==this._styleMap[e].line},_splitTextIntoLines:function(e){for(var i=t.Text.prototype._splitTextIntoLines.call(this,e),s=this._wrapText(i.lines,this.width),a=new Array(s.length),n=0;n<s.length;n++)a[n]=s[n].join("");return i.lines=a,i.graphemeLines=s,i},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(e){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(e))}}),t.Textbox.fromObject=function(e,i){return t.Object._fromObject("Textbox",e,i,"text")}}("undefined"!=typeof exports?exports:this),function(){var e=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(t,i,s,a,n,r,o){var l,c=i.target,h=t.x*c.scaleX/o.x,u=t.y*c.scaleY/o.y;if(!("x"===n&&c instanceof fabric.Textbox))return e.call(fabric.Canvas.prototype,t,i,s,a,n,r,o);var d=c._getTransformedDimensions().x,p=c.width*(t.x/d);return i.newScaleX=h,i.newScaleY=u,p>=c.getMinWidth()?(l=p!==c.width,c.set("width",p),l):void 0},fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var e in this._styleMap)this._textLines[e]||delete this.styles[this._styleMap[e].line]}})}(),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.pako=e()}}(function(){return function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};t[r][0].call(c.exports,function(e){return a(t[r][1][e]||e)},c,c.exports,e,t,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t,i){"use strict";function s(e,t){var i=new u(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}var a=e("./zlib/inflate.js"),n=e("./utils/common"),r=e("./utils/strings"),o=e("./zlib/constants"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=e("./zlib/gzheader"),u=function(e){this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=a.inflateInit2(this.strm,t.windowBits);if(i!==o.Z_OK)throw new Error(l[i]);this.header=new h,a.inflateGetHeader(this.strm,this.header)};u.prototype.push=function(e,t){var i,s,l,c,h,u=this.strm,d=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?o.Z_FINISH:o.Z_NO_FLUSH,u.input="string"==typeof e?r.binstring2buf(e):e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new n.Buf8(d),u.next_out=0,u.avail_out=d),(i=a.inflate(u,o.Z_NO_FLUSH))!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),this.ended=!0,!1;u.next_out&&(0===u.avail_out||i===o.Z_STREAM_END||0===u.avail_in&&s===o.Z_FINISH)&&("string"===this.options.to?(l=r.utf8border(u.output,u.next_out),c=u.next_out-l,h=r.buf2string(u.output,l),u.next_out=c,u.avail_out=d-c,c&&n.arraySet(u.output,u.output,l,c,0),this.onData(h)):this.onData(n.shrinkBuf(u.output,u.next_out)))}while((u.avail_in>0||0===u.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(s=o.Z_FINISH),s!==o.Z_FINISH||(i=a.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===o.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=u,i.inflate=s,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,s(e,t)},i.ungzip=s},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,"./zlib/messages":11,"./zlib/zstream":12}],2:[function(e,t,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)i.hasOwnProperty(s)&&(e[s]=i[s])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var a={arraySet:function(e,t,i,s,a){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),a);else for(var n=0;s>n;n++)e[a+n]=t[i+n]},flattenChunks:function(e){var t,i,s,a,n,r;for(s=0,t=0,i=e.length;i>t;t++)s+=e[t].length;for(r=new Uint8Array(s),a=0,t=0,i=e.length;i>t;t++)r.set(n=e[t],a),a+=n.length;return r}},n={arraySet:function(e,t,i,s,a){for(var n=0;s>n;n++)e[a+n]=t[i+n]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,n))},i.setTyped(s)},{}],3:[function(e,t,i){"use strict";function s(e,t){if(65537>t&&(e.subarray&&r||!e.subarray&&n))return String.fromCharCode.apply(null,a.shrinkBuf(e,t));for(var i="",s=0;t>s;s++)i+=String.fromCharCode(e[s]);return i}var a=e("./common"),n=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(c){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(c){r=!1}for(var o=new a.Buf8(256),l=0;256>l;l++)o[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;o[254]=o[254]=1,i.string2buf=function(e){var t,i,s,n,r,o=e.length,l=0;for(n=0;o>n;n++)55296==(64512&(i=e.charCodeAt(n)))&&o>n+1&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),l+=128>i?1:2048>i?2:65536>i?3:4;for(t=new a.Buf8(l),r=0,n=0;l>r;n++)55296==(64512&(i=e.charCodeAt(n)))&&o>n+1&&56320==(64512&(s=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),128>i?t[r++]=i:2048>i?(t[r++]=192|i>>>6,t[r++]=128|63&i):65536>i?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},i.buf2binstring=function(e){return s(e,e.length)},i.binstring2buf=function(e){for(var t=new a.Buf8(e.length),i=0,s=t.length;s>i;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,a,n,r,l=t||e.length,c=new Array(2*l);for(a=0,i=0;l>i;)if(128>(n=e[i++]))c[a++]=n;else if((r=o[n])>4)c[a++]=65533,i+=r-1;else{for(n&=2===r?31:3===r?15:7;r>1&&l>i;)n=n<<6|63&e[i++],r--;r>1?c[a++]=65533:65536>n?c[a++]=n:(c[a++]=55296|(n-=65536)>>10&1023,c[a++]=56320|1023&n)}return s(c,a)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return 0>i?t:0===i?t:i+o[e[i]]>t?i:t}},{"./common":2}],4:[function(e,t){"use strict";t.exports=function(e,t,i,s){for(var a=65535&e|0,n=e>>>16&65535|0,r=0;0!==i;){i-=r=i>2e3?2e3:i;do{n=n+(a=a+t[s++]|0)|0}while(--r);a%=65521,n%=65521}return a|n<<16|0}},{}],5:[function(e,t){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(e,t){"use strict";var i=function(){for(var e,t=[],i=0;256>i;i++){e=i;for(var s=0;8>s;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,s,a){var n=i,r=a+s;e^=-1;for(var o=a;r>o;o++)e=e>>>8^n[255&(e^t[o])];return-1^e}},{}],7:[function(e,t){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],8:[function(e,t){"use strict";t.exports=function(e,t){var i,s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y,x,w,S,C,A,_,k;_=e.input,a=(s=e.next_in)+(e.avail_in-5),k=e.output,r=(n=e.next_out)-(t-e.avail_out),o=n+(e.avail_out-257),l=(i=e.state).dmax,c=i.wsize,h=i.whave,u=i.wnext,d=i.window,p=i.hold,f=i.bits,g=i.lencode,m=i.distcode,v=(1<<i.lenbits)-1,b=(1<<i.distbits)-1;e:do{15>f&&(p+=_[s++]<<f,p+=_[s++]<<(f+=8),f+=8),y=g[p&v];t:for(;;){if(p>>>=x=y>>>24,f-=x,0==(x=y>>>16&255))k[n++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=g[(65535&y)+(p&(1<<x)-1)];continue t}if(32&x){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}w=65535&y,(x&=15)&&(x>f&&(p+=_[s++]<<f,f+=8),w+=p&(1<<x)-1,p>>>=x,f-=x),15>f&&(p+=_[s++]<<f,p+=_[s++]<<(f+=8),f+=8),y=m[p&b];i:for(;;){if(p>>>=x=y>>>24,f-=x,!(16&(x=y>>>16&255))){if(0==(64&x)){y=m[(65535&y)+(p&(1<<x)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(S=65535&y,(x&=15)>f&&(p+=_[s++]<<f,x>(f+=8)&&(p+=_[s++]<<f,f+=8)),(S+=p&(1<<x)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=x,f-=x,S>(x=n-r)){if((x=S-x)>h&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(C=0,A=d,0===u){if(C+=c-x,w>x){w-=x;do{k[n++]=d[C++]}while(--x);C=n-S,A=k}}else if(x>u){if(C+=c+u-x,w>(x-=u)){w-=x;do{k[n++]=d[C++]}while(--x);if(C=0,w>u){w-=x=u;do{k[n++]=d[C++]}while(--x);C=n-S,A=k}}}else if(C+=u-x,w>x){w-=x;do{k[n++]=d[C++]}while(--x);C=n-S,A=k}for(;w>2;)k[n++]=A[C++],k[n++]=A[C++],k[n++]=A[C++],w-=3;w&&(k[n++]=A[C++],w>1&&(k[n++]=A[C++]))}else{C=n-S;do{k[n++]=k[C++],k[n++]=k[C++],k[n++]=k[C++],w-=3}while(w>2);w&&(k[n++]=k[C++],w>1&&(k[n++]=k[C++]))}break}}break}}while(a>s&&o>n);p&=(1<<(f-=(w=f>>3)<<3))-1,e.next_in=s-=w,e.next_out=n,e.avail_in=a>s?a-s+5:5-(s-a),e.avail_out=o>n?o-n+257:257-(n-o),i.hold=p,i.bits=f}},{}],9:[function(e,t,i){"use strict";function s(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function n(e){var t;return e&&e.state?(e.total_in=e.total_out=(t=e.state).total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(C),t.distcode=t.distdyn=new d.Buf32(A),t.sane=1,t.back=-1,y):x}function r(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,n(e)):x}function o(e,t){var i,s;return e&&e.state?(s=e.state,0>t?(i=0,t=-t):(i=1+(t>>4),48>t&&(t&=15)),t&&(8>t||t>15)?x:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,r(e))):x}function l(e,t){var i,s;return e?(s=new a,e.state=s,s.window=null,(i=o(e,t))!==y&&(e.state=null),i):x}function c(e){if(_){var t;for(h=new d.Buf32(512),u=new d.Buf32(32),t=0;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(m(v,e.lens,0,288,h,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;m(b,e.lens,0,32,u,0,e.work,{bits:5}),_=!1}e.lencode=h,e.lenbits=9,e.distcode=u,e.distbits=5}var h,u,d=e("../utils/common"),p=e("./adler32"),f=e("./crc32"),g=e("./inffast"),m=e("./inftrees"),v=1,b=2,y=0,x=-2,w=1,S=12,C=852,A=592,_=!0;i.inflateReset=r,i.inflateReset2=o,i.inflateResetKeep=n,i.inflateInit=function(e){return l(e,15)},i.inflateInit2=l,i.inflate=function(e,t){var i,a,n,r,o,l,h,u,C,A,_,k,T,I,M,O,P,D,J,E,L,j,F,R,N=0,z=new d.Buf8(4),B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return x;(i=e.state).mode===S&&(i.mode=13),o=e.next_out,n=e.output,r=e.next_in,a=e.input,u=i.hold,C=i.bits,A=l=e.avail_in,_=h=e.avail_out,j=y;e:for(;;)switch(i.mode){case w:if(0===i.wrap){i.mode=13;break}for(;16>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(2&i.wrap&&35615===u){i.check=0,z[0]=255&u,z[1]=u>>>8&255,i.check=f(i.check,z,2,0),u=0,C=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",i.mode=30;break}if(8!=(15&u)){e.msg="unknown compression method",i.mode=30;break}if(C-=4,L=8+(15&(u>>>=4)),0===i.wbits)i.wbits=L;else if(L>i.wbits){e.msg="invalid window size",i.mode=30;break}i.dmax=1<<L,e.adler=i.check=1,i.mode=512&u?10:S,u=0,C=0;break;case 2:for(;16>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(i.flags=u,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=u>>8&1),512&i.flags&&(z[0]=255&u,z[1]=u>>>8&255,i.check=f(i.check,z,2,0)),u=0,C=0,i.mode=3;case 3:for(;32>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}i.head&&(i.head.time=u),512&i.flags&&(z[0]=255&u,z[1]=u>>>8&255,z[2]=u>>>16&255,z[3]=u>>>24&255,i.check=f(i.check,z,4,0)),u=0,C=0,i.mode=4;case 4:for(;16>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}i.head&&(i.head.xflags=255&u,i.head.os=u>>8),512&i.flags&&(z[0]=255&u,z[1]=u>>>8&255,i.check=f(i.check,z,2,0)),u=0,C=0,i.mode=5;case 5:if(1024&i.flags){for(;16>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}i.length=u,i.head&&(i.head.extra_len=u),512&i.flags&&(z[0]=255&u,z[1]=u>>>8&255,i.check=f(i.check,z,2,0)),u=0,C=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((k=i.length)>l&&(k=l),k&&(i.head&&(L=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),d.arraySet(i.head.extra,a,r,k,L)),512&i.flags&&(i.check=f(i.check,a,k,r)),l-=k,r+=k,i.length-=k),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===l)break e;k=0;do{L=a[r+k++],i.head&&L&&i.length<65536&&(i.head.name+=String.fromCharCode(L))}while(L&&l>k);if(512&i.flags&&(i.check=f(i.check,a,k,r)),l-=k,r+=k,L)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===l)break e;k=0;do{L=a[r+k++],i.head&&L&&i.length<65536&&(i.head.comment+=String.fromCharCode(L))}while(L&&l>k);if(512&i.flags&&(i.check=f(i.check,a,k,r)),l-=k,r+=k,L)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;16>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(u!==(65535&i.check)){e.msg="header crc mismatch",i.mode=30;break}u=0,C=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=S;break;case 10:for(;32>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}e.adler=i.check=s(u),u=0,C=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=o,e.avail_out=h,e.next_in=r,e.avail_in=l,i.hold=u,i.bits=C,2;e.adler=i.check=1,i.mode=S;case S:if(5===t||6===t)break e;case 13:if(i.last){u>>>=7&C,C-=7&C,i.mode=27;break}for(;3>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}switch(i.last=1&u,C-=1,3&(u>>>=1)){case 0:i.mode=14;break;case 1:if(c(i),i.mode=20,6===t){u>>>=2,C-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=30}u>>>=2,C-=2;break;case 14:for(u>>>=7&C,C-=7&C;32>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&u,u=0,C=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(k=i.length){if(k>l&&(k=l),k>h&&(k=h),0===k)break e;d.arraySet(n,a,r,k,o),l-=k,r+=k,h-=k,o+=k,i.length-=k;break}i.mode=S;break;case 17:for(;14>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(i.nlen=257+(31&u),C-=5,i.ndist=1+(31&(u>>>=5)),C-=5,i.ncode=4+(15&(u>>>=5)),u>>>=4,C-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;3>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}i.lens[B[i.have++]]=7&u,u>>>=3,C-=3}for(;i.have<19;)i.lens[B[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,j=m(0,i.lens,0,19,i.lencode,0,i.work,F={bits:i.lenbits}),i.lenbits=F.bits,j){e.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;O=(N=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,P=65535&N,!(C>=(M=N>>>24));){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(16>P)u>>>=M,C-=M,i.lens[i.have++]=P;else{if(16===P){for(R=M+2;R>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(u>>>=M,C-=M,0===i.have){e.msg="invalid bit length repeat",i.mode=30;break}L=i.lens[i.have-1],k=3+(3&u),u>>>=2,C-=2}else if(17===P){for(R=M+3;R>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}C-=M,L=0,k=3+(7&(u>>>=M)),u>>>=3,C-=3}else{for(R=M+7;R>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}C-=M,L=0,k=11+(127&(u>>>=M)),u>>>=7,C-=7}if(i.have+k>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=30;break}for(;k--;)i.lens[i.have++]=L}}if(30===i.mode)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,j=m(v,i.lens,0,i.nlen,i.lencode,0,i.work,F={bits:i.lenbits}),i.lenbits=F.bits,j){e.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,j=m(b,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,F={bits:i.distbits}),i.distbits=F.bits,j){e.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(l>=6&&h>=258){e.next_out=o,e.avail_out=h,e.next_in=r,e.avail_in=l,i.hold=u,i.bits=C,g(e,_),o=e.next_out,n=e.output,h=e.avail_out,r=e.next_in,a=e.input,l=e.avail_in,u=i.hold,C=i.bits,i.mode===S&&(i.back=-1);break}for(i.back=0;O=(N=i.lencode[u&(1<<i.lenbits)-1])>>>16&255,P=65535&N,!(C>=(M=N>>>24));){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(O&&0==(240&O)){for(D=M,J=O,E=P;O=(N=i.lencode[E+((u&(1<<D+J)-1)>>D)])>>>16&255,P=65535&N,!(C>=D+(M=N>>>24));){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}u>>>=D,C-=D,i.back+=D}if(u>>>=M,C-=M,i.back+=M,i.length=P,0===O){i.mode=26;break}if(32&O){i.back=-1,i.mode=S;break}if(64&O){e.msg="invalid literal/length code",i.mode=30;break}i.extra=15&O,i.mode=22;case 22:if(i.extra){for(R=i.extra;R>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}i.length+=u&(1<<i.extra)-1,u>>>=i.extra,C-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;O=(N=i.distcode[u&(1<<i.distbits)-1])>>>16&255,P=65535&N,!(C>=(M=N>>>24));){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(0==(240&O)){for(D=M,J=O,E=P;O=(N=i.distcode[E+((u&(1<<D+J)-1)>>D)])>>>16&255,P=65535&N,!(C>=D+(M=N>>>24));){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}u>>>=D,C-=D,i.back+=D}if(u>>>=M,C-=M,i.back+=M,64&O){e.msg="invalid distance code",i.mode=30;break}i.offset=P,i.extra=15&O,i.mode=24;case 24:if(i.extra){for(R=i.extra;R>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}i.offset+=u&(1<<i.extra)-1,u>>>=i.extra,C-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===h)break e;if(i.offset>(k=_-h)){if((k=i.offset-k)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=30;break}T=k>i.wnext?i.wsize-(k-=i.wnext):i.wnext-k,k>i.length&&(k=i.length),I=i.window}else I=n,T=o-i.offset,k=i.length;k>h&&(k=h),h-=k,i.length-=k;do{n[o++]=I[T++]}while(--k);0===i.length&&(i.mode=21);break;case 26:if(0===h)break e;n[o++]=i.length,h--,i.mode=21;break;case 27:if(i.wrap){for(;32>C;){if(0===l)break e;l--,u|=a[r++]<<C,C+=8}if(e.total_out+=_-=h,i.total+=_,_&&(e.adler=i.check=i.flags?f(i.check,n,_,o-_):p(i.check,n,_,o-_)),_=h,(i.flags?u:s(u))!==i.check){e.msg="incorrect data check",i.mode=30;break}u=0,C=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;32>C;){if(0===l)break e;l--,u+=a[r++]<<C,C+=8}if(u!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=30;break}u=0,C=0}i.mode=29;case 29:j=1;break e;case 30:j=-3;break e;case 31:return-4;case 32:default:return x}return e.next_out=o,e.avail_out=h,e.next_in=r,e.avail_in=l,i.hold=u,i.bits=C,(i.wsize||_!==e.avail_out&&i.mode<30&&(i.mode<27||4!==t))&&function(e,t,i,s){var a,n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new d.Buf8(n.wsize)),s>=n.wsize?(d.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):((a=n.wsize-n.wnext)>s&&(a=s),d.arraySet(n.window,t,i-s,a,n.wnext),(s-=a)?(d.arraySet(n.window,t,i-s,s,0),n.wnext=s,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}(e,e.output,e.next_out,_-e.avail_out)?(i.mode=31,-4):(_-=e.avail_out,e.total_in+=A-=e.avail_in,e.total_out+=_,i.total+=_,i.wrap&&_&&(e.adler=i.check=i.flags?f(i.check,n,_,e.next_out-_):p(i.check,n,_,e.next_out-_)),e.data_type=i.bits+(i.last?64:0)+(i.mode===S?128:0)+(20===i.mode||15===i.mode?256:0),(0===A&&0===_||4===t)&&j===y&&(j=-5),j)},i.inflateEnd=function(e){if(!e||!e.state)return x;var t=e.state;return t.window&&(t.window=null),e.state=null,y},i.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?x:(i.head=t,t.done=!1,y):x},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(e,t){"use strict";var i=e("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],n=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],r=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,o,l,c,h,u,d){var p,f,g,m,v,b,y,x,w,S=d.bits,C=0,A=0,_=0,k=0,T=0,I=0,M=0,O=0,P=0,D=0,J=null,E=0,L=new i.Buf16(16),j=new i.Buf16(16),F=null,R=0;for(C=0;15>=C;C++)L[C]=0;for(A=0;l>A;A++)L[t[o+A]]++;for(T=S,k=15;k>=1&&0===L[k];k--);if(T>k&&(T=k),0===k)return c[h++]=20971520,c[h++]=20971520,d.bits=1,0;for(_=1;k>_&&0===L[_];_++);for(_>T&&(T=_),O=1,C=1;15>=C;C++)if(O<<=1,0>(O-=L[C]))return-1;if(O>0&&(0===e||1!==k))return-1;for(j[1]=0,C=1;15>C;C++)j[C+1]=j[C]+L[C];for(A=0;l>A;A++)0!==t[o+A]&&(u[j[t[o+A]]++]=A);switch(e){case 0:J=F=u,b=19;break;case 1:J=s,E-=257,F=a,R-=257,b=256;break;default:J=n,F=r,b=-1}if(D=0,A=0,C=_,v=h,I=T,M=0,g=-1,m=(P=1<<T)-1,1===e&&P>852||2===e&&P>592)return 1;for(;;){y=C-M,u[A]<b?(x=0,w=u[A]):u[A]>b?(x=F[R+u[A]],w=J[E+u[A]]):(x=96,w=0),p=1<<C-M,_=f=1<<I;do{c[v+(D>>M)+(f-=p)]=y<<24|x<<16|w|0}while(0!==f);for(p=1<<C-1;D&p;)p>>=1;if(0!==p?(D&=p-1,D+=p):D=0,A++,0==--L[C]){if(C===k)break;C=t[o+u[A]]}if(C>T&&(D&m)!==g){for(0===M&&(M=T),v+=_,O=1<<(I=C-M);k>I+M&&!(0>=(O-=L[I+M]));)I++,O<<=1;if(P+=1<<I,1===e&&P>852||2===e&&P>592)return 1;c[g=D&m]=T<<24|I<<16|v-h|0}}return 0!==D&&(c[v+D]=C-M<<24|64<<16|0),d.bits=T,0}},{"../utils/common":2}],11:[function(e,t){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(e,t){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[1])(1)}),function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof exports?t():(t(),e.FileSaver={})}(this,function(){function e(e,t,i){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="blob",s.onload=function(){a(s.response,t,i)},s.onerror=function(){console.error("could not download file")},s.send()}function t(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var s="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=s.saveAs||("object"!=typeof window||window!==s?function(){}:"download"in HTMLAnchorElement.prototype?function(a,n,r){var o=s.URL||s.webkitURL,l=document.createElement("a");l.download=n=n||a.name||"download",l.rel="noopener","string"==typeof a?(l.href=a,l.origin!==location.origin?t(l.href)?e(a,n,r):i(l,l.target="_blank"):i(l)):(l.href=o.createObjectURL(a),setTimeout(function(){o.revokeObjectURL(l.href)},4e4),setTimeout(function(){i(l)},0))}:"msSaveOrOpenBlob"in navigator?function(s,a,n){if(a=a||s.name||"download","string"==typeof s)if(t(s))e(s,a,n);else{var r=document.createElement("a");r.href=s,r.target="_blank",setTimeout(function(){i(r)})}else navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Depricated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(s,n),a)}:function(t,i,a,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof t)return e(t,i,a);i="application/octet-stream"===t.type,a=/constructor/i.test(s.HTMLElement)||s.safari;var r=/CriOS\/[\d]+/.test(navigator.userAgent);if((r||i&&a)&&"object"==typeof FileReader){var o=new FileReader;o.onloadend=function(){var e=o.result;e=r?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},o.readAsDataURL(t)}else{var l=s.URL||s.webkitURL,c=l.createObjectURL(t);n?n.location=c:location.href=c,n=null,setTimeout(function(){l.revokeObjectURL(c)},4e4)}});s.saveAs=a.saveAs=a,"undefined"!=typeof module&&(module.exports=a)}),function(e){"use strict";var t,i=e.Uint8Array,s=e.HTMLCanvasElement,a=s&&s.prototype,n=/\s*;\s*base64\s*(?:;|$)/i,r="toDataURL",o=function(e){for(var s,a,n=e.length,r=new i(n/4*3|0),o=0,l=0,c=[0,0],h=0,u=0;n--;)a=e.charCodeAt(o++),255!==(s=t[a-43])&&void 0!==s&&(c[1]=c[0],c[0]=a,u=u<<6|s,4==++h&&(r[l++]=u>>>16,61!==c[1]&&(r[l++]=u>>>8),61!==c[0]&&(r[l++]=u),h=0));return r};i&&(t=new i([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),s&&!a.toBlob&&(a.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))e(this.msToBlob());else{var s,a=Array.prototype.slice.call(arguments,1),l=this[r].apply(this,a),c=l.indexOf(","),h=l.substring(c+1),u=n.test(l.substring(0,c));Blob.fake?((s=new Blob).encoding=u?"base64":"URI",s.data=h,s.size=h.length):i&&(s=u?new Blob([o(h)],{type:t}):new Blob([decodeURIComponent(h)],{type:t})),e(s)}},a.toBlobHD=a.toDataURLHD?function(){r="toDataURLHD";var e=this.toBlob();return r="toDataURL",e}:a.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this),ddtabcontent.getCookie=function(e){var t=new RegExp(e+"=[^;]+","i");return document.cookie.match(t)?document.cookie.match(t)[0].split("=")[1]:""},ddtabcontent.setCookie=function(e,t){document.cookie=e+"="+t+";path=/"},ddtabcontent.prototype={expandit:function(e){this.cancelautorun();var t="";try{"string"==typeof e&&document.getElementById(e).getAttribute("rel")?t=document.getElementById(e):parseInt(e)!=isNaN()&&this.tabs[e].getAttribute("rel")&&(t=this.tabs[e])}catch(i){alert("Invalid Tab ID or position entered!")}""!=t&&this.expandtab(t)},cycleit:function(e,t){if("next"==e)var i=this.currentTabIndex<this.hottabspositions.length-1?this.currentTabIndex+1:0;else"prev"==e&&(i=this.currentTabIndex>0?this.currentTabIndex-1:this.hottabspositions.length-1);void 0===t&&this.cancelautorun(),this.expandtab(this.tabs[this.hottabspositions[i]])},setpersist:function(e){this.enabletabpersistence=e},setselectedClassTarget:function(e){this.selectedClassTarget=e||"link"},getselectedClassTarget:function(e){return this.selectedClassTarget=="linkparent".toLowerCase()?e.parentNode:e},urlparamselect:function(e){return null==window.location.search.match(new RegExp(e+"=(\\d+)","i"))?null:parseInt(RegExp.$1)},expandtab:function(e){var t=e.getAttribute("rel"),i=e.getAttribute("rev")?","+e.getAttribute("rev").replace(/\s+/,"")+",":"";this.expandsubcontent(t),this.expandrevcontent(i);for(var s=0;s<this.tabs.length;s++)this.getselectedClassTarget(this.tabs[s]).className=this.tabs[s].getAttribute("rel")==t?"selected":"";this.enabletabpersistence&&ddtabcontent.setCookie(this.tabinterfaceid,e.tabposition),this.setcurrenttabindex(e.tabposition)},expandsubcontent:function(e){for(var t=0;t<this.subcontentids.length;t++){var i=document.getElementById(this.subcontentids[t]);i.style.display=i.id==e?"block":"none"}},expandrevcontent:function(e){for(var t=this.revcontentids,i=0;i<t.length;i++)document.getElementById(t[i]).style.display=-1!=e.indexOf(","+t[i]+",")?"block":"none"},setcurrenttabindex:function(e){for(var t=0;t<this.hottabspositions.length;t++)if(e==this.hottabspositions[t]){this.currentTabIndex=t;break}},autorun:function(){this.cycleit("next",!0)},cancelautorun:function(){void 0!==this.autoruntimer&&clearInterval(this.autoruntimer)},init:function(e){var t=ddtabcontent.getCookie(this.tabinterfaceid),i=-1,s=this.urlparamselect(this.tabinterfaceid);this.automodeperiod=e||0;for(var a=0;a<this.tabs.length;a++)if(this.tabs[a].tabposition=a,this.tabs[a].getAttribute("rel")){var n=this;this.hottabspositions[this.hottabspositions.length]=a,this.subcontentids[this.subcontentids.length]=this.tabs[a].getAttribute("rel"),this.tabs[a].onclick=function(){return n.expandtab(this),n.cancelautorun(),!1},this.tabs[a].getAttribute("rev")&&(this.revcontentids=this.revcontentids.concat(this.tabs[a].getAttribute("rev").split(/\s*,\s*/))),(s==a||this.enabletabpersistence&&-1==i&&parseInt(t)==a||!this.enabletabpersistence&&-1==i&&"selected"==this.getselectedClassTarget(this.tabs[a]).className)&&(i=a)}this.expandtab(-1!=i?this.tabs[i]:this.tabs[this.hottabspositions[0]]),parseInt(this.automodeperiod)>500&&this.hottabspositions.length>1&&(this.autoruntimer=setInterval(function(){n.autorun()},this.automodeperiod))}};var Arrive=function(e,t,i){function s(e,t,i){r.addMethod(t,i,e.unbindEvent),r.addMethod(t,i,e.unbindEventWithSelectorOrCallback),r.addMethod(t,i,e.unbindEventWithSelectorAndCallback)}function a(e){e.arrive=c.bindEvent,s(c,e,"unbindArrive"),e.leave=h.bindEvent,s(h,e,"unbindLeave")}if(e.MutationObserver&&"undefined"!=typeof HTMLElement){var n=0,r=(u=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(e,t){return e instanceof HTMLElement&&u.call(e,t)},addMethod:function(e,t,i){var s=e[t];e[t]=function(){return i.length==arguments.length?i.apply(this,arguments):"function"==typeof s?s.apply(this,arguments):void 0}},callCallbacks:function(e,t){t&&t.options.onceOnly&&1==t.firedElems.length&&(e=[e[0]]);for(var i,s=0;i=e[s];s++)i&&i.callback&&i.callback.call(i.elem,i.elem);t&&t.options.onceOnly&&1==t.firedElems.length&&t.me.unbindEventWithSelectorAndCallback.call(t.target,t.selector,t.callback)},checkChildNodesRecursively:function(e,t,i,s){for(var a,n=0;a=e[n];n++)i(a,t,s)&&s.push({callback:t.callback,elem:a}),0<a.childNodes.length&&r.checkChildNodesRecursively(a.childNodes,t,i,s)},mergeArrays:function(e,t){var i,s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i]);for(i in t)t.hasOwnProperty(i)&&(s[i]=t[i]);return s},toElementsArray:function(t){return void 0===t||"number"==typeof t.length&&t!==e||(t=[t]),t}}),o=function(){var e=function(){this._eventsBucket=[],this._beforeRemoving=this._beforeAdding=null};return e.prototype.addEvent=function(e,t,i,s){return e={target:e,selector:t,options:i,callback:s,firedElems:[]},this._beforeAdding&&this._beforeAdding(e),this._eventsBucket.push(e),e},e.prototype.removeEvent=function(e){for(var t,i=this._eventsBucket.length-1;t=this._eventsBucket[i];i--)e(t)&&(this._beforeRemoving&&this._beforeRemoving(t),(t=this._eventsBucket.splice(i,1))&&t.length&&(t[0].callback=null))},e.prototype.beforeAdding=function(e){this._beforeAdding=e},e.prototype.beforeRemoving=function(e){this._beforeRemoving=e},e}(),l=function(t,s){var a=new o,n=this,l={fireOnAttributesModification:!1};return a.beforeAdding(function(i){var a,r=i.target;r!==e.document&&r!==e||(r=document.getElementsByTagName("html")[0]),a=new MutationObserver(function(e){s.call(this,e,i)});var o=t(i.options);a.observe(r,o),i.observer=a,i.me=n}),a.beforeRemoving(function(e){e.observer.disconnect()}),this.bindEvent=function(e,t,i){t=r.mergeArrays(l,t);for(var s=r.toElementsArray(this),n=0;n<s.length;n++)a.addEvent(s[n],e,t,i)},this.unbindEvent=function(){var e=r.toElementsArray(this);a.removeEvent(function(t){for(var s=0;s<e.length;s++)if(this===i||t.target===e[s])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(e){var t=r.toElementsArray(this);a.removeEvent("function"==typeof e?function(s){for(var a=0;a<t.length;a++)if((this===i||s.target===t[a])&&s.callback===e)return!0;return!1}:function(s){for(var a=0;a<t.length;a++)if((this===i||s.target===t[a])&&s.selector===e)return!0;return!1})},this.unbindEventWithSelectorAndCallback=function(e,t){var s=r.toElementsArray(this);a.removeEvent(function(a){for(var n=0;n<s.length;n++)if((this===i||a.target===s[n])&&a.selector===e&&a.callback===t)return!0;return!1})},this},c=new function(){function e(e,t,s){return!(!r.matchesSelector(e,t.selector)||(e._id===i&&(e._id=n++),-1!=t.firedElems.indexOf(e._id))||(t.firedElems.push(e._id),0))}var t={fireOnAttributesModification:!1,onceOnly:!1,existing:!1},s=(c=new l(function(e){var t={attributes:!1,childList:!0,subtree:!0};return e.fireOnAttributesModification&&(t.attributes=!0),t},function(t,i){t.forEach(function(t){var s=t.addedNodes,a=t.target,n=[];null!==s&&0<s.length?r.checkChildNodesRecursively(s,i,e,n):"attributes"===t.type&&e(a,i)&&n.push({callback:i.callback,elem:a}),r.callCallbacks(n,i)})})).bindEvent;return c.bindEvent=function(e,i,a){void 0===a?(a=i,i=t):i=r.mergeArrays(t,i);var n=r.toElementsArray(this);if(i.existing){for(var o=[],l=0;l<n.length;l++)for(var c=n[l].querySelectorAll(e),h=0;h<c.length;h++)o.push({callback:a,elem:c[h]});if(i.onceOnly&&o.length)return a.call(o[0].elem,o[0].elem);setTimeout(r.callCallbacks,1,o)}s.call(this,e,i,a)},c},h=new function(){function e(e,t){return r.matchesSelector(e,t.selector)}var t={},i=(h=new l(function(){return{childList:!0,subtree:!0}},function(t,i){t.forEach(function(t){var s=[];null!==(t=t.removedNodes)&&0<t.length&&r.checkChildNodesRecursively(t,i,e,s),r.callCallbacks(s,i)})})).bindEvent;return h.bindEvent=function(e,s,a){void 0===a?(a=s,s=t):s=r.mergeArrays(t,s),i.call(this,e,s,a)},h};return t&&a(t.fn),a(HTMLElement.prototype),a(NodeList.prototype),a(HTMLCollection.prototype),a(HTMLDocument.prototype),a(Window.prototype),s(c,t={},"unbindAllArrive"),s(h,t,"unbindAllLeave"),t}var u}(window,"undefined"==typeof jQuery?null:jQuery,void 0);!function(e){var t=!1,i=navigator.userAgent.toLowerCase();(0<=i.indexOf("iphone")||0<=i.indexOf("ipad"))&&(t=!0),e.fn.doubletap=function(i,s,a){var n,r;a=null==a?500:a,n=1==t?"touchend":"click",e(this).bind(n,function(t){var n=(new Date).getTime(),o=n-(o=e(this).data("lastTouch")||n+1);clearTimeout(r),500>o&&0<o?null!=i&&"function"==typeof i&&i(t):(e(this).data("lastTouch",n),r=setTimeout(function(e){null!=s&&"function"==typeof s&&s(e),clearTimeout(r)},a,[t])),e(this).data("lastTouch",n)})}}(jQuery),function(e){function t(){var e=document.createElement("div");return void 0!==e.style.MozTransition||void 0!==e.style.OTransition||void 0!==e.style.webkitTransition||void 0!==e.style.transition}function i(e,t,i,s,a){this.axisName=e,this.position=t,this.padding=i,this.plot=s,this.opts=a,this.width=0,this.height=0}function s(e,t,s,a,n){i.prototype.constructor.call(this,e,t,s,a,n)}function a(e,t,s,a,n){i.prototype.constructor.call(this,e,t,s,a,n),this.elem=null}function n(e,t,i,s,n){a.prototype.constructor.call(this,e,t,i,s,n)}function r(e,t,i,s,a){n.prototype.constructor.call(this,e,t,i,s,a),this.requiresResize=!1}i.prototype.cleanup=function(){},(s.prototype=new i).constructor=s,s.prototype.calculateSize=function(){this.opts.axisLabelFontSizePixels||(this.opts.axisLabelFontSizePixels=14),this.opts.axisLabelFontFamily||(this.opts.axisLabelFontFamily="sans-serif"),"left"==this.position||"right"==this.position?(this.width=this.opts.axisLabelFontSizePixels+this.padding,this.height=0):(this.width=0,this.height=this.opts.axisLabelFontSizePixels+this.padding)},s.prototype.draw=function(e){this.opts.axisLabelColour||(this.opts.axisLabelColour="black");var t=this.plot.getCanvas().getContext("2d");t.save(),t.font=this.opts.axisLabelFontSizePixels+"px "+this.opts.axisLabelFontFamily,t.fillStyle=this.opts.axisLabelColour;var i,s,a=t.measureText(this.opts.axisLabel).width,n=this.opts.axisLabelFontSizePixels,r=0;"top"==this.position?(i=e.left+e.width/2-a/2,s=e.top+.72*n):"bottom"==this.position?(i=e.left+e.width/2-a/2,s=e.top+e.height-.72*n):"left"==this.position?(i=e.left+.72*n,s=e.height/2+e.top+a/2,r=-Math.PI/2):"right"==this.position&&(i=e.left+e.width-.72*n,s=e.height/2+e.top-a/2,r=Math.PI/2),t.translate(i,s),t.rotate(r),t.fillText(this.opts.axisLabel,0,0),t.restore()},(a.prototype=new i).constructor=a,a.prototype.calculateSize=function(){var t=e('<div class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>");this.plot.getPlaceholder().append(t),this.labelWidth=t.outerWidth(!0),this.labelHeight=t.outerHeight(!0),t.remove(),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelWidth+this.padding:this.height=this.labelHeight+this.padding},a.prototype.cleanup=function(){this.elem&&this.elem.remove()},a.prototype.draw=function(t){this.plot.getPlaceholder().find("#"+this.axisName+"Label").remove(),this.elem=e('<div id="'+this.axisName+'Label" " class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem),"top"==this.position?(this.elem.css("left",t.left+t.width/2-this.labelWidth/2+"px"),this.elem.css("top",t.top+"px")):"bottom"==this.position?(this.elem.css("left",t.left+t.width/2-this.labelWidth/2+"px"),this.elem.css("top",t.top+t.height-this.labelHeight+"px")):"left"==this.position?(this.elem.css("top",t.top+t.height/2-this.labelHeight/2+"px"),this.elem.css("left",t.left+"px")):"right"==this.position&&(this.elem.css("top",t.top+t.height/2-this.labelHeight/2+"px"),this.elem.css("left",t.left+t.width-this.labelWidth+"px"))},(n.prototype=new a).constructor=n,n.prototype.calculateSize=function(){a.prototype.calculateSize.call(this),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelHeight+this.padding:this.height=this.labelHeight+this.padding},n.prototype.transforms=function(e,t,i){var s={"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":""};if(0!=t||0!=i){var a=" translate("+t+"px, "+i+"px)";s["-moz-transform"]+=a,s["-webkit-transform"]+=a,s["-o-transform"]+=a,s["-ms-transform"]+=a}if(0!=e){var n=" rotate("+e+"deg)";s["-moz-transform"]+=n,s["-webkit-transform"]+=n,s["-o-transform"]+=n,s["-ms-transform"]+=n}var r="top: 0; left: 0; ";for(var o in s)s[o]&&(r+=o+":"+s[o]+";");return r+";"},n.prototype.calculateOffsets=function(e){var t={x:0,y:0,degrees:0};return"bottom"==this.position?(t.x=e.left+e.width/2-this.labelWidth/2,t.y=e.top+e.height-this.labelHeight):"top"==this.position?(t.x=e.left+e.width/2-this.labelWidth/2,t.y=e.top):"left"==this.position?(t.degrees=-90,t.x=e.left-this.labelWidth/2+this.labelHeight/2,t.y=e.height/2+e.top):"right"==this.position&&(t.degrees=90,t.x=e.left+e.width-this.labelWidth/2-this.labelHeight/2,t.y=e.height/2+e.top),t.x=Math.round(t.x),t.y=Math.round(t.y),t},n.prototype.draw=function(t){this.plot.getPlaceholder().find("."+this.axisName+"Label").remove();var i=this.calculateOffsets(t);this.elem=e('<div class="axisLabels '+this.axisName+'Label" style="position:absolute; '+this.transforms(i.degrees,i.x,i.y)+'">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem)},(r.prototype=new n).constructor=r,r.prototype.transforms=function(e,t,i){var s="";if(0!=e){for(var a=e/90;a<0;)a+=4;s+=" filter: progid:DXImageTransform.Microsoft.BasicImage(rotation="+a+"); ",this.requiresResize="right"==this.position}return 0!=t&&(s+="left: "+t+"px; "),0!=i&&(s+="top: "+i+"px; "),s},r.prototype.calculateOffsets=function(e){var t=n.prototype.calculateOffsets.call(this,e);return"top"==this.position?t.y=e.top+1:"left"==this.position?(t.x=e.left,t.y=e.height/2+e.top-this.labelWidth/2):"right"==this.position&&(t.x=e.left+e.width-this.labelHeight,t.y=e.height/2+e.top-this.labelWidth/2),t},r.prototype.draw=function(e){n.prototype.draw.call(this,e),this.requiresResize&&(this.elem=this.plot.getPlaceholder().find("."+this.axisName+"Label"),this.elem.css("width",this.labelWidth),this.elem.css("height",this.labelHeight))},e.plot.plugins.push({init:function(i){i.hooks.processOptions.push(function(i,o){if(o.axisLabels.show){var l=!1,c={};i.hooks.draw.push(function(i,o){var h=!1;l?(l=!1,e.each(i.getAxes(),function(e,t){var s=t.options||i.getOptions()[e];s&&s.axisLabel&&t.show&&c[e].draw(t.box)})):(e.each(i.getAxes(),function(e,o){var l=o.options||i.getOptions()[e];if(e in c&&(o.labelHeight=o.labelHeight-c[e].height,o.labelWidth=o.labelWidth-c[e].width,l.labelHeight=o.labelHeight,l.labelWidth=o.labelWidth,c[e].cleanup(),delete c[e]),l&&l.axisLabel&&o.show){h=!0;var u=null;if(l.axisLabelUseHtml||"Microsoft Internet Explorer"!=navigator.appName)u=!l.axisLabelUseHtml&&(t()||document.createElement("canvas").getContext&&"function"==typeof document.createElement("canvas").getContext("2d").fillText||l.axisLabelUseCanvas)?l.axisLabelUseCanvas||!t()?s:n:a;else{var d=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(d)&&(rv=parseFloat(RegExp.$1)),u=rv>=9&&!l.axisLabelUseCanvas&&!l.axisLabelUseHtml?n:l.axisLabelUseCanvas||l.axisLabelUseHtml?l.axisLabelUseCanvas?s:a:r}c[e]=new u(e,o.position,void 0===l.axisLabelPadding?2:l.axisLabelPadding,i,l),c[e].calculateSize(),l.labelHeight=o.labelHeight+c[e].height,l.labelWidth=o.labelWidth+c[e].width}}),h&&(l=!0,i.setupGrid(),i.draw()))})}})},options:{axisLabels:{show:!0}},name:"axisLabels",version:"2.0"})}(jQuery),function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";var e,t,i=["webkit","Moz","ms","O"],s={};function a(e,t){var i,s=document.createElement(e||"div");for(i in t)s[i]=t[i];return s}function n(e){for(var t=1,i=arguments.length;t<i;t++)e.appendChild(arguments[t]);return e}function r(i,a,n,r){var o=["opacity",a,~~(100*i),n,r].join("-"),l=.01+n/r*100,c=Math.max(1-(1-i)/a*(100-l),i),h=e.substring(0,e.indexOf("Animation")).toLowerCase();return s[o]||(t.insertRule("@"+(h&&"-"+h+"-"||"")+"keyframes "+o+"{0%{opacity:"+c+"}"+l+"%{opacity:"+i+"}"+(l+.01)+"%{opacity:1}"+(l+a)%100+"%{opacity:"+i+"}100%{opacity:"+c+"}}",t.cssRules.length),s[o]=1),o}function o(e,t){var s,a,n=e.style;if(void 0!==n[t=t.charAt(0).toUpperCase()+t.slice(1)])return t;for(a=0;a<i.length;a++)if(void 0!==n[s=i[a]+t])return s}function l(e,t){for(var i in t)e.style[o(e,i)||i]=t[i];return e}function c(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)void 0===e[s]&&(e[s]=i[s])}return e}function h(e,t){return"string"==typeof e?e:e[t%e.length]}var u,d={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};function p(e){this.opts=c(e||{},p.defaults,d)}if(p.defaults={},c(p.prototype,{spin:function(t){this.stop();var i=this,s=i.opts,n=i.el=a(null,{className:s.className});if(l(n,{position:s.position,width:0,zIndex:s.zIndex,left:s.left,top:s.top}),t&&t.insertBefore(n,t.firstChild||null),n.setAttribute("role","progressbar"),i.lines(n,i.opts),!e){var r,o=0,c=(s.lines-1)*(1-s.direction)/2,h=s.fps,u=h/s.speed,d=(1-s.opacity)/(u*s.trail/100),p=u/s.lines;!function e(){o++;for(var t=0;t<s.lines;t++)r=Math.max(1-(o+(s.lines-t)*p)%u*d,s.opacity),i.opacity(n,t*s.direction+c,r,s);i.timeout=i.el&&setTimeout(e,~~(1e3/h))}()}return i},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(t,i){var s,o=0,c=(i.lines-1)*(1-i.direction)/2;function u(e,t){return l(a(),{position:"absolute",width:i.scale*(i.length+i.width)+"px",height:i.scale*i.width+"px",background:e,boxShadow:t,transformOrigin:"left",transform:"rotate("+~~(360/i.lines*o+i.rotate)+"deg) translate("+i.scale*i.radius+"px,0)",borderRadius:(i.corners*i.scale*i.width>>1)+"px"})}for(;o<i.lines;o++)s=l(a(),{position:"absolute",top:1+~(i.scale*i.width/2)+"px",transform:i.hwaccel?"translate3d(0,0,0)":"",opacity:i.opacity,animation:e&&r(i.opacity,i.trail,c+o*i.direction,i.lines)+" "+1/i.speed+"s linear infinite"}),i.shadow&&n(s,l(u("#000","0 0 4px #000"),{top:"2px"})),n(t,n(s,u(h(i.color,o),"0 0 1px rgba(0,0,0,.1)")));return t},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}}),"undefined"!=typeof document){u=a("style",{type:"text/css"}),n(document.getElementsByTagName("head")[0],u),t=u.sheet||u.styleSheet;var f=l(a("group"),{behavior:"url(#default#VML)"});!o(f,"transform")&&f.adj?function(){function e(e,t){return a("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}t.addRule(".spin-vml","behavior:url(#default#VML)"),p.prototype.lines=function(t,i){var s=i.scale*(i.length+i.width),a=2*i.scale*s;function r(){return l(e("group",{coordsize:a+" "+a,coordorigin:-s+" "+-s}),{width:a,height:a})}var o,c=-(i.width+i.length)*i.scale*2+"px",u=l(r(),{position:"absolute",top:c,left:c});function d(t,a,o){n(u,n(l(r(),{rotation:360/i.lines*t+"deg",left:~~a}),n(l(e("roundrect",{arcsize:i.corners}),{width:s,height:i.scale*i.width,left:i.scale*i.radius,top:-i.scale*i.width>>1,filter:o}),e("fill",{color:h(i.color,t),opacity:i.opacity}),e("stroke",{opacity:0}))))}if(i.shadow)for(o=1;o<=i.lines;o++)d(o,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(o=1;o<=i.lines;o++)d(o);return n(t,u)},p.prototype.opacity=function(e,t,i,s){var a=e.firstChild;s=s.shadow&&s.lines||0,a&&t+s<a.childNodes.length&&(a=(a=(a=a.childNodes[t+s])&&a.firstChild)&&a.firstChild)&&(a.opacity=i)}}():e=o(f,"animation")}return p}),function(){var e=this.ElementQueries=function(){this.withTracking=!1;var t=[];function i(e){e||(e=document.documentElement);var t=getComputedStyle(e,"fontSize");return parseFloat(t)||16}function s(e,t){var s=t.replace(/[0-9]*/,"");switch(t=parseFloat(t),s){case"px":return t;case"em":return t*i(e);case"rem":return t*i();case"vw":return t*document.documentElement.clientWidth/100;case"vh":return t*document.documentElement.clientHeight/100;case"vmin":case"vmax":var a=document.documentElement.clientWidth/100,n=document.documentElement.clientHeight/100;return t*(0,Math["vmin"===s?"min":"max"])(a,n);default:return t}}function a(e){this.element=e,this.options={};var t,i,a,n,r,o,l,c=0,h=0;this.addOption=function(e){var t=[e.mode,e.property,e.value].join(",");this.options[t]=e};var u=["min-width","min-height","max-width","max-height"];this.call=function(){for(t in c=this.element.offsetWidth,h=this.element.offsetHeight,r={},this.options)this.options.hasOwnProperty(t)&&(a=s(this.element,(i=this.options[t]).value),n="width"==i.property?c:h,o="","min"==i.mode&&n>=a&&(o+=i.value),"max"==i.mode&&n<=a&&(o+=i.value),r[l=i.mode+"-"+i.property]||(r[l]=""),o&&-1===(" "+r[l]+" ").indexOf(" "+o+" ")&&(r[l]+=" "+o));for(var e in u)r[u[e]]?this.element.setAttribute(u[e],r[u[e]].substr(1)):this.element.removeAttribute(u[e])}}function n(i,s){i.elementQueriesSetupInformation?i.elementQueriesSetupInformation.addOption(s):(i.elementQueriesSetupInformation=new a(i),i.elementQueriesSetupInformation.addOption(s),i.elementQueriesSensor=new ResizeSensor(i,function(){i.elementQueriesSetupInformation.call()})),i.elementQueriesSetupInformation.call(),e.instance.withTracking&&t.indexOf(i)<0&&t.push(i)}function r(e,t,i,s){var a;if(document.querySelectorAll&&(a=document.querySelectorAll.bind(document)),a||"undefined"==typeof $$||(a=$$),a||"undefined"==typeof jQuery||(a=jQuery),!a)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var r=a(e),o=0,l=r.length;o<l;o++)n(r[o],{mode:t,property:i,value:s})}var o=/,?([^,\n]*?)\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]([^\n\s\{]*?)/gim;function l(e){var t,i;for(e=e.replace(/'/g,'"');null!==(t=o.exec(e));)5<t.length&&r(i=t[1]||t[5]||i,t[2],t[3],t[4])}function c(e){var t="";if(e)if("string"==typeof e)-1===(e=e.toLowerCase()).indexOf("min-width")&&-1===e.indexOf("max-width")||l(e);else for(var i=0,s=e.length;i<s;i++)1===e[i].type?-1!==(t=e[i].selectorText||e[i].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?l(t):-1===t.indexOf("min-width")&&-1===t.indexOf("max-width")||l(t):4===e[i].type&&c(e[i].cssRules||e[i].rules)}this.init=function(e){this.withTracking=e;for(var t=0,i=document.styleSheets.length;t<i;t++)try{c(document.styleSheets[t].cssText||document.styleSheets[t].cssRules||document.styleSheets[t].rules)}catch(s){if("SecurityError"!==s.name)throw s}},this.update=function(e){this.withTracking=e,this.init()},this.detach=function(){if(!this.withTracking)throw"withTracking is not enabled. We can not detach elements since we don not store it.Use ElementQueries.withTracking = true; before domready.";for(var i;i=t.pop();)e.detach(i);t=[]}};e.update=function(t){e.instance.update(t)},e.detach=function(e){e.elementQueriesSetupInformation?(e.elementQueriesSensor.detach(),delete e.elementQueriesSetupInformation,delete e.elementQueriesSensor,console.log("detached")):console.log("detached already",e)},e.withTracking=!1,e.init=function(){e.instance||(e.instance=new e),e.instance.init(e.withTracking)},window.addEventListener?window.addEventListener("load",e.init,!1):window.attachEvent("onload",e.init),function(e){if(document.addEventListener&&document.addEventListener("DOMContentLoaded",e,!1),/KHTML|WebKit|iCab/i.test(navigator.userAgent))var t=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(e(),clearInterval(t))},10);window.onload=e}(e.init)}(),function(){this.ResizeSensor=function(e,t){function i(){var e,t;this.q=[],this.add=function(e){this.q.push(e)},this.call=function(){for(e=0,t=this.q.length;e<t;e++)this.q[e].call()}}function s(e,t){if(e.resizedAttached){if(e.resizedAttached)return void e.resizedAttached.add(t)}else e.resizedAttached=new i,e.resizedAttached.add(t);e.resizeSensor=document.createElement("div"),e.resizeSensor.className="resize-sensor";var s="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: scroll; z-index: -1; visibility: hidden;",a="position: absolute; left: 0; top: 0;";e.resizeSensor.style.cssText=s,e.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+s+'"><div style="'+a+'"></div></div><div class="resize-sensor-shrink" style="'+s+'"><div style="'+a+' width: 200%; height: 200%"></div></div>',e.appendChild(e.resizeSensor),{fixed:1,absolute:1}[function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}(e,"position")]||(e.style.position="relative");var n,r,o=e.resizeSensor.childNodes[0],l=o.childNodes[0],c=e.resizeSensor.childNodes[1],h=function(){l.style.width=o.offsetWidth+10+"px",l.style.height=o.offsetHeight+10+"px",o.scrollLeft=o.scrollWidth,o.scrollTop=o.scrollHeight,c.scrollLeft=c.scrollWidth,c.scrollTop=c.scrollHeight,n=e.offsetWidth,r=e.offsetHeight};h();var u=function(e,t,i){e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener(t,i)},d=function(){e.offsetWidth==n&&e.offsetHeight==r||e.resizedAttached&&e.resizedAttached.call(),h()};u(o,"scroll",d),u(c,"scroll",d)}var a=Object.prototype.toString.call(e),n="[object Array]"===a||"[object NodeList]"===a||"[object HTMLCollection]"===a||"undefined"!=typeof jQuery&&e instanceof jQuery||"undefined"!=typeof Elements&&e instanceof Elements;if(n)for(var r=0,o=e.length;r<o;r++)s(e[r],t);else s(e,t);this.detach=function(){if(n)for(var t=0,i=e.length;t<i;t++)ResizeSensor.detach(e[t]);else ResizeSensor.detach(e)}},this.ResizeSensor.detach=function(e){e.resizeSensor&&(e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached)}}();var ImageFilters,$jscomp,JS9,Module,gaussBlur=function(){function e(e,t,i,s,a){for(var n=0;n<e.length;n++)t[n]=e[n]==e[n]?e[n]:0;!function(e,t,i,s,a){for(var n=1/(a+a+1),r=0;r<s;r++){for(var o=r*i,l=o,c=o+a,h=e[o],u=e[o+i-1],d=(a+1)*h,p=0;p<a;p++)d+=e[o+p];for(p=0;p<=a;p++)d+=e[c++]-h,t[o++]=d*n;for(p=a+1;p<i-a;p++)d+=e[c++]-e[l++],t[o++]=d*n;for(p=i-a;p<i;p++)d+=u-e[l++],t[o++]=d*n}}(t,e,i,s,a),function(e,t,i,s,a){for(var n=1/(a+a+1),r=0;r<i;r++){for(var o=r,l=o,c=o+a*i,h=e[o],u=e[o+i*(s-1)],d=(a+1)*h,p=0;p<a;p++)d+=e[o+p*i];for(p=0;p<=a;p++)t[o]=(d+=e[c]-h)*n,c+=i,o+=i;for(p=a+1;p<s-a;p++)t[o]=(d+=e[c]-e[l])*n,l+=i,c+=i,o+=i;for(p=s-a;p<s;p++)t[o]=(d+=u-e[l])*n,l+=i,o+=i}}(e,t,i,s,a)}return function(t,i,s,a,n){var r=function(e,t){var i=Math.sqrt(12*e*e/3+1),s=Math.floor(i);s%2==0&&s--;for(var a=s+2,n=Math.round((12*e*e-3*s*s-12*s-9)/(-4*s-4)),r=[],o=0;o<3;o++)r.push(o<n?s:a);return r}(n);e(t,i,s,a,(r[0]-1)/2),e(i,t,s,a,(r[1]-1)/2),e(t,i,s,a,(r[2]-1)/2)}}();ImageFilters=function(){"use strict";function e(e,t,i,s,a){var n,r,o,l,c,h,u,d,p,f,g,m,v,b,y=Math.round(Math.sqrt(i.length)),x=Math.floor(y/2),w=t.width,S=t.height,C=w*S*4,A=w,_=S,k=t.data,T=e.createImageData(t.width,t.height);for(n=0;n<C;n++)T[n]=k[n];if("[object Array]"!==Object.prototype.toString.call(i))return t;void 0===s&&(s=!0);var I=s?1:0;for(a&&function(e){var t,i;for(i=e.reduce(function(e,t){return e+t}),t=0;t<e.length;++t)e[t]/=i}(i),o=0;o<_;o++)for(r=0;r<A;r++){for(c=o,l=r,h=4*(o*A+r),g=0,m=0,v=0,b=0,d=0;d<y;d++)for(u=0;u<y;u++)g+=T[p=4*(Math.min(S-1,Math.max(0,c+d-x))*w+Math.min(w-1,Math.max(0,l+u-x)))]*(f=i[d*y+u]),m+=T[p+1]*f,v+=T[p+2]*f,b+=T[p+3]*f;k[h]=g,k[h+1]=m,k[h+2]=v,k[h+3]=b+I*(255-b)}return t}function t(e,t,i,s){var a,n,r,o,l,c,h,u,d,p,f,g,m,v=Math.round(Math.sqrt(i.length)),b=Math.floor(v/2),y=t.data,x=t.width,w=t.height,S=x,C=w,A={width:S,height:C,data:new Float32Array(S*C*4)},_=A.data,k=s?1:0;for(n=0;n<C;n++)for(a=0;a<S;a++){for(o=n,r=a,l=4*(n*S+a),p=0,f=0,g=0,m=0,h=0;h<v;h++)for(c=0;c<v;c++)p+=y[u=4*(Math.min(w-1,Math.max(0,o+h-b))*x+Math.min(x-1,Math.max(0,r+c-b)))]*(d=i[h*v+c]),f+=y[u+1]*d,g+=y[u+2]*d,m+=y[u+3]*d;_[l]=p,_[l+1]=f,_[l+2]=g,_[l+3]=m+k*(255-m)}return A.data}function i(e,t){var i,s=t.data;for(i=0;i<s.length;i+=4)s[i]=s[i+1]=s[i+2]=.299*s[i]+.587*s[i+1]+.114*s[i+2];return t}function s(e,t){var i,s=t.data;for(i=0;i<s.length;i+=4)s[i]=s[i+1]=s[i+2]=(s[i]+s[i+1]+s[i+2])/3;return t}return{convolve:e,luminance:function(e,t){var i,s=t.data;for(i=0;i<s.length;i+=4)s[i]=s[i+1]=s[i+2]=.2126*s[i]+.7152*s[i+1]+.0722*s[i+2];return t},greyscale:i,greyscaleAvg:s,brighten:function(e,t,i){var s,a=t.data;for(i=i||10,s=0;s<a.length;s+=4)a[s]+=i,a[s+1]+=i,a[s+2]+=i;return t},noise:function(e,t,i,s){var a,n,r,o=t.data;for(arguments.length<3&&(i=-30,s=30),n=s-i,a=0;a<o.length;a+=4)r=Math.floor(Math.random()*n-s),o[a]+=r,o[a+1]+=r,o[a+2]+=r;return t},duotone:function(e,t,i){var s,a=t.data;switch(i){case"r":i=0;break;case"g":i=1;break;case"b":i=2;break;default:i=0}for(s=0;s<a.length;s+=4)a[s+i]=(a[s]+a[s+1]+a[s+2]-a[s+i])/2;return t},invert:function(e,t){var i,s=t.data;for(i=0;i<s.length;i+=4)s[i]=255-s[i],s[i+1]=255-s[i+1],s[i+2]=255-s[i+2];return t},pixelate:function(e,t,i){var s,a,n,r,o,l,c,h,u,d,p,f=t.width,g=t.height,m=t.data;for(arguments.length<3&&(i=2),p=2*i,h=i;h<g-i;h+=p)for(c=i;c<f-i;c+=p)for(s=m[r=4*(f*h+c)],a=m[r+1],n=m[r+2],d=-i;d<i;++d)for(l=f*(h+d),u=-i;u<i;++u)m[o=4*(l+(c+u))]=s,m[o+1]=a,m[o+2]=n;return t},sobel:function(e,a,n){var r,o,l,c,h,u=a.data;if(h=t(0,a=s(0,a),[-1,0,1,-2,0,2,-1,0,1]),c=t(0,a,[-1,-2,-1,0,0,0,1,2,1]),n)for(r=0;r<u.length;r+=4)o=Math.abs(c[r]),l=Math.abs(h[r]),u[r]=o,u[r+1]=l,u[r+2]=(o+l)/4;else{for(r=0;r<u.length;r+=4)o=Math.abs(c[r]),l=Math.abs(h[r]),u[r]=o,u[r+1]=l,u[r+2]=(o+l)/2;i(0,a)}return a},medianFilter:function(t,i){return e(t,i,[1,0,0,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,0,0,1],!0,!0)},sepia:function(e,t){var i,s,a,n,r=t.data;for(i=0;i<r.length;i+=4)r[i]=.393*(s=r[i])+.769*(a=r[i+1])+.189*(n=r[i+2]),r[i+1]=.349*s+.686*a+.168*n,r[i+2]=.272*s+.534*a+.131*n;return t},contrast:function(e,t,i){var s,a=t.data;for(arguments.length<3&&(i=2),i<-100?i=-100:i>100&&(i=100),s=0;s<a.length;s+=4)a[s]=255*((a[s]/255-.5)*i+.5),a[s+1]=255*((a[s+1]/255-.5)*i+.5),a[s+2]=255*((a[s+2]/255-.5)*i+.5);return t},threshold:function(e,t,i,s,a){var n,r=t.data;for(arguments.length<3?(i=10,s=0,a=255):arguments.length<5&&(s=0,a=255),n=0;n<r.length-1;n+=4)r[n]=r[n+1]=r[n+2]=.2126*r[n]+.7152*r[n+1]+.0722*r[n+2]>=i?a:s;return t},gamma:function(e,t,i){var s,a=t.data;for(arguments.length<3&&(i=.2),s=0;s<a.length;s+=4)a[s]=255*Math.pow(a[s]/255,i),a[s+1]=255*Math.pow(a[s+1]/255,i),a[s+2]=255*Math.pow(a[s+2]/255,i);return t},gaussBlur5:function(t,i){return e(t,i,[.003,.0133,.0219,.0133,.003,.0133,.0596,.0983,.0596,.0133,.0219,.0983,.1621,.0983,.0219,.0133,.0596,.0983,.0596,.0133,.003,.0133,.0219,.0133,.003])},posterize:function(e,t,i){var s,a,n,r=[],o=1,l=t.data;for(arguments.length<3&&(i=40),s=0;s<256;++s)s<i*o?r[s]=i*(o-1):(r[s]=i*o,++o);for(s=0;s<l.length;s+=4)a=l[s+1],n=l[s+2],l[s]=r[l[s]],l[s+1]=r[a],l[s+2]=r[n];return t},scatter:function(e,t,i){var s,a,n,r,o,l,c,h,u,d,p,f,g=t.width,m=t.height,v=t.data;for(arguments.length<3&&(i=5),o=2*i,l=(i-1)*i,a=i;a<m-i;a+=o)for(s=i;s<g-i;s+=o)for(n=!1,r=0;!n;)c=Math.floor(Math.random()*o-i),h=Math.floor(Math.random()*o-i),u=Math.floor(Math.random()*o-i),d=void 0,f=4*(g*(Math.floor(Math.random()*o-i)+a)+(u+s)),(d=[])[0]=v[p=4*(g*(h+a)+(c+s))],d[1]=v[p+1],d[2]=v[p+2],d[3]=v[p+3],v[p]=v[f],v[p+1]=v[f+1],v[p+2]=v[f+2],v[p+3]=v[f+3],v[f]=d[0],v[f+1]=d[1],v[f+2]=d[2],v[f+3]=d[3],++r>l&&(n=!0);return t},solarize:function(e,t,i){var s,a,n,r,o=t.data;for(arguments.length<3&&(i=50),s=0;s<o.length;++s)((a=o[s])+(n=o[s+1])+(r=o[s+2]))/3<i&&(o[s]=255-a,o[s+1]=255-n,o[s+2]=255-r);return t},sharpen:function(t,i,s){return arguments.length<3&&(s=20),e(t,i,[0,-3,0,-3,s,-3,0,-3,0],!0,!0)},edgeDetect:function(t,i){return e(t,i,[-1,-1,-1,-1,8,-1,-1,-1,-1])},blur:function(t,i){return e(t,i,[1,2,1,2,1,2,1,2,1],!0,!0)},emboss:function(t,i,s){return arguments.length<3&&(s=95),e(t,i,[-18,-9,9,-9,100-s,9,0,9,18],!0,!0)},lighten:function(t,i,s){return(arguments.length<3||s<0)&&(s=12/9),e(t,i,[0,0,0,0,s,0,0,0,0])},darken:function(t,i,s){return(arguments.length<3||s>1)&&(s=6/9),e(t,i,[0,0,0,0,s,0,0,0,0])}}}(),function(e){if(e.support.touch="ontouchend"in document,e.support.touch){var t,i=e.ui.mouse.prototype,s=i._mouseInit,a=i._mouseDestroy;i._touchStart=function(e){!t&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(t=!0,this._touchMoved=!1,n(e,"mouseover"),n(e,"mousemove"),n(e,"mousedown"))},i._touchMove=function(e){t&&(this._touchMoved=!0,n(e,"mousemove"))},i._touchEnd=function(e){t&&(n(e,"mouseup"),n(e,"mouseout"),this._touchMoved||n(e,"click"),t=!1)},i._mouseInit=function(){this.element.bind({touchstart:e.proxy(this,"_touchStart"),touchmove:e.proxy(this,"_touchMove"),touchend:e.proxy(this,"_touchEnd")}),s.call(this)},i._mouseDestroy=function(){this.element.unbind({touchstart:e.proxy(this,"_touchStart"),touchmove:e.proxy(this,"_touchMove"),touchend:e.proxy(this,"_touchEnd")}),a.call(this)}}function n(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var i=e.originalEvent.changedTouches[0],s=document.createEvent("MouseEvents");s.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(s)}}}(jQuery),JS9Inline={},JS9Inline["images/close.gif"]="data:image/gif;base64,R0lGODlhEAAOAKIAAAAAAGNjY3t7e5ycnL29vcbGxt7e3v///yH5BAAAAAAALAAAAAAQAA4AAANCeLrccybKKUWAJOudLSYAsIVE4RkaWZDdhRZZyJYnx8JEna3yVsOsm24GEuVcHJzGhNwlWweBdEqlBgqDrHa7LSQAADs=",JS9Inline["images/min.gif"]="data:image/gif;base64,R0lGODlhEAAOAPcAAAQCBISChNTSzERCRPz+/B+a/wCD/wB8/z8I7hz//wCA/wB8/wD/AAD/ABX/AAD/AAkF8AD/AACAeQB8AAADAgIoAABCAAAAAAAQ9AMgAAAWAAAAAKDWKeXyAhLVAAB3AOk/3OVHAoFIAHwAAABmrAAGAgESAAAAAFYB9AAAAAAAAAAAAKgAKeQAAhIAAAAAAG4W3AAKAgABAAADAMgBrOUAAhIAAAAAABgABu4AAZAAAHwAAHAAFQUAApEAAHwAAP/kyv8BAv8AAP8AAG1QmgUAApEAAHwAAIUA8ecAAIEAAHwAAAAAKQAAAhUAAAAAAGCArAMf5wAAEgAAALAj24kAvyAA1AAAd7hs8GF4ABX3eQC0AABo8QCFAACAKQC/An5QuABjBACMBsDhAAAIMAABgAAARQAAAP9/AP8CAP8gAP8BAP8Alv8An//8Of8FdgA6IAA8RwA6FQB2AAAgAAAAAAAAAAAAAABmqAAG5xUSEgAAAHwSYIYAngAAgAACfNgAEOUAIBIAFgAAAJ8AAOsAAIEAAHwAAErkB+MBAIEAAHwAAEBQAOUAAE8AAAAAALggAGEAIAEAFgAAAGxmAAAGAAASAAAAABR8AOWGABIAAAAAADTwAADmAAASAMAAAPiFAPcrABKDAAB8ABgAaO4AnpAAgHwAfHAA/wUA/5EA/3wA//8AYP8Anv8AgP8AfG0AEQUBAJEAAHwAAErpEfQrAICDAHx8AAAUXADn8BUSEgAAAADE/wAr/wCD/wB8/7gAAGEAABUAAAAAAAAQHAEg6AAWEgAAAAA0DgBkzwCDSwB8AFf//PT/54D/Enz/AAAYW+fo4hISTgAAALhtMGFk6BWDEgB8ALi4NOnvZBJOgwAAfAAQrQAZ6ABPEgAAAOQA7QEB/wAA/wAAfxAUnCDn6BYSEgAAAFAAEAABIAAAFgAAAA6INABkZACDgwB8fO4BEOYAIBIAFgAAAAEAfAAAhgAAAAAAAABwAObnABISAAAAAKC/fubPVRLVRwB3ACH5BAAAAAAALAAAAAAQAA4ARwhFAAkIHEiw4AACAhIqXKgwwEGGEBM6JBCgosWLFx9GZDhxI0eNAgCIHLmwo8eGIE+aPClgpUqQI0miRMiy5YCbOHPqvBkQADs=",JS9Inline["images/resize.gif"]="data:image/gif;base64,R0lGODlhDQANAPcAAISChNTSzPz+/AB8AGlwyB+ZWgCAeQB8AGL/GBz/5wD/EgD/AABtAACZABWAAAB8AAnaAACi6AA+EgB3AACYZwJRBAAa1wAAdwC+VAOU5wDUEgB3AKAtmOW01RLU1AB3d+nExOUDA4FAQHwAAAAghAAAAAEAAAAAAFbuAAAEAAAgAAAAAKgSxOQAARIAtgACAW4AAQAAAAAAAAAAAMierOUC5xIAEgAAABgB9u4AGpAA13wAWnDExAUDA5FAQHwAAP8whP+AAP9FAP8AAG3uAAUEAJEgAHwAAIUAxOcAAYEAtnwAAQAAxAAAAxUAQAAAAGBQMAMWgAAARQAAABABAAIAAB4AAAAAALjQbWEHRRUARQAAAAAAkAAAHAAATwAAAH5IcAAyHAAVT8AAAAAApAAA7AAAEgAAAP+kXP/m8v8SEv8AAP+YMP/VgP/URf93AADEIAAD8gBAEgAAAAAgAAAAAAAAAAAAAADuMAAEgBUgRQAAANYCYB4AngAAgAAAfNj8EOXm/xISFQAAAJ/8AOvmAIESAHwAAEqCB+PPAIHVAHx3AEDkAOXmAE8SAAAAALjEAGEB8AEAFQAAAGwFAAAAAAAAAAAAABTWAOUeABIAAAAAADTwAADmAAASAMAAAPiFAPcrABKDAAB8ABgAaO4AnpAAgHwAfHAA/wUA/5EA/3wA//8AYP8Anv8AgP8AfG0AFAUBAJEAAHwAAErpFPQrAICDAHx8AAAUXADn8BUSEgAAAADE/wAr/wCD/wB8/7gAAGEAABUAAAAAAAAQHAH/6AAVEgAAAAA0DgBkzwCDSwB8AFf//PT/54D/Enz/AAAYW+fo4hISTgAAALhtMGFk6BWDEgB8AJi4NFHvZBpOgwAAfAAQsOcZ6BJPEgAAAAAA6ucB/xIA/wAAfwAUnADn6AASEgAAAAEAEAAB/wAAFQAAABCINOdkZBKDgwB8fP8BEP8A//8AFf8AAPgA1uUAHhIAAAAAAAEzAAC5AADUAAB3AECYfvA6VRIzRwAAACH5BAEAAAEALAAAAAANAA0ARwg4AAMIHEhQoACCAgAACJBw4cGCBhUyhEixYsSFBRsylLjRoUSNFjdaBAlRY8KMHzle7CjSZMqFAQEAOw==",JS9Inline["images/restore.gif"]="data:image/gif;base64,R0lGODlhEAAOAKIAAAAAAGNjY3t7e5ycnL29vcbGxt7e3v///yH5BAAAAAAALAAAAAAQAA4AAANCeLrccybKKUWAJIPNM7GYxm1ZARpEQQDe6p3ryLIpLM/vhdIibeouDy9jKwVVH+CtlQwxjU2BdEqlBgqDrHa7LSQAADs=",JS9Inline["images/toolbar/dax_images/annulus.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAA0VJREFUOBGtVUsotkEUPp9bLgu5EyG3RJFLipCQ+8LCztpOylaKbBQbFCmyQArJbUmiLFm5ZKPYIXKPROef5/m/dz5fvv6N/9TMnDnnOc/Me+bMvC7xiHrUX2kuRLMzoxr5FZsT7HL95UX/T9KDgwPZ2tqS0NBQeXl5kaqqKiktLRU/Pz+H68foJicxyK18fHzo+Pi45uTkaEpKiubm5mpycrJGR0drcHCwpqen6/DwsJqFbMx3BZvFat9tend3p5GRkXBoZWUlSfLz87WhoUHr6uo4dwcSMz097RWPidvvIX59fdWoqCiNi4vTpqYmzcvL05mZGb2+vrbBV1dXOjU1pRkZGVpUVESSyclJ6/dJPDY2RiB2l5CQoDs7OwwA8cLCApuzyPb2NrEm3xyPj48tudeOPz8/FZ9cXV2tAO/u7hI4MjLCwO+fDxsECxcUFGhqaqp2dnbShs6L+PDwkAdVW1urbW1tBC0vLxOEwIGBATboCFxaWiKmtbWVG0lKStKnpyfavIgHBwcJKCws1LW1NQLKyspIsrKywjk66AiED7K6uqrZ2dk8j/X1ddrgt8WIOvX39xdTamIO0PhETk9PJTY2VpqbmzlHBx22k5MT2kwJytfXlwQFBcnDw4PFWeK3tzcCQP78/ExAWlqa3NzcyN7eng2ADpupZdqADQsLE+dSOEBLbGpWTClJTEyMzM7O0t/V1cWxu7tbJiYm2KBDHN/c3BxjTA4kIiKCPqdjXsyOmauamhotLy9XHCakr6+POTVgO/b399MHDC4RyhM17fPwgBwaGmKwc8PMO0GCs7MzHR0dZYMOASmufGNjI0uup6eHdnTuTXhu3v39PY2ZmZlaX1/PgI2NDcXXOPL+/q6bm5taUlJCDDYBoqOjIwfC+Y/X7fLyUkytGqzwJTs/P5f4+HgxV5gHdHFxIbe3t5KVlcUq2N/fl/n5eWlvb2cMOucg7UqOYgK1t7eXKwcGBmpxcbFWVFSw4Uuc+sZ7sbi46ITZ0XAj1pMK63EreOmQ95aWFi6SmJioISEh2tHRoWaXiufVl4DzRyqwki95fHyUgIAAMW+KhIeH+4JYG1IBYggW/qv9snfn11B75P8wu/+jfwBHNh7VFKzvswAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/bin_minus.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAHNJREFUOBFjZECA/wgmRSxGkG4wAaT/AwFFpsE0MzJCzAWRVDMU2XAmGIfa9KjB8BBlgbGgsQnjYtCkppqhF8bwoMDwOxYBUoKLZkFBkotJiUCauXjoGQwPY1LCD0uCwRAaekFBMxfTtGqCBTx1Kj1oPQoAxO4aKZojfrAAAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/bin_one.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAcElEQVQ4je2VQQqAMAwEd6X///J6kNRYxKYlgqJzKBTCENiQEDtCDqwPAEk5XnLzMlPq5Uuq0fEhMUkL6pTiC6/wAfdqgYmOI9IpsSRExvN54f3iMKVfcqQdN/u3k1LF2RtuuONoA+8L79bTZKQe0xVltSAyVTWNowAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/bin_plus.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAZ0lEQVQ4je2VwQqAMAxDE/H/f7ketDWIYx4ycOg7jDHGo6TQEicBD6wDQER4vOTupVOq8sVqFH5xsebl6GaTa4Pzf6vxE0fxhLu49E1jeUfFWtHHm6f0BleJ3RNuvoyHiYeupsS6TDf27CMrUMHB2wAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/box.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAdBJREFUOBG1lUuuAUEUhk/TXgkSESJWYGLEBpiyACLRe7AWsQRTRizDGkyMveIV1O3/uKe622253dxbSamj+j/ff5zuLgY5QznhR5GBbP6wV2WPj2iSbBgOV83nc9VoNFS1WgU99Oz3+yhMDzBMOMFlu91St9sly7Jos9nQ7Xaj+/2Oy54BbTQapUQiwXM8HtNyuaThcEiXy4UGg4HWq9lsxlUeDgftGjRoNpuqUqmoTqejWq0Wp9nkR8VS2fl8plQqpR2DBOv1mrLZLJVKJcpkMjolgsi24Q0x0FcDBKfTidsGaSTCOM7ygMUgAE9L0FfkofffT4QDFtU74Ov1KumvwVoRMvAryGlKSNhv8j8Bu3srhh6wn0CEr1bTND29FR2DBSirXAyyJpNJfhOftfxKP2+G+Z5OpykWi/2o2lMx3MOOQqFAyHO/HGDoQ6hcLtN0OqVcLkf7/Z4fer/HCO0CJB6PE/qLGFVjuPUM3u12tFqtqNfrsSDoB4qp1+tsAqi7apzK9p5i8GKxoHa7TbVajXuG49HvhgKAvqJiHK+oPp/P0/F4pMlkwjn65sG9WCzSaDTidsDMD+reQ4wJrUz5tf/21yRgGD3OTrF8f2XmF9vR8PqhJ8SqAAAAAElFTkSuQmCC",JS9Inline["images/toolbar/dax_images/circle.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAltJREFUOBG1VbtqckEQPio2ERFDiKWCQgQvURFUJEXA97D0DfQJvCBICrGQpEoaGxGt7NTKSkHJC6i1F7wSkEzOTNyJBzWnyP8PeGZ25/u+mT1nd9VIPwY/4Z8iDbLpIXuQ7U9qgqzRfOvi81fRXq8nNZtN6erqSlqtVlIsFpMikYh0EBB6Ci9yKKyw/X4PxWIRdDodLuPsL5fLwWazUfDE4MChjsUczGYzFrLb7Rw7HA6wWq08FgXL5TJzRXAivN1umRgIBCguFAowHA4FBwaDAeTzecahSKlU4jwGJ8JPT080KURrtZqCcDyoVquENZlM5N/f3zmtEP78/ASLxQL39/cEbDQaDLwUYOGDCCQSCYYphPv9PoFcLhf4/X4GqQV3d3dwc3ND3PV6TXCFcDqdBgTh5MvLi5oe55+fn4lzfX0N9XqdhbWyEBnuU71eT7HZbD7MqjtZkEBGo1Gaz+dMYOHdbifJ+5cS8v5kgFogsFqt9uTQUPvdbpeW5Ha7IRwO81LVAsR6PB6w2WwgPrjcDGp9H5CPjw+QXwX4fD4q0G631TSh0+kQFsXx8Jz9eKiSzWYJ6PV6ybdarYviWBibwj1/e3sLyWSSsYqOcXaxWBAYE7g89K+vrzAej5k0mUzg7e2NcogJhUIUXzwggjkajVj8+K6IRqPw8PDAOfmGA6fTSWMsfmwnHYvkdDqFVCrFIgaDgT4OvsdgMAjHBSuViqCxvygsEHjTZTIZeHx85CJIisfj9Drwej1niFG96GUQ2XK5pAOEex0Pw2+GF/1//WsSxXG5/8Ko2S9lWG7BgiF1AQAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/ellipse.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAd5JREFUOBHVVc/LcUEUfnxsSJGF8mOrSBYSe3uSkqWNHXbKv2Ajf4FSVkpRVjb2yoolCxaSnWSD4rxzxjXve7vf+/3o2rxTM3PmznOeczrnuY0Fn4M+TVOWhb3lInYSwxTby9liefLy+jbSr+S/Xod37z+P2Pa3EpxOJ1itVgW73+9wuVzq/J1hIH48HlitVhgMBthsNuh2uwbffD6PaDSKYrGISCQCm81AI+WmVHE4HFCpVDAajRRZoVBAMBjE7XYDB3U4HGi32+qejfF4jGw2q75pkpNyo+PxyEKWU4BosVjQ+XzmoIZxuVwkvtPpKJ9araZwGs+TuNVqSVCj0VCAfzFE2SiVSknfZrMpXZjYtNy4sTwzmQzm8zlnqUoio3wthWgOLZdLEor4bdLX61Xe9Xo9isVilE6nKZfLUalUUhnrfmluXrVaxXA4VFHL5TL8fj8EGbgpdrsdk8kEs9kMXq8X4XBY3jmdTohAEqtr3is10Xlar9fEtdaaYNjdbjcFAgHyeDwk5Eb1ep222+2LQuJ1Gas0NWO/32M6nWK326Hf78Pn88msOftkMolEIoFQKIR4PK5z5Yz/SKxD/8eBiU2r4rt4P4+Ya8yDO/q0TK6a1J4PlMb1HmbtHf0Agx5jcd8nPeAAAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/erase.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAhBJREFUOBGtlEmLIkEQhV+5ixuiIKInD568i8vRv67iyaOgJ3EBV9xxd+oFZnXaWtPVzASklUvEly8iMzXwZY+v7j/1DEa7noiHaXDaarWara/JE4Eedgh0aolEAmyBQADH4/EtjCzDMB6U7RhsBnwEfZ+knyrF97W3sQ7VM9Tn9SBHYD1YQflVfa7rPtzgR7AeoEC6Mn1O9+Xh2RodC4UC4vE4FouFrR/h9M3lcpaPLZiOxWIR6XQaHo8HwWAQfr8fp9PJClYd+iaTSVlXcx/BdCyVSshmswiFQqKG8HK5LP1P6a/Xa9zvd8XF23UjlIBMJoNoNAqv1yuwy+WC3W6H2WyGfr+PXq8n8xbJ7KgNyXgBc6JarUr6hPp8PrjdbomlmvP5jMPhgO12i9Vqhfl8jk6nI+sKygE5Viny+TwqlQpSqRQikYgFpRPN5XKJetb6drvJq2MGNB0qE+aPdd1isZjUU6kkSFJ6glWAUk61g8HgI5S+FpjF3+/3ku71epWDoBLVqJKloMrxeIx2u20LJdgqRbfbFYWsMdWyUT2/SuVms8FwOESr1for9AXMAdUxfdaaFg6H5Q4zAyodjUZoNps/QhlrKeaApuBUzoOkapZgMpmg0Wg4gpLzBtbhVM4HwtrX63XHUDKsw+NANyqfTqdYLpfy5fg3pv65zbjfBdpt8rz3L5f0/5DNh8dN/wBgJjws35ZigAAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/incexl.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAACZUlEQVQ4EbVVP49hURS/2EIyKr6AXhQzpUw3UUlGoZMoVD6CUYloFRPVCIkvIDQoZGhQUIhCQkSoJhFCSEQhxt37O/Pu9d6+LWbX7knuPf9/57g557GwK/GreJNkQTZdgnNBN6HJZIvlC9eqB61Wq0xzyLhvceTIPK1B6hLdEi2XSxik+m2OHH2epl+B9AGNRoOCpe3p6UkVkjZwUCAQMAHjKUx0uVzY3d2dsj8/P7Nms8lGoxELhUJkz2azxNfrNUP870h10u12TZWn0ylfrVY8HA7zdrvN3W43F6AqB0IsFjPloZAKkgGTyYQvFgsKLhaLvFarkdxqtXgikSB5MBjw9/d3ygWGHgfyD3EpyuVyJHc6HebxeEgej8dMFCHZ4XCwVCrFdrsde3h4YJFIhHm9XpW/2WyYy+UiHUOHqsr5LwSMnuq4UCgwMW7MbrfTsdlsDAdBKPz5+clOpxPVhQyC32q1kv/j44PF43HmdDrJh8vwTtD/9uTzeT3WFzAsoiN+Pp/piK4oSH/BJo/eDhlzL0lr7AosHX/K6/W6aSoEuBF4u90acPf7PXV5PB4Ndvw6Sb9+CkwdawaqjgLJZNLw3vf39xwgYhOVvVwuE76+QQPw6+urCoZDrLBKgI7FAGFJoPf7fS4mhotpUnEkiMsArCnSp7hYGgrEO4IqlQrpKkATkC/JAIzvAQzo3O/3U8dYWVkQHF3OZjOyRaNRHgwG+dvbG5/P52QbDoeEbQCGpdfrUYAcnZeXF+7z+Xg6nSZ7JpOhxMPhQPrj4yPppVKJdLHupAP4v/01SWBRhDYO/FYizJ/qZl5jMo9ZwQAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/lin.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAdUlEQVQ4jbXVuxKAIAxE0Y3j//9yLBRkQCCP9RYpz2TSRPCm4CR1AFBVjityu8JEW/xgQc+mtTTcgxS4RftzhuEVGoZ3aAi2oG7YirpgD2qGvagJjqBbOIou4Qw6hbPoJ8xAB5iFDjALBYCTDZZ+fU0l6jO9AJCBOywi1jRaAAAAAElFTkSuQmCC",JS9Inline["images/toolbar/dax_images/log.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAeklEQVQ4jeXVwRKAIAgE0KXp/3+ZDoWVlhBuXdqDxzcOAgr2KDiRcgBQVY4rsrrCRI/4xIK2m5bMGSSSMOyBdTld+AqMvMktnAW7cI1muqZbipE2bNot+uqPYcvo0FAGxIVZZWhgC2N3fFOKf8OnyWMu/Fe/Jgv1M10A+Y0mOIrZ25cAAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/mag.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAhUlEQVQ4je3VSw6AMAgE0Bnj/a+MC3+1QCsWExfOwo3po6lYiDOCnPB4ABCRHJdcXUbQbZFKvZ4k5hGwfl8WuAV7O2sVnnqYtRuvYFmgCz/ND38IbvVyuI9rrPejlHHhCGL1uAlbaPSSUmecgSo4C1VwFtqERy/+y8fLmiLAy6NpT+owXQD/yjU2FZ2yfgAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/mag_minus.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAj0lEQVQ4jc2VzRKAIAiEd5ve/5XpkJUJ/pA40x68OHzLAArxSBAj3gcAEYnhkieXHmgKUirjSWKfAZb3ucEQuJZZy3jrwaxsaoa5QRf8Va5SjDYP+EvGnllflvEwuDXL7jkuYb2HkqsK9kCs2ptgC+r9pFSNI6AKHAVV4ChoEzz78b+aF7VFgMWr6VLoMj0A4Ck7NzuePjoAAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/mag_one.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAkUlEQVQ4jd3VQRKAIAgFUH7T/a9Mi6IUCWGkTX/RQscnk4yCnjDVBPeHiJi5xgVOFxn0WjRErwdA+wqo59sNQvBbZd7G2wyzqgHQYTLXjk3hSHVW0nD0oNNwND+GdRfoLpFxidvHugOiHeHCGcTqFBO20OwlNfzjCnSAq9ABrkJdePXi7w6v6hUh+vhpkpQ+pgfAhD42e0WmxgAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/mag_plus.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAmElEQVQ4jc2VwRKAIAhE2ab//2U6FKWIKEkz7cGDDk9cGAE9YsoR7oWImDmHC5xcRKBXUCMdD4D2FaA+Ly+YAvcy8y7eRjArGwAVTM7KvSH4rUJW6CdbrxH9I2Ptpdemn2U8DdZdoLtE9kWuFb1izagLjkAsr02wBY1+Uo3HGdAGnAVtwFlQF7z68VfFy5oiRB+PJlHqMD0AdL1EOgvj9K4AAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/open.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAaElEQVQ4je2VsQ6AMAgFj8b//2RxMFYdaBt5deoNHY8XGsC4cTRYfQB313jNTq8ppU/5NlC9SRSqZKQtmokhTtQrHCbOUgB28edVcbafsViund3jJV7iF91d8XV4/k+cXf5TT9OF9Jge5XkaMmpYL80AAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/pan.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAaklEQVQ4je2VQQ7AIAgEdxv//2V6UGhjGpVADybOwQPR0SAB4kGQA20BICI5XrJ6qdIWCKOu0gcjvB93hUwDjtgo8y2VWdX0H78s/jo8unS/HB+x4aoKT6NaFnsb1OY5zmr2wM+jSUkdpjcwVB02iqQEaQAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/poly.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAiVJREFUOBG1lb/LeVEcx899egYjGWyUUmaTgaySIn+BUpRsBgtlk2KQSUYk8iMGGWQzEFGSMsmAyGSSdL7384nL/d5zv99Hz/N8yj2f+/m83y/Huc65HHkGfabfyjhw44UfKR/foj3MHMcBjHy+C71cLmS73RKVSkWGwyGpVqtEo9EQAI5GI+J2uzH/eHwTaxwMBmQ8HhOHw4FinU5HFAoF0ev1CLbb7UStVhOlUkkWiwXp9XokGAwKKFgGSez3e1gb/Hi9XhqLxajP56P8LFF7Pp8Fz+FwQF2pVMLa3YfrK4geSTQaRfHjXm6cz+eoy2azguSfYGjabDZBzEpmsxlC0+m0qC0Lvt1uaOj3+yLD6w2/9qhJJBKvZcxlwY1GA00Sx70wmUywn0wmmRJZsNPppFarlWmChwfGQCDA7ENRFgyNYrHINPJ/JzTWajVmXxbc6XTQuNlsZI2VSgU17XabqWHOGJYBGv+Ler2OOqPRKJEywVBMpVISMavQ7XYRbjAYRG0JeLVaoRB23TsBILPZTE+nE9ok4Ewm86VlADds6UKhQC0WC3oA5vf72WBoRiIRbP594U81msvlaDgcFkCgd7lcNJ/P09eHLZrx8XhEw3q9Rub1eqVwqIRCIREITOVymcLOkwsReLlcIiAej1OTySSCwU6cTqdyHEkdwHDQY7RaLRx3ux3xeDyk2WwSrVZ7774//MqriZ8G/z55Bvz8nwhk/gFmYEMZs2bI8QAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/pow.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAdUlEQVQ4je3VzQ6AIAwD4Nb4/q88DzJMDD9u1JP2wI0vDYRBXDFowroAMDONS54uFWjB4A5JbGv9+vkgfD9fGdzLD2tgvzg57Gm93DQ8arsEe3pzJgXP2qZhz2gq7hHoSdMmHNk4m+GhxpEP4dWvqRaSyKXsAYwlIy0KAJCPAAAAAElFTkSuQmCC",JS9Inline["images/toolbar/dax_images/smooth.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAcxJREFUOBG1VT3PAUEQnnudqLT+g+hEoaZUSdQaoVAo1EoVnR9w4Q+IqHRKnUYiohLdJUokvrLvzjJj73YveROvSe7mma9nd2fncOAt4g0/Qg5Wq5fUQspHbFTsOE9efP8bqU7+Q0aU3u/3gLugZ7VaRaUaftyxVQ6HA/bHeHa7nTWfnK8a1QrysT6dTiKXyzFpo9FgjIWe53FuGEQS3243Ua/Xmajf7wvf91X9cDhk/3Q6DXMqG4mtPXZdF5LJpIw/pVwuQyqVUsblciE3tNttWC6XbIeBsWqv1+NddTodsV6vAzndbpfji8UiEENDLmDfcSKR4MUrlQqk02m2Edzvd7bxdDaxtiIej3Pu4/FgTEDeAUGIxWKMdWAQTyYTaDabnGMj1vuczWZhu91yPgGDWD8aXo6NWE4J1Go14gC9hpwGsX40nIZ8Pk+5AX29XtnWa8hpEOur672kAtLn85kgtFotOB6PbBPgcdlsNjxGMihmsxnHwqBQKARy8UslwVokV/bL4OTxeEx5kTpcQ+Qvv0k8Go0iycIBnTyTyagw+ni6pQdKpRIUi0WoVqsy9jfBusFgAPP5HPT5/9oP/Vf/mujM6ibJ+ECrzf4CoCsJ1NPuJS8AAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/srcbkg.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAACPElEQVQ4Ea1VzeppURRfbjcfJSMZKRMZeAAvYWpkbCwlJryAgYmJBzAwouQNlAkjyVeRb4lSRBlg372Ws7e9Of27XXfV2Xut3/qt39rOWcexwMvYy/3Ks2A1LXxn3L5SE8UWy1P317toq9UCTBoE4qOfy+UIu9/vhI1Gow8eJowD0inxtGSHwwEB1mg0aL9cLoQjJq5ut8sEbzweS9yQUPl0GyQuBHC/Xq+SGIvFPjgCqNfrwpV8vBWaJRIJGA6HhNntdpmbzWbSf3esVus7RLHstlwu5U/jGVYqleQJMFYNY/UyyekFSNhutyqP7XY7Np/PNQyDyWTCzufzB44NcTYwAYvFAh6PB7jdbnA6neSv12vweDxgs9k4DWCz2cDxeMQCcLlc4PV6gT8HmE6ncLvdwOFwgN/vf06LEFbHi1T+ccGmqPVb1CPwP02bilqtZqrd6XSA33fT3E8gPywdl54yBcqSz+fl01fgH13ejH4+kfirSgL9fp/t93utEImBQIAwfnrW6/Vk/nQ6MXVMMaEJK4BIyGIkptNpiWOMls1mNYxPFeGmwpThCyZxftEMIu2r1YowgReLRYpFM4Hz+PWCvPvtdlsWYQ6vaDRKGC6hUIiwcDhMu0gYXF24UqmwSCTyQYzH46xarRKOO5poVigUhKaK68KC3Gw2iVQul6VAMpmUPn/TpC9qBoOBubDW9i8CFBSGfjAYpBD9rz5NqVQKfD4f/W/wkYNMJkOvM1eX3zze5DnU6HxpdNg/mvUqocfy/04AAAAASUVORK5CYII=",JS9Inline["images/toolbar/dax_images/stats.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAiElEQVQ4jcWVQQ6AMAgEWeP/v4wHRROECoXGOXgxGdctbUEPTD3gfhARM/d4gdMLLb1epNGOrZbPZ7e+LKkj9Xh/aCYW4WwtrjiSaFocXVBmNisbJq6M4GcVs30vG7f/xO1Tocku5FCc2YEpcQQAZl2uuJLWFVfOCOF1umnp8qnIsvRqElov0wOPRzI0EbAbcgAAAABJRU5ErkJggg==",JS9Inline["images/toolbar/dax_images/text.png"]="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAAnNJREFUOBGtlT9LelEYx7+aipboYCEYQQkSqJMvIXC3VqMlaOkVNIjY0Jtwc3Fql0AcdXAQRA0cGlIaaiiL7J/6u98nz/VejZRfPnD+cs7nfO9znudcCyY2mnT/1LNwt1RaO9LsTzS12WL55rJeGtQIt6mBsa3X6/j6+oLD4QAVGL9mrEjmPj8/ZU04HDZu1/tUrFun06FPTMVms43cbvdobW3NNK/WXV1djdrtts7g/IziQqEgJ8bjcQQCATidTvR6PWhwUelyubCzs4NKpYL7+3tQ9eXlpYyr1aqsI8AqFEOVz+dlFIvF4Pf75VPpEhZCV1ZW8Pj4iIODAySTSRA2HA4RjUZRKpV0kgncarVQLBZxfHyM1dVV1Go1JBIJBINB9Pt9Xc3d3R08Hg9OT09lbTabxdvbG8rl8s/gra0tnJ2dYXt7G+l0Gvv7+9jb28Pr66tspDIW2svLi7SZTAapVAqhUEj2PD09ybzJx9oF4eLiAg8PD+K7w8NDWfT8/IyPjw+BajeE9/d3/YDNzU2cn5+j0WiIIK/XOwuWGa1aX18HlSjjBSkYwQxFFqNFIhGwKDP5WE1OtwQTRCiN7lD96bVqvBB4MBjMgJYCZrapjKMiq3W+nvkrxiDGr0pvqjUepD7f2C4EZvbZ7XaBqUSZBzaFm/FE1W82m7i5uQHDiJfIxPD5fNJXa35qf1VMVQwhJgNdQd/yfeDrxwzlodNhpw75VfHJyQm63a5AmCBMINrt7S02Njbk0N3dXVxfXyue3i700OdyOVHMF47GOKZb+OrRNUdHRzqQHX4pwTTtor+D/3v4//X4UjX0xJZDHv9H/wHHHTR7bR1QiQAAAABJRU5ErkJggg==",($jscomp={scope:{},findInternal:function(e,t,i){e instanceof String&&(e=String(e));for(var s=e.length,a=0;a<s;a++){var n=e[a];if(t.call(i,n,a,e))return{i:a,v:n}}return{i:-1,v:void 0}}}).defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){if(i.get||i.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=i.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.polyfill=function(e,t,i,s){if(t){for(i=$jscomp.global,e=e.split("."),s=0;s<e.length-1;s++){var a=e[s];a in i||(i[a]={}),i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&$jscomp.defineProperty(i,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}},"es6-impl","es3"),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jquery")):e(jQuery)}(function(e,t){function i(t,i,s,a){for(var n=[],r=0;r<t.length;r++)if(c=t[r]){var o=tinycolor(c),l=(l=.5>o.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light")+(tinycolor.equals(i,c)?" sp-thumb-active":""),c=o.toString(a.preferredFormat||"rgb"),h=d?"background-color:"+o.toRgbString():"filter:"+o.toFilter();n.push('<span title="'+c+'" data-color="'+o.toRgbString()+'" class="'+l+'"><span class="sp-thumb-inner" style="'+h+';" /></span>')}else n.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",a.noColorSelectedText)).html());return"<div class='sp-cf "+s+"'>"+n.join("")+"</div>"}function s(t,i){var s=e.extend({},c,t);return s.callbacks={move:o(s.move,i),change:o(s.change,i),show:o(s.show,i),hide:o(s.hide,i),beforeShow:o(s.beforeShow,i)},s}function a(a,n){function o(){if(J.showPaletteOnly&&(J.showPalette=!0),Ce.text(J.showPaletteOnly?J.togglePaletteMoreText:J.togglePaletteLessText),J.palette){Q=J.palette.slice(0),ee=e.isArray(Q[0])?Q:[Q],te={};for(var t=0;t<ee.length;t++)for(var i=0;i<ee[t].length;i++){var s=tinycolor(ee[t][i]).toRgbString();te[s]=!0}}le.toggleClass("sp-flat",E),le.toggleClass("sp-input-disabled",!J.showInput),le.toggleClass("sp-alpha-enabled",J.showAlpha),le.toggleClass("sp-clear-enabled",Le),le.toggleClass("sp-buttons-disabled",!J.showButtons),le.toggleClass("sp-palette-buttons-disabled",!J.togglePaletteOnly),le.toggleClass("sp-palette-disabled",!J.showPalette),le.toggleClass("sp-palette-only",J.showPaletteOnly),le.toggleClass("sp-initial-disabled",!J.showInitial),le.addClass(J.className).addClass(J.containerClassName),P()}function c(){if(j&&window.localStorage){try{var t=window.localStorage[j].split(",#");1<t.length&&(delete window.localStorage[j],e.each(t,function(e,t){f(t)}))}catch(i){}try{ie=window.localStorage[j].split(";")}catch(i){}}}function f(t){if(L){if(t=tinycolor(t).toRgbString(),!te[t]&&-1===e.inArray(t,ie))for(ie.push(t);ie.length>se;)ie.shift();if(j&&window.localStorage)try{window.localStorage[j]=ie.join(";")}catch(i){}}}function g(){var t=k(),s=e.map(ee,function(e,s){return i(e,t,"sp-palette-row sp-palette-row-"+s,J)});c(),ie&&s.push(i(function(){var e=[];if(J.showPalette)for(var t=0;t<ie.length;t++){var i=tinycolor(ie[t]).toRgbString();te[i]||e.push(ie[t])}return e.reverse().slice(0,J.maxSelectionSize)}(),t,"sp-palette-row sp-palette-row-selection",J)),be.html(s.join(""))}function m(){if(J.showInitial){var e=Pe,t=k();ye.html(i([e,t],t,"sp-palette-row-initial",J))}}function v(){(0>=W||0>=H||0>=G)&&P(),B=!0,le.addClass("sp-dragging"),ae=null,re.trigger("dragstart.spectrum",[k()])}function b(){B=!1,le.removeClass("sp-dragging"),re.trigger("dragstop.spectrum",[k()])}function y(){var e=ve.val();null!==e&&""!==e||!Le?(e=tinycolor(e)).isValid()?(_(e),O(!0)):ve.addClass("sp-validation-error"):(_(null),O(!0))}function x(){z?A():w()}function w(){var t=e.Event("beforeShow.spectrum");if(z)P();else if(re.trigger(t,[k()]),!1!==R.beforeShow(k())&&!t.isDefaultPrevented()){for(t=0;t<h.length;t++)h[t]&&h[t].hide();z=!0,e(ne).bind("keydown.spectrum",S),e(ne).bind("click.spectrum",C),e(window).bind("resize.spectrum",N),Te.addClass("sp-active"),le.removeClass("sp-hidden"),P(),I(),Pe=k(),m(),R.show(Pe),re.trigger("show.spectrum",[Pe])}}function S(e){27===e.keyCode&&A()}function C(e){2==e.button||B||(Je?O(!0):_(Pe,!0),A())}function A(){z&&!E&&(z=!1,e(ne).unbind("keydown.spectrum",S),e(ne).unbind("click.spectrum",C),e(window).unbind("resize.spectrum",N),Te.removeClass("sp-active"),le.addClass("sp-hidden"),R.hide(k()),re.trigger("hide.spectrum",[k()]))}function _(e,t){var i,s;tinycolor.equals(e,k())?I():(!e&&Le?Ee=!0:(Ee=!1,s=(i=tinycolor(e)).toHsv(),Y=s.h%360/360,V=s.s,K=s.v,Z=s.a),I(),i&&i.isValid()&&!t&&(De=J.preferredFormat||i.getFormat()))}function k(e){return e=e||{},Le&&Ee?null:tinycolor.fromRatio({h:Y,s:V,v:K,a:Math.round(100*Z)/100},{format:e.format||De})}function T(){I(),R.move(k()),re.trigger("move.spectrum",[k()])}function I(){ve.removeClass("sp-validation-error"),M();var e=tinycolor.fromRatio({h:Y,s:1,v:1});he.css("background-color",e.toHexString()),e=De,!(1>Z)||0===Z&&"name"===e||"hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb");var t=k({format:e}),i="";if(Me.removeClass("sp-clear-display"),Me.css("background-color","transparent"),!t&&Le)Me.addClass("sp-clear-display");else{i=t.toHexString();var s=t.toRgbString();if(d||1===t.alpha?Me.css("background-color",s):(Me.css("background-color","transparent"),Me.css("filter",t.toFilter())),J.showAlpha){(s=t.toRgb()).a=0;var a="linear-gradient(left, "+(s=tinycolor(s).toRgbString())+", "+i+")";u?fe.css("filter",tinycolor(s).toFilter({gradientType:1},i)):(fe.css("background","-webkit-"+a),fe.css("background","-moz-"+a),fe.css("background","-ms-"+a),fe.css("background","linear-gradient(to right, "+s+", "+i+")"))}i=t.toString(e)}J.showInput&&ve.val(i),J.showPalette&&g(),m()}function M(){var e=V,t=K;Le&&Ee?(me.hide(),pe.hide(),ue.hide()):(me.show(),pe.show(),ue.show(),e*=H,t=W-t*W,e=Math.max(-q,Math.min(H-q,e-q)),t=Math.max(-q,Math.min(W-q,t-q)),ue.css({top:t+"px",left:e+"px"}),me.css({left:Z*$-U/2+"px"}),pe.css({top:Y*G-X+"px"}))}function O(e){var t=k(),i="",s=!tinycolor.equals(t,Pe);t&&(i=t.toString(De),f(t)),Ae&&re.val(i),e&&s&&(R.change(t),re.trigger("change",[t]))}function P(){z&&(H=he.width(),W=he.height(),q=ue.height(),de.width(),G=de.height(),X=pe.height(),$=ge.width(),U=me.width(),E||(le.css("position","absolute"),le.offset(J.offset?J.offset:function(t,i){var s,a=t.outerWidth(),n=t.outerHeight(),r=i.outerHeight(),o=(s=(l=t[0].ownerDocument).documentElement).clientWidth+e(l).scrollLeft(),l=s.clientHeight+e(l).scrollTop();return(s=i.offset()).top+=r,s.left-=Math.min(s.left,s.left+a>o&&o>a?Math.abs(s.left+a-o):0),s.top-=Math.min(s.top,s.top+n>l&&l>n?Math.abs(n+r-0):0),s}(le,Ie))),M(),J.showPalette&&g(),re.trigger("reflow.spectrum"))}function D(){A(),oe=!0,re.attr("disabled",!0),Ie.addClass("sp-disabled")}var J=s(n,a),E=J.flat,L=J.showSelectionPalette,j=J.localStorageKey,F=J.theme,R=J.callbacks,N=function(e,t,i){var s;return function(){var t=this,i=arguments;s||(s=setTimeout(function(){s=null,e.apply(t,i)},10))}}(P),z=!1,B=!1,H=0,W=0,q=0,G=0,$=0,U=0,X=0,Y=0,V=0,K=0,Z=1,Q=[],ee=[],te={},ie=J.selectionPalette.slice(0),se=J.maxSelectionSize,ae=null,ne=a.ownerDocument,re=e(a),oe=!1,le=e(p,ne).addClass(F),ce=le.find(".sp-picker-container"),he=le.find(".sp-color"),ue=le.find(".sp-dragger"),de=le.find(".sp-hue"),pe=le.find(".sp-slider"),fe=le.find(".sp-alpha-inner"),ge=le.find(".sp-alpha"),me=le.find(".sp-alpha-handle"),ve=le.find(".sp-input"),be=le.find(".sp-palette"),ye=le.find(".sp-initial"),xe=le.find(".sp-cancel"),we=le.find(".sp-clear"),Se=le.find(".sp-choose"),Ce=le.find(".sp-palette-toggle"),Ae=re.is("input"),_e=Ae&&"color"===re.attr("type")&&e.fn.spectrum.inputTypeColorSupport(),ke=Ae&&!E,Te=ke?e("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(F).addClass(J.className).addClass(J.replacerClassName):e([]),Ie=ke?Te:re,Me=Te.find(".sp-preview-inner"),Oe=J.color||Ae&&re.val(),Pe=!1,De=J.preferredFormat,Je=!J.showButtons||J.clickoutFiresChange,Ee=!Oe,Le=J.allowEmpty&&!_e;!function(){function t(t){return t.data&&t.data.ignore?(_(e(t.target).closest(".sp-thumb-el").data("color")),T()):(_(e(t.target).closest(".sp-thumb-el").data("color")),T(),O(!0),J.hideAfterPaletteSelect&&A()),!1}if(u&&le.find("*:not(input)").attr("unselectable","on"),o(),ke&&re.after(Te).hide(),Le||we.hide(),E)re.after(le).hide();else{var i="parent"===J.appendTo?re.parent():e(J.appendTo);1!==i.length&&(i=e("body")),i.append(le)}c(),Ie.bind("click.spectrum touchstart.spectrum",function(t){oe||x(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(re.is(":disabled")||!0===J.disabled)&&D(),le.click(r),ve.change(y),ve.bind("paste",function(){setTimeout(y,1)}),ve.keydown(function(e){13==e.keyCode&&y()}),xe.text(J.cancelText),xe.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),_(Pe,!0),A()}),we.attr("title",J.clearText),we.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Ee=!0,T(),E&&O(!0)}),Se.text(J.chooseText),Se.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),u&&ve.is(":focus")&&ve.trigger("change"),ve.hasClass("sp-validation-error")||(O(!0),A())}),Ce.text(J.showPaletteOnly?J.togglePaletteMoreText:J.togglePaletteLessText),Ce.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),J.showPaletteOnly=!J.showPaletteOnly,J.showPaletteOnly||E||le.css("left","-="+(ce.outerWidth(!0)+5)),o()}),l(ge,function(e,t,i){Z=e/$,Ee=!1,i.shiftKey&&(Z=Math.round(10*Z)/10),T()},v,b),l(de,function(e,t){Y=parseFloat(t/G),Ee=!1,J.showAlpha||(Z=1),T()},v,b),l(he,function(e,t,i){i.shiftKey?ae||(ae=Math.abs(e-V*H)>Math.abs(t-(W-K*W))?"x":"y"):ae=null,i=!ae||"y"===ae,ae&&"x"!==ae||(V=parseFloat(e/H)),i&&(K=parseFloat((W-t)/W)),Ee=!1,J.showAlpha||(Z=1),T()},v,b),Oe?(_(Oe),I(),De=J.preferredFormat||tinycolor(Oe).format,f(Oe)):I(),E&&w(),be.delegate(".sp-thumb-el",i=u?"mousedown.spectrum":"click.spectrum touchstart.spectrum",t),ye.delegate(".sp-thumb-el:nth-child(1)",i,{ignore:!0},t)}();var je={show:w,hide:A,toggle:x,reflow:P,option:function(i,s){return i===t?e.extend({},J):s===t?J[i]:(J[i]=s,"preferredFormat"===i&&(De=J.preferredFormat),void o())},enable:function(){oe=!1,re.attr("disabled",!1),Ie.removeClass("sp-disabled")},disable:D,offset:function(e){J.offset=e,P()},set:function(e){_(e),O()},get:k,destroy:function(){re.show(),Ie.unbind("click.spectrum touchstart.spectrum"),le.remove(),Te.remove(),h[je.id]=null},container:le};return je.id=h.push(je)-1,je}function n(){}function r(e){e.stopPropagation()}function o(e,t){var i=Array.prototype.slice,s=i.call(arguments,2);return function(){return e.apply(t,s.concat(i.call(arguments)))}}function l(t,i,s,a){function n(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function r(e){if(c){if(u&&9>l.documentMode&&!e.button)return o();var s=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0],a=Math.max(0,Math.min((s&&s.pageX||e.pageX)-h.left,p));s=Math.max(0,Math.min((s&&s.pageY||e.pageY)-h.top,d)),f&&n(e),i.apply(t,[a,s,e])}}function o(){c&&(e(l).unbind(g),e(l.body).removeClass("sp-dragging"),setTimeout(function(){a.apply(t,arguments)},0)),c=!1}i=i||function(){},s=s||function(){},a=a||function(){};var l=document,c=!1,h={},d=0,p=0,f="ontouchstart"in window,g={};g.selectstart=n,g.dragstart=n,g["touchmove mousemove"]=r,g["touchend mouseup"]=o,e(t).bind("touchstart mousedown",function(i){(i.which?3==i.which:2==i.button)||c||!1===s.apply(t,arguments)||(c=!0,d=e(t).height(),p=e(t).width(),h=e(t).offset(),e(l).bind(g),e(l.body).addClass("sp-dragging"),r(i),n(i))})}var c={beforeShow:n,move:n,change:n,show:n,hide:n,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:["#ffffff #000000 #ff0000 #ff8000 #ffff00 #008000 #0000ff #4b0082 #9400d3".split(" ")],selectionPalette:[],disabled:!1,offset:null},h=[],u=!!/msie/i.exec(window.navigator.userAgent),d=function(){var e=document.createElement("div").style;return e.cssText="background-color:rgba(0,0,0,.5)",!!~(""+e.backgroundColor).indexOf("rgba")||!!~(""+e.backgroundColor).indexOf("hsla")}(),p=function(){var e="";if(u)for(var t=1;6>=t;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div><div class='sp-palette-button-container sp-cf'><button type='button' class='sp-palette-toggle'></button></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-clear sp-clear-display'></div><div class='sp-hue'><div class='sp-slider'></div>",e,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button type='button' class='sp-choose'></button></div></div></div>"].join("")}();e.fn.spectrum=function(t,i){if("string"==typeof t){var s=this,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=h[e(this).data("spectrum.id")];if(i){var a=i[t];if(!a)throw Error("Spectrum: no such method: '"+t+"'");"get"==t?s=i.get():"container"==t?s=i.container:"option"==t?s=i.option.apply(i,n):"destroy"==t?(i.destroy(),e(this).removeData("spectrum.id")):a.apply(i,n)}}),s}return this.spectrum("destroy").each(function(){var i=a(this,i=e.extend({},t,e(this).data()));e(this).data("spectrum.id",i.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=l,e.fn.spectrum.defaults=c,e.fn.spectrum.inputTypeColorSupport=function t(){if(void 0===t._cachedResult){var i=e("<input type='color'/>")[0];t._cachedResult="color"===i.type&&""!==i.value}return t._cachedResult},e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){var t=e("input[type=color]");t.length&&!e.fn.spectrum.inputTypeColorSupport()&&t.spectrum({preferredFormat:"hex6"})},function(){function e(e,t,i){e=b(e,255),t=b(t,255),i=b(i,255);var s,a=T(e,t,i),n=(a+(o=k(e,t,i)))/2;if(a==o)s=o=0;else{var r=a-o,o=.5<n?r/(2-a-o):r/(a+o);switch(a){case e:s=(t-i)/r+(t<i?6:0);break;case t:s=(i-e)/r+2;break;case i:s=(e-t)/r+4}s/=6}return{h:s,s:o,l:n}}function t(e,t,i){e=b(e,255),t=b(t,255),i=b(i,255);var s,a=T(e,t,i),n=k(e,t,i),r=a-n;if(a==n)s=0;else{switch(a){case e:s=(t-i)/r+(t<i?6:0);break;case t:s=(i-e)/r+2;break;case i:s=(e-t)/r+4}s/=6}return{h:s,s:0===a?0:r/a,v:a}}function i(e,t,i,s){return e=[y(_(e).toString(16)),y(_(t).toString(16)),y(_(i).toString(16))],s&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function s(e,t,i,s){return[y(Math.round(255*parseFloat(s)).toString(16)),y(_(e).toString(16)),y(_(t).toString(16)),y(_(i).toString(16))].join("")}function a(e,t){t=0===t?0:t||10;var i=M(e).toHsl();return i.s-=t/100,i.s=k(1,T(0,i.s)),M(i)}function n(e,t){t=0===t?0:t||10;var i=M(e).toHsl();return i.s+=t/100,i.s=k(1,T(0,i.s)),M(i)}function r(e){return M(e).desaturate(100)}function o(e,t){t=0===t?0:t||10;var i=M(e).toHsl();return i.l+=t/100,i.l=k(1,T(0,i.l)),M(i)}function l(e,t){t=0===t?0:t||10;var i=M(e).toRgb();return i.r=T(0,k(255,i.r-_(-t/100*255))),i.g=T(0,k(255,i.g-_(-t/100*255))),i.b=T(0,k(255,i.b-_(-t/100*255))),M(i)}function c(e,t){t=0===t?0:t||10;var i=M(e).toHsl();return i.l-=t/100,i.l=k(1,T(0,i.l)),M(i)}function h(e,t){var i=M(e).toHsl(),s=(_(i.h)+t)%360;return i.h=0>s?360+s:s,M(i)}function u(e){return(e=M(e).toHsl()).h=(e.h+180)%360,M(e)}function d(e){var t=M(e).toHsl(),i=t.h;return[M(e),M({h:(i+120)%360,s:t.s,l:t.l}),M({h:(i+240)%360,s:t.s,l:t.l})]}function p(e){var t=M(e).toHsl(),i=t.h;return[M(e),M({h:(i+90)%360,s:t.s,l:t.l}),M({h:(i+180)%360,s:t.s,l:t.l}),M({h:(i+270)%360,s:t.s,l:t.l})]}function f(e){var t=M(e).toHsl(),i=t.h;return[M(e),M({h:(i+72)%360,s:t.s,l:t.l}),M({h:(i+216)%360,s:t.s,l:t.l})]}function g(e,t,i){t=t||6,i=i||30;var s=M(e).toHsl();for(i=360/i,e=[M(e)],s.h=(s.h-(i*t>>1)+720)%360;--t;)s.h=(s.h+i)%360,e.push(M(s));return e}function m(e,t){t=t||6;for(var i=(a=M(e).toHsv()).h,s=a.s,a=a.v,n=[],r=1/t;t--;)n.push(M({h:i,s:s,v:a})),a=(a+r)%1;return n}function v(e){return e=parseFloat(e),(isNaN(e)||0>e||1<e)&&(e=1),e}function b(e,t){var i=e;return"string"==typeof i&&-1!=i.indexOf(".")&&1===parseFloat(i)&&(e="100%"),i="string"==typeof e&&-1!=e.indexOf("%"),e=k(t,T(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),1e-6>A.abs(e-t)?1:e%t/parseFloat(t)}function y(e){return 1==e.length?"0"+e:""+e}function x(e){return 1>=e&&(e=100*e+"%"),e}var w=/^[\s,#]+/,S=/\s+$/,C=0,A=Math,_=A.round,k=A.min,T=A.max,I=A.random,M=function(e,t){var i,s,a,n,r;if(t=t||{},(e=e||"")instanceof M)return e;if(!(this instanceof M))return new M(e,t);r={r:0,g:0,b:0};var o=1;if(a=i=!1,"string"==typeof(s=e))e:{s=s.replace(w,"").replace(S,"").toLowerCase();var l=!1;if(O[s])s=O[s],l=!0;else if("transparent"==s){s={r:0,g:0,b:0,a:0,format:"name"};break e}s=(n=D.rgb.exec(s))?{r:n[1],g:n[2],b:n[3]}:(n=D.rgba.exec(s))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=D.hsl.exec(s))?{h:n[1],s:n[2],l:n[3]}:(n=D.hsla.exec(s))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=D.hsv.exec(s))?{h:n[1],s:n[2],v:n[3]}:(n=D.hsva.exec(s))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=D.hex8.exec(s))?{a:parseInt(n[1],16)/255,r:parseInt(n[2],16),g:parseInt(n[3],16),b:parseInt(n[4],16),format:l?"name":"hex8"}:(n=D.hex6.exec(s))?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16),format:l?"name":"hex"}:!!(n=D.hex3.exec(s))&&{r:parseInt(n[1]+""+n[1],16),g:parseInt(n[2]+""+n[2],16),b:parseInt(n[3]+""+n[3],16),format:l?"name":"hex"}}if("object"==typeof s){if(s.hasOwnProperty("r")&&s.hasOwnProperty("g")&&s.hasOwnProperty("b"))r=s.g,i=s.b,r={r:255*b(s.r,255),g:255*b(r,255),b:255*b(i,255)},i=!0,a="%"===String(s.r).substr(-1)?"prgb":"rgb";else if(s.hasOwnProperty("h")&&s.hasOwnProperty("s")&&s.hasOwnProperty("v")){s.s=x(s.s),s.v=x(s.v),l=s.s,r=s.v,a=6*b(a=s.h,360),l=b(l,100),r=b(r,100);var c=a-(i=A.floor(a));r={r:255*[r,n=r*(1-c*l),a=r*(1-l),a,l=r*(1-(1-c)*l),r][i%=6],g:255*[l,r,r,n,a,a][i],b:255*[a,a,l,r,r,n][i]},i=!0,a="hsv"}else s.hasOwnProperty("h")&&s.hasOwnProperty("s")&&s.hasOwnProperty("l")&&(s.s=x(s.s),s.l=x(s.l),r=function(e,t,i){function s(e,t,i){return 0>i&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:.5>i?t:i<2/3?e+(t-e)*(2/3-i)*6:e}if(e=b(e,360),t=b(t,100),i=b(i,100),0===t)i=t=e=i;else{var a=.5>i?i*(1+t):i+t-i*t,n=2*i-a;i=s(n,a,e+1/3),t=s(n,a,e),e=s(n,a,e-1/3)}return{r:255*i,g:255*t,b:255*e}}(s.h,s.s,s.l),i=!0,a="hsl");s.hasOwnProperty("a")&&(o=s.a)}o=v(o),s=s.format||a,a=k(255,T(r.r,0)),n=k(255,T(r.g,0)),r=k(255,T(r.b,0)),this._originalInput=e,this._r=a,this._g=n,this._b=r,this._a=o,this._roundA=_(100*this._a)/100,this._format=t.format||s,this._gradientType=t.gradientType,1>this._r&&(this._r=_(this._r)),1>this._g&&(this._g=_(this._g)),1>this._b&&(this._b=_(this._b)),this._ok=i,this._tc_id=C++};M.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=v(e),this._roundA=_(100*this._a)/100,this},toHsv:function(){var e=t(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=t(this._r,this._g,this._b),i=_(360*e.h),s=_(100*e.s);return e=_(100*e.v),1==this._a?"hsv("+i+", "+s+"%, "+e+"%)":"hsva("+i+", "+s+"%, "+e+"%, "+this._roundA+")"},toHsl:function(){var t=e(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=e(this._r,this._g,this._b),i=_(360*t.h),s=_(100*t.s);return t=_(100*t.l),1==this._a?"hsl("+i+", "+s+"%, "+t+"%)":"hsla("+i+", "+s+"%, "+t+"%, "+this._roundA+")"},toHex:function(e){return i(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return s(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:_(this._r),g:_(this._g),b:_(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+_(this._r)+", "+_(this._g)+", "+_(this._b)+")":"rgba("+_(this._r)+", "+_(this._g)+", "+_(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:_(100*b(this._r,255))+"%",g:_(100*b(this._g,255))+"%",b:_(100*b(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+_(100*b(this._r,255))+"%, "+_(100*b(this._g,255))+"%, "+_(100*b(this._b,255))+"%)":"rgba("+_(100*b(this._r,255))+"%, "+_(100*b(this._g,255))+"%, "+_(100*b(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(1>this._a)&&(P[i(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+s(this._r,this._g,this._b,this._a),i=t,a=this._gradientType?"GradientType = 1, ":"";return e&&(i=M(e).toHex8String()),"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1;return t||!(1>this._a&&0<=this._a)||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"name"!==e?("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(o,arguments)},brighten:function(){return this._applyModification(l,arguments)},darken:function(){return this._applyModification(c,arguments)},desaturate:function(){return this._applyModification(a,arguments)},saturate:function(){return this._applyModification(n,arguments)},greyscale:function(){return this._applyModification(r,arguments)},spin:function(){return this._applyModification(h,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(g,arguments)},complement:function(){return this._applyCombination(u,arguments)},monochromatic:function(){return this._applyCombination(m,arguments)},splitcomplement:function(){return this._applyCombination(f,arguments)},triad:function(){return this._applyCombination(d,arguments)},tetrad:function(){return this._applyCombination(p,arguments)}},M.fromRatio=function(e,t){if("object"==typeof e){var i,s={};for(i in e)e.hasOwnProperty(i)&&(s[i]="a"===i?e[i]:x(e[i]));e=s}return M(e,t)},M.equals=function(e,t){return!(!e||!t)&&M(e).toRgbString()==M(t).toRgbString()},M.random=function(){return M.fromRatio({r:I(),g:I(),b:I()})},M.mix=function(e,t,i){var s,a;return i=0===i?0:i||50,e=M(e).toRgb(),t=M(t).toRgb(),M({r:t.r*(s=((-1==(s=2*(i/=100)-1)*(a=t.a-e.a)?s:(s+a)/(1+s*a))+1)/2)+e.r*(a=1-s),g:t.g*s+e.g*a,b:t.b*s+e.b*a,a:t.a*i+e.a*(1-i)})},M.readability=function(e,t){var i=M(e),s=M(t),a=i.toRgb(),n=s.toRgb();return i=i.getBrightness(),s=s.getBrightness(),{brightness:Math.abs(i-s),color:Math.max(a.r,n.r)-Math.min(a.r,n.r)+Math.max(a.g,n.g)-Math.min(a.g,n.g)+Math.max(a.b,n.b)-Math.min(a.b,n.b)}},M.isReadable=function(e,t){var i=M.readability(e,t);return 125<i.brightness&&500<i.color},M.mostReadable=function(e,t){for(var i=null,s=0,a=!1,n=0;n<t.length;n++){var r=125<(o=M.readability(e,t[n])).brightness&&500<o.color,o=o.brightness/125*3+o.color/500;(r&&!a||r&&a&&o>s||!r&&!a&&o>s)&&(a=r,s=o,i=M(t[n]))}return i};var O=M.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},P=M.hexNames=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[e[t]]=t);return i}(O),D={rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsva:/hsva[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};window.tinycolor=M}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})}),function(e){function t(i,s){var a,n,r,o,l;if(s=s||{},(i=i||"")instanceof t)return i;if(!(this instanceof t))return new t(i,s);l={r:0,g:0,b:0};var c=1;if(r=a=!1,"string"==typeof(n=i))e:{n=n.replace(A,"").replace(_,"").toLowerCase();var h=!1;if(P[n])n=P[n],h=!0;else if("transparent"==n){n={r:0,g:0,b:0,a:0,format:"name"};break e}n=(o=J.rgb.exec(n))?{r:o[1],g:o[2],b:o[3]}:(o=J.rgba.exec(n))?{r:o[1],g:o[2],b:o[3],a:o[4]}:(o=J.hsl.exec(n))?{h:o[1],s:o[2],l:o[3]}:(o=J.hsla.exec(n))?{h:o[1],s:o[2],l:o[3],a:o[4]}:(o=J.hsv.exec(n))?{h:o[1],s:o[2],v:o[3]}:(o=J.hsva.exec(n))?{h:o[1],s:o[2],v:o[3],a:o[4]}:(o=J.hex8.exec(n))?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16),a:parseInt(o[4],16)/255,format:h?"name":"hex8"}:(o=J.hex6.exec(n))?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16),format:h?"name":"hex"}:(o=J.hex4.exec(n))?{r:parseInt(o[1]+""+o[1],16),g:parseInt(o[2]+""+o[2],16),b:parseInt(o[3]+""+o[3],16),a:parseInt(o[4]+""+o[4],16)/255,format:h?"name":"hex8"}:!!(o=J.hex3.exec(n))&&{r:parseInt(o[1]+""+o[1],16),g:parseInt(o[2]+""+o[2],16),b:parseInt(o[3]+""+o[3],16),format:h?"name":"hex"}}if("object"==typeof n){if(C(n.r)&&C(n.g)&&C(n.b))l=n.g,a=n.b,l={r:255*x(n.r,255),g:255*x(l,255),b:255*x(a,255)},a=!0,r="%"===String(n.r).substr(-1)?"prgb":"rgb";else if(C(n.h)&&C(n.s)&&C(n.v)){a=l=S(n.s),l=r=S(n.v),o=6*x(o=n.h,360),a=x(a,100),l=x(l,100);var u=o-(r=e.floor(o));l={r:255*[l,h=l*(1-u*a),o=l*(1-a),o,a=l*(1-(1-u)*a),l][r%=6],g:255*[a,l,l,h,o,o][r],b:255*[o,o,a,l,l,h][r]},a=!0,r="hsv"}else C(n.h)&&C(n.s)&&C(n.l)&&(l=S(n.s),a=S(n.l),l=function(e,t,i){function s(e,t,i){return 0>i&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:.5>i?t:i<2/3?e+(t-e)*(2/3-i)*6:e}if(e=x(e,360),t=x(t,100),i=x(i,100),0===t)i=t=e=i;else{var a=.5>i?i*(1+t):i+t-i*t,n=2*i-a;i=s(n,a,e+1/3),t=s(n,a,e),e=s(n,a,e-1/3)}return{r:255*i,g:255*t,b:255*e}}(n.h,l,a),a=!0,r="hsl");n.hasOwnProperty("a")&&(c=n.a)}c=y(c),n=n.format||r,r=I(255,M(l.r,0)),o=I(255,M(l.g,0)),l=I(255,M(l.b,0)),this._originalInput=i,this._r=r,this._g=o,this._b=l,this._a=c,this._roundA=T(100*this._a)/100,this._format=s.format||n,this._gradientType=s.gradientType,1>this._r&&(this._r=T(this._r)),1>this._g&&(this._g=T(this._g)),1>this._b&&(this._b=T(this._b)),this._ok=a,this._tc_id=k++}function i(e,t,i){e=x(e,255),t=x(t,255),i=x(i,255);var s,a=M(e,t,i),n=(a+(o=I(e,t,i)))/2;if(a==o)s=o=0;else{var r=a-o,o=.5<n?r/(2-a-o):r/(a+o);switch(a){case e:s=(t-i)/r+(t<i?6:0);break;case t:s=(i-e)/r+2;break;case i:s=(e-t)/r+4}s/=6}return{h:s,s:o,l:n}}function s(e,t,i){e=x(e,255),t=x(t,255),i=x(i,255);var s,a=M(e,t,i),n=I(e,t,i),r=a-n;if(a==n)s=0;else{switch(a){case e:s=(t-i)/r+(t<i?6:0);break;case t:s=(i-e)/r+2;break;case i:s=(e-t)/r+4}s/=6}return{h:s,s:0===a?0:r/a,v:a}}function a(e,t,i,s){return e=[w(T(e).toString(16)),w(T(t).toString(16)),w(T(i).toString(16))],s&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function n(t,i,s,a){return[w(e.round(255*parseFloat(a)).toString(16)),w(T(t).toString(16)),w(T(i).toString(16)),w(T(s).toString(16))].join("")}function r(e,i){i=0===i?0:i||10;var s=t(e).toHsl();return s.s-=i/100,s.s=I(1,M(0,s.s)),t(s)}function o(e,i){i=0===i?0:i||10;var s=t(e).toHsl();return s.s+=i/100,s.s=I(1,M(0,s.s)),t(s)}function l(e){return t(e).desaturate(100)}function c(e,i){i=0===i?0:i||10;var s=t(e).toHsl();return s.l+=i/100,s.l=I(1,M(0,s.l)),t(s)}function h(e,i){i=0===i?0:i||10;var s=t(e).toRgb();return s.r=M(0,I(255,s.r-T(-i/100*255))),s.g=M(0,I(255,s.g-T(-i/100*255))),s.b=M(0,I(255,s.b-T(-i/100*255))),t(s)}function u(e,i){i=0===i?0:i||10;var s=t(e).toHsl();return s.l-=i/100,s.l=I(1,M(0,s.l)),t(s)}function d(e,i){var s=t(e).toHsl(),a=(s.h+i)%360;return s.h=0>a?360+a:a,t(s)}function p(e){return(e=t(e).toHsl()).h=(e.h+180)%360,t(e)}function f(e){var i=t(e).toHsl(),s=i.h;return[t(e),t({h:(s+120)%360,s:i.s,l:i.l}),t({h:(s+240)%360,s:i.s,l:i.l})]}function g(e){var i=t(e).toHsl(),s=i.h;return[t(e),t({h:(s+90)%360,s:i.s,l:i.l}),t({h:(s+180)%360,s:i.s,l:i.l}),t({h:(s+270)%360,s:i.s,l:i.l})]}function m(e){var i=t(e).toHsl(),s=i.h;return[t(e),t({h:(s+72)%360,s:i.s,l:i.l}),t({h:(s+216)%360,s:i.s,l:i.l})]}function v(e,i,s){i=i||6,s=s||30;var a=t(e).toHsl();for(s=360/s,e=[t(e)],a.h=(a.h-(s*i>>1)+720)%360;--i;)a.h=(a.h+s)%360,e.push(t(a));return e}function b(e,i){i=i||6;for(var s=(n=t(e).toHsv()).h,a=n.s,n=n.v,r=[],o=1/i;i--;)r.push(t({h:s,s:a,v:n})),n=(n+o)%1;return r}function y(e){return e=parseFloat(e),(isNaN(e)||0>e||1<e)&&(e=1),e}function x(t,i){var s=t;return"string"==typeof s&&-1!=s.indexOf(".")&&1===parseFloat(s)&&(t="100%"),s="string"==typeof t&&-1!=t.indexOf("%"),t=I(i,M(0,parseFloat(t))),s&&(t=parseInt(t*i,10)/100),1e-6>e.abs(t-i)?1:t%i/parseFloat(i)}function w(e){return 1==e.length?"0"+e:""+e}function S(e){return 1>=e&&(e=100*e+"%"),e}function C(e){return!!J.CSS_UNIT.exec(e)}var A=/^\s+/,_=/\s+$/,k=0,T=e.round,I=e.min,M=e.max,O=e.random;t.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var t,i,s=this.toRgb();return t=s.r/255,i=s.g/255,s=s.b/255,.2126*(t=.03928>=t?t/12.92:e.pow((t+.055)/1.055,2.4))+.7152*(i=.03928>=i?i/12.92:e.pow((i+.055)/1.055,2.4))+.0722*(.03928>=s?s/12.92:e.pow((s+.055)/1.055,2.4))},setAlpha:function(e){return this._a=y(e),this._roundA=T(100*this._a)/100,this},toHsv:function(){var e=s(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=s(this._r,this._g,this._b),t=T(360*e.h),i=T(100*e.s);return e=T(100*e.v),1==this._a?"hsv("+t+", "+i+"%, "+e+"%)":"hsva("+t+", "+i+"%, "+e+"%, "+this._roundA+")"},toHsl:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=i(this._r,this._g,this._b),t=T(360*e.h),s=T(100*e.s);return e=T(100*e.l),1==this._a?"hsl("+t+", "+s+"%, "+e+"%)":"hsla("+t+", "+s+"%, "+e+"%, "+this._roundA+")"},toHex:function(e){return a(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(t){var i=this._g,s=this._b,a=this._a;return i=[w(T(this._r).toString(16)),w(T(i).toString(16)),w(T(s).toString(16)),w(e.round(255*parseFloat(a)).toString(16))],t&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:T(this._r),g:T(this._g),b:T(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+T(this._r)+", "+T(this._g)+", "+T(this._b)+")":"rgba("+T(this._r)+", "+T(this._g)+", "+T(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:T(100*x(this._r,255))+"%",g:T(100*x(this._g,255))+"%",b:T(100*x(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+T(100*x(this._r,255))+"%, "+T(100*x(this._g,255))+"%, "+T(100*x(this._b,255))+"%)":"rgba("+T(100*x(this._r,255))+"%, "+T(100*x(this._g,255))+"%, "+T(100*x(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(1>this._a)&&(D[a(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var i="#"+n(this._r,this._g,this._b,this._a),s=i,a=this._gradientType?"GradientType = 1, ":"";return e&&(s="#"+n((e=t(e))._r,e._g,e._b,e._a)),"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+i+",endColorstr="+s+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1;return t||!(1>this._a&&0<=this._a)||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex4"===e&&(i=this.toHex8String(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return t(this.toString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(c,arguments)},brighten:function(){return this._applyModification(h,arguments)},darken:function(){return this._applyModification(u,arguments)},desaturate:function(){return this._applyModification(r,arguments)},saturate:function(){return this._applyModification(o,arguments)},greyscale:function(){return this._applyModification(l,arguments)},spin:function(){return this._applyModification(d,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(v,arguments)},complement:function(){return this._applyCombination(p,arguments)},monochromatic:function(){return this._applyCombination(b,arguments)},splitcomplement:function(){return this._applyCombination(m,arguments)},triad:function(){return this._applyCombination(f,arguments)},tetrad:function(){return this._applyCombination(g,arguments)}},t.fromRatio=function(e,i){if("object"==typeof e){var s,a={};for(s in e)e.hasOwnProperty(s)&&(a[s]="a"===s?e[s]:S(e[s]));e=a}return t(e,i)},t.equals=function(e,i){return!(!e||!i)&&t(e).toRgbString()==t(i).toRgbString()},t.random=function(){return t.fromRatio({r:O(),g:O(),b:O()})},t.mix=function(e,i,s){return s=0===s?0:s||50,e=t(e).toRgb(),i=t(i).toRgb(),t({r:(i.r-e.r)*(s/=100)+e.r,g:(i.g-e.g)*s+e.g,b:(i.b-e.b)*s+e.b,a:(i.a-e.a)*s+e.a})},t.readability=function(i,s){var a=t(i),n=t(s);return(e.max(a.getLuminance(),n.getLuminance())+.05)/(e.min(a.getLuminance(),n.getLuminance())+.05)},t.isReadable=function(e,i,s){var a;switch(e=t.readability(e,i),i=!1,"AA"!==(s=((a=s||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==s&&(s="AA"),"small"!==(a=(a.size||"small").toLowerCase())&&"large"!==a&&(a="small"),s+a){case"AAsmall":case"AAAlarge":i=4.5<=e;break;case"AAlarge":i=3<=e;break;case"AAAsmall":i=7<=e}return i},t.mostReadable=function(e,i,s){var a,n,r,o,l=null,c=0;n=(s=s||{}).includeFallbackColors,r=s.level,o=s.size;for(var h=0;h<i.length;h++)(a=t.readability(e,i[h]))>c&&(c=a,l=t(i[h]));return t.isReadable(e,l,{level:r,size:o})||!n?l:(s.includeFallbackColors=!1,t.mostReadable(e,["#fff","#000"],s))};var P=t.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},D=t.hexNames=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[e[t]]=t);return i}(P),J={CSS_UNIT:/(?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?)/,rgb:/rgb[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,rgba:/rgba[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsl:/hsl[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsla:/hsla[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsv:/hsv[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hsva:/hsva[\s|\(]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))[,|\s]+((?:[-\+]?\d*\.\d+%?)|(?:[-\+]?\d+%?))\s*\)?/,hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):window.tinycolor=t}(Math),($jscomp={scope:{}}).defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){if(i.get||i.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[t]=i.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.symbolCounter_=0,$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++},$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.arrayIterator=function(e){var t=0;return $jscomp.iteratorPrototype(function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}})},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.array=$jscomp.array||{},$jscomp.iteratorFromArray=function(e,t){$jscomp.initSymbolIterator(),e instanceof String&&(e+="");var i=0,s={next:function(){if(i<e.length){var a=i++;return{value:t(a,e[a]),done:!1}}return s.next=function(){return{done:!0,value:void 0}},s.next()}};return s[Symbol.iterator]=function(){return s},s},$jscomp.polyfill=function(e,t,i,s){if(t){for(i=$jscomp.global,e=e.split("."),s=0;s<e.length-1;s++){var a=e[s];a in i||(i[a]={}),i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&$jscomp.defineProperty(i,e,{configurable:!0,writable:!0,value:t})}},$jscomp.polyfill("Array.prototype.keys",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3"),$jscomp.polyfill("Math.asinh",function(e){return e||function(e){if(0===(e=Number(e)))return e;var t=Math.log(Math.abs(e)+Math.sqrt(e*e+1));return 0>e?-t:t}},"es6-impl","es3"),$jscomp.polyfill("Math.sinh",function(e){if(e)return e;var t=Math.exp;return function(e){return 0===(e=Number(e))?e:(t(e)-t(-e))/2}},"es6-impl","es3"),$jscomp.findInternal=function(e,t,i){e instanceof String&&(e=String(e));for(var s=e.length,a=0;a<s;a++){var n=e[a];if(t.call(i,n,a,e))return{i:a,v:n}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}},"es6-impl","es3"),$jscomp.polyfill("Array.prototype.fill",function(e){return e||function(e,t,i){var s=this.length||0;for(0>t&&(t=Math.max(0,s+t)),(null==i||i>s)&&(i=s),0>(i=Number(i))&&(i=Math.max(0,s+i)),t=Number(t||0);t<i;t++)this[t]=e;return this}},"es6-impl","es3"),$jscomp.polyfill("Math.log10",function(e){return e||function(e){return Math.log(e)/Math.LN10}},"es6-impl","es3"),"object"!=typeof Module&&(Module={}),JS9=function(){var e={NAME:"JS9",VERSION:"2.3",COPYRIGHT:"Copyright (c) 2012-2019 Smithsonian Institution",DEFID:"JS9",WIDTH:512,HEIGHT:512,ANON:"Anonymous",PREFSFILE:"js9Prefs.json",WORKERFILE:"js9worker.js",ZINDEX:0,SHAPEZINDEX:4,MESSZINDEX:80,BTNZINDEX:90,MENUZINDEX:1e3,COLORSIZE:1024,SCALESIZE:16384,INVSIZE:1024,HISTSIZE:16384,INSTALLDIR:"",TOROOT:"",PLUGINS:"",LIGHTWIN:"dhtml",ANTIALIAS:!1,SCALEIREG:!0,NOMOVE:3,DBLCLICK:300,TIMEOUT:250,SPINOUT:250,SUPERMENU:/^SUPERMENU_/,RESIZEDIST:20,RESIZEFUDGE:5,RAWID0:"raw0",RAWIDX:"alt",IDFMT:"  (%s)",MINZOOM:.125,MAXZOOM:32,ADDZOOM:.1,CHROMEFILEWARNING:!0,CLIPBOARDERROR:"the local clipboard (which only holds data copied from within JS9) does not contain any content. Were you trying to paste something copied outside JS9?",CLIPBOARDERROR2:"the local clipboard (which only holds data copied from within JS9) does not contain any regions",URLEXP:/^(https?|ftp):\/\//};return e.TOUCHSUPPORTED=window.hasOwnProperty("ontouchstart")||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints,e.BROWSER=function(){var e,t=navigator.platform,i=navigator.appName,s=navigator.userAgent,a=s.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);return e=s.match(/version\/([\.\d]+)/i),a&&null!==e&&(a[2]=e[1]),(a=a?[a[1],a[2],t]:[i,navigator.appVersion,"-?",t]).push(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(s)),a}(),e.PIXEL_RATIO=function(){var e=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}(),e.globalOpts={helperType:"none",helperPort:2718,requireHelper:!1,allinoneHelper:!1,requireFits2Fits:!1,quietReturn:!1,useWasm:!0,allowFileWasm:!1,winType:"light",rgb:{active:!1,rim:null,gim:null,bim:null},defcolor:"#00FF00",pngisfits:!0,fits2fits:"never",fits2png:!1,prependJS9Dir:!0,dataDir:null,alerts:!0,valposTarget:null,valposWidth:"medium",internalValPos:!0,internalContrastBias:!0,containContrastBias:!1,wcsCrosshair:!1,regionsToClipboard:!0,magnifierRegions:!0,pannerDirections:!0,htimeout:1e4,lhtimeout:1e4,ehtimeout:5e3,ehretries:10,xtimeout:18e4,extlist:"EVENTS STDEVT",imopts:"IMOPTS",imcmap:"IMCMAP",table:{xdim:4096,ydim:4096,bin:1},image:{xdim:4096,ydim:4096,bin:1},reproj:{xdim:4096,ydim:4096},reprojSwitches:"",binMode:"s",clearImageMemory:"heap",helperProtocol:location.protocol,reloadRefresh:!1,reloadRefreshReg:!0,panWithinDisplay:!1,svgBorder:!0,unremoveReg:100,maxMemory:75e7,corsURL:"params/loadcors.html",proxyURL:"params/loadproxy.html",loadProxy:!1,imsectionURL:"params/imsection.html",postMessage:!1,waitType:"spinner",spinColor:"#FF0000",spinOpacity:.35,resize:!0,resizeHandle:!0,resizeRedisplay:!0,cloneNewDisplay:!0,logoDisplay:!1,lightWinClose:"ask",regionDisplay:"lightwin",regionConfigSize:"medium",refreshDragDrop:!0,reduceMosaic:"js9",reduceRegcnts:!0,plot3d:{cube:"*:*:all",mode:"avg",areaunits:"pixels",color:"green"},imexamLineHeight:1,copyWcsPosFormat:"$ra $dec $sys",floatPrecision:6,mouseActions:["display value/position","change contrast/bias","pan the image"],touchActions:["display value/position","change contrast/bias","pan the image"],keyboardActions:{b:"toggle selected region: source/background",c:"toggle crosshair",d:"send selected region to back",e:"toggle selected region: include/exclude","M-e":"edit selected region",i:"refresh image",I:"display full image","M-i":"display selected cutouts","M-k":"toggle keyboard actions plugin",l:"toggle active shape layers","M-l":"new JS9 light window","M-m":"toggle mouse/touch plugin","M-o":"open local file",P:"paste regions from local clipboard",p:"paste regions to current position",u:"undo remove of region(s)","M-,":"toggle preferences plugin","M-p":"toggle preferences plugin",r:"copy selected region to clipboard",R:"copy all regions to clipboard",s:"select region",S:"select all regions","M-s":"toggle shape layers plugin","/":"copy wcs position to clipboard","?":"copy value and position to clipboard",0:"reset zoom","=":"zoom in","+":"zoom in","-":"zoom out","^":"raise region layer to top",">":"display next image","<":"display previous image",delete:"remove selected region",leftArrow:"move region/position left",upArrow:"move region/position up",rightArrow:"move region/position right",downArrow:"move region/position down"},mousetouchZoom:!0,toolbarTooltips:!1,centerDivs:["JS9Menubar"],resizeDivs:["JS9Menubar","JS9Colorbar","JS9Toolbar"],pinchWait:8,pinchThresh:6,xeqPlugins:!0,extendedPlugins:!0,intensivePlugins:!1,dynamicSelect:"click",dynamicHighlight:!0,corsProxy:"https://js9.si.edu/cgi-bin/CORS-proxy.cgi",simbadProxy:"https://js9.si.edu/cgi-bin/simbad-proxy.cgi",catalogs:{ras:["RA","_RAJ2000","RAJ2000"],decs:["Dec","_DEJ2000","DEJ2000"],shape:"circle",color:"yellow",width:7,height:7,radius:3.5,r1:5,r2:3.5,wcssys:"ICRS",skip:"#\n",save:!0,tooltip:"$xreg.data.ra $xreg.data.dec"},topColormaps:"grey heat cool viridis magma sls red green blue".split(" "),infoBox:"file object wcsfov wcscen wcspos impos physpos value regions progress".split(" "),infoBoxResize:!0,menuBar:"file edit view zoom scale color region wcs analysis help".split(" "),menubarStyle:"classic",userMenus:!1,userMenuDivider:"",imagesFileSubmenu:5,toolBar:"annulus box circle ellipse line polygon text linear log zoom+ zoom- zoom1".split(" "),syncOps:"colormap contrastbias pan regions scale wcs zoom".split(" "),syncReciprocate:!0,hiddenPluginDivs:[],separate:{layout:"auto",leftMargin:10,topMargin:10},imageTemplates:".fits,.fts,.png,.jpg,.jpeg,.fz",wcsUnits:{FK4:"sexagesimal",FK5:"sexagesimal",ICRS:"sexagesimal",galactic:"degrees",ecliptic:"degrees",linear:"degrees",physical:"pixels",image:"pixels"},regionTemplates:".reg",sessionTemplates:".ses,.js9ses",colormapTemplates:".cmap",catalogTemplates:".cat,.tab",localTemplates:".fits,.fts",controlsMatchRegion:!1,internalColorPicker:!0,newWindowWidth:530,newWindowHeight:625,debug:0},e.desktopOpts={currentPath:!0,sessionPath:!0},e.imageOpts={inherit:!1,contrast:1,bias:.5,invert:!1,exp:1e3,colormap:"grey",scale:"linear",scaleclipping:"dataminmax",scalemin:Number.NaN,scalemax:Number.NaN,zscalecontrast:.25,zscalesamples:600,zscaleline:120,wcssys:"native",lcs:"physical",valpos:!0,opacity:1,sigma:"none",maskOpacity:.4,alpha:255,alpha1:100,zoom:1,zooms:5,nancolor:"#000000",wcsalign:!0,rotationMode:"relative",crosshair:!1,disable:[],ltvbug:!0,listonchange:!1,whichonchange:"selected"},e.regionOpts={},e.catalogOpts={},e.crosshairOpts={},e.gridOpts={},e.emscriptenOpts={},e.blendOpts={active:!0,mode:"screen",opacity:1},e.analOpts={epattern:/^(ERROR:[^\n]*)\n/,dpathURL:"params/datapath.html",fpathURL:"params/filepath.html"},e.lightOpts={nclick:0,dhtml:{top:".dhtmlwindow",drag:".drag-contentarea",dragBar:"drag-handle",format:"width=%spx,height=%spx,center=1,resize=%s,scrolling=0",textWin:"width=830px,height=400px,center=1,resize=1,scrolling=1",plotWin:"width=830px,height=420px,center=1,resize=1,scrolling=1",dpathWin:"width=830px,height=175px,center=1,resize=1,scrolling=1",lcloseWin:"width=512px,height=190px,center=1,resize=1,scrolling=1",paramWin:"width=830px,height=235px,center=1,resize=1,scrolling=1",regWin0:"width=600px,height=72px,center=1,resize=1,scrolling=1",regWin:"width=600px,height=235px,center=1,resize=1,scrolling=1",imageWin:"width=512px,height=598px,center=1,resize=1,scrolling=1",lineWin:"width=400px,height=60px,center=1,resize=1,scrolling=1"},lcloseURL:"params/lightclose.html"},e.textColorOpts={regions:"#00FF00",info:"#00FF00",inimage:"#000000"},e.plotOpts={annotate:!1,annotateColor:"#FF0000",color:"blue",zoomStack:{enabled:!0},selection:{mode:"xy"},series:{clickable:!0,hoverable:!0,lines:{show:!0},points:{show:!1}},legend:{backgroundColor:null,backgroundOpacity:0},xaxis:{autorange:!0},yaxis:{autorange:!0}},e.helpOpts={user:{heading:"JS9Help",type:"help",url:"user.html",title:"User Manual"},install:{heading:"JS9Help",type:"help",url:"install.html",title:"Installing JS9"},webpage:{heading:"JS9Help",type:"help",url:"webpage.html",title:"Adding JS9 To A Web Page"},yourdata:{heading:"JS9Help",type:"help",url:"yourdata.html",title:"Adding Data To A Web Page"},localtasks:{heading:"JS9Help",type:"help",url:"localtasks.html",title:"Adding Local Analysis Tasks and Plugins"},helper:{heading:"JS9Help",type:"help",url:"helper.html",title:"Adding Server-side Analysis Tasks"},serverside:{heading:"JS9Help",type:"help",url:"serverside.html",title:"Server-side Analysis with JS9"},publicapi:{heading:"JS9Help",type:"help",url:"publicapi.html",title:"The JS9 Public API"},extmsg:{heading:"JS9Help",type:"help",url:"extmsg.html",title:"External Messaging"},desktop:{heading:"JS9Help",type:"help",url:"desktop.html",title:"JS9 on the Desktop"},python:{heading:"JS9Help",type:"help",url:"python.html",title:"JS9 with Python and Jupyter"},archives:{heading:"JS9Help",type:"help",url:"archives.html",title:"Accessing Data Archives"},preferences:{heading:"JS9Help",type:"help",url:"preferences.html",title:"Setting Site Preferences"},regions:{heading:"JS9Help",type:"help",url:"regions.html",title:"Regions Format"},changelog:{heading:"JS9Help",type:"help",url:"changelog.html",title:"ChangeLog"},repfile:{heading:"JS9Help",type:"help",url:"repfile.html",title:"Dealing with Large Files"},memory:{heading:"JS9Help",type:"help",url:"memory.html",title:"Dealing with Memory Limitations"},issues:{heading:"JS9Help",type:"help",url:"knownissues.html",title:"Known Issues"}},e.images=[],e.displays=[],e.colormaps=[],e.commands=[],e.plugins=[],e.preloads=[],e.auxFiles=[],e.supermenus=[],e.publics={},e.helper={},e.fits={},e.userOpts={},e.preloadwaiting={},e.scales="linear log histeq power sqrt squared asinh sinh".split(" "),e.wcssyss="FK4 FK5 ICRS galactic ecliptic native image physical".split(" "),e.wcsunitss=["degrees","sexagesimal","pixels"],e.bugs={},e.bugs.hide_menu=!1,"Firefox"===e.BROWSER[0]&&0<=e.BROWSER[2].search(/Linux/)&&(e.bugs.firefox_linux=!0),"Chrome"!==e.BROWSER[0]&&"Safari"!==e.BROWSER[0]||(e.bugs.webkit_resize=!0),"Chrome"!==e.BROWSER[0]&&(e.globalOpts.imageTemplates+=",.gz"),/iPad|iPhone|iPod/.test(navigator.platform)&&/11_2_(?:[2-9])/.test(navigator.userAgent)&&(e.globalOpts.useWasm=!1),e.BROWSER[3]&&(e.globalOpts.maxMemory=Math.min(e.globalOpts.maxMemory,35e7),e.globalOpts.table.xdim=2048,e.globalOpts.table.ydim=2048,e.globalOpts.image.xdim=2048,e.globalOpts.image.ydim=2048,e.imageOpts.crosshair=!1,e.globalOpts.reproj={xdim:2048,ydim:2048}),window.hasOwnProperty("Jupyter")&&(e.globalOpts.useWasm=!1),window.isElectron&&("Chrome"===e.BROWSER[0]&&66<=parseFloat(e.BROWSER[1])&&(e.globalOpts.allowFileWasm=!0),(!window.electronVersion||5>parseInt(window.electronVersion,10))&&(e.globalOpts.internalColorPicker=!1),e.hasNode="object"==typeof process&&"function"==typeof require,e.hasNode&&(e.localMount=require("os").hostname())),e.Image=function(t,i,s){var a,n,r,o=this,l=null,c=0,h=0,u=function(t){e.isNull((t=t||{}).scaleclipping)?"zscale"===this.params.scaleclipping?this.zscale(!0):"zmax"===this.params.scaleclipping&&this.zscale("zmax"):"zscale"===t.scaleclipping?this.zscale(!0):"zmax"===t.scaleclipping&&this.zscale("zmax"),e.notNull(t.scalemin)&&(this.params.scalemin=t.scalemin),e.notNull(t.scalemax)&&(this.params.scalemax=t.scalemax)},d=function(t){var i,s,a,n,r,o=e.globalOpts.imopts,c=e.globalOpts.imcmap;if(this.display.clearMessage(),e.images.push(this),this.notifyHelper(),l&&l.regions&&this.addShapes("regions",l.regions),r=e.globalOpts.alerts,e.globalOpts.alerts=!1,this.raw&&this.raw.header&&this.raw.header[c]){try{a=JSON.parse(this.raw.header[c])}catch(h){a=null}if(a)try{e.AddColormap(a)}catch(h){}}if(this.raw&&this.raw.header&&this.raw.header[c+"1"]){for(i=1,s="";100>i&&(n=c+String(i),this.raw.header[n]);i++)s+=this.raw.header[n];if(s){try{a=JSON.parse(s)}catch(h){a=null}if(a)try{e.AddColormap(a)}catch(h){}}}if(this.raw&&this.raw.header&&this.raw.header[o]){try{a=JSON.parse(this.raw.header[o])}catch(h){a=null}if(a)try{this.setParam("all",a)}catch(h){}}if(this.raw&&this.raw.header&&this.raw.header[o+"1"]){for(i=1,s="";100>i&&(n=o+String(i),this.raw.header[n]);i++)s+=this.raw.header[n];if(s){try{a=JSON.parse(s)}catch(h){a=null}if(a)try{this.setParam("all",a)}catch(h){}}}if(e.globalOpts.alerts=r,this.xeqPlugins("image","onimageload"),this.updateshapes&&this.updateShapes("regions","all","update"),this.status.load="complete",e.waiting(!1),t)try{e.xeqByName(t,window,this)}catch(h){e.error("in image onload callback",h,!1)}if(t=(s=this.proxyURL||this.file).replace(/\[.*\]/,""),(e.preloadwaiting[s]||e.preloadwaiting[t])&&(delete e.preloadwaiting[s],delete e.preloadwaiting[t],!Object.keys(e.preloadwaiting).length&&e.notNull(e.globalOpts.onpreload)))try{e.xeqByName(e.globalOpts.onpreload,window,this)}catch(h){e.error("in onpreload callback",h,!1)}};if(i&&("object"==typeof i?(l=i).display&&(a=l.display):a=i),a||(a=0<e.displays.length?e.displays[0].id:e.DEFID),this.type="image",this.display=e.lookupDisplay(a),this.params={},this.regstack=[],this.tmp={},this.params.xeqonchange=!0,this.params=$.extend(!0,this.params,e.imageOpts,l),this.display.image&&(this.params.inherit=this.display.image.params.inherit,this.params.inherit&&(this.params=$.extend(!0,this.params,this.display.image.params))),i=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setColormap(this.params.colormap),e.globalOpts.xeqPlugins=i,this.displayMode=!0,this.clickState=0,this.clickInRegion=!1,this.clickInLayer=null,this.queried=!1,l&&l.proxyFile&&(this.proxyFile=l.proxyFile),l&&l.proxyURL&&(this.proxyURL=l.proxyURL),l&&l.parentFile&&(this.parentFile=l.parentFile),l&&l.parent&&(this.parent=l.parent,this.parent.cardstr&&this.parent.ncard)){for(this.parent.raw={header:{},history:[],comments:[]},i=0;i<this.parent.ncard;i++)a=this.parent.cardstr.slice(80*i,80*(i+1)),void 0!==(a=e.cardpars(a))&&("HISTORY"===a[0]?this.parent.raw.header[a[0]+"__"+c++]=a[1]:"COMMENT"===a[0]?this.parent.raw.header[a[0]+"__"+h++]=a[1]:this.parent.raw.header[a[0]]=a[1]);this.parent.lcs={},e.Image.prototype.initLCS.call(this.parent,this.parent.raw.header)}if(l&&l.id&&(this.id=l.id),this.iy=this.ix=0,this.png={},this.png.image=new Image,this.status={},this.rgb={},this.rgb.sect={zoom:1,ozoom:1},this.layers={},this.zlayer=e.SHAPEZINDEX,this.lcs={},this.aux={},this.binning={bin:1,obin:1},this.raws=[],this.blend=$.extend(!0,{},e.blendOpts),this.updateshapes=!1,t)switch(e.waiting(!0,this.display),typeof t){case"object":this.source=l.source||"fits",this.mkRawDataFromHDU(t,$.extend({},{file:t.filename},l)),u.call(this,l),this.params.zoom&&(r=this.parseZoom(this.params.zoom),this.rgb.sect.zoom=r,this.rgb.sect.ozoom=r),this.mkSection(),l&&l.rgbFile?(this.rgbFile=l.rgbFile,$(this.png.image).on("load",function(){var t;o.png.image.width===o.raw.width&&o.png.image.height===o.raw.height||(t=sprintf("rgb dims [%s,%s] don't match image [%s,%s]",o.png.image.width,o.png.image.height,o.raw.width,o.raw.height),e.error(t)),o.mkOffScreenCanvas(),o.displayImage("all",l),d.call(o,s)}).on("error",function(){e.waiting(!1),o.status.load="error",e.error("could not load image: "+o.id)}),this.png.image.src=this.rgbFile):(this.displayImage("all",l),d.call(this,s));break;case"string":this.source=l.source||"fits2png",this.imtab="image",this.file=e.cleanPath(t),this.id0=this.file.split("/").reverse()[0],this.id=e.getImageID(this.id0,this.display.id),this.status.load="loading",$(this.png.image).on("load",function(){o.mkOffScreenCanvas(),o.mkRawDataFromPNG(),o.params.zoom&&(r=o.parseZoom(o.params.zoom),o.rgb.sect.zoom=r,o.rgb.sect.ozoom=r),u.call(o,l),o.mkSection(),(n=(function(t){var i=1,s=[];return e.notNull((t=t||{}).bin)&&(i="string"==typeof t.bin?parseInt(t.bin,10):t.bin),e.notNull(t.xcen)&&s.push(t.xcen/i),e.notNull(t.ycen)&&s.push(t.ycen/i),e.notNull(t.zoom)&&(t=this.parseZoom(t.zoom))&&s.push(t),s}).call(l)).length&&o.mkSection.apply(o,n),o.displayImage("all",l),d.call(o,s),e.DEBUG&&e.log("JS9 image: %s dims(%d,%d) min/max(%d,%d)",o.file,o.raw.width,o.raw.height,o.raw.dmin,o.raw.dmax)}).on("error",function(){e.waiting(!1),o.status.load="error",e.error("could not load image: "+o.id)}),this.png.image.src=t;break;default:e.log("unknown specification type for Load: "+typeof t)}},e.Image.prototype.getImageData=function(e){var t=null;if(e)if("array"===e)t=Array.prototype.slice.call(this.raw.data);else if("base64"===e){e="";var i=new Uint8Array(this.raw.data.buffer),s=i.byteLength;for(t=0;t<s;t++)e+=String.fromCharCode(i[t]);t=window.btoa(e)}else e&&"false"!==e&&(t=this.raw.data);return e=this.fileDimensions(),{id:this.id,file:this.file,fits:this.fitsFile||"",source:this.source,imtab:this.imtab,width:this.raw.width,height:this.raw.height,bitpix:this.raw.bitpix,bin:this.binning.bin,header:this.raw.header,hdus:this.hdus,fwidth:e.xdim,fheight:e.ydim,dwidth:this.display.width,dheight:this.display.height,data:t}},e.Image.prototype.closeImage=function(t){var i,s,a,n,r=!1;if(s=e.images.length,"string"==typeof(t=t||{}))try{t=JSON.parse(t)}catch(o){e.error("can't parse closeImage opts: "+t,o)}for(n=e.Dysel.getDisplayOr(this.display),i=0;i<s;i++)if(this===e.images[i]){if((s=e.images[i])===s.display.image&&(r=i+1),r)for(a in!1!==t.clear&&(s.display.clearMessage(),s.display.context.clear()),s.layers)s.layers.hasOwnProperty(a)&&("main"!==s.layers[a].dlayer.dtype&&s.display!==n||s.showShapeLayer(a,!1,{local:!0}));switch(s.xeqPlugins("image","onimageclose"),r&&(s.display.image=null),s.cmapObj.name){case"red":e.globalOpts.rgb.rim=null;break;case"green":e.globalOpts.rgb.gim=null;break;case"blue":e.globalOpts.rgb.bim=null}for(t=0;t<s.raws.length;t++)(a=s.raws[t]).hdu&&a.hdu.fits&&1>=(n=e.lookupVfile(a.hdu.fits.vfile)).length&&e.cleanupFITSFile(a,!0),a.altwcs&&this.freeWCS(a);s.removeProxyFile(),s.rgb=null,s.offscreen=null,s.raw=null,s.colorData=null,s.colorCells=null,s.psColors=null,s.psInverse=null,e.images.splice(i,1);break}if(r){for(i=r-=2;0<=i;i--)if(this.display===(s=e.images[i]).display){s.displayImage("all"),s.refreshLayers(),r=e.images.length;break}for(i=e.images.length-1;i>r;i--)if(this.display===(s=e.images[i]).display){s.displayImage("all"),s.refreshLayers();break}}},e.Image.prototype.mkOffScreenCanvas=function(){if(!this.png||!this.png.image)return this;this.offscreen={},this.offscreen.canvas=document.createElement("canvas"),this.offscreen.canvas.setAttribute("width",this.png.image.width),this.offscreen.canvas.setAttribute("height",this.png.image.height),this.offscreen.context=this.offscreen.canvas.getContext("2d"),e.ANTIALIAS||(this.offscreen.context.imageSmoothingEnabled=!1,this.offscreen.context.webkitImageSmoothingEnabled=!1,this.offscreen.context.msImageSmoothingEnabled=!1),this.offscreen.context.drawImage(this.png.image,0,0);try{this.offscreen.img=this.offscreen.context.getImageData(0,0,this.png.image.width,this.png.image.height)}catch(t){e.CHROMEFILEWARNING&&"Chrome"===e.BROWSER[0]&&""===document.domain?alert("When using the file:// URI, Chrome must be run with the --allow-file-access-from-files switch to permit JS9 to access data."):alert("could not read off-screen image data [same-origin policy violation?]")}return this},e.Image.prototype.initLCS=function(t){var i,s,a=[[0,0,0],[0,0,0],[0,0,0]],n=(t=t||this.raw.header).CRPIX1||1,r=t.CRPIX2||1,o=-(t.CROTA2||0)*Math.PI/180,l=Math.sin(o),c=Math.cos(o);return o&&((s=[[0,0,0],[0,0,0],[0,0,0]])[0][0]=c,s[0][1]=-l,s[0][2]=0,s[1][0]=l,s[1][1]=c,s[1][2]=0,(i=e.invertMatrix3(s))||(s=null)),a[0][0]=t.LTM1_1||1,a[1][0]=t.LTM2_1||0,a[0][1]=t.LTM1_2||0,a[1][1]=t.LTM2_2||1,a[2][0]=t.LTV1||0,a[2][1]=t.LTV2||0,"image"===this.imtab&&this.params.ltvbug&&(void 0!==t.LTV1&&1>a[0][0]&&(a[2][0]+=.5*a[0][0]),void 0!==t.LTV2&&1>a[1][1]&&(a[2][1]+=.5*a[1][1])),this.lcs.physical={forward:$.extend(!0,[],a),reverse:e.invertMatrix3(a)},this.lcs.physical.reverse?s&&(this.lcs.physical.frot=$.extend(!0,[],s),this.lcs.physical.rrot=$.extend(!0,[],i),this.lcs.physical.cx=n-a[2][0]-1,this.lcs.physical.cy=r-a[2][1]-1):delete this.lcs.physical,a[0][0]=t.DTM1_1||1,a[1][0]=t.DTM2_1||0,a[0][1]=t.DTM1_2||0,a[1][1]=t.DTM2_2||1,a[2][0]=t.DTV1||0,a[2][1]=t.DTV2||0,this.lcs.detector={forward:$.extend(!0,[],a),reverse:e.invertMatrix3(a)},this.lcs.detector.reverse?s&&(this.lcs.detector.frot=$.extend(!0,[],s),this.lcs.detector.rrot=$.extend(!0,[],i),this.lcs.detector.cx=n-a[2][0]-1,this.lcs.detector.cy=r-a[2][1]-1):delete this.lcs.detector,a[0][0]=t.ATM1_1||1,a[1][0]=t.ATM2_1||0,a[0][1]=t.ATM1_2||0,a[1][1]=t.ATM2_2||1,a[2][0]=t.ATV1||0,a[2][1]=t.ATV2||0,this.lcs.amplifier={forward:$.extend(!0,[],a),reverse:e.invertMatrix3(a)},this.lcs.amplifier.reverse?s&&(this.lcs.amplifier.frot=$.extend(!0,[],s),this.lcs.amplifier.rrot=$.extend(!0,[],i),this.lcs.amplifier.cx=n-a[2][0]-1,this.lcs.amplifier.cy=r-a[2][1]-1):delete this.lcs.amplifier,this.params&&!this.lcs[this.params.lcs]&&(this.params.lcs="image"),this.params&&!this.params.wcssys0&&(this.setWCSSys("physical"),this.params.wcssys0=this.params.lcs),this.lcs.physical&&!this.lcs.ophysical&&(this.lcs.ophysical=$.extend(!0,{},this.lcs.physical)),this},e.Image.prototype.mkRawDataFromIMG=function(t){var i,s,a,n,r;if(t){for(i=t.height,s=t.width,a=t.data,this.raws.push({from:"img"}),this.raw=this.raws[this.raws.length-1],this.raw.id=e.RAWID0,this.raw.data=new Float32Array(i*s),r=t=0;r<i;r++)for(n=0;n<s;n++)this.raw.data[(i-r)*s+n]=.299*a[t]+.587*a[t+1]+.114*a[t+2],t+=4;return this.raw.width=s,this.raw.height=i,this.raw.bitpix=-32,e.Image.prototype.dataminmax.call(this),this.source="png",this.raw.header={SIMPLE:!0,NAXIS:2,NAXIS1:this.raw.width,NAXIS2:this.raw.height,BITPIX:this.raw.bitpix},this.initWCS(),this.initLCS(),this.xeqPlugins("image","onrawdata"),this}},e.Image.prototype.mkRawDataFromPNG=function(){var t,i,s,a,n,r,o,l,c,h=[];r=n=0,s=new ArrayBuffer(8);var u=new Uint8Array(s),d=new DataView(s);if(!this.offscreen.img)return this;for(this.raws.push({from:"png"}),this.raw=this.raws[this.raws.length-1],this.raw.id=e.RAWID0,a=this.offscreen.img.data,t=s=0;s<a.length&&0!==a[s];s++)if(255!==a[s]&&(h[t]=String.fromCharCode(a[s]),t++),15===t&&'{"js9Protocol":'!==h.join("")){c=!0;break}if(!(15>t||c)){t=h.join(""),2<e.DEBUG&&e.log("jsonHeader: %s",t);try{i=JSON.parse(t)}catch(p){e.error("can't read FITS header from PNG file: "+t,p)}if(1===i.js9Protocol)this.raw.header=i,this.raw.endian=this.raw.header.js9Endian,this.raw.protocol=this.raw.header.js9Protocol;else for(this.raw.endian=i.js9Endian,this.raw.protocol=i.js9Protocol,this.raw.cardstr=i.cardstr,this.raw.ncard=i.ncard,this.raw.header={},i=this.raw.ncard,t=0;t<i;t++)c=this.raw.cardstr.slice(80*t,80*(t+1)),void 0!==(c=e.cardpars(c))&&("HISTORY"===c[0]?this.raw.header[c[0]+"__"+n++]=c[1]:"COMMENT"===c[0]?this.raw.header[c[0]+"__"+r++]=c[1]:this.raw.header[c[0]]=c[1]);switch(s+=1,this.raw.header.NAXIS1?this.raw.width=this.raw.header.NAXIS1:e.error("NAXIS1 missing from PNG-based FITS header"),this.raw.header.NAXIS2?this.raw.height=this.raw.header.NAXIS2:e.error("NAXIS2 missing from PNG-based FITS header"),this.raw.header.BITPIX?this.raw.bitpix=this.raw.header.BITPIX:e.error("BITPIX missing from PNG-based FITS header"),"little"===this.raw.endian?l=!0:"big"===this.raw.endian?l=!1:e.error("js9Endian missing from PNG-based FITS header"),this.object=this.raw.header.OBJECT,this.telescope=this.raw.header.TELESCOP,this.instrument=this.raw.header.INSTRUME,n=this.raw.width*this.raw.height,r=s%4,this.raw.bitpix){case 8:for(this.raw.data=new Uint8Array(n),t=0;t<n;t++){switch(r){case 0:o=a[s],s+=1,r=1;break;case 1:o=a[s],s+=1,r=2;break;case 2:o=a[s],s+=2,r=0;break;case 3:o=a[s+1],s+=2,r=1}this.raw.data[t]=o}break;case 16:case-16:for(16===this.raw.bitpix?(this.raw.data=new Int16Array(n),i=DataView.prototype.getInt16):(this.raw.data=new Uint16Array(n),i=DataView.prototype.getUint16),t=0;t<n;t++){switch(r){case 0:u[0]=a[s],u[1]=a[s+1],o=i.call(d,0,l),s+=2,r=2;break;case 1:u[0]=a[s],u[1]=a[s+1],o=i.call(d,0,l),s+=3,r=0;break;case 2:u[0]=a[s],u[1]=a[s+2],o=i.call(d,0,l),s+=3,r=1;break;case 3:u[0]=a[s+1],u[1]=a[s+2],o=i.call(d,0,l),s+=3,r=2}this.raw.data[t]=o}break;case 32:case-32:for(32===this.raw.bitpix?(this.raw.data=new Int32Array(n),i=DataView.prototype.getInt32):(this.raw.data=new Float32Array(n),i=DataView.prototype.getFloat32),t=0;t<n;t++){switch(r){case 0:u[0]=a[s],u[1]=a[s+1],u[2]=a[s+2],u[3]=a[s+4],o=i.call(d,0,l),s+=5,r=1;break;case 1:u[0]=a[s],u[1]=a[s+1],u[2]=a[s+3],u[3]=a[s+4],o=i.call(d,0,l),s+=5,r=2;break;case 2:u[0]=a[s],u[1]=a[s+2],u[2]=a[s+3],u[3]=a[s+4],o=i.call(d,0,l),s+=6,r=0;break;case 3:u[0]=a[s+1],u[1]=a[s+2],u[2]=a[s+3],u[3]=a[s+5],o=i.call(d,0,l),s+=6,r=1}this.raw.data[t]=o}break;case-64:for(this.raw.data=new Float64Array(n),t=0;t<n;t++){switch(r){case 0:case 4:u[0]=a[s],u[1]=a[s+1],u[2]=a[s+2],u[3]=a[s+4],u[4]=a[s+5],u[5]=a[s+6],u[6]=a[s+8],u[7]=a[s+9],o=d.getFloat64(0,l),s+=10,r=2;break;case 1:case 5:u[0]=a[s],u[1]=a[s+1],u[2]=a[s+3],u[3]=a[s+4],u[4]=a[s+5],u[5]=a[s+7],u[6]=a[s+8],u[7]=a[s+9],o=d.getFloat64(0,l),s+=11,r=0;break;case 2:case 6:u[0]=a[s],u[1]=a[s+2],u[2]=a[s+3],u[3]=a[s+4],u[4]=a[s+6],u[5]=a[s+7],u[6]=a[s+8],u[7]=a[s+10],o=d.getFloat64(0,l),s+=11,r=1;break;case 3:case 7:u[0]=a[s+1],u[1]=a[s+2],u[2]=a[s+3],u[3]=a[s+5],u[4]=a[s+6],u[5]=a[s+7],u[6]=a[s+9],u[7]=a[s+10],o=d.getFloat64(0,l),s+=11,r=2}this.raw.data[t]=o}break;default:e.error("unsupported bitpix in PNG file: "+this.raw.bitpix)}return this.dataminmax(),this.offscreen.img=null,this.initWCS(),this.initLCS(),this.xeqPlugins("image","onrawdata"),this}e.Image.prototype.mkRawDataFromIMG.call(this,this.offscreen.img)},e.Image.prototype.mkRawDataFromHDU=function(t,i){var s,a,n,r,o,l,c,h,u,d,p,f,g,m,v=this;if(d=u=0,i=i||{},$.isArray(t)||e.isTypedArray(t)||t instanceof ArrayBuffer?($.isArray(t[0])&&(t=t.reduce(function(e,t){return e.concat(t)})),r={image:t}):"object"==typeof t?r=t:e.error("unknown or missing input for HDU creation"),r.data&&!r.image&&(r.image=r.data),r.image||e.error("data missing from JS9 FITS object"+JSON.stringify(r)),2>r.naxis&&e.error("can't image a FITS file with less than 2 dimensions"),this.raw&&(l=this.raw,p=this.raw.width,f=this.raw.height,g=this.raw.bitpix,c=this.raw.header.LTM1_1||1,h=this.params.wcssys,m=this.params.wcsunits,this.freeWCS()),this.raws=this.raws||[],o=this.raws.length){for(i.rawid=i.rawid||e.RAWIDX,s=n=0;s<o;s++)if(i.rawid===this.raws[s].id){this.raws[s]={from:a=this.raws[s].from,id:i.rawid},this.raw=this.raws[s],n++;break}n||(this.raws.push({from:"hdu",id:i.rawid}),this.raw=this.raws[o],l=null)}else this.raws.push({from:"hdu"}),this.raw=this.raws[o],this.raw.id=e.RAWID0;if(this.raw.hdu=r,r.axis?(this.raw.width=r.axis[1],this.raw.height=r.axis[2]):r.naxis1&&r.naxis2?(this.raw.width=r.naxis1,this.raw.height=r.naxis2):p&&f&&(this.raw.width=p,this.raw.height=f),r.bitpix?this.raw.bitpix=r.bitpix:g&&(this.raw.bitpix=g),"base64"===r.encoding)for(a=window.atob(r.image),r.image=new ArrayBuffer(a.length),n=new Uint8Array(r.image),s=0;s<a.length;s++)n[s]=a.charCodeAt(s);switch($.isArray(r.image[0])&&(r.image=r.image.reduce(function(e,t){return e.concat(t)})),this.raw.bitpix){case 8:this.raw.data=new Uint8Array(r.image);break;case 16:this.raw.data=new Int16Array(r.image);break;case-16:this.raw.data=new Uint16Array(r.image);break;case 32:this.raw.data=new Int32Array(r.image);break;case-32:this.raw.data=new Float32Array(r.image);break;case-64:this.raw.data=new Float64Array(r.image)}if(this.raw.card=r.card,this.raw.cardstr=r.cardstr,this.raw.ncard=r.ncard,r.head)this.raw.header=r.head;else if(this.raw.card)for(this.raw.header={},n=this.raw.card.length,s=0;s<n;s++)void 0!==(o=e.cardpars(this.raw.card[s]))&&("HISTORY"===o[0]?this.raw.header[o[0]+"__"+u++]=o[1]:"COMMENT"===o[0]?this.raw.header[o[0]+"__"+d++]=o[1]:this.raw.header[o[0]]=o[1]);else if(this.raw.cardstr)for(this.raw.header={},n=this.raw.ncard,s=0;s<n;s++)o=this.raw.cardstr.slice(80*s,80*(s+1)),void 0!==(o=e.cardpars(o))&&("HISTORY"===o[0]?this.raw.header[o[0]+"__"+u++]=o[1]:"COMMENT"===o[0]?this.raw.header[o[0]+"__"+d++]=o[1]:this.raw.header[o[0]]=o[1]);else this.raw.header={},this.raw.header.SIMPLE=!0,this.raw.header.NAXIS=2,this.raw.header.NAXIS1=this.raw.width,this.raw.header.NAXIS2=this.raw.height,this.raw.header.BITPIX=this.raw.bitpix;s=this.raw.header,l||this.parentFile||this.parent||void 0===s.LTV1&&void 0===s.LTV2&&void 0===s.LTM1_1&&void 0===s.LTM2_2||(this.parent={},this.parent.raw={header:$.extend(!0,{},s)},this.parent.lcs={},e.Image.prototype.initLCS.call(this.parent,this.parent.raw.header)),("image"===r.imtab&&void 0!==r.x1&&1!==r.x1||void 0!==r.y1&&1!==r.y1||void 0===r.bin||1!==r.bin)&&(n=r.bin||1,u=void 0!==r.x1?r.x1:0,d=void 0!==r.y1?r.y1:0,void 0!==s.CRPIX1&&(s.CRPIX1=(s.CRPIX1-u)/n+.5),void 0!==s.CRPIX2&&(s.CRPIX2=(s.CRPIX2-d)/n+.5),void 0!==s.CDELT1&&(s.CDELT1*=n),void 0!==s.CDELT2&&(s.CDELT2*=n),void 0!==s.CD1_1&&(s.CD1_1*=n),void 0!==s.CD1_2&&(s.CD1_2*=n),void 0!==s.CD2_1&&(s.CD2_1*=n),void 0!==s.CD2_2&&(s.CD2_2*=n),s.LTM1_1=s.LTM1_1||1,s.LTM1_1/=n,s.LTM2_1=s.LTM2_1||0,s.LTM2_1/=n,s.LTM1_2=s.LTM1_2||0,s.LTM1_2/=n,s.LTM2_2=s.LTM2_2||1,s.LTM2_2/=n,s.LTV1=s.LTV1||0,s.LTV1=(s.LTV1-u)/n+.5,s.LTV2=s.LTV2||0,s.LTV2=(s.LTV2-d)/n+.5),i.file&&i.file!==this.file?(this.file=i.file,this.id=null):i.filename&&i.filename!==this.file?(this.file=i.filename,this.id=null):r.filename&&r.filename!==this.file&&(this.file=r.filename,this.id=null),this.file0=this.file=this.file||e.ANON+e.uniqueID(),i.id&&(this.id0=i.id,this.id=e.getImageID(i.id,this.display.id,this)),this.id||!this.file||this.file.match(/\[.*[^a-zA-Z0-9_].*\]/)||(i.extname||i.extnum?(i.extname?(this.file=this.file.replace(/\[.*\]/,""),this.file+=sprintf("[%s]",i.extname)):i.extnum&&0<i.extnum&&(this.file=this.file.replace(/\[.*\]/,""),this.file+=sprintf("[%s]",i.extnum)),r&&r.fits&&(i.extname&&(r.fits.extname=i.extname),i.extnum&&0<i.extnum&&(r.fits.extnum=i.extnum))):r.fits?r.fits.extname?(this.file=this.file.replace(/\[.*\]/,""),this.file+=sprintf("[%s]",r.fits.extname)):r.fits.extnum&&0<r.fits.extnum&&(this.file=this.file.replace(/\[.*\]/,""),this.file+=sprintf("[%s]",r.fits.extnum)):this.raw.header&&this.raw.header.EXTNAME&&(this.file=this.file.replace(/\[.*\]/,""),this.file+=sprintf("[%s]",this.raw.header.EXTNAME))),this.id||(this.id0=(this.parentFile||this.file).split("/").reverse()[0],this.id=e.getImageID(this.id0,this.display.id,this)),i.proxyFile&&(this.proxyFile=i.proxyFile),this.raw.filter=i.filter||"",this.imtab=r.imtab?r.imtab:r.table?"table":"image",this.raw.imtab=this.imtab,void 0!==r.dmin&&void 0!==r.dmax?this.dataminmax(r.dmin,r.dmax):this.dataminmax(),this.object=this.raw.header.OBJECT,this.telescope=this.raw.header.TELESCOP,this.instrument=this.raw.header.INSTRUME,this.binning.bin="table"===this.imtab&&r.table?r.table.bin||1:r.bin?r.bin:1,i.ltm2obin&&s.LTM1_1?this.binning.obin=s.LTM1_1/c:l||(this.binning.obin=this.binning.bin),this.initWCS(),h&&this.setWCSSys(h),m&&this.setWCSUnits(m),this.initLCS();try{i.hdus?v.hdus=i.hdus:this.parentFile&&e.helper.connected&&e.helper.js9helper?(t={id:this.expandMacro("$id"),cmd:this.expandMacro("js9Xeq listhdus $filename"),image:this.file,fits:this.parentFile,rtype:"text"},e.helper.send("listhdus",t,function(e){e.stderr||e.errcode||!e.stdout||(v.hdus=JSON.parse(e.stdout))})):this.raw&&this.raw.hdu&&this.raw.hdu.fits&&(a=e.listhdu(this.raw.hdu.fits.vfile),this.hdus=JSON.parse(a))}catch(b){}if(this.raw.hdu.fits&&this.raw.hdu.fits.vfile){for(a=!1===(a=e.globalOpts.clearImageMemory)?["never"]:!0===a?["always"]:a.toLowerCase().split(/[,>]/),h=l=!1,s=0,c=!1;s<a.length&&!c;s++)switch(a[s]){case"never":l=!1,c=!0;break;case"always":c=l=!0;break;case"heap":h=!0;break;case"auto":2>=this.raw.header.NAXIS&&(!this.hdus||1===this.hdus.length)?l=!0:(l=!1,c=!0);break;case"nocube":2>=this.raw.header.NAXIS?l=!0:(l=!1,c=!0);break;case"noext":this.hdus&&1!==this.hdus.length?(l=!1,c=!0):l=!0;break;case"size":a[s+1]&&e.vsize(r.fits.vfile)>1e6*a[s+1]?l=!0:(l=!1,c=!0)}l?(2<e.DEBUG&&e.log("removing underlying FITS vfile for %s: %s",this.id,this.raw.hdu.fits.vfile),e.cleanupFITSFile(this.raw,!0)):h&&this.raw.hdu.fits.heap&&(2<e.DEBUG&&e.log("freeing heap space for %s: %s",this.id,this.raw.hdu.fits.vfile),e.vfree(this.raw.hdu.fits.heap),this.raw.hdu.fits.heap=null)}return this.xeqPlugins("image","onrawdata"),this},e.Image.prototype.mkSection=function(t,i,s){var a,n=this.rgb.sect;switch(n.ozoom=n.zoom,arguments.length){case 0:n.xcen=Math.floor(this.raw.width/2),n.ycen=Math.floor(this.raw.height/2),n.width=Math.min(this.raw.width,this.display.canvas.width),n.height=Math.min(this.raw.height,this.display.canvas.height);break;case 1:e.isNumber(t)||e.error("invalid input for generating section"),n.zoom=parseFloat(t),n.width=Math.min(this.raw.width*n.zoom,this.display.canvas.width),n.height=Math.min(this.raw.height*n.zoom,this.display.canvas.height);break;case 2:e.isNumber(t)&&e.isNumber(i)||e.error("invalid input for generating section"),n.xcen=parseFloat(t),n.ycen=parseFloat(i),e.notNull(n.ix)&&(n.width=Math.min(this.raw.width*n.zoom,this.display.canvas.width)),e.notNull(n.iy)&&(n.height=Math.min(this.raw.height*n.zoom,this.display.canvas.height));break;case 3:e.isNumber(t)&&e.isNumber(i)&&e.isNumber(s)||e.error("invalid input for generating section"),n.xcen=parseFloat(t),n.ycen=parseFloat(i),n.zoom=parseFloat(s),n.width=Math.min(this.raw.width*n.zoom,this.display.canvas.width),n.height=Math.min(this.raw.height*n.zoom,this.display.canvas.height)}return delete n.ix,delete n.iy,n.width=Math.floor(n.width),n.height=Math.floor(n.height),n.x0=Math.floor(n.xcen-n.width/(2*n.zoom)),n.y0=Math.floor(n.ycen-n.height/(2*n.zoom)),n.x1=Math.floor(n.xcen+n.width/(2*n.zoom)),n.y1=Math.floor(n.ycen+n.height/(2*n.zoom)),0>n.x0&&(e.globalOpts.panWithinDisplay?n.x1-=n.x0:n.ix=n.x0*n.zoom,n.x0=0),0>n.y0&&(e.globalOpts.panWithinDisplay?n.y1-=n.y0:n.iy=n.y0*n.zoom,n.y0=0),n.x1>this.raw.width&&(e.globalOpts.panWithinDisplay?n.x0-=n.x1-this.raw.width:n.ix=(n.x1-this.raw.width)*n.zoom,n.x1=this.raw.width),n.y1>this.raw.height&&(e.globalOpts.panWithinDisplay?n.y0-=n.y1-this.raw.height:n.iy=(n.y1-this.raw.height)*n.zoom,n.y1=this.raw.height),n.ix&&1>n.zoom&&(0<n.x0&&(n.x0-=a=n.x0,n.ix+=a*n.zoom),n.x1<this.raw.width&&(n.x1+=a=this.raw.height-n.x1,n.ix-=a*n.zoom)),n.iy&&1>n.zoom&&(0<n.y0&&(n.y0-=a=n.y0,n.iy+=a*n.zoom),n.y1<this.raw.height&&(n.y1+=a=this.raw.height-n.y1,n.iy-=a*n.zoom)),n.x0=Math.max(0,n.x0),n.x1=Math.min(this.raw.width,n.x1),n.y0=Math.max(0,n.y0),n.y1=Math.min(this.raw.height,n.y1),n.width=Math.ceil((n.x1-n.x0)*n.zoom),n.height=Math.ceil((n.y1-n.y0)*n.zoom),this.offscreenRGB=null,this.params.zoom=n.zoom,this},e.Image.prototype.mkColorData=function(){var t,i,s=e.SCALESIZE,a=this.params.scalemin,n=this.params.scalemax,r=this.raw.width*this.raw.height,o=(s-1)/(n-a);for(this.colorData||(this.colorData=[]),t=0;t<r;t++)this.colorData[t]=(i=this.raw.data[t])<=a?0:i>=n?s-1:Math.floor((i-a)*o+.5);return this},e.Image.prototype.calcContrastBias=function(t){var i=e.COLORSIZE,s=this.params.bias,a=this.params.contrast;return 1e-4>s-.5&&1e-4>a-1?t:(this.params.invert&&(s=1-s),0>(t=Math.floor(((t/i-s)*a+.5)*i))?0:t>=i?i-1:t)},e.Image.prototype.mkColorCells=function(){var t,i,s=e.COLORSIZE;for(this.colorCells||(this.colorCells=[]),t=0;t<s;t++)i=this.calcContrastBias(i=this.params.invert?s-t-1:t),this.colorCells[t]=this.cmapObj.mkColorCell(i);return this},e.Image.prototype.mkScaledCells=function(){var t,i,s,a,n,r,o,l,c,h,u,d;o=e.COLORSIZE;var p=e.SCALESIZE,f=e.INVSIZE;if(n=e.HISTSIZE,!this.colorCells)return this;if(!this.psColors){for(s=this.psColors=[],l=[],"#"===(i=this.params.nancolor).charAt(0)&&(i=i.slice(1)),i=i.toUpperCase(),t=r=0;6>r;r+=2,t++)d="0123456789ABCDEF".indexOf(i.charAt(r)),a="0123456789ABCDEF".indexOf(i.charAt(r+1)),l[t]=16*d+a;s.NaN=l}switch(this.psInverse||(this.psInverse=[],this.psInverse.NaN=0),i=this.params.scalemax-this.params.scalemin,r=this.params.scalemin,this.params.scale){case"linear":for(s=0;s<p;s++)t=s/p,t=Math.floor(t*o),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++)this.psInverse[s]=(t=s/f)*i+r;break;case"log":for(n=this.params.exp,s=0;s<p;s++)t=Math.log(n*s/p+1)/Math.log(n),(t=Math.floor(t*o))>=o&&(t=o-1),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++)t=(Math.pow(n,s/f)-1)/n,this.psInverse[s]=t*i+r;break;case"power":for(n=this.params.exp,s=0;s<p;s++)t=(Math.pow(n,s/p)-1)/n,(t=Math.floor(t*o))>=o&&(t=o-1),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++)t=Math.log(n*s/f+1)/Math.log(n),this.psInverse[s]=t*i+r;break;case"sqrt":for(s=0;s<p;s++)t=s/p,(t=Math.floor(Math.sqrt(t)*o))>=o&&(t=o-1),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++)this.psInverse[s]=(t=s/f)*t*i+r;break;case"squared":for(s=0;s<p;s++)t=s/p,(t=Math.floor(t*t*o))>=o&&(t=o-1),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++)t=Math.sqrt(s/f),this.psInverse[s]=t*i+r;break;case"asinh":for(s=0;s<p;s++)t=s/p,(t=Math.floor(Math.asinh(10*t)/3*o))>=o&&(t=o-1),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++)t=s/f,t=Math.sinh(3*t)/10,this.psInverse[s]=t*i+r;break;case"sinh":for(s=0;s<p;s++)t=s/p,(t=Math.floor(Math.sinh(3*t)/10*o))>=o&&(t=o-1),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++)t=s/f,t=Math.asinh(10*t)/3,this.psInverse[s]=t*i+r;break;case"histeq":if(l=this.raw.data,c=this.raw.width*this.raw.height,i=this.raw.dmax-this.raw.dmin,u=this.raw.dmax,r=this.raw.dmin,h=t=0,d=[],!this.hist||!this.hist.length){for(this.hist=[],s=0;s<n;s++)d[s]=0;for(s=0;s<c;s++)l[s]>=r&&l[s]<=u&&(a=Math.floor((l[s]-r)/i*n+.5))<n&&(d[a]+=1);for(s=0;s<n;s++)h+=d[s];for(a=h/n,s=l=0;s<n&&l<n;s++)for(this.hist[s]=l/n,t+=d[s];t>=a&&l<n;)t-=a,l++;for(t=(n-1)/n;s<n;)this.hist[s++]=t}for(s=0;s<p;s++)t=this.hist[s*n/p],t=Math.floor(t*o),this.psColors[s]=this.colorCells[t];for(s=0;s<f;s++){for(o=s/f,a=0;a<n-1&&!(this.hist[a]>o);a++);this.psInverse[s]=(t=a/n)*i+r}break;default:e.log("unknown scale '"+this.params.scale+"'")}return this},e.Image.prototype.mkRGBImage=function(){var t,i,s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y,x,w,S,C=null,A=null,_=null,k=!1;if(!this.rgb)return this;if(!e.globalOpts.rgb.active||this!==e.globalOpts.rgb.rim&&this!==e.globalOpts.rgb.gim&&this!==e.globalOpts.rgb.bim||(k=!0,e.globalOpts.rgb.rim&&(C=e.globalOpts.rgb.rim),e.globalOpts.rgb.gim&&(A=e.globalOpts.rgb.gim),e.globalOpts.rgb.bim&&(_=e.globalOpts.rgb.bim)),o=this.display.context,i=(t=this.rgb).sect,this.MakeRGBImage&&"function"==typeof this.MakeRGBImage&&this.MakeRGBImage()||this.MakePrimaryImage&&"function"==typeof this.MakePrimaryImage&&this.MakePrimaryImage())return this;if(this.rgbFile){if(a=this.offscreen.context.getImageData(s=i.x0,a=this.offscreen.canvas.height-1-(i.y0+(r=i.height/i.zoom)),n=i.width/i.zoom,r),1===i.zoom)t.img=a;else for(t.img=o.createImageData(i.width,i.height),t=t.img,d=h=0;h<a.height;h++,d++)for(b=h*a.width,f=d*i.zoom,u=o=0;o<a.width;o++,u++)for(s=4*(b+o),p=u*i.zoom,g=0;g<i.zoom;g++)for(y=(m=Math.floor(f+g))*i.width,m=0;m<i.zoom;m++)v=Math.floor(p+m),t.data[v=4*(y+v)]=a.data[s],t.data[v+1]=a.data[s+1],t.data[v+2]=a.data[s+2],t.data[v+3]=a.data[s+3];return this}if(t.img&&t.img.width===i.width&&t.img.height===i.height||(t.img=o.createImageData(i.width,i.height)),t=t.img,!this.psColors)return this;for(x=void 0!==this.params.opacity?255*this.params.opacity:void 0!==this.params.alpha?this.params.alpha:255,this.maskData&&(this.params.maskInvert?void 0!==this.params.opacity&&void 0!==this.params.maskOpacity?(a=255*this.params.opacity,n=255*this.params.maskOpacity):void 0!==this.params.alpha1&&void 0!==this.params.alpha2?(a=this.params.alpha2,n=this.params.alpha1):(a=0,n=255):void 0!==this.params.opacity&&void 0!==this.params.maskOpacity?(a=255*this.params.maskOpacity,n=255*this.params.opacity):void 0!==this.params.alpha1&&void 0!==this.params.alpha2?(a=this.params.alpha1,n=this.params.alpha2):(a=255,n=0)),l=Math.max(1,Math.floor(1/i.zoom)),c=i.zoom*l,h=i.y1-1,d=0;h>=i.y0;h-=l,d++)for(b=h*this.raw.width,f=d*c,o=i.x0,u=0;o<i.x1;o+=l,u++){if(k){if(w=A?A.colorData[b+o]:0,S=_?_.colorData[b+o]:0,void 0===(r=C?C.colorData[b+o]:0)||void 0===w||void 0===S)return e.globalOpts.rgb.active=!1,e.error("RGB images are incompatible. Turning off RGB mode.","",!1),e.Image.prototype.mkRGBImage.call(this),this}else s=this.colorData[b+o];for(this.maskData&&(x=0<this.maskData[b+o]?a:n),p=u*c,g=0;g<i.zoom;g++)for(y=(m=Math.ceil(f+g))*i.width,m=0;m<i.zoom;m++)(v=4*(y+(v=Math.ceil(p+m))))<t.data.length&&(k?(t.data[v]=C?C.psColors[r][0]:0,t.data[v+1]=A?A.psColors[w][1]:0,t.data[v+2]=_?_.psColors[S][2]:0):(t.data[v]=this.psColors[s][0],t.data[v+1]=this.psColors[s][1],t.data[v+2]=this.psColors[s][2]),t.data[v+3]=x)}return this},e.Image.prototype.blendImage=function(t,i,s){return 0===arguments.length?this.blend:!0===t||!1===t||"true"===t||"false"===t?("true"===t?t=!0:"false"===t&&(t=!1),this.blend.active=t,this.xeqPlugins("image","onimageblend"),this.display.blendMode&&this.displayImage(),this):((e.notNull(t)||e.notNull(i))&&(e.notNull(t)&&(/normal|multiply|screen|overlay|darken|lighten|color-dodge|color-burn|hard-light|soft-light|difference|exclusion|hue|saturation|color|luminosity|clear|copy|source-over|destination-over|source-in|destination-in|source-out|destination-out|source-atop|destination-atop|xor|lighter/i.test(t)||e.error("invalid composite/blend operation: "+t),this.blend.mode=t),e.notNull(i)&&("string"==typeof i?i=parseFloat(i):"number"!=typeof i&&e.error("invalid opacity: "+i),this.blend.opacity=Math.min(Math.max(i,0),1)),e.notNull(s)&&("true"===s?s=!0:"false"===s&&(s=!1),this.blend.active=s),this.xeqPlugins("image","onimageblend"),this.display.blendMode&&this.blend.active&&this.displayImage()),this)},e.Image.prototype.calcDisplayOffsets=function(t){var i,s,a=this.rgb.sect;return this.ix=Math.floor((this.display.canvas.width-this.rgb.img.width)/2),this.iy=Math.floor((this.display.canvas.height-this.rgb.img.height)/2),e.notNull(a.ix)&&(this.ix-=a.ix/2),e.notNull(a.iy)&&(this.iy+=a.iy/2),t&&this.wcsAlign()&&(t=(i=this.wcsim).rgb.sect,i=e.pix2pix(i,this,i.getPan()),s=e.globalOpts.panWithinDisplay,e.globalOpts.panWithinDisplay=!0,this.mkSection(i.x,i.y,t.zoom),e.globalOpts.panWithinDisplay=s,this.ix-=(a.xcen-(a.x0+a.x1)/2)*t.zoom,this.iy+=(a.ycen-(a.y0+a.y1)/2)*t.zoom),this},e.Image.prototype.putImage=function(t){var i=this.rgb,s=this.display.context;return t=t||{},"reproject"===this.rawDataLayer()&&t.wcsim&&(this.wcsim=t.wcsim),this.calcDisplayOffsets(!0),e.notNull(t.opacity)||e.notNull(t.blend)?(s.save(),void 0!==t.opacity&&(s.globalAlpha=t.opacity),void 0!==t.blend&&(s.globalCompositeOperation=t.blend),s.drawImage(function(t,i){var s,a;return t.offscreenRGB||(s=(a=document.createElement("canvas")).getContext("2d"),a.width=i.width,a.height=i.height,e.ANTIALIAS||(s.imageSmoothingEnabled=!1,s.webkitImageSmoothingEnabled=!1,s.msImageSmoothingEnabled=!1),s.putImageData(i,0,0),t.offscreenRGB={canvas:a,context:s}),t.offscreenRGB.canvas}(this,i.img),this.ix,this.iy),s.restore()):s.putImageData(i.img,this.ix,this.iy),this},e.Image.prototype.displayImage=function(t,i){var s,a,n;n=0;var r=[],o={};if(!1===t)return this.displayMode=!1,this;if(!0===t&&(this.displayMode=!0,t="all"),!this.displayMode)return this;if("object"==typeof t&&(i=t,t=null),t?"all"===t?(t="colors,scaled,rgb,display,plugins",o.notify=!0):"rgbonly"===t?(t="rgb,nodisplay",o.notify=!0):"display"===t&&(o.notify=!0):t="rgb",t.split(",").forEach(function(e,t,i){switch(e=e.trim(),o[e]=!0,e){case"colors":o.scaled=!0,o.rgb=!0;break;case"scaled":o.rgb=!0}}),o.display=!0,o.plugins=!0,this.rgbFile&&(o.colors=!1,o.scaled=!1),"string"==typeof i)try{i=JSON.parse(i)}catch(l){e.error("can't parse displayImage opts: "+i,l)}if(i=i||{},this.display.blendMode&&!1!==i.blendMode)for(s=0;s<e.images.length;s++)(a=e.images[s]).display===this.display&&a.blend.active&&(r.push(a),n++);if(o.colors&&(this.mkColorData(),this.offscreenRGB=null),o.scaled&&(this.mkColorCells(),this.mkScaledCells(),this.offscreenRGB=null),o.rgb&&(this.mkRGBImage(),this.offscreenRGB=null,n))for(s=r.length-1;0<=s;s--)(a=r[s]).mkRGBImage(),a.offscreenRGB=null;if(o.nodisplay)return this;if(o.display){if(this.display.context.clear(),n){for(s=r.length-1;0<=s;s--)r[s].calcDisplayOffsets(!1);for(s=r.length-1;0<=s;s--)(a=r[s]).putImage(n={wcsim:i.wcsim,blend:a.blend.mode,opacity:a.blend.opacity}),a===this&&a.displayShapeLayers()}else this.putImage(i),this.displayShapeLayers();if(this.display.image=this,this.delayedShapes&&this.delayedShapes.length){for(;this.delayedShapes.length;)s=this.delayedShapes.shift(),this.addShapes(s.layer,s.shape,s.opts);delete this.delayedShapes}}return this.xeqPlugins("image","onimagedisplay"),this},e.Image.prototype.refreshImage=function(t,i){var s,a;if("string"==typeof i)try{i=JSON.parse(i)}catch(n){e.error("can't parse refresh opts: "+i,n)}if(i=i||{},t&&"string"!=typeof t){if(i.rawid=i.rawid||e.RAWID0,"function"==typeof i&&(i={onrefresh:i}),!i.onrefresh&&e.imageOpts.onrefresh&&(i.onrefresh=e.imageOpts.onrefresh),a=this.imageToLogicalPos({x:this.rgb.sect.xcen,y:this.rgb.sect.ycen}),s=this.rgb.sect.zoom,this.binning.obin=this.binning.bin,this.mkRawDataFromHDU(t,i),i.resetSection?(this.mkSection(),this.mkSection(s)):(a=this.logicalToImagePos({x:a.x,y:a.y}),this.mkSection(a.x,a.y,s)),this.displayImage("colors",i),this.notifyHelper(),(i.refreshRegions||i.resetSection||this.binning.obin!==this.binning.bin)&&(this.refreshLayers(),this.updateShapes("regions","all","binning")),this.xeqPlugins("image","onimagerefresh"),e.waiting(!1),i.onrefresh)try{e.xeqByName(i.onrefresh,window,this)}catch(n){e.error("in image refresh callback",n)}return this}i.onrefresh&&(i.onload=i.onrefresh,delete i.onrefresh),i.refresh=this,e.Load(document.domain?t||this.file:t||this.fitsFile||this.file,i,{display:this.display})},e.Image.prototype.fileDimensions=function(){var e,t;return this.parent&&"BINTABLE"!==this.parent.raw.header.XTENSION?(e=this.parent.raw.header.TABDIM1?this.parent.raw.header.TABDIM1:this.parent.raw.header.NAXIS1,t=this.parent.raw.header.TABDIM2?this.parent.raw.header.TABDIM2:this.parent.raw.header.NAXIS2):(e=this.raw.header.TABDIM1?this.raw.header.TABDIM1:this.raw.header.NAXIS1,t=this.raw.header.TABDIM2?this.raw.header.TABDIM2:this.raw.header.NAXIS2),{xdim:e,ydim:t}},e.Image.prototype.maybePhysicalToImage=function(t){var i;return"image"===this.imtab&&this.parent&&this.parent.lcs&&t.x&&t.y&&(t=e.Image.prototype.logicalToImagePos.call(this.parent,t={x:t.x,y:t.y},"ophysical"),i={x:Math.floor(t.x+.5),y:Math.floor(t.y+.5)}),i},e.Image.prototype.displaySection=function(t,i){var s,a,n,r,o,l,c,h,u,d,p,f,g=this,m=function(t,i,s){var a;return e.isNull(t)?e.isNull(i)||(a=i):a=t,a||s},v=function(t,s){var a,r;if(a="",c=$.extend(!0,{},s||{}),e.isNull(c.refreshRegions)&&(c.refreshRegions=!0),e.isNull(c.resetSection)&&(c.resetSection=!0),!1!==c.waiting&&e.waiting(!0,g.display),t.fits.extname?a=sprintf("[%s]",t.fits.extname):t.fits.extnum&&0<t.fits.extnum?a=sprintf("[%s]",t.fits.extnum):g.parent&&(g.parent.extname?a=sprintf("[%s]",g.parent.extname):g.parent.extnum&&0<g.parent.extnum&&(a=sprintf("[%s]",g.parent.extnum))),a=g.id.replace(/\[.*\]/,"")+a,c.separate){if(delete c.xcen,delete c.ycen,c.id=a,"string"==typeof c.separate){switch((r=c.separate.split(":")).length){case 1:a=r[0];break;default:a=r[0],c.id=r[1]}c.display=e.lookupDisplay(a)}else c.display=g.display;"parentFile"===n&&g.fitsFile&&(a=e.lookupImage(g.fitsFile),c.parentFile=a&&a.parentFile?a.parentFile:g.fitsFile),o=g.listRegions("all",{mode:1}),(l=new e.Image(t,c,i=c.ondisplaysection||c.onrefresh||i)).binning.obin=l.binning.bin,o&&!1!==c.refreshRegions&&l.addShapes("regions",o)}else if("string"==typeof c.refresh){switch(delete c.xcen,delete c.ycen,c.id=a,(r=c.refresh.split(":")).length){case 1:a=r[0];break;default:a=r[0],c.id=r[1]}c.display=e.lookupDisplay(a),c.display.image?(c.rawid=g.raw.id,c.onrefresh=c.ondisplaysection||c.onrefresh||i,c.display.image.refreshImage(t,c)):("parentFile"===n&&g.fitsFile&&(a=e.lookupImage(g.fitsFile),c.parentFile=a&&a.parentFile?a.parentFile:g.fitsFile),o=g.listRegions("all",{mode:1}),(l=new e.Image(t,c,i=c.ondisplaysection||c.onrefresh||i)).binning.obin=l.binning.bin,o&&l.addShapes("regions",o))}else c.id=a,c.rawid=g.raw.id,c.onrefresh=c.ondisplaysection||c.onrefresh||i,g.refreshImage(t,c);e.waiting(!1)};if(this.raw&&this.raw.hdu&&this.raw.hdu.fits||e.error("invalid image for displaySection"),"full"===t)h=this.fileDimensions(),t={xdim:h.xdim,ydim:h.ydim,xcen:0,ycen:0};else{if("selected"===t)return void this.selectShapes("regions","selected",function(e){var t,s,a=0,n=0,r=1e6,o=0,l=1e6,h=0,u=(e=e.pub).shape;switch(e.lcs&&(e=e.lcs),u){case"annulus":t=2*e.radii[e.radii.length-1],s=2*e.radii[e.radii.length-1];break;case"box":t=e.width,s=e.height;break;case"circle":t=2*e.radius,s=2*e.radius;break;case"ellipse":t=2*e.r1,s=2*e.r2;break;case"polygon":case"line":for(t=0;t<e.pts.length;t++)a+=e.pts[t].x,n+=e.pts[t].y,e.pts[t].x>o&&(o=e.pts[t].x),e.pts[t].x<r&&(r=e.pts[t].x),e.pts[t].y>h&&(h=e.pts[t].y),e.pts[t].y<l&&(l=e.pts[t].y);e.x=a/e.pts.length,e.y=n/e.pts.length,"line"===e.shape&&2===e.pts.length?(t=Math.sqrt((e.pts[0].x-e.pts[1].x)*(e.pts[0].x-e.pts[1].x)+(e.pts[0].y-e.pts[1].y)*(e.pts[0].y-e.pts[1].y)),s=1):(t=o-r,s=h-l);break;case"text":s=t=10}this.displaySection(c={xcen:e.x,ycen:e.y,xdim:t,ydim:s,separate:!0,refreshRegions:!1,resetSection:!0},i)});if("string"==typeof t)try{t=JSON.parse(t)}catch(b){e.error("can't parse section opts: "+t,b)}}if(a=(t=t||{}).separate?$.extend(!0,{},this.raw.hdu):this.raw.hdu,(n=t.from)||(n=this.parentFile&&e.helper.connected&&e.helper.js9helper?"parentFile":"virtualFile"),a.table?h=a.table:("parentFile"===n&&this.raw.header&&e.notNull(this.raw.header.LTM1_1)?(d=1,p=this.raw.header.LTM1_1):(d=a.bin||1,p=1),u=this.imageToLogicalPos(h={x:this.raw.width/2,y:this.raw.height/2}),(h={}).bin=Math.floor(d/p+.5),h.xcen=Math.floor(u.x+.5*(h.bin-1)),h.ycen=Math.floor(u.y+.5*(h.bin-1)),(d=this.maybePhysicalToImage({x:h.xcen,y:h.ycen}))&&(h.xcen=d.x,h.ycen=d.y),h.xdim=Math.floor(a.naxis1*h.bin),h.ydim=Math.floor(a.naxis2*h.bin),h.filter=this.raw.filter||""),"string"==typeof t.bin)switch(t.bin.match(/[as]$/)&&(t.binMode=t.bin.slice(-1),t.bin=t.bin.slice(0,-1)),d=h.bin||this.binning.bin,t.bin.charAt(0)){case"*":case"x":case"X":t.bin=d*parseInt(t.bin.slice(1),10);break;case"/":t.bin=d/parseInt(t.bin.slice(1),10);break;case"+":t.bin=d+parseInt(t.bin.slice(1),10);break;case"-":t.bin=d-parseInt(t.bin.slice(1),10);break;case"i":case"I":t.bin=2*d;break;case"o":case"O":t.bin=d/2;break;default:e.isNumber(t.bin)?t.bin=parseInt(t.bin,10):e.error("invalid bin for displaySection: "+t.bin)}switch(t.xcen=m(t.xcen,h.xcen,0),t.ycen=m(t.ycen,h.ycen,0),this.imtab){case"table":t.xdim=m(t.xdim,h.xdim,e.fits.options.table.xdim),t.ydim=m(t.ydim,h.ydim,e.fits.options.table.ydim),t.bin=m(t.bin,h.bin,e.fits.options.table.bin);break;default:t.xdim=m(t.xdim,h.xdim,e.fits.options.image.xdim),t.ydim=m(t.ydim,h.ydim,e.fits.options.image.ydim),t.bin=m(t.bin,h.bin,e.fits.options.image.bin)}t.binMode=m(t.binMode,h.binMode,e.globalOpts.binMode),"string"==typeof t.bin&&(t.bin.match(/[as]$/)&&(t.binMode=t.bin.slice(-1)),t.bin=parseInt(t.bin,10)),t.bin=Math.max(1,t.bin||1),t.filter=m(t.filter,h.filter,""),this.raw.filter=t.filter||"",!1!==t.waiting&&e.waiting(!0,g.display),window.setTimeout(function(){switch(n){case"parentFile":s=g.proxyFile,(f=[]).push({name:"xcen",value:t.xcen}),delete t.xcen,f.push({name:"ycen",value:t.ycen}),delete t.ycen,f.push({name:"xdim",value:t.xdim}),f.push({name:"ydim",value:t.ydim}),void 0!==t.xdim&&(t.xdim=0),void 0!==t.ydim&&(t.ydim=0),t.binMode&&(t.bin=sprintf("%s%s",t.bin,t.binMode),delete t.binMode),f.push({name:"bin",value:t.bin}),delete t.bin,f.push({name:"filter",value:t.filter||""}),f.push({name:"slice",value:t.slice||""}),delete t.slice,(r={id:g.expandMacro("$id"),image:g.file,fits:g.parentFile,rtype:"text"}).cmd="js9Xeq imsection "+g.parentFile,t.extension&&(r.cmd=r.cmd.replace(/\[.*\]/,""),r.cmd+="["+t.extension+"]",delete t.extension),r.cmd+=g.expandMacro(" $xdim@$xcen,$ydim@$ycen,$bin $filter $slice",f),e.helper.send("imsection",r,function(i){var a,n;if((i="object"==typeof i?i:0<=i.search(e.analOpts.epattern)?{stderr:i}:{stdout:i}).stderr)e.error(i.stderr);else if(i.errcode)e.error("in displaySection: "+i.errcode);else{if(n=i.stdout.split(/\n/),"/"!==(i=e.cleanPath(n[0])).charAt(0)&&(i=e.InstallDir(i)),t.proxyFile=i,s&&s!==t.proxyFile&&g.removeProxyFile(s),n[1]){try{a=JSON.parse(n[1])}catch(r){e.log("couldn't parse imsection as JSON: %s",i),a=null}a&&(t.extname=a.extname,t.extnum=a.extnum,t.hdus=a.hdus,t.parent=a)}n[2]&&(a=e.cleanPath(n[2]),t.parentFile=a),t.ltm2obin=!0,e.fetchURL(i,i,t,function(i){e.cleanupFITSFile(g.raw,!0),!1!==t.waiting&&e.waiting(!0,g.display),e.fits.handleFITSFile(i,t,v)})}});break;case"virtualFile":e.cleanupFITSFile(g.raw,!1),e.getFITSImage(a.fits,a,t,function(e){v(e,t)});break;default:e.error("image section cannot be extracted from this data file")}},e.SPINOUT)},e.Image.prototype.displayExtension=function(t,i,s){var a,n,r,o;if("string"==typeof i)try{i=JSON.parse(i)}catch(l){e.error("can't parse extension opts: "+i,l)}if((i=i||{}).waiting=!1,this.hdus||e.error("no FITS HDUs found for displayExtension()"),void 0===t&&e.error("missing extname/extnum for displayExtension()"),"string"==typeof t){for(i.extension=t,r=t.toLowerCase(),n=a=0;a<this.hdus.length;a++)if(this.hdus[a].name&&this.hdus[a].name.toLowerCase()===r){n++;break}n||e.error(sprintf("no FITS HDU %s for displayExtension()",t))}else"number"==typeof t&&(i.extension=t,this.hdus[t]?r=this.hdus[t].name||t.toString():e.error(sprintf("no FITS HDU %s for displayExtension()",t)));if(i.separate){for(a=sprintf("[%s]",r),t=this.id.replace(/\[.*\]/,"")+a,n=a=0;a<e.images.length;a++)if(t===(o=e.images[a]).id&&0<$("#"+o.display.id).length&&this.display.id===o.display.id){n++;break}if(n)return o.displayImage("display",i),void o.display.clearMessage()}return e.cleanupFITSFile(this.raw,!1),this.displaySection(i,s),this},e.Image.prototype.displaySlice=function(t,i,s){var a;if("string"==typeof i)try{i=JSON.parse(i)}catch(n){e.error("can't parse slice opts: "+i,n)}if((i=i||{}).waiting=!1,void 0===t&&e.error("missing slice for displaySlice()"),"all"===t&&3===this.raw.header.NAXIS)for(this.displaySlice(1,a,s),t=2;t<=this.raw.header.NAXIS3;t++)a=$.extend(!0,{},i,{separate:!0}),this.displaySlice(t,a,s);else i.slice=e.isNumber(t)?sprintf("*:*:%s",t):t,e.cleanupFITSFile(this.raw,!1),this.displaySection(i,s);return this},e.Image.prototype.toArray=function(t){var i,s,a,n,r,o,l,c,h=this.raw.data.buffer;for((t=t||{}).simple=!0,2880==(o=2880-(t=e.raw2FITS(this.raw,t)).length%2880)&&(o=0),i=0;i<o;i++)t+=" ";for(2880==(o=2880-h.byteLength%2880)&&(o=0),i=new ArrayBuffer(t.length+h.byteLength+o),l=new Uint8Array(i),i=0;i<t.length;i++)l[i]=t.charCodeAt(i);if(0<new Int8Array(new Int16Array([1]).buffer)[0])for(r=t.length,n=Math.abs(this.raw.bitpix)/8,c=new Uint8Array(h),i=0;i<c.byteLength;i+=n)for(s=i+n-1,a=0;a<n;s--,a++)l[r++]=c[s];else l.set(new Uint8Array(h),t.length);for(r=t.length+h.byteLength,i=0;i<o;i++)l[r++]=0;return l},e.Image.prototype.wcsAlign=function(){return this.wcsim&&this.params.wcsalign&&this.display===this.wcsim.display},e.Image.prototype.getPan=function(){var t=this.rgb.sect,i=(t.x0+t.x1)/2,s=(t.y0+t.y1)/2;return e.notNull(t.ix)&&(i+=t.ix/(2*t.zoom)),e.notNull(t.iy)&&(s+=t.iy/(2*t.zoom)),{x:i,y:s,ox:t.xcen,oy:t.ycen,x0:t.x0,y0:t.y0,x1:t.x1,y1:t.y1,ix:t.ix||0,iy:t.iy||0}},e.Image.prototype.setPan=function(t,i){var s,a,n,r,o,l;if(!(0<=$.inArray("pan",this.params.disable))){if(0===arguments.length&&(t=this.raw.width/2,i=this.raw.height/2),1===arguments.length&&"string"==typeof t)try{t=JSON.parse(t)}catch(c){e.error("can't parse setPan JSON: "+t,c)}if("object"==typeof t&&(e.notNull((s=t).x)&&e.notNull(s.y)&&(t=s.x,i=s.y),e.notNull(s.px)&&e.notNull(s.py)&&(t=(r=this.logicalToImagePos({x:s.px,y:s.py})).x,i=r.y),"string"==typeof s.wcs&&(r=s.wcs.trim().split(/ +/),s.ra=r[0],s.dec=r[1],3<=r.length&&(s.wcssys=r[2])),e.notNull(s.ra)&&e.notNull(s.dec)&&0<this.raw.wcs&&(s.wcssys&&(n=this.getWCSSys(),o=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(s.wcssys)),"string"==typeof s.ra&&(s.ra=e.saostrtod(s.ra),":"===String.fromCharCode(e.saodtype())&&"galactic"!==this.params.wcssys&&"ecliptic"!==this.params.wcssys&&(s.ra*=15)),"string"==typeof s.dec&&(s.dec=e.saostrtod(s.dec)),r=e.wcs2pix(this.raw.wcs,s.ra,s.dec).trim().split(/ +/),t=parseFloat(r[0]),i=parseFloat(r[1]),n&&(this.setWCSSys(n),e.globalOpts.xeqPlugins=o))),e.isNumber(t)&&e.isNumber(i)||e.error("invalid input for setPan: "+t+" "+i),this.wcsAlign()&&(l=e.globalOpts.panWithinDisplay,e.globalOpts.panWithinDisplay=!0),this.mkSection(t,i),this.display.blendMode)for(s=0;s<e.images.length;s++)(n=e.images[s])!==this&&n.display===this.display&&n.blend.active&&(n.wcsim===this||this.wcsim===n||n.wcsim&&n.wcsim===this.wcsim)&&(n.params.wcsalign||this.params.wcsalign)&&(o=e.pix2pix(this,n,{x:t,y:i}),n.mkSection(o.x,o.y));for(a in this.wcsAlign()&&(e.globalOpts.panWithinDisplay=l),this.displayImage("rgb"),this.layers)this.layers.hasOwnProperty(a)&&this.layers[a].show&&this.layers[a].opts.panzoom&&this.refreshShapes(a);return e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetpan"),this}},e.Image.prototype.getZoom=function(){return this.rgb.sect.zoom},e.Image.prototype.parseZoom=function(e){var t;switch(t=this.rgb.sect.zoom,typeof e){case"string":switch(e.charAt(0)){case"*":case"x":case"X":e=t*parseFloat(e.slice(1));break;case"/":e=t/parseFloat(e.slice(1));break;case"I":case"i":e=2*t;break;case"O":case"o":e=t/2;break;case"T":case"t":e=Math.min(this.display.width/this.raw.width,this.display.height/this.raw.height),e=Math.round(1e6*(e+1e-7))/1e6;break;default:e=parseFloat(e)}break;case"number":break;default:return}return e},e.Image.prototype.setZoom=function(t){var i,s,a,n,r;if(!(0<=$.inArray("zoom",this.params.disable))){if((i=this.parseZoom(t))||e.error("invalid input for setZoom: "+t),this.wcsAlign()&&(r=e.globalOpts.panWithinDisplay,e.globalOpts.panWithinDisplay=!0),this.mkSection(i),this.display.blendMode)for(t=0;t<e.images.length;t++)(a=e.images[t])!==this&&a.display===this.display&&a.blend.active&&(a.wcsim===this||this.wcsim===a||a.wcsim&&a.wcsim===this.wcsim)&&(a.params.wcsalign||this.params.wcsalign)&&(n=e.pix2pix(this,a,this.getPan()),a.mkSection(n.x,n.y,i));for(s in this.wcsAlign()&&(e.globalOpts.panWithinDisplay=r),this.displayImage("rgb"),this.layers)this.layers.hasOwnProperty(s)&&this.layers[s].show&&this.layers[s].opts.panzoom&&this.refreshShapes(s);return e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetzoom"),this}},e.Image.prototype.alignPanZoom=function(t,i){var s,a,n;if(t)return"string"==typeof t&&((s=e.getImage(t))?t=s:e.error("unknown image for alignPanZoom: "+t)),n=this.raw.wcsinfo||{cdelt1:1},a=t.raw.wcsinfo||{cdelt1:1},s=t.getPan(),this.setPan(e.pix2pix(t,this,{x:s.ox,y:s.oy})),this.setZoom((t.rgb.sect.zoom||1)*n.cdelt1/a.cdelt1),this},e.Image.prototype.refreshLayers=function(){this.setZoom(this.getZoom()),this.binning.obin=this.binning.bin,this.rgb.sect.ozoom=this.rgb.sect.zoom},e.Image.prototype.imageToLogicalPos=function(e,t){var i,s,a,n,r,o=e.x;a=e.y;var l="image";switch(t=t||this.params.lcs||"image"){case"physical":this.lcs.physical&&(l=t,i=this.lcs.physical.reverse,s=this.lcs.physical.rrot,n=this.lcs.physical.cx,r=this.lcs.physical.cy);break;case"detector":this.lcs.detector&&(l=t,i=this.lcs.detector.reverse,s=this.lcs.detector.rrot,n=this.lcs.detector.cx,r=this.lcs.detector.cy);break;case"amplifier":this.lcs.amplifier&&(l=t,i=this.lcs.amplifier.reverse,s=this.lcs.amplifier.rrot,n=this.lcs.amplifier.cx,r=this.lcs.amplifier.cy)}return i&&(o=e.x*i[0][0]+e.y*i[1][0]+i[2][0],a=e.x*i[0][1]+e.y*i[1][1]+i[2][1],s&&(i=n+(o-n)*s[0][0]+(a-r)*s[1][0]+s[2][0],a=r+(o-n)*s[0][1]+(a-r)*s[1][1]+s[2][1],o=i),"table"===this.imtab&&(s=0>this.raw.bitpix?.5:1,void 0!==this.raw.header.TABMIN1&&(o=o-s+this.raw.header.TABMIN1),void 0!==this.raw.header.TABMIN2&&(a=a-s+this.raw.header.TABMIN2))),{x:o,y:a,sys:l}},e.Image.prototype.logicalToImagePos=function(e,t){var i,s,a,n,r,o={x:e.x,y:e.y};switch(a=this.raw.header.CRPIX1||1,n=this.raw.header.CRPIX2||1,t=t||this.params.lcs||"image"){case"ophysical":this.lcs.ophysical?(i=this.lcs.ophysical.forward,s=this.lcs.ophysical.frot):this.lcs.physical&&(i=this.lcs.physical.forward,s=this.lcs.physical.frot);break;case"physical":this.lcs.physical&&(i=this.lcs.physical.forward,s=this.lcs.physical.frot);break;case"detector":this.lcs.detector&&(i=this.lcs.detector.forward,s=this.lcs.detector.frot);break;case"amplifier":this.lcs.amplifier&&(i=this.lcs.amplifier.forward,s=this.lcs.amplifier.frot)}return i&&("table"===this.imtab&&(r=0>this.raw.bitpix?.5:1,void 0!==this.raw.header.TABMIN1&&(e.x=e.x-this.raw.header.TABMIN1+r),void 0!==this.raw.header.TABMIN2&&(e.y=e.y-this.raw.header.TABMIN2+r)),o.x=e.x*i[0][0]+e.y*i[1][0]+i[2][0],o.y=e.x*i[0][1]+e.y*i[1][1]+i[2][1],s&&(i=a+(o.x-a)*s[0][0]+(o.y-n)*s[1][0]+s[2][0],s=n+(o.x-a)*s[0][1]+(o.y-n)*s[1][1]+s[2][1],o.x=i,o.y=s)),o},e.Image.prototype.displayToImagePos=function(e){var t=this.rgb.sect;return{x:(e.x-this.ix+.5)/t.zoom+t.x0+.5,y:(this.rgb.img.height-(e.y-this.iy+.5))/t.zoom+t.y0+.5}},e.Image.prototype.imageToDisplayPos=function(e){var t=this.rgb.sect;return{x:(e.x-.5-t.x0)*t.zoom+this.ix-.5,y:(t.y0-(e.y-.5))*t.zoom+this.rgb.img.height+this.iy-.5}},e.Image.prototype.logicalToDisplayPos=function(e,t,i){return this.imageToDisplayPos(this.logicalToImagePos(e,t,i))},e.Image.prototype.displayToLogicalPos=function(e){return this.imageToLogicalPos(this.displayToImagePos(e))},e.Image.prototype.getWCSSys=function(){if(this.params.wcssys)return this.params.wcssys},e.Image.prototype.setWCSSys=function(t){if(!(0<=$.inArray("wcs",this.params.disable)))return"image"===t?(this.params.wcssys="image",this.params.wcsunits="pixels",e.wcsunits.image="pixels"):"physical"===t?(this.params.wcssys="physical",this.params.wcsunits="pixels",e.globalOpts.wcsUnits.physical="pixels"):this.raw.wcs&&0<this.raw.wcs&&("native"===t&&(t=this.params.wcssys0),t=e.wcssys(this.raw.wcs,t))&&(this.params.wcssys=t.trim(),this.setWCSUnits(t=e.globalOpts.wcsUnits[this.params.wcssys]||"sexagesimal")),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetwcssys"),this},e.Image.prototype.initWCS=function(t){var i,s,a,n=/(WCSNAME|WCSAXES|CRVAL[0-9]|CRPIX[0-9]|PC[0-9]_[0-9]|CDELT[0-9]|CD[0-9]_[0-9]|CTYPE[0-9]|CUNIT[0-9]|CRVAL[0-9]|PV[0-9]_[0-9]|PS[0-9]_[0-9]|RADESYS|LONPOLE|LATPOLE)([A-Z])/;if(!this.raw.header)return this;for(s in t=t||this.raw.header,this.freeWCS(),this.raw.altwcs={},this.raw.altwcs[i="default"]={},this.raw.altwcs[i].header=t,t)t.hasOwnProperty(s)&&(a=s.match(n))&&a.length&&(this.raw.altwcs[i=a[2]]||(this.raw.altwcs[i]={},this.raw.altwcs[i].header=$.extend({},t)),"RADESYS"===a[1]&&(a[1]="RADECSYS"),this.raw.altwcs[i].header[a[1]]=t[a[0]]);for(s in this.raw.altwcs)if(this.raw.altwcs.hasOwnProperty(s)&&(t=e.raw2FITS(this.raw.altwcs[s].header),this.raw.altwcs[s].wcs=e.initwcs(t),0<this.raw.altwcs[s].wcs))try{this.raw.altwcs[s].wcsinfo=JSON.parse(e.wcsinfo(this.raw.altwcs[s].wcs))}catch(r){}return this.setWCS("default"),this},e.Image.prototype.freeWCS=function(t){var i;if((t=t||this.raw).altwcs)for(i in t.altwcs)t.altwcs.hasOwnProperty(i)&&0<t.altwcs[i].wcs&&(e.freewcs(t.altwcs[i].wcs),t.altwcs[i].wcs=null)},e.Image.prototype.getWCS=function(){var e,t;for(e in this.raw.altwcs)if(this.raw.altwcs.hasOwnProperty(e)&&this.raw.wcs===this.raw.altwcs[e].wcs)return(t=$.extend(!0,{},this.raw.altwcs[e].wcsinfo)).version=e,t.wcsname=this.raw.altwcs[e].header.WCSNAME,t;return null},e.Image.prototype.setWCS=function(t){var i;if(t=t||"default",!this.raw||!this.raw.altwcs)return this;for(i in this.raw.altwcs)if(this.raw.altwcs.hasOwnProperty(i)&&(t===i||t===this.raw.altwcs[i].header.WCSNAME))return 0>=this.raw.altwcs[i].wcs&&e.error("invalid WCS for version: %s",t),this.raw.wcs=this.raw.altwcs[i].wcs,this.raw.wcsinfo=this.raw.altwcs[i].wcsinfo,t=this.raw.wcsinfo&&this.raw.wcsinfo.radecsys?this.raw.wcsinfo.radecsys:"native"!==this.params.wcssys?this.params.wcssys.trim():this.params.lcs,this.setWCSSys(t),this.params.wcssys0||(this.params.wcssys0=t),this.setWCSUnits(this.params.wcsunits),this;e.error("could not find WCS version: "+t)},e.Image.prototype.getWCSUnits=function(){return this.params.wcsunits?this.params.wcsunits:"pixels"},e.Image.prototype.setWCSUnits=function(t){if(!(0<=$.inArray("wcs",this.params.disable)))return"pixels"===t?(this.params.wcssys="physical",this.params.wcsunits="pixels",e.globalOpts.wcsUnits[this.params.wcssys]="pixels"):this.raw.wcs&&0<this.raw.wcs&&("image"!==this.params.wcssys&&"physical"!==this.params.wcssys||this.setWCSSys(this.raw.wcs,e.imageOpts.wcssys),(t=e.wcsunits(this.raw.wcs,t))&&(this.params.wcsunits=t.trim(),e.globalOpts.wcsUnits[this.params.wcssys]=this.params.wcsunits)),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetwcsunits"),this},e.Image.prototype.notifyHelper=function(){var t,i=this,s=new RegExp("^"+e.ANON+"[0-9]*");if(e.helper.connected&&!this.file.match(s)){switch(e.helper.type){case"get":case"post":e.helper.pageid||e.helper.send("pageid",null,function(t){t&&t.trim().match(/^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$/)&&(e.helper.pageid=t,e.helper.js9helper="js9helper")})}e.helper.send("image",{image:this.file},function(s){var a;"object"==typeof s?(a=s.stdout,s.stderr&&1<e.DEBUG&&e.log(s.stderr)):a=s,a&&(s=a.trim().match(/(?:[^\s\[]+|\[[^\]]*\])+/g),i&&"?"!==(s=s[1])&&(e.globalOpts.dataDir?(a=s.lastIndexOf("/")+1,i.fitsFile=e.globalOpts.dataDir+"/"+s.slice(a)):(i.fitsFile=s,0>i.fitsFile.indexOf("/")&&(t=i.file.match(/.*\//))&&t.length&&(s=new RegExp("^"+e.INSTALLDIR),t=t[0].replace(s,""),i.fitsFile=t+i.fitsFile),e.globalOpts.prependJS9Dir&&(i.fitsFile&&!i.fitsFile.match(/^\${JS9_DIR}/)&&"/"!==i.fitsFile.charAt(0)&&(i.fitsFile="${JS9_DIR}/"+i.fitsFile),i.parentFile&&!i.parentFile.match(/^\${JS9_DIR}/)&&"/"!==i.parentFile.charAt(0)&&(i.parentFile="${JS9_DIR}/"+i.parentFile))),1<e.DEBUG&&e.log("JS9 fitsFile: %s %s",i.file,i.fitsFile)),i&&i.fitsFile&&(i.fitsFile=e.cleanPath(i.fitsFile)),i&&i.parentFile&&(i.parentFile=e.cleanPath(i.parentFile)),i.queried||(i.queryHelper("all"),i.queried=!0))})}return this},e.Image.prototype.queryHelper=function(t){var i=this;return t=t||"all",!e.helper.connected||"all"!==t&&"getAnalysis"!==t||this.analysisPackages||e.helper.send("getAnalysis",{fits:this.fitsFile},function(t){if(t)try{i.analysisPackages=JSON.parse(t)}catch(s){e.log("can't get analysis",s)}}),this},e.Image.prototype.expandMacro=function(t,i){var s,a=this;if(t)return t.replace(/\${?([a-zA-Z][a-zA-Z0-9_()]+)}?/g,function(t,n,r){var o;r=function(e,t){var i=e.params.wcssys;if(t)switch(t){case"wcs":"physical"!==i&&"image"!==i||(e.params.wcssys=e.params.wcssys0);break;case"physical":case"image":e.params.wcssys=t}return i};var l=function(e,t){var i;return"table"===e.imtab?e.raw.hdu.table.filter&&!t.match(e.raw.hdu.table.filter)&&(t=t.match(/\]\[/)?t.slice(0,-1)+"&&"+e.raw.hdu.table.filter+"]":t+"["+e.raw.hdu.table.filter+"]"):"image"===e.imtab&&(i=e.file.match(/\[.*\]/))&&(t=t.match(/\[.*\]/)?t.replace(/\[.*\]/,i):t+i),t},c=n.split("(");switch(c[1]&&(c[1]=c[1].replace(/\)$/,"")),c[0]){case"id":o=a.display.divjq.attr("id");break;case"image":case"png":o=a.id;break;case"filename":a.parentFile&&"this"!==c[1]?a.raw&&a.raw.filter?((o=a.parentFile).match(/\[.*\]/)||(o+="[EVENTS]"),o+="["+a.raw.filter+"]"):o=l(a,a.parentFile):a.fitsFile?o=l(a,a.fitsFile):e.error("no FITS file for "+a.id);break;case"fits":a.fitsFile||e.error("no FITS file for "+a.id),o=l(a,a.fitsFile);break;case"parent":a.parentFile||e.error("no parent FITS file for "+a.id),o=a.parentFile;break;case"ext":a.fitsFile?null===(o=a.fitsFile.match(/\[.*\]/))&&(o=""):e.error("no FITS file for "+a.id);break;case"imcenter":o=sprintf("%s,%s",(o=a.displayToLogicalPos({x:a.display.width/2,y:a.display.height/2})).x,o.y);break;case"wcscenter":o=a.displayToImagePos({x:a.display.width/2,y:a.display.height/2}),o=e.pix2wcs(a.raw.wcs,o.x,o.y).replace(/\s+/g,",");break;case"sregions":t=r(a,c[1]),o=a.listRegions("source",{mode:0}).replace(/\s+/g,""),t&&(a.params.wcssys=t);break;case"bregions":t=r(a,c[1]),o=a.listRegions("background",{mode:0}).replace(/\s+/g,""),t&&(a.params.wcssys=t);break;case"regions":t=r(a,c[1]),o=a.listRegions("all",{mode:0}).replace(/\s+/g,""),t&&(a.params.wcssys=t);break;default:if(i)for(s=i.length,r=0;r<s;r++)if(i[r].name===n){o=i[r].value;break}void 0===o&&(o=t)}return o})},e.Image.prototype.lookupAnalysis=function(e){var t,i,s,a=null;if(this.analysisPackages){for(i=0;i<this.analysisPackages.length&&!a;i++)for(s=this.analysisPackages[i],t=0;t<s.length&&(!(a=s[t]).xclass||a.xclass+":"+a.name!==e);t++)a=null;if(a)return a;for(i=0;i<this.analysisPackages.length&&!a;i++)for(s=this.analysisPackages[i],t=0;t<s.length&&(a=s[t]).name!==e;t++)a=null}return a},e.Image.prototype.runAnalysis=function(t,i,s){var a,n=this,r={},o=function(t,i){switch(e.helper||e.error(t,i),e.helper.type){case"nodejs":case"socket.io":e.helper.socket&&"polling"===e.helper.socket.io.engine.transport.name?window.setTimeout(function(){e.error(t,i)},0):e.error(t,i);break;default:e.error(t,i)}};if("string"==typeof i)try{i=JSON.parse(i)}catch(l){e.error("can't parse analysis opts: "+i,l)}if(s=s||e.globalOpts.analysisFunc,e.helper.connected&&this.analysisPackages){if(a=this.lookupAnalysis(t)){if(a.action&&(r.cmd=this.expandMacro(a.action,i)),a.keys)for(r.keys={},t=0;t<a.keys.length;t++)r.keys[a.keys[t]]=this.expandMacro("$"+a.keys[t],i);switch(r.id=this.expandMacro("$id"),r.image=this.file,r.fits=this.fitsFile,r.rtype=a.rtype,e.helper.type){case"nodejs":case"socket.io":i=a.xclass?a.xclass+":"+a.name:a.name;break;default:i="runAnalysis"}return e.waiting(!0,this.display),e.helper.send(i,r,function(t){var i,l;if(e.waiting(!1),(i="object"==typeof t?t:0<=t.search(e.analOpts.epattern)?{stderr:t}:{stdout:t}).errcode=i.errcode||0,s)s.call(n,i.stdout,i.stderr,i.errcode,a);else{if(i.stderr){if(!(0<=(t=i.stderr).search(/WARNING:/i)&&0>t.search(/ERROR:/i)))return void o(t,e.analOpts.epattern);e.log(t)}else if(i.errcode){if(t=sprintf("ERROR: running %s [%s]",a.name,i.errcode),!i.stdout)return void o(t,e.analOpts.epattern);e.log(t)}switch(a.rtype){case"text":case void 0:n.displayAnalysis("text",i.stdout,{divid:e.globalOpts.analysisDiv});break;case"plot":n.displayAnalysis("plot",i.stdout,{divid:e.globalOpts.analysisDiv});break;case"alert":i.stdout&&alert(i.stdout);break;case"fits":case"png":(l=i.stdout.split(/\s+/))&&l[0]&&("/"!==(t=e.cleanPath(l[0])).charAt(0)&&(t=e.InstallDir(t)),i={proxyFile:t},l[1]&&(l=e.cleanPath(l[1]),i.parentFile=l),i.fits2fits=!1,e.Load(t,i,{display:n.display}));break;case"regions":(l=i.stdout.split(/\s+/))&&l[0]&&(t=e.cleanPath(l[0]),e.fetchURL(null,t,r={responseType:"text"},function(e,t){n.addShapes("regions",e,t)}));break;case"catalog":(l=i.stdout.split(/\s+/))&&l[0]&&(t=e.cleanPath(l[0]),e.fetchURL(null,t,r={responseType:"text"},function(e,t){n.loadCatalog(null,e,t)}));break;case"none":break;default:e.error("unknown analysis result type: "+a.rtype)}}}),this}e.error("could not find analysis task: "+t)}},e.Image.prototype.displayAnalysis=function(t,i,s){var a,n,r,o,l,c,h,u,d,p={x:"linear",y:"linear"};u=e.lightOpts[e.LIGHTWIN];var f=function(e){return 0===e?e:Math.log(e)},g=function(e){return 0===e?e:Math.exp(e)},m=function(e,t){var i,s,a;if(!e.text)return null;if(s=e.x||0,"%Y"===e.y.toUpperCase()){for(i=1;i<t.length-1;i++)if(t[i][0]>s){a=Math.max(t[i-1][1],t[i][1],t[i+1][1]);break}}else a=e.y;return{x:s,y:a}},v=function(t,i,s){var a,n,r,o=s.data,l=s.annotations.color||e.plotOpts.annotateColor;for(t.find(".plotAnnotation").remove(),a=0;a<s.annotations.data.length;a++)r=m(n=s.annotations.data[a],o),0>(r=i.pointOffset({x:r.x,y:r.y})).left||r.left>t.width()||(n=sprintf("<div class='plotAnnotation' style='position: absolute; left: %spx; top:%spx; color: %s; font-size: small'>%s</div>",r.left,r.top+-25,l,"&darr;"+n.text),t.append(n))};if("string"==typeof s)try{s=JSON.parse(s)}catch(b){e.error("can't parse display opts: "+s,b)}switch(a=(s=s||{}).winformat,s.divid&&0<$("#"+s.divid).length&&(c=$("#"+s.divid)),l=s.title||"",this&&!l&&(l="AnalysisResults: "+(s=(s=this.fitsFile||this.id||"").split("/").reverse()[0])+sprintf(e.IDFMT,this.display.id)),s="Analysis_"+e.uniqueID(),t){case"text":i="<div class='JS9Analysis'></div><pre class='JS9AnalysisText'>"+(i||"")+"</pre></div>",c?c.html(i):n=e.lightWin(s,"inline",i,l,a=a||u.textWin);break;case"plot":if("string"==typeof i)try{r=JSON.parse(i)}catch(b){e.error("can't plot return data: "+i,b)}else"object"==typeof i&&(r=i);if(!r)return;if(i=sprintf("<div id='%s' class='JS9Analysis'><div id='%sPlot' class='JS9Plot' ></div></div>",s,s),c?c.html(i):n=e.lightWin(s,"inline",i,l,a=a||u.plotWin),o=$("#"+s+" #"+s+"Plot"),c&&(o.css("width",c.css("width")),o.css("height",c.css("height")),o.css("margin",0)),r.data){switch(e.globalOpts.plotLibrary){case"plotly":for(d=function(e,t,i,s){var a;switch(i){case"x":a={xaxis:{type:s,autorange:!0}};break;case"y":a={yaxis:{type:s,autorange:!0}}}Plotly.restyle(e.attr("id"),a)},u=$.extend(!0,{},e.plotOpts,r.opts),r.label&&(u.title=r.label),i={x:[],y:[],type:"scatter"},3<=r.data[0].length&&(i.error_y={type:"data",array:[],visible:!0},r.points&&r.points.yerr&&r.points.yerr.color&&(i.error_y.color=r.points.yerr.color)),a=0;a<r.data.length;a++)i.x.push(r.data[a][0]),i.y.push(r.data[a][1]),i.error_y&&i.error_y.array&&i.error_y.array.push(r.data[a][2]);e.plotOpts.annotate&&r.annotations&&(u.annotations=function(t){var i,s,a,n=t.data,r=t.annotations.color||e.plotOpts.annotateColor,o=[];for(i=0;i<t.annotations.data.length;i++)(a=m(s=t.annotations.data[i],n))&&o.push(s={x:a.x,y:a.y,xref:"x",yref:"y",text:s.text,arrowcolor:r,font:{color:r},showarrow:!0,arrowhead:2,ax:0,ay:-30});return o}(r)),"log"===u.xscale&&(u.xaxis=u.xaxis||{},u.xaxis.type="log",u.xaxis.autorange=!0,p.x="log"),"log"===u.yscale&&(u.yaxis=u.yaxis||{},u.yaxis.type="log",u.yaxis.autorange=!0,p.y="log");try{Plotly.newPlot(o.attr("id"),[i],u)}catch(b){e.error("can't plot data (plotly)",b)}break;default:d=function(e,t,i,s){switch(i){case"x":i=t.getAxes().xaxis;break;case"y":i=t.getAxes().yaxis}switch(s){case"linear":i.options.transform=null,i.options.inverseTransform=null;break;case"log":i.options.transform=f,i.options.inverseTransform=g}p[i]=s,t.setupGrid(),t.draw()},u=$.extend(!0,{},e.plotOpts,r.opts),e.plotOpts.annotate&&r.annotations&&(u.zoomStack.func=function(e,t){v(o,e,r)}),r.color=r.color||u.color,"log"===r.xscale&&(u.xaxis=u.xaxis||{},u.xaxis.transform=f,u.xaxis.inverseTransform=g,p.x="log"),"log"===r.yscale&&(u.yaxis=u.yaxis||{},u.yaxis.transform=f,u.yaxis.inverseTransform=g,p.y="log");try{h=$.plot(o,[r],u)}catch(b){e.error("can't plot data (flot)",b)}e.plotOpts.annotate&&r.annotations&&v(o,h,r)}o.css("outline","none"),o.attr("tabindex",0),o.on("keypress",function(e){if(e=String.fromCharCode(e.which||e.keyCode),"linear"===p[e])p[e]="log";else{if("log"!==p[e])return;p[e]="linear"}d(o,h,e,p[e])})}break;case"params":case"regions":case"textline":c?e.allinone?c.html(i):$.ajax({url:i,cache:!1,dataType:"text",success:function(e){c.html(e)}}):n=e.lightWin(s,n=e.allinone?"inline":"ajax",i,l,a="params"===t?a||u.paramWin:"regions"===t?"small"===e.globalOpts.regionConfigSize?a||u.regWin0:a||u.regWin:a||u.dpathWin)}return n},e.Image.prototype.loadAuxFile=function(t,i){var s,a,n,r,o=this,l=e.auxFiles.length,c=[],h=function(){if(o.aux[a.name]=a,e.Image.prototype.mkOffScreenCanvas.call(r),e.Image.prototype.mkRawDataFromPNG.call(r),i)try{e.xeqByName(i,window,o,a)}catch(t){e.error("in aux mask onload callback",t)}e.DEBUG&&e.log("JS9 %s: %s dims(%d,%d) min/max(%d,%d)",r.type,r.file,r.raw.width,r.raw.height,r.raw.dmin,r.raw.dmax)},u=function(t){if(o.aux[a.name]=a,a.regions=t,i)try{e.xeqByName(i,window,o,a)}catch(s){e.error("in aux region onload callback",s)}},d=function(t){if(o.aux[a.name]=a,a.text=t,i)try{e.xeqByName(i,window,o,a)}catch(s){e.error("in aux text onload callback",s)}},p=function(t,i,s){e.log(sprintf("could not load auxiliary file: %s [%s]",a.url,i))};if(t&&l){for(s=0;s<l;s++)(a=e.auxFiles[s]).image&&!a.regex&&(a.regex=new RegExp(a.image));for(n=t.split(":"),s=0;s<l;s++)if(n[0]===(a=e.auxFiles[s]).name&&this.id.match(a.regex)&&(1===n.length||n[1]===a.type))switch(a.type){case"mask":if(a.im){if(this.aux[a.name]=a,i)try{e.xeqByName(i,window,this,a)}catch(f){e.error("in aux mask callback",f)}}else c.push(a);break;case"regions":if(a.layer){if(this.aux[a.name]=a,i)try{e.xeqByName(i,window,this,a)}catch(f){e.error("in aux regions callback",f)}}else c.push(a);break;case"text":if(a.text){if(this.aux[a.name]=a,i)try{e.xeqByName(i,window,this,a)}catch(f){e.error("in aux text callback",f)}}else c.push(a)}for(s=0;s<c.length;s++)switch(a=c[s],a.type){case"mask":a.im=Object.create(e.Image),(r=a.im).type="aux",r.file=a.url,r.id=r.file.split("/").reverse()[0],r.params={},r.params.scalemin=Number.NaN,r.params.scalemax=Number.NaN,r.raws=[],r.png={},r.png.image=new Image,$(r.png.image).on("load",h).on("error",p),r.png.image.src=e.InstallDir(a.url);break;case"regions":a.layer=this.display.newShapeLayer(t,e.Regions.opts),n=e.InstallDir(a.url),$.ajax({url:n,cache:!1,dataType:"json",mimeType:"application/json",success:u,error:p});break;case"text":n=e.InstallDir(a.url),$.ajax({url:n,cache:!1,dataType:"text",success:d,error:p})}}},e.Image.prototype.saveFITS=function(t){var i;return window.hasOwnProperty("saveAs")?(t=t?t.replace(/\.fz$/i,"").replace(/(png|jpg|jpeg)$/i,"fits"):"js9.fits",i=this.toArray({notab:!0,twoaxes:!0}),i=new Blob([i],{type:"application/octet-binary"}),saveAs(i,t)):e.error("no saveAs function available to save FITS file"),t},e.Image.prototype.saveIMG=function(t,i,s){var a,n,r,o,l,c;if(window.hasOwnProperty("saveAs")){if("number"==typeof s)c=s,s=null;else if("string"==typeof s){if(e.isNumber(s))c=parseFloat(s),s=null;else try{s=JSON.parse(s)}catch(h){s=null}s&&(c=s.quality)}if(t=t||"js9.png",i=i||"image/png",s=s||{},o=this.display.width,l=this.display.height,(n=document.createElement("canvas")).setAttribute("width",o),n.setAttribute("height",l),r=n.getContext("2d"),"image"===s.source?r.putImageData(this.rgb.img,0,0):r.drawImage(this.display.canvas,0,0),!1!==s.layers)for(a in this.layers)this.layers.hasOwnProperty(a)&&"main"===this.layers[a].dlayer.dtype&&this.layers[a].show&&r.drawImage(s=this.layers[a].dlayer.canvasjq[0],0,0,o,l);e.notNull(c)&&(0>c||1<c)&&(c=.95),n.toBlob(function(e){saveAs(e,t)},i,c)}else e.error("no saveAs function available for saving image");return t},e.Image.prototype.savePNG=function(e,t){return(e=e||"js9.png").match(/\.png$/)||(e+=".png"),this.saveIMG(e,"image/png",t)},e.Image.prototype.saveJPEG=function(e,t){return(e=e||"js9.jpg").match(/\.jpg$/)||e.match(/\.jpeg$/)||(e+=".jpg"),this.saveIMG(e,"image/jpeg",t)},e.Image.prototype.updateValpos=function(t,i){var s,a,n,r,o,l,c,h,u,d;s=null;var p=e.floatPrecision(this.params.scalemin,this.params.scalemax);if(n=function(e,t){var i,s="";for(t=t||3,0>e&&(e=Math.abs(e),s="-"),i=""+e;i.length<t;)i="0"+i;return s+i},this.params.valpos){if(void 0===i&&(i=!0),this.valpos)return i&&this.display.displayMessage("info",this.valpos,e.globalOpts.valposTarget),this.valpos;switch(l={x:t.x,y:t.y,sys:"image"},c="image"===this.params.wcssys?l:this.imageToLogicalPos(t),s=this.raw.data[Math.floor(t.y-.5)*this.raw.width+Math.floor(t.x-.5)],this.raw.bitpix){case 8:case 16:case-16:case 32:o=n(s);break;case-32:case-64:o=e.floatFormattedString(s,p,3);break;default:o=n(s)}a=(n=o)+"&nbsp;&nbsp;&nbsp;&nbsp;"+(r=c.x.toFixed(3)+" "+c.y.toFixed(3)+" ("+c.sys+")"),s={ix:l.x,iy:l.y,ipos:l.x.toFixed(2)+"\t\t "+l.y.toFixed(2),isys:"image",px:c.x,py:c.y,ppos:c.x.toFixed(2)+"\t\t "+c.y.toFixed(2),psys:c.sys,ra:"",dec:"",wcspos:"",wcssys:"",racen:"",deccen:"",wcsfov:"",wcspix:"",val:s,val3:o,id:this.id,file:this.file,object:this.object},(this.telescope||this.instrument)&&(s.object+="  (",this.telescope&&(s.object+=this.telescope,this.instrument&&(s.object+=", ")),this.instrument&&(s.object+=this.instrument),s.object+=")"),0<this.raw.wcs&&"image"!==this.params.wcssys&&"physical"!==this.params.wcssys&&(a=n+"&nbsp;&nbsp;&nbsp;&nbsp;"+(a=(l=e.pix2wcs(this.raw.wcs,t.x,t.y).trim().split(/\s+/))[0]+" "+l[1]+" ("+(l[2]||"wcs")+")")+"&nbsp;&nbsp;&nbsp;&nbsp;"+r,s.ra=l[0],s.dec=l[1],s.wcspos=l[0]+"\t "+l[1],s.wcssys=l[2],this.raw.wcsinfo&&(l=Math.abs(this.raw.wcsinfo.cdelt1),h=Math.abs(this.raw.wcsinfo.cdelt2),c=1/60,1<=l||1<=h?o="deg":l>=c||h>=c?(o="'",l*=60,h*=60):(o='"',l*=3600,h*=3600),d=this.binning.bin,c=(((u=this.rgb.sect).x1-u.x0)*l).toFixed(0),h=((u.y1-u.y0)*h).toFixed(0),s.wcsfov=c+o+" x "+h+o,c=e.floatFormattedString(l*d/u.zoom,p,3),s.wcspix=c+o+" / pixel",s.wcsfovpix=s.wcsfov+"  ("+s.wcspix+")",l=e.pix2wcs(this.raw.wcs,(u.x1+u.x0)/2,(u.y1+u.y0)/2).trim().split(/\s+/),s.racen=l[0],s.deccen=l[1],s.wcscen=l[0]+"\t "+l[1])),s.vstrsmall=n+"&nbsp;&nbsp;&nbsp;&nbsp;"+r,s.vstr=a,s.vstrmedium=a,s.vstrlarge=a+"&nbsp;&nbsp;&nbsp;&nbsp;"+this.file,i&&this.display.displayMessage("info",s,e.globalOpts.valposTarget)}return s},e.Image.prototype.toggleValpos=function(){this.params.valpos=!this.params.valpos,this.params.valpos||this.display.clearMessage()},e.Image.prototype.getColormap=function(){if(this.cmapObj)return{colormap:this.cmapObj.name,contrast:this.params.contrast,bias:this.params.bias}},e.Image.prototype.setColormap=function(t,i,s){if(!(0<=$.inArray("colormap",this.params.disable)&&this.cmapObj)){switch(arguments.length){case 1:case 3:switch(t){case"rgb":e.globalOpts.rgb.active=!e.globalOpts.rgb.active;break;case"invert":this.params.invert=!this.params.invert;break;case"reset":this.params.invert=e.imageOpts.invert,this.params.contrast=e.imageOpts.contrast,this.params.bias=e.imageOpts.bias;break;default:if(this.cmapObj)switch(this.cmapObj.name){case"red":this===e.globalOpts.rgb.rim&&(e.globalOpts.rgb.rim=null);break;case"green":this===e.globalOpts.rgb.gim&&(e.globalOpts.rgb.gim=null);break;case"blue":this===e.globalOpts.rgb.bim&&(e.globalOpts.rgb.bim=null)}switch(this.cmapObj=e.lookupColormap(t),this.params.colormap=this.cmapObj.name,t){case"red":e.globalOpts.rgb.rim=this;break;case"green":e.globalOpts.rgb.gim=this;break;case"blue":e.globalOpts.rgb.bim=this}}3===arguments.length&&(isNaN(i)||(this.params.contrast=i),isNaN(s)||(this.params.bias=s));break;case 2:isNaN(t)||(this.params.contrast=t),isNaN(i)||(this.params.bias=i)}return this.displayImage("colors"),this.xeqstash&&this.xeqstash.filterRGBImage&&delete this.xeqstash.filterRGBImage,e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetcolormap"),this}},e.Image.prototype.getScale=function(){if(this.params.scale)return{scale:this.params.scale,scalemin:this.params.scalemin,scalemax:this.params.scalemax,scaleclipping:this.params.scaleclipping}},e.Image.prototype.setScale=function(t,i,s){var a=this,n=function(t){0<=e.scales.indexOf(t)?a.params.scale=t:"dataminmax"===t?(a.params.scaleclipping="dataminmax",a.params.scalemin=a.raw.dmin,a.params.scalemax=a.raw.dmax):"zscale"===t?(void 0!==a.params.z1&&void 0!==a.params.z2||a.zscale(!1),a.params.scaleclipping="zscale",a.params.scalemin=a.params.z1,a.params.scalemax=a.params.z2):"zmax"===t?(void 0===a.params.z1&&a.zscale(!1),a.params.scaleclipping="zmax",a.params.scalemin=a.params.z1,a.params.scalemax=a.raw.dmax):"user"===t?a.params.scaleclipping="user":e.error("unknown scale: "+t)};if(!(0<=$.inArray("scale",this.params.disable))){if(arguments.length){switch(arguments.length){case 1:n(t);break;case 2:this.params.scalemin=parseFloat(t),this.params.scalemax=parseFloat(i),this.params.scaleclipping="user";break;default:n(t),"zscale"!==t&&"zmax"!==t&&(this.params.scalemin=parseFloat(i),this.params.scalemax=parseFloat(s),this.params.scaleclipping="user")}this.displayImage("colors")}return e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onsetscale"),this}},e.Image.prototype.getParam=function(e){return e?"all"===e?this.params:this.params[e]:null},e.Image.prototype.setParam=function(e,t){var i,s;if(!e)return null;if("all"===e&&"object"==typeof t)return $.extend(!0,this.params,t),(t.colormap||t.contrast||t.bias)&&(s=this.getColormap(),t.colormap=t.colormap||s.colormap,t.contrast=t.contrast||s.contrast,t.bias=t.bias||s.bias,this.setColormap(t.colormap,t.contrast,t.bias)),(t.scale||t.scalemin||t.scalemax)&&(s=this.getScale(),t.scale=t.scale||s.scale,t.scalemin=t.scalemin||s.scalemin,t.scalemax=t.scalemax||s.scalemax,this.setScale(t.scale,t.scalemin,t.scalemax)),t.invert&&(this.params.invert=t.invert,this.displayImage("colors")),t.zoom&&this.setZoom(t.zoom),t.wcssys&&this.setWCSSys(t.wcssys),t.wcsunits&&this.setWCSUnits(t.wcsunits),this.params;if("disable"===e){for($.isArray(t)||(t=[t]),i=0;i<t.length;i++)0>(s=$.inArray(t[i],this.params.disable))&&this.params.disable.push(t[i]);return this.params.disable}if("enable"===e){for($.isArray(t)||(t=[t]),i=0;i<t.length;i++)0<=(s=$.inArray(t[i],this.params.disable))&&this.params.disable.splice(s,1);return this.params.disable}switch(i=this.params[e],this.params[e]=t,e){case"colormap":this.setColormap(t);break;case"invert":this.displayImage("colors");break;case"contrast":s=this.getColormap(),this.setColormap(s.colormap,t,s.bias);break;case"bias":s=this.getColormap(),this.setColormap(s.colormap,s.contrast,t);break;case"scale":this.setScale(t);break;case"scalemin":s=this.getScale(),this.setScale("user",t,s.scalemax);break;case"scalemax":s=this.getScale(),this.setScale("user",s.scalemin,t);break;case"scaleclipping":s=this.getScale(),this.setScale(t,s.scalemin,s.scalemax);break;case"wcssys":this.setWCSSys(t);break;case"wcsunits":this.setWCSUnits(t);break;case"zoom":this.setZoom(t)}return i},e.Image.prototype.dataminmax=function(e,t){var i,s,a=isNaN(this.params.scalemin)||void 0===this.params.scalemin,n=isNaN(this.params.scalemax)||void 0===this.params.scalemax;if("dataminmax"===this.params.scaleclipping&&(this.raw.dmin!==this.params.scalemin&&void 0!==this.raw.dmin||(a=!0),this.raw.dmax!==this.params.scalemax&&void 0!==this.raw.dmax||(n=!0)),void 0!==e&&void 0!==t)this.raw.dmin=e,this.raw.dmax=t;else if(this.raw.dmin=Number.MAX_VALUE,this.raw.dmax=Number.MIN_VALUE,0<this.raw.bitpix)if(void 0!==this.raw.header.BLANK)for(s=this.raw.header.BLANK,i=0;i<this.raw.data.length;i++)this.raw.data[i]!==s&&(this.raw.dmin=Math.min(this.raw.dmin,this.raw.data[i]),this.raw.dmax=Math.max(this.raw.dmax,this.raw.data[i]));else for(i=0;i<this.raw.data.length;i++)this.raw.dmin=Math.min(this.raw.dmin,this.raw.data[i]),this.raw.dmax=Math.max(this.raw.dmax,this.raw.data[i]);else for(i=0;i<this.raw.data.length;i++)isNaN(this.raw.data[i])||(this.raw.dmin=Math.min(this.raw.dmin,this.raw.data[i]),this.raw.dmax=Math.max(this.raw.dmax,this.raw.data[i]));return a&&(this.params.scalemin=this.raw.dmin),n&&(this.params.scalemax=this.raw.dmax),this},e.Image.prototype.zscale=function(t){var i,s,a;if(!e.zscale||!this.raw||!this.raw.data)return this;s=(i=this.raw.data).length*i.BYTES_PER_ELEMENT;try{a=e.vmalloc(s)}catch(n){e.error("image too large for zscale malloc: "+s,n)}try{e.vmemcpy(new Uint8Array(i.buffer),a)}catch(n){e.error("can't copy image to zscale heap: "+s,n)}return i=e.zscale(a,this.raw.width,this.raw.height,this.raw.bitpix,this.params.zscalecontrast,this.params.zscalesamples,this.params.zscaleline),e.vfree(a),a=i.trim().split(/\s+/),this.params.z1=parseFloat(a[0]),this.params.z2=parseFloat(a[1]),"zmax"===t?(this.params.scalemin=this.params.z1,this.params.scalemax=this.raw.dmax):t&&(this.params.scalemin=this.params.z1,this.params.scalemax=this.params.z2),this},e.Image.prototype.countsInRegions=function(t){var i,s,a,n,r,o=this,l="field",c="";for(n=function(t,i,s){var a,n;if(a=/(annulus|box|circle|ellipse|line|polygon|point|text) *\(/,!t)return s;if("string"==typeof t){if(!(i=o.expandMacro(t)))return s;if(i.match(a))return i}for((a=o.getShapes("regions",t))&&a.length||e.error("no regions found: "+t),i="",t=0;t<a.length;t++)n=a[t],o.params.wcssys?(i||(i=n.wcssys||""),i+=sprintf("; %s",n.wcsstr)):(i||(i=n.imsys||""),i+=sprintf("; %s",n.imstr));return i||s},this.raw.hdu&&this.raw.hdu.fits&&this.raw.hdu.fits.vfile||e.error("no virtual file available for regcnts: "+this.id),i=0;i<arguments.length;i++)if("string"==typeof(s=arguments[i])&&"{"===s.charAt(0))try{arguments[i]=JSON.parse(s)}catch(h){e.error("can't parse json arg in regcnts: "+s,h)}switch(arguments.length){case 0:break;case 1:"object"==typeof arguments[0]?r=arguments[0]:l=n(arguments[0],"$sregions","field");break;case 2:l=n(arguments[0],"$sregions","field"),"object"==typeof arguments[1]?r=arguments[1]:c=n(arguments[1],"$bregions","");break;default:l=n(arguments[0],"$sregions","field"),c=n(arguments[1],"$bregions",""),r=arguments[2]}return(r=r||{}).reduce=r.reduce||e.globalOpts.reduceRegcnts,r.dim=r.dim||Math.max(e.globalOpts.image.xdim,e.globalOpts.image.ydim),s=r.cmdswitches||"",i=this.raw.hdu.fits.vfile,(n=this.file.match(/\[.*\]/))&&(i+=n),"table"===this.imtab?(n=this.raw.hdu.table.filter)&&!i.match(n)&&(i=i.match(/\]\[/)?i.slice(0,-1)+"&&"+n+"]":i+"["+n+"]"):3===this.raw.header.NAXIS&&0>s.search(/(^| )-c/)&&(s+=sprintf(" -c %s",this.raw.hdu.slice||1)),r.reduce&&!this.parentFile&&(n=this.fileDimensions(),1<(n=Math.floor(Math.max(n.xdim,n.ydim)/r.dim+.5))&&("table"===this.imtab?s+=sprintf(" -b %s",n):(a=sprintf("bin%s_%s",n,i.split("/").reverse()[0]),n=sprintf("0@0,0@0,%s",n),e.imsection(i,a,n,""),i=a))),e.waiting(!0,this.display),s=e.regcnts(i,l,c,s),e.waiting(!1),a&&e.vunlink(a),(s.match(/^ERROR/)||s.match(/FITSIO status/))&&e.error(s),r.lightwin&&this.displayAnalysis("text",s,{divid:e.globalOpts.analysisDiv}),s},e.Image.prototype.radialProfile=function(t){var i,s,a,n,r,o;for(r=[],o={cmdswitches:"-j -r"},i=0;i<arguments.length;i++)"object"==typeof arguments[i]?(s=$.extend(!0,{},arguments[i],o),r.push(s),n=s):r.push(arguments[i]);s||r.push(o),n=n||{},i=e.Image.prototype.countsInRegions.apply(this,r);try{a=JSON.parse(i)}catch(l){e.error("can't parse regcnts JSON",l)}for(a.columnUnits.radii||e.error("no radii available for radial profile"),i=a.columnUnits.radii,s=a.columnUnits.surfBrightness,r=n.color||"green",o=n.errorcolor||"red",n=e.isNull(n.errorbars)||n.errorbars?"y":"n",n={color:sprintf("%s",r),label:sprintf("surface brightness(%s) vs. radius(%s)",s,i),points:{errorbars:sprintf("%s",n),yerr:{show:"true",color:sprintf("%s",o)}},data:[]},i=0;i<a.backgroundSubtractedResults.length;i++)("undefined"===(s=a.backgroundSubtractedResults[i]).radius2||"NA"===s.radius2||s.radius1>s.radius2)&&e.error("radial profile source region must be an annulus"),n.data.push(s=[(s.radius1+s.radius2)/2,s.surfBrightness,s.surfError]);return this.displayAnalysis("plot",n,{divid:e.globalOpts.analysisDiv})},e.Image.prototype.plot3d=function(t,i,s){var a,n,r,o,l,c,h=[];for(this.raw.header&&3===this.raw.header.NAXIS||e.error("plot3d requires a data cube with 3 dimensions"),(s=$.extend(!0,{},s,e.globalOpts.plot3d)).cube=s.cube||"*:*:all",r=s.cube.split(":"),a=0;a<r.length;a++)if("all"===r[a]){l=a+1;break}l||e.error("plot3d requires specification of cube's third index"),s.cmdswitches=sprintf("-j -c %s",s.cube),r=s.mode||"avg",s.areaunits?s.areaunits.match(/^p/)?(s.areaunits="pixels",s.cmdswitches+=" -p"):s.areaunits.match(/^a/)?s.areaunits="arcsec":(s.areaunits="pixels",s.cmdswitches+=" -p"):(s.areaunits="pixels",s.cmdswitches+=" -p"),a=s.color||"green",t=this.countsInRegions(t,i,s);try{o=JSON.parse(t)}catch(u){e.error("can't parse regcnts results: "+t,u)}for(t=(t=this.raw.header["CTYPE"+String(l)])?sprintf("%s",t.toLowerCase()):"slice",i="avg"===r?"pixels"===s.areaunits?"counts/pixel**2":"counts/arcsec**2":sprintf("summed counts"),i={color:sprintf("%s",a),label:sprintf("%s vs %s ",i,t),data:[]},c=this.raw.header["CRVAL"+String(l)]||0,l=this.raw.header["CDELT"+String(l)]||1,a=0;a<o.source.cubeSlices;a++){for(t="backgroundSubtractedResults"+String(a+1),n=h[a]=0;n<o[t].length;n++)h[a]="avg"===r?h[a]+o[t][n].surfBrightness:h[a]+o[t][n].netCounts;i.data.push(t=[a*l+c,h[a]])}return this.displayAnalysis("plot",i,{divid:s.divid||e.globalOpts.analysisDiv})},e.Image.prototype.rawDataLayer=function(t,i){var s,a,n,r,o,l;if(!arguments.length)return this.raw.id;if("string"==typeof t){if("function"!=typeof i){for(n=t,s=0;s<this.raws.length;s++)if(n===(r=this.raws[s]).id){if("remove"===i){if(n===e.RAWID0&&e.error("can't remove primary (raw0) data layer"),r.hdu&&r.hdu.fits&&1>=(a=e.lookupVfile(r.hdu.fits.vfile)).length&&e.cleanupFITSFile(r,!0),this.raw=this.raws[0],r.current0&&r.current0.id)for(a=0;a<this.raws.length;a++)if(r.current0.id===this.raws[a].id){this.raw=this.raws[a];break}for(a=0;a<e.images.length;a++)if((r=e.images[a]).xeqstash)for(o in r.xeqstash)r.xeqstash.hasOwnProperty(o)&&r.xeqstash[o].id===n&&delete r.xeqstash[o];this.raws.splice(s,1)}else this.raw=r;return this.raw.header.BITPIX&&(this.raw.bitpix=this.raw.header.BITPIX),this.imtab=this.raw.imtab||this.imtab,this.dataminmax(),this.mkSection(),this.initWCS(),this.initLCS(),this.displayImage("all"),this.refreshLayers(),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onrawdatalayer"),!0}return!1}t={rawid:t}}if("function"!=typeof i)return!1;if("string"==typeof t)try{t=JSON.parse(t)}catch(c){e.error("can't parse rawData opts: "+t,c)}if(o=(t=t||{}).rawid||e.RAWIDX,void 0===t.oraw&&(t.oraw="current0"),"current"===t.oraw)n=this.raw;else if("current0"===t.oraw)n=this.raw.id===o?this.raw.current0:this.raw;else for(s=0;s<this.raws.length;s++)if(t.oraw===(r=this.raws[s]).id){n=r;break}for(n||(n=this.raws[0]),r=-1,s=0;s<this.raws.length;s++)if(o===this.raws[s].id){a=this.raws[s],r=s;break}if(0>r||t.alwaysCopy){if((a=$.extend(!0,{},n)).current0=n,t.bitpix){switch(t.bitpix){case 8:a.data=new Uint8Array(n.height*n.width);break;case 16:a.data=new Int16Array(n.height*n.width);break;case-16:a.data=new Uint16Array(n.height*n.width);break;case 32:a.data=new Int32Array(n.height*n.width);break;case-32:a.data=new Float32Array(n.height*n.width);break;case-64:a.data=new Float64Array(n.height*n.width)}for(l=a.width*a.height,s=0;s<l;s++)a.data[s]=n.data[s];a.bitpix=t.bitpix}else switch(n.bitpix){case 8:a.data=new Uint8Array(n.data);break;case 16:a.data=new Int16Array(n.data);break;case-16:a.data=new Uint16Array(n.data);break;case 32:a.data=new Int32Array(n.data);break;case-32:a.data=new Float32Array(n.data);break;case-64:a.data=new Float64Array(n.data)}a.id=o,a.from=t.from||a.from||"func"}return i.call(this,n,a,t)&&(0<=r?this.raws[r]=a:this.raws.push(a),this.raw=a,this.raw.header.bitpix&&(this.raw.bitpix=this.raw.header.bitpix),!1!==t.dataminmax&&this.dataminmax(),this.displayImage("all",t)),!0},e.Image.prototype.gaussBlurData=function(t){var i={};if(void 0===t&&e.error("missing sigma value for gaussBlurData"),this.params.sigma=t,"string"==typeof i)try{i=JSON.parse(i)}catch(s){e.error("can't parse gaussBlur opts: "+i,s)}return(i=i||{}).bitpix=-64===this.raw.bitpix?-64:-32,i.oraw="current0",i.alwaysCopy=!0,i.rawid=i.rawid||"gaussBlur",i.sigma=t,this.xeqStashSave("gaussBlurData",Array.prototype.slice.call(arguments),i.rawid),this.rawDataLayer(i,function(i,s){var a;switch(s.bitpix){case-32:a=new Float32Array(s.data);break;case-64:a=new Float64Array(s.data);break;default:e.error("invalid temp bitpix for gaussBlur: "+s.bitpix)}return gaussBlur(a,s.data,s.width,s.height,t),!0}),this},e.Image.prototype.imarithData=function(t,i,s){var a;if(!arguments.length)return"add sub mul div min max reset".split(" ");if("string"==typeof s)try{s=JSON.parse(s)}catch(n){e.error("can't parse imarith opts: "+s,n)}if((s=s||{}).rawid=s.rawid||"imarith","reset"!==t&&"remove"!==t){switch(void 0!==t&&void 0!==i||e.error("missing arg(s) for image arithmetic"),this.xeqStashSave("imarithData",Array.prototype.slice.call(arguments),s.rawid),t){case"add":case"sub":case"mul":case"div":case"min":case"max":s.op=t;break;default:e.error("invalid operator for image arithmetic: "+t)}if("object"==typeof i?(this.raw.width===i.raw.width&&this.raw.height===i.raw.height||e.error("images must be the same size for image arithmetic"),s.argtype="image",s.argval=i):e.isNumber(i)?(s.argtype="value",s.argval=i):((a=e.lookupImage(i))||e.error("imarith arg1 must be an image or a constant: "+i),s.argval=a,s.argtype="image"),"div"===s.op&&"value"===s.argtype&&0===s.argval&&e.error("imarith can't divide by zero (nor can anyone else)"),!s.bitpix)switch(s.argtype){case"image":s.bitpix=0<this.raw.bitpix&&0<s.argval.raw.bitpix?Math.max(this.raw.bitpix,s.argval.raw.bitpix):0>this.raw.bitpix&&0>s.argval.raw.bitpix?Math.min(this.raw.bitpix,s.argval.raw.bitpix):0>this.raw.bitpix&&0<s.argval.raw.bitpix?this.raw.bitpix:s.argval.raw.bitpix;break;case"value":s.bitpix=-64===this.raw.bitpix?-64:-32}return s.alwaysCopy=!0,s.oraw="current",this.rawDataLayer(s,function(t,i,s){switch(s.argtype){case"image":switch(t=s.argval.raw.data,s.op){case"add":for(s=0;s<i.data.length;s++)i.data[s]+=t[s];break;case"sub":for(s=0;s<i.data.length;s++)i.data[s]-=t[s];break;case"mul":for(s=0;s<i.data.length;s++)i.data[s]*=t[s];break;case"div":for(s=0;s<i.data.length;s++)i.data[s]=0===t[s]?0:i.data[s]/t[s];break;case"min":for(s=0;s<i.data.length;s++)i.data[s]=Math.min(i.data[s],t[s]);break;case"max":for(s=0;s<i.data.length;s++)i.data[s]=Math.max(i.data[s],t[s]);break;default:e.error("unknown operation for imarith: "+s.op)}break;case"value":switch(t=s.argval,s.op){case"add":for(s=0;s<i.data.length;s++)i.data[s]+=t;break;case"sub":for(s=0;s<i.data.length;s++)i.data[s]-=t;break;case"mul":for(s=0;s<i.data.length;s++)i.data[s]*=t;break;case"div":for(s=0;s<i.data.length;s++)i.data[s]=0===t?0:i.data[s]/t;break;case"min":for(s=0;s<i.data.length;s++)i.data[s]=Math.min(i.data[s],t);break;case"max":for(s=0;s<i.data.length;s++)i.data[s]=Math.max(i.data[s],t);break;default:e.error("unknown op for imarith: "+s.op)}break;default:e.error("unknown argument type for imarith: "+s.argtype)}return!0}),this}this.rawDataLayer(s.rawid,"remove")},e.Image.prototype.shiftData=function(t,i,s){if(void 0!==t&&void 0!==i||e.error("missing translation value(s) for shiftData"),"string"==typeof s)try{s=JSON.parse(s)}catch(a){e.error("can't parse shift opts: "+s,a)}return(s=s||{}).rawid=s.rawid||"shift",s.x=t,s.y=i,this.xeqStashSave("shiftData",Array.prototype.slice.call(arguments),s.rawid),this.rawDataLayer(s,function(e,t,i){var s,a,n,r,o=e.data.BYTES_PER_ELEMENT;if(void 0===t.xoff&&(t.xoff=0),void 0===t.yoff&&(t.yoff=0),t.xoff+=i.x,t.yoff+=i.y,!i.fill||"clear"===i.fill)if(0<t.bitpix?t.header.BLANK=r=i.blank||t.header.BLANK||0:r=NaN,"function"==typeof t.data.fill)t.data.fill(r);else for(i=0;i<t.data.length;i++)t.data[i]=r;for(i=0;i<e.height;i++)if(!(0>(n=i+t.yoff)||n>=e.height)){if(r=e.width,0>(a=(s=0)+t.xoff)&&(s-=a,r+=a,a=0),a+r>e.width&&(r-=a+r-e.width),0>=r)return!1;s=(i*e.width+s)*o,s=new Uint8Array(e.data.buffer,s,r*o),a=(n*e.width+a)*o,(r=new Uint8Array(t.data.buffer,a,r*o)).set(s)}return!0}),this},e.Image.prototype.rotateData=function(t,i){var s,a,n,r,o,l,c=0,h=0;if(this.raws&&this.raws[0]||e.error("no raw data for reprojection"),(s=this.raws[0]).header&&s.wcsinfo||e.error("no WCS info available for reprojection"),"string"==typeof i)try{i=JSON.parse(i)}catch(u){e.error("can't parse rotate opts: "+i,u)}if((i=i||{}).stash="rotateData",i.rawid="rotate",i.oraw=e.RAWID0,!0!==i.resetSection&&(i.resetSection=!1),a=s.header,n=$.extend(!0,{},a),s.width&&s.height&&(n.NAXIS1=s.width,n.NAXIS2=s.height),s.wcsinfo&&(c=s.wcsinfo.cdelt1||0,h=s.wcsinfo.cdelt2||0),"string"==typeof t)switch(t.toLowerCase()){case"northisup":case"northup":t=0,0<c&&(c=-c),0>h&&(h=-h)}return o=-(r=t)*Math.PI/180,l=Math.sin(o),o=Math.cos(o),e.isNull(a.CD1_1)?(n.CROTA2=r,n.CDELT1=c,n.CDELT2=h):(n.CD1_1=c*o,n.CD1_2=-h*l,n.CD2_1=c*l,n.CD2_2=h*o),s.wcsinfo&&(n.ptype=s.wcsinfo.ptype),this.xeqStashSave("rotateData",Array.prototype.slice.call(arguments),i.rawid),this.reprojectData(n,i)},e.Image.prototype.reproject=function(t,i){var s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y,x={},w=!1;b=/SIMPLE|BITPIX|NAXIS|NAXIS[1-4]|AMDX|AMDY|CD[1-2]_[1-2]|CDELT[1-4]|CNPIX[1-4]|CO1_[1-9][0-9]|CO2_[1-9][0-9]|CROTA[1-4]|CRPIX[1-4]|CRVAL[1-4]|CTYPE[1-4]|CUNIT[1-4]|DATE|DATE_OBS|DC-FLAG|DEC|DETSEC|DETSIZE|EPOCH|EQUINOX|EQUINOX[a-z]|IMAGEH|IMAGEW|LATPOLE|LONGPOLE|MJD-OBS|PC00[1-4]00[1-4]|PC[1-4]_[1-4]|PIXSCALE|PIXSCAL[1-2]|PLTDECH|PLTDECM|PLTDECS|PLTDECSN|PLTRAH|PLTRAM|PLTRAS|PPO|PROJP[1-9]|PROJR0|PV[1-3]_[1-3]|PV[1-4]_[1-4]|RA|RADECSYS|SECPIX|SECPIX|SECPIX[1-2]|UT|UTMID|VELOCITY|VSOURCE|WCSAXES|WCSDEP|WCSDIM|WCSNAME|XPIXSIZE|YPIXSIZE|ZSOURCE|LTM|LTV/,d=/TAN|SIN|ZEA|STG|ARC/;var S=function(t,i){var s;return i?(s=$.extend(!0,{},t),e.isNull(s.CRVAL1)&&!e.isNull(i.crval1)&&(s.CRVAL1=i.crval1),e.isNull(s.CRVAL2)&&!e.isNull(i.crval2)&&(s.CRVAL2=i.crval2),e.isNull(s.CRPIX1)&&!e.isNull(i.crpix1)&&(s.CRPIX1=i.crpix1),e.isNull(s.CRPIX2)&&!e.isNull(i.crpix2)&&(s.CRPIX2=i.crpix2),e.isNull(s.CDELT1)&&!e.isNull(i.cdelt1)&&(s.CDELT1=i.cdelt1),e.isNull(s.CDELT2)&&!e.isNull(i.cdelt2)&&(s.CDELT2=i.cdelt2),e.isNull(s.CROTA2)&&!e.isNull(i.crot)&&(s.CROTA2=i.crot),s):t};if(e.reproject&&t&&this!==t){for(o in this.raws&&this.raws[0]||e.error("no raw data for reprojection"),(p=this.raws[0]).header&&p.wcsinfo||e.error("no WCS info available for reprojection"),i=i||{},r=$.extend(!0,{},p.header))r.hasOwnProperty(o)&&b.test(o)&&delete r[o];if("object"==typeof t){for(o in t.raw&&t.raw.header?l=t.raw.header:t.BITPIX&&t.NAXIS1&&t.NAXIS2?l=t:e.error("invalid wcs object input to reproject()"),l)l.hasOwnProperty(o)&&b.test(o)&&(x[o]=l[o]);if(!(r=$.extend(!0,{},x,r)).NAXIS||!r.NAXIS1||!r.NAXIS2)return;o=e.raw2FITS(r,{addcr:!0}),x="wcs_"+e.uniqueID()+".txt",e.vfile(x,o),y=(o=e.globalOpts.reproj.xdim||e.globalOpts.image.xdim)*(b=e.globalOpts.reproj.ydim||e.globalOpts.image.ydim)*32,(r.NAXIS1*r.NAXIS2*Math.abs(r.BITPIX)>y||p.header.NAXIS1*p.header.NAXIS2*Math.abs(p.header.BITPIX)>y)&&e.error("the max reproject size is "+o+" * "+b+" * 4 bytes/pixel. You can use the Bin/Filter/Section plugin to extract a section, then save it as FITS and reproject the smaller image.")}else x=t;try{d.test(p.wcsinfo.ptype)||(c=S(p.header,p.wcsinfo),n="owcs_"+e.uniqueID()+".txt",e.vfile(n,e.raw2FITS(c,{addcr:!0})),s="awcs_"+e.uniqueID()+".txt",u=e.tanhdr(n,s,""),1<e.DEBUG&&e.log("tanhdr (input): %s %s -> %s",n,s,u),e.vunlink(n),0<=u.search(/\[struct stat="OK"/)&&(i.cmdswitches=i.cmdswitches||"",i.cmdswitches+=" -i "+s)),(t.raw&&!d.test(t.raw.wcsinfo.ptype)||t.ptype&&!d.test(t.ptype))&&(c=S(l,t.raw.wcsinfo),n="owcs_"+e.uniqueID()+".txt",e.vfile(n,e.raw2FITS(c,{addcr:!0})),a="awcs_"+e.uniqueID()+".txt",u=e.tanhdr(n,a,""),1<e.DEBUG&&e.log("tanhdr (reproj): %s %s -> %s",n,a,u),e.vunlink(n),0<=u.search(/\[struct stat="OK"/)&&(e.vunlink(x),x=a))}catch(C){}for(p.hdu&&p.hdu.fits.vfile?(a=p.hdu.fits.vfile,p.hdu.fits.extname?a+=sprintf("[%s]",p.hdu.fits.extname):p.hdu.fits.extnum&&0<p.hdu.fits.extnum&&(a+=sprintf("[%s]",p.hdu.fits.extnum))):(h=this.toArray(),a=this.id.replace(/\.png$/,"_png.fits"),e.vfile(a,h)),n=this.id.replace(/\[.*\]/,"").replace(/\.png$/i,".fits").replace(/\.fz$/i,"").replace(/\.gz$/i,""),n="reproj_"+e.uniqueID()+"_"+n,c=i.rawid||"reproject",l=0;l<this.raws.length&&((d=this.raws[l]).id!==c||!e.cleanupFITSFile(d,!0));l++);p.hdu&&"table"===p.hdu.imtab&&p.hdu.table&&!a.match(/\[bin /)&&(a.match(/\[EVENTS\]/)||(a+="[EVENTS]"),d=p.hdu.table,a+=sprintf("[bin X=%s:%s,Y=%s:%s]",p=Math.floor(d.xcen-d.xdim/2+1),l=Math.floor(d.xcen+d.xdim/2),c=Math.floor(d.ycen-d.ydim/2+1),d=Math.floor(d.ycen+d.ydim/2)));try{0<=(f=n.lastIndexOf("."))&&(g=n.substring(0,f)+"_area"+n.substring(f)),v=i.cmdswitches||"",u=e.reproject(a,n,x,v+=" -a 0 "+e.globalOpts.reprojSwitches),1<e.DEBUG&&e.log("reproject: %s %s %s [%s] -> %s",a,n,x,v,u),e.vunlink(g),e.vunlink(x),s&&e.vunlink(s),h&&e.vunlink(a),0>u.search(/\[struct stat="OK"/)&&(w=!0,(m=u.match(/msg="(.*)"/))&&m[1]?e.error(m[1]+" (from mProjectPP)"):e.error(u))}catch(C){if(w)return;e.vunlink(g),e.vunlink(x),u?e.error(u):e.error("WCS reproject failed",C)}return n}},e.Image.prototype.reprojectData=function(t,i){var s,a,n=this;if(t&&e.reproject&&("string"==typeof t&&((s=e.getImage(t))?t=s:e.error("unknown WCS for reproject: "+t)),this!==t)){if("string"==typeof(i=i||{}))try{i=JSON.parse(i)}catch(r){e.error("can't parse reproject opts: "+i,r)}return i.rawid||this.xeqStashSave("reprojectData",Array.prototype.slice.call(arguments),"reproject"),i.stash||(i.stash="reprojectData"),e.waiting(!0,this.display),window.setTimeout(function(){var s,r;if(r=function(e){n.xeqPlugins("image","onreprojectdata"),(s=s||{}).refreshRegions=!0,!1!==i.resetSection&&(s.resetSection=!0),n.refreshImage(e,s),n.xeqStashCall(n.xeqstash,[i.stash,"reprojectData"])},r=(i=i||{}).reprojHandler||r,a=n.reproject(t,i)){(s=$.extend(!0,{},e.fits.options,i)).rawid=s.rawid||"reproject",t.raw&&t.raw.header&&(s.wcsim=t);try{e.handleFITSFile(a,s,r)}catch(o){e.error("can't process reprojected FITS file",o)}}},e.SPINOUT),this}},e.Image.prototype.filterRGBImage=function(t){var i,s=[],a=Array.prototype.slice.call(arguments);if(!t){for(i in e.ImageFilters)e.ImageFilters.hasOwnProperty(i)&&s.push(i);return s}if("reset"===t||e.ImageFilters[t]||e.error("JS9 image filter '"+t+"' not available"),"reset"===t)return this.setColormap("reset"),this;this.xeqStashSave("filterRGBImage",Array.prototype.slice.call(arguments)),a.shift(),a.unshift(this.display.context,this.rgb.img);try{e.ImageFilters[t].apply(null,a)}catch(n){e.error("JS9 image filter '"+t+"' failed",n)}return this.displayImage("display"),e.globalOpts.extendedPlugins&&this.xeqPlugins("image","onfilterrgbimage"),this},e.Image.prototype.moveToDisplay=function(t){var i,s,a,n=0,r=this.display;if(s=e.lookupDisplay(t),!t||!s)return e.error("could not find display: "+t),null;for(i in this.display.clearMessage(),this.display.context.clear(),this.xeqPlugins("image","onimageclear"),r.layers)r.layers.hasOwnProperty(i)&&("main"!==r.layers[i].dtype||s.layers[i]||s.newShapeLayer(i,r.layers[i].opts));if(s.image)for(i in s.layers)s.layers.hasOwnProperty(i)&&"main"===s.layers[i].dtype&&s.image.showShapeLayer(i,!1,{local:!0});for(i in this.layers)this.layers.hasOwnProperty(i)&&(t=this.layers[i],(a=s.layers[i])?(this.showShapeLayer(i,!1,{local:!0}),t.dlayer=a,t.divjq=a.divjq,t.canvasjq=a.canvasjq,t.canvas=a.canvas):delete this.layers[i]);for(i in this.display=s,this.display.image=this,this.mkSection(),this.displayImage("all"),this.layers)this.layers.hasOwnProperty(i)&&this.showShapeLayer(i,!0,{local:!0});for(this.refreshLayers(),r.image=null,i=0;i<e.images.length;i++)if(r===(s=e.images[i]).display){s.display.image=null,s.displayImage("all"),s.refreshLayers(),n++;break}return!n&&r.winid&&r.winid.close&&(0<=(i=$.inArray(r,e.displays))&&e.displays.splice(i,1),r.winid.close()),this},e.Image.prototype.saveSession=function(t,i){var s,a,n,r,o,l,c,h,u,d,p=function(){var e={};for(c in e.file=this.file,e.dwidth=this.display.width,e.dheight=this.display.height,e.params=$.extend(!0,{},this.params),e.tmp={},"active"===this.tmp.gridStatus&&(e.tmp.gridStatus="active"),u=this.imageToLogicalPos({x:this.rgb.sect.xcen,y:this.rgb.sect.ycen}),(d=this.maybePhysicalToImage(u))&&(u=d),e.sect={},e.sect.xcen=u.x,e.sect.ycen=u.y,e.sect.xdim=this.raw.width,e.sect.ydim=this.raw.height,e.sect.zoom=this.rgb.sect.zoom,e.layers=[],this.layers)this.layers.hasOwnProperty(c)&&"main"===(o=(r=this.layers[c]).dlayer).dtype&&"crosshair"!==c&&"grid"!==c&&((l={}).name=c,l.json=o.canvas.toJSON(o.el),l.dopts=$.extend(!0,{},o.opts),r.catalog&&(l.catalog=r.catalog),r.starbase&&(l.starbase=JSON.stringify(r.starbase)),e.layers.push(l));return e.blend=this.blend,e.xeqstash=this.xeqstash,this.wcsim&&this.wcsim.id&&(e.wcsim=this.wcsim.id),e.params.display&&delete e.params.display,e.params.crosshair=!1,e};if(window.hasOwnProperty("saveAs")||e.error("no saveAs function available to save session"),(t=t||"js9.ses").match(/\.ses$/)||(t+=".ses"),"string"==typeof i)try{i=JSON.parse(i)}catch(f){e.error("can't parse session opts: "+i,f)}if(i=i||{},e.waiting(!0,this.display),a={images:[]},"display"===i.mode)for(s=0;s<e.images.length;s++)(h=e.images[s]).display.id===this.display.id&&a.images.push(p.call(h));else a.images.push(p.call(this));for(a.display={blendMode:this.display.blendMode},a.globals=$.extend(!0,{},e.globalOpts),delete a.globals.rgb,a.cmaps=[],s=0;s<e.colormaps.length;s++)"user"===e.colormaps[s].source&&a.cmaps.push(e.colormaps[s]);try{n=JSON.stringify(a,null,4)}catch(f){e.error("can't create json file for save session",f)}return s=new Blob([n],{type:"application/json"}),saveAs(s,t),e.waiting(!1),t},e.Image.prototype.xeqStashSave=function(t,i,s,a){var n,r;for(a=a||"image",this.xeqstash=this.xeqstash||{},n=0;n<i.length;n++)"object"==typeof i[n]&&(i[n]instanceof e.Image?i[n]=i[n].id:i[n]instanceof e.Display&&(i[n]=i[n].id));for(n=0;n<this.xeqstash.length;n++)if((r=this.xeqstash[n]).func===t&&r.context===a)return r.args=i,this;return this.xeqstash[t]={args:i,id:s,context:a},this},e.Image.prototype.xeqStashCall=function(t,i){var s,a;for(s in t=t||this.xeqstash)if(t.hasOwnProperty(s)&&!(0<=$.inArray(s,i))){(a=t[s]).context=a.context||"image";try{switch(a.context){case"image":this[s].apply(this,a.args);break;case"display":this.display[s].apply(this.display,a.args);break;default:this[s].apply(this,a.args)}}catch(n){e.error("error executing stash: "+s,n,!1)}}},e.Image.prototype.xeqPlugins=function(t,i,s){var a,n,r,o,l,c=function(e,t){var i="JS9:"+e;$(document).trigger(i,t)};if(t&&i&&e.globalOpts.xeqPlugins){for(a in o=this.display.pluginInstances)if(o.hasOwnProperty(a)&&(r=(n=o[a]).plugin.opts,n.isActive(i)&&"function"==typeof r[i])){switch(this.callingPlugin=i,t){case"image":try{r[i].call(n,this),c(i,{im:this})}catch(h){n.errLog(i,h)}break;case"region":case"shape":try{r[i].call(n,this,s),c(i,{im:this,xreg:s})}catch(h){n.errLog(i,h)}break;case"keypress":l=s.originalEvent||s;try{r[i].call(n,this,this.ipos,l),c(i,{im:this,ipos:this.ipos,evt:l})}catch(h){n.errLog(i,h)}break;case"mouse":if(!this.clickInRegion||r[i+"_inRegion"]){l=s.originalEvent||s;try{r[i].call(n,this,this.ipos,l),c(i,{im:this,ipos:this.ipos,evt:l})}catch(h){n.errLog(i,h)}}}delete this.callingPlugin}return this}},e.Image.prototype.uploadFITSFile=function(){var t,i,s=this,a=function(t){delete s.tmp.upload,window.setTimeout(function(){e.progress(!1)},1e3),t.stderr?e.error(t.stderr):t.stdout&&(s.fitsFile=t.stdout.trim(),s.proxyFile=s.fitsFile,e.globalOpts.prependJS9Dir&&!s.fitsFile.match(/^\${JS9_DIR}/)&&"/"!==s.fitsFile.charAt(0)&&(s.fitsFile="${JS9_DIR}/"+s.fitsFile),s.queryHelper("all"))};if(e.worker&&("nodejs"===e.helper.type||"socket.io"===e.helper.type)&&this.raw.hdu&&this.raw.hdu.fits&&this.raw.hdu.fits.vfile)return this.tmp.upload&&e.error("only one upload allowed at a time"),t=this.raw.hdu.fits.vfile,e.helper.send("quotacheck",null,function(n){(n.stderr||n.errcode)&&e.error(n.stderr||"from quotacheck: "+n.errcode),i=e.vread(t,"binary"),e.worker.socketio(function(){s.tmp.upload=!0,e.progress(!0,s.display),e.worker.postMessage("uploadFITS",[t,i],a,[i.buffer])})}),this},e.Image.prototype.removeProxyFile=function(t){var i,s,a=this;if("boolean"==typeof t)s=t;else if("string"==typeof t){if(t.match(/^\//))return;if(i=new RegExp("^"+e.INSTALLDIR),(i=t.replace(i,"")).match(/\.\./))return;i=t}else{if(!this.proxyFile)return;i=this.proxyFile}i&&e.Send("removeproxy",{cmd:"js9Xeq removeproxy "+i},function(e){s&&e&&"OK"===e.stdout.trim()&&(a.proxyFile=null,a.fitsFile=null,a.analysisPackages=null,a.queryHelper("all"))})},e.Image.prototype.starbaseToShapes=function(t,i){var s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y;d=e.globalOpts.catalogs.ras,s=e.globalOpts.catalogs.decs;var x=[],w=e.globalOpts.catalogs,S=function(t,i,s){return(t=e.wcs2pix(t.raw.wcs,i,s).trim().split(/ +/))&&t.length?{x:parseFloat(t[0]),y:parseFloat(t[1])}:null};if(a=function(e,t,i,s){var a,n;if(void 0!==s)n=s;else{for(n=-1,a=0;a<i.length;a++){for(s=0;s<t.length;s++)if(i[a].toLowerCase()===t[s].toLowerCase()){n=e[t[s]];break}if(0<=n)break}if(0>n)for(b=i[0],y=new RegExp("^"+b,"i"),s=0;s<t.length;s++)if(t[s].match(y)){n=e[t[s]];break}if(0>n)for(b=i[0],y=new RegExp(".*"+b+".*","i"),s=0;s<t.length;s++)if(t[s].match(y)){n=e[t[s]];break}}return n},t&&t.data&&t.headline){switch(l=t.data,h=t.delims,0>(d=a(t,c=t.headline,d,(i=i||{}).xcol))&&e.error("can't find an RA column (see Preferences:catalogs)"),0>(p=a(t,c,s,i.ycol))&&e.error("can't find a Dec column (see Preferences:catalogs)"),r=i.shape||w.shape||"circle"){case"box":u=function(e,t,s){return{width:i.width||w.width||7,height:i.height||w.height||7}};break;case"circle":u=function(e,t,s){return{radius:i.radius||w.radius||3.5}};break;case"ellipse":u=function(e,t,s){return{r1:i.r1||w.r1||3.5,r2:i.r2||w.r2||3.5}};break;default:u=function(e,t,s){return{width:i.width||7,height:i.height||7}}}for(m=this.getWCSSys(),this.setWCSSys(v=i.wcssys?i.wcssys:w.wcssys?w.wcssys:"ICRS"),a=s=0;s<l.length;s++)if(f=l[s][d],g=l[s][p],"\0"!==h[d]&&0<=":h ".indexOf(h[d])&&"galactic"!==v&&"ecliptic"!==v&&(f*=15),n=S(this,f,g)){if(o=u.call(this,l[s][1],l[s][1]),o={id:s.toString(),shape:r,x:n.x,y:n.y,width:o.width,height:o.height,radius:o.radius,r1:o.r1,r2:o.r2,angle:0,data:{ra:f,dec:g}},!1!==i.save&&!1!==e.globalOpts.catalogs.save)for(n=0;n<=c.length;n++)c[n]&&(o.data[c[n]]=l[s][n]);i.color&&(o.color=i.color),x[a++]=o}return this.setWCSSys(m),x}},e.Image.prototype.loadCatalog=function(t,i,s){var a,n,r=$.extend(!0,{},e.Catalogs.opts);if(a=e.globalOpts.catalogs,1===arguments.length&&"string"!=typeof t&&(i=t,t=null),2===arguments.length&&"string"!=typeof t&&(s=i,i=t,t=null),i){if(a.tooltip&&(r.tooltip=a.tooltip),"string"==typeof s)try{s=JSON.parse(s)}catch(o){e.error("can't parse catalog opts: "+s,o)}(s=s||{}).color=s.color||a.color||"#00FF00",s.wcssys=s.wcssys||a.wcssys,s.updateWCS=!0,a={convFuncs:{def:function(t){var i={};return i.val=e.saostrtod(t),i.delim=String.fromCharCode(e.saodtype()),"\0"!==i.delim&&0<=" \t-.:hdmsr'\"".indexOf(i.delim)||e.isNumber(t)?i:(i.val=t,i)}},units:s.units||a.units,skip:s.skip||a.skip};try{n=new e.Starbase(i,a)}catch(o){e.error("could not parse catalog. Is it in tab-separated column format?")}return n&&n.data&&n.data.length||e.error("no objects found in catalog"),(a=this.starbaseToShapes(n,s)).length?(t=t||"catalog_"+e.uniqueID(),this.display.newShapeLayer(t,r),this.removeShapes(t),this.layers[t].catalog=i,this.layers[t].starbase=n,this.addShapes(t,a,s)):e.error("no catalog objects found"),this}},e.Image.prototype.saveCatalog=function(t,i){var s,a;return s=i||this.activeShapeLayer(),this.layers[s]&&this.layers[s].catalog||e.error(s&&"undefined"!==s?"no catalog available: "+s:"no active catalog available"),a=new Blob([this.layers[s].catalog],{type:"text/plain;charset=utf-8"}),(t=t||s+".cat").match(/\.cat$/)||(t+=".cat"),window.hasOwnProperty("saveAs")?saveAs(a,t):e.error("no saveAs function available to save catalog"),t},e.Image.prototype.wcs2wcs=function(t,i,s,a){var n,r,o;return n=this.getWCSSys(),r=this.getWCSUnits(),t=t||n,i=i||n,"string"==typeof s&&(":"===(o=e.strtoscaled(s)).dtype&&"galactic"!==t&&"ecliptic"!==t&&(o.dval*=15),s=o.dval),"string"==typeof a&&(a=(o=e.strtoscaled(a)).dval),o=this.setWCSSys(t).getWCSSys(),"native"!==t&&o!==t&&e.error("unknown or invalid wcs: "+t),s=e.wcs2pix(this.raw.wcs,s,a).trim().split(/ +/),t=parseFloat(s[0]),s=parseFloat(s[1]),this.setWCSSys(i),this.setWCSUnits("degrees"),t=e.pix2wcs(this.raw.wcs,t,s).trim(),this.setWCSUnits(r),n!==i&&this.setWCSSys(n),t},e.Image.prototype.wcs2imlen=function(t){var i,s=1;if(t){switch(t=e.strtoscaled(t),void 0!==(i=this.raw.wcsinfo||{cdelt1:1,cdelt2:1}).cdelt1?s=i.cdelt1:void 0!==i.cdelt2&&(s=i.cdelt2),this.params.wcssys){case"image":break;case"physical":this.lcs&&this.lcs.physical&&(t.dval*=this.lcs.physical.forward[0][0]);break;default:t.dtype&&"."!==t.dtype&&"\0"!==t.dtype&&(t.dval=Math.abs(t.dval/s))}return t.dval}},e.Colormap=function(t,i,s,a){var n,r;if(t){switch(this.name=t,arguments.length){case 2:this.type="lut",this.colors=i;break;case 4:this.type="sao",this.vertices=[i,s,a];break;default:e.error("colormap requires a colormap name and 1 or 3 array args")}for(this.source=e.inited?"user":"core",n=0;n<e.colormaps.length;n++)if(e.colormaps[n].name===this.name){e.colormaps[n]=this,r=!0;break}r||e.colormaps.push(this),1<e.DEBUG&&e.log("JS9 colormap:  %s",this.name)}},e.Colormap.prototype.mkColorCell=function(t){var i,s,a,n=e.COLORSIZE,r=[0,0,0];switch(this.type){case"sao":for(s=t/n,t=0;3>t;t++){for(i=(a=this.vertices[t]).length,n=0;n<i&&!(a[n][0]>s);n++);n=0===n?a[0][1]:n===i?a[i-1][1]:(i=(a[n][1]-a[n-1][1])/(a[n][0]-a[n-1][0]))?i*(s-a[n-1][0])+a[n-1][1]:a[n][1],r[t]=255*n}break;case"lut":s=this.colors.length,0>(t=Math.floor(t*s/n))?(r[0]=255*this.colors[0][0],r[1]=255*this.colors[0][1],r[2]=255*this.colors[0][2]):t<s?(r[0]=255*this.colors[t][0],r[1]=255*this.colors[t][1],r[2]=255*this.colors[t][2]):(r[0]=255*this.colors[s-1][0],r[1]=255*this.colors[s-1][1],r[2]=255*this.colors[s-1][2]);break;default:e.error("unknown colormap type")}return r},e.Display=function(t){var i=this;this.divjq=t instanceof jQuery?t:"object"==typeof t?$(t):$("#"+t),this.divjq.attr("id")||this.divjq.attr("id",e.DEFID),this.id=this.divjq.attr("id"),this.tmp={},this.divjq.addClass("JS9"),this.width=this.divjq.attr("data-width"),this.width||(this.width=e.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=e.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.width0=this.width,this.height0=this.height,this.canvas=document.createElement("canvas"),this.canvasjq=$(this.canvas).addClass("JS9Image").attr("id",this.id+"Image").attr("width",this.width).attr("height",this.height).css("z-index",e.ZINDEX),this.displayConjq=$("<div>").addClass("JS9Container").css("z-index",e.ZINDEX).attr("tabindex","0").append(this.canvasjq).appendTo(this.divjq),e.allinone||(this.iconjq=$("<div>").addClass("JS9Logo").css("display","none").css("z-index",e.ZINDEX+1).appendTo(this.divjq),this.iconimgjs=$("<img>").addClass("JS9Logo").attr("src",e.InstallDir("images/js9logo.png")).attr("alt","js9").attr("title","js9").appendTo(this.iconjq),e.globalOpts.logoDisplay&&this.iconjq.css("display","block")),e.globalOpts.resizeHandle&&window.hasOwnProperty("ResizeSensor")&&(this.divjq.css("resize","both").css("overflow","hidden"),e.bugs.webkit_resize&&(this.owidth=parseInt(this.divjq.css("width"),10),this.oheight=parseInt(this.divjq.css("height"),10),this.divjq.css("width",this.width+e.RESIZEFUDGE).css("height",this.height+e.RESIZEFUDGE)),this.resizeSensor=new ResizeSensor(this.divjq,function(){var t=i.divjq.width(),s=i.divjq.height();e.bugs.webkit_resize&&(t-=e.RESIZEFUDGE,s-=e.RESIZEFUDGE),i.resize(t,s)})),this.context=this.canvas.getContext("2d"),e.ANTIALIAS||(this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.msImageSmoothingEnabled=!1),this.tooltip=$("<div>").attr("id","tooltip_"+this.id).addClass("JS9Tooltip").appendTo(this.divjq),this.image=null,this.pluginInstances={},this.layers={},this.initMessages(),this.blendMode=!1,this.mouseActions=e.globalOpts.mouseActions.slice(0),this.touchActions=e.globalOpts.touchActions.slice(0),this.mousetouchZoom=e.globalOpts.mousetouchZoom,this.divjq.on("mouseenter",this,function(t){return e.mouseEnterCB(t)}),this.divjq.on("mouseover",this,function(t){return e.mouseOverCB(t)}),this.divjq.on("mousedown touchstart",this,function(t){return e.mouseDownCB(t)}),this.divjq.on("mousemove touchmove",this,function(t){return e.mouseMoveCB(t)}),this.divjq.on("mouseup touchend",this,function(t){return e.mouseUpCB(t)}),this.divjq.on("mouseout",this,function(t){return e.mouseOutCB(t)}),this.divjq.on("keypress",this,function(t){return e.keyPressCB(t)}),this.divjq.on("keydown",this,function(t){return e.keyDownCB(t)}),this.divjq.on("keyup",this,function(t){return e.keyUpCB(t)}),this.divjq.on("wheel",this,function(t){return e.wheelCB(t)}),this.divjq.on("dragenter",this,function(t){return e.dragenterCB(this.id,t)}),this.divjq.on("dragover",this,function(t){return e.dragoverCB(this.id,t)}),this.divjq.on("dragexit",this,function(t){return e.dragexitCB(this.id,t)}),this.divjq.on("drop",this,function(t){return e.dragdropCB(this.id,t)}),this.divjq.on("contextmenu",this,function(){return!1}),this.addFileDialog("Load",e.globalOpts.imageTemplates),this.addFileDialog("RefreshImage",e.globalOpts.imageTemplates),this.addFileDialog("LoadRegions",e.globalOpts.regionTemplates),this.addFileDialog("LoadSession",e.globalOpts.sessionTemplates),this.addFileDialog("LoadColormap",e.globalOpts.colormapTemplates),this.addFileDialog("LoadCatalog",e.globalOpts.catalogTemplates),e.displays.push(this),e.DEBUG&&e.log("JS9 display:  %s",this.id)},e.Display.prototype.addFileDialog=function(t,i){var s,a,n=this;t&&e.publics[t]&&(a="openLocal"+t+"-"+n.id,s=$("<div>").css("visibility","hidden").css("position","relative").css("top",-50).css("left",-50).appendTo(n.divjq),s=$("<input>").attr("type","file").attr("id",a).attr("multiple",!0).appendTo(s),i&&s.attr("accept",i),s.on("change",function(){var i;for(this.files.length&&e.waiting(!0,n),i=0;i<this.files.length;i++)e.publics[t](this.files[i],{display:n.id});return this.value=null,!1}))},e.Display.prototype.initMessages=function(){this.messageContainer=$("<div>").addClass("JS9Container").css("z-index",e.MESSZINDEX).appendTo(this.divjq),this.infoArea=$("<div>").addClass("JS9Message").appendTo(this.messageContainer),this.regionsArea=$("<div>").addClass("JS9Message").appendTo(this.messageContainer),this.progressArea=$("<div>").addClass("JS9Progress").addClass("JS9Message").appendTo(this.messageContainer),this.progressBar=$("<progress>").addClass("JS9ProgressBar").attr("value",0).attr("max",100).attr("name","progress").appendTo(this.progressArea);try{this.messageContainer.draggable({start:function(t,i){this.oicb=e.globalOpts.internalContrastBias,e.globalOpts.internalContrastBias=!1},stop:function(t,i){e.globalOpts.internalContrastBias=this.oicb}})}catch(t){}return this},e.Display.prototype.displayPlugin=function(t){var i,s,a,n,r,o,l=this;if("string"==typeof t)for(i=0;i<e.plugins.length;i++)if((n=e.plugins[i]).name===t){t=n;break}switch("object"==typeof t&&t.name||e.error("unknown plugin type for displayPlugin"),o=this.pluginInstances[t.name],e.globalOpts.winType){case"light":if(s=e.lightOpts[e.LIGHTWIN],o&&o.status){if("inactive"===o.status){if(o.winHandle&&(o.winHandle.show(),o.status="active",t.opts.onplugindisplay))try{t.opts.onplugindisplay.call(o,this.image)}catch(c){e.log("onplugindisplayCB: %s [%s]\n%s",t.name,c.message,e.strace(c))}}else if("active"===o.status&&o.winHandle&&(o.winHandle.hide(),o.status="inactive",t.opts.onpluginclose))try{t.opts.onpluginclose.call(o,l.image)}catch(c){e.log("onplugincloseCB: %s [%s]\n%s",t.name,c.message,e.strace(c))}}else if(r=t.name.replace(/\s/g,"_"),i=this.id+"_"+r+"_lightDiv",n=this.id+"_"+r+"_outerDiv",r=this.id+"_"+r+"_innerDiv",o||(a=$("<div>").attr("id",n).css("display","none").appendTo($(this.divjq)),$("<div>").addClass(t.name).attr("id",r).attr("data-js9id",this.divjq.attr("id")).css("height","100%").css("width","100%").appendTo(a)),s=sprintf(s.format,a=t.opts.winDims[0]||e.WIDTH,t.opts.winDims[1]||e.HEIGHT,t.opts.winResize?"1":"0"),a=t.opts.toolbarHTML&&0<=t.opts.toolbarHTML.search(/\$title/)?"":t.opts.winTitle||"",a+=sprintf(e.IDFMT,this.id),n=e.lightWin(i,"div",n,a,s),i=$("#"+i+" #"+r),(o=e.instantiatePlugin(i,t,n)).winHandle.onclose=function(){if(o.winHandle.hide(),o.status="inactive",t.opts.onpluginclose)try{t.opts.onpluginclose.call(o,l.image)}catch(c){e.log("onplugincloseCB: %s [%s]\n%s",t.name,c.message,e.strace(c))}return!1},o.status="active",t.opts.onplugindisplay)try{t.opts.onplugindisplay.call(o,this.image)}catch(c){e.log("onplugindisplayCB: %s [%s]\n%s",t.name,c.message,e.strace(c))}break;case"new":e.error("external window support for plugins not yet implemented")}},e.Display.prototype.resize=function(t,i,s){var a,n,r,o,l,c=function(e){e.left+=o,e.top+=l,e.setCoords()};if(e.globalOpts.resize||e.error("display resize not enabled"),!t&&!i)return{width:this.width,height:this.height};if("full"===t){if(s=i,window.innerWidth&&(t=window.innerWidth),window.innerHeight)for(i=window.innerHeight,a=0;a<e.globalOpts.centerDivs.length;a++)this.pluginInstances[n=e.globalOpts.centerDivs[a]]&&(i-=this.pluginInstances[n].divjq.height())}else"image"===t?(this.image||e.error("can't resize display to 'image' without an image"),s=i,t=this.image.raw.width,i=this.image.raw.height):"reset"===t&&(s=i,t=this.width0||t,i=this.height0||i);if(t=Math.floor(t),i=i?Math.floor(i):t,(10>t||10>i)&&e.error("invalid dimension(s) passed to display resize"),t===this.width&&i===this.height)return this;for(r in s=s||{},o=((a=t)-this.width)/2,l=((t=i)-this.height)/2,this.width=a,this.height=t,this.divjq.css("width",a),this.divjq.css("height",t),this.canvasjq.attr("width",a),this.canvasjq.attr("height",t),e.bugs.webkit_resize&&!this.resizing&&(this.owidth=Math.min(this.owidth,a),this.oheight=Math.min(this.oheight,t)),0<=$.inArray("JS9Menubar",e.globalOpts.resizeDivs)&&(e.isNull(s.resizeMenubar)||s.resizeMenubar)&&(i=this.pluginInstances.JS9Menubar)&&$("#"+this.id+"Menubar").css("width",a),0<=$.inArray("JS9Toolbar",e.globalOpts.resizeDivs)&&(e.isNull(s.resizeToolbar)||s.resizeToolbar)&&(i=this.pluginInstances.JS9Toolbar)&&(i.divjq.attr("data-width",String(a)+"px"),e.Toolbar.init.call(i)),0<=$.inArray("JS9Colorbar",e.globalOpts.resizeDivs)&&(e.isNull(s.resizeColorbar)||s.resizeColorbar)&&(i=this.pluginInstances.JS9Colorbar)&&(i.divjq.attr("data-width",String(a)+"px"),e.Colorbar.init.call(i)),this.layers)this.layers.hasOwnProperty(r)&&"main"===(i=this.layers[r]).dtype&&(i.divjq.css("width",a),i.divjq.css("height",t),i.canvasjq.attr("width",a),i.canvasjq.attr("height",t),i.canvas.setWidth(a),i.canvas.setHeight(t),i.canvas.calcOffset());for(a=0;a<e.images.length;a++)if((t=e.images[a]).mkSection(),t.display&&this===t.display&&(t.resize?(t.resize.left+=o,t.resize.top+=l):t.resize={left:o,top:l},t===t.display.image))for(r in t.layers)t.layers.hasOwnProperty(r)&&("main"!==(i=t.layers[r]).dlayer.type||i.json||(i.canvas.getObjects().forEach(c),i.canvas.renderAll()));return e.bugs.webkit_resize&&this.divjq.css("width",this.width+e.RESIZEFUDGE).css("height",this.height+e.RESIZEFUDGE),!this.image||!e.globalOpts.resizeRedisplay&&this.resizing||(this.image.displayImage("all",s),this.image.refreshLayers()),s.center&&this.center(),this},e.Display.prototype.inResize=function(t){return!!(e.globalOpts.resizeHandle&&t.x+e.RESIZEDIST>=this.divjq.width()&&t.y+e.RESIZEDIST>=this.divjq.height())},e.Display.prototype.center=function(){var t,i,s,a;s=(o=this.divjq).offset().top;var n=o.height(),r=$(window).height();a=o.offset().left;var o=o.width(),l=$(window).width();for(t=0;t<e.globalOpts.centerDivs.length;t++)this.pluginInstances[i=e.globalOpts.centerDivs[t]]&&(n+=(i=this.pluginInstances[i].divjq).height(),s=Math.min(i.offset().top,s));return s=n<r?s-(r/2-n/2):s,a=o<l?a-(l/2-o/2):a,$("html, body").animate({scrollTop:s,scrollLeft:a},250),this},e.Display.prototype.gather=function(t){var i,s;if("string"==typeof t)try{t=JSON.parse(t)}catch(a){e.error("can't parse gather opts: "+t,a)}for(i=(t=t||{}).images||e.images,t=0;t<i.length;t++)(s="number"==typeof i[t]?e.images[i[t]]:i[t])&&s.display!==this&&s.moveToDisplay(this);e.globalOpts.extendedPlugins&&this.image&&this.image.xeqPlugins("image","ongatherdisplay")},e.Display.prototype.separate=function(t){var i,s,a,n,r,o,l,c,h,u,d,p,f,g,m,v=this,b=0,y={},x=0,w=0,S=1,C=/_sep[0-9][0-9]*/,A=e.globalOpts.separate,_=e.bugs.webkit_resize?e.RESIZEFUDGE:0,k=function(t,i){switch(t||e.error("can't init seapration ops: no from id"),n=i.leftMargin||A.leftMargin||0,r=i.topMargin||A.topMargin||0,a=i.layout||e.globalOpts.separate.layout||"auto"){case"auto":case"horizontal":w=1,x=0;break;case"vertical":w=0,x=1;break;default:w=1,x=0}o=43,l=0,c=$("#"+t),0<(h=$("#"+t+"Menubar")).length&&(h.isactive="visible"===h.closest(".JS9PluginContainer").css("visibility")),0<(u=$("#"+t+"Toolbar")).length&&(u.isactive="visible"===u.closest(".JS9PluginContainer").css("visibility")),0<(d=$("#"+t+"Colorbar")).length&&(d.isactive="visible"===d.closest(".JS9PluginContainer").css("visibility")),0<c.length&&(p=c.width(),f=c.height(),g=c.offset().top-$(window).scrollTop(),m=c.offset().left-$(document).scrollLeft(),h.isactive&&(f+=h.height(),g-=h.height()),u.isactive&&(f+=u.height(),g-=u.height()),d.isactive&&(f+=d.height(),g-=d.height(),g+=7))},T=function(e,t){var i,s;return e&&(0<c.length&&(i="",h.isactive&&(i+=sprintf("<div class='JS9Menubar' id='%sMenubar' data-width=%s></div>",t,c.width())),u.isactive&&(i+=sprintf("<div class='JS9Toolbar' id='%sToolbar' data-width=%s></div>",t,c.width())),i+=sprintf("<div class='JS9' id='%s' data-width=%s data-height=%s></div>",t,c.width()-_,c.height()-_),d.isactive&&(i+=sprintf("<div style='margin-top: 2px;'><div class='JS9Colorbar' id='%sColorbar' data-width=%s></div></div>",t,c.width()))),"auto"===a&&m+p*(w+.5)>window.innerWidth&&(x++,w=0),s=sprintf("width=%s,height=%s,top=%s,left=%s,resize=1,scolling=1",p,f,g+(f+r+o)*x,m+(p+n+l)*w),"auto"===a||"horizontal"===a?w++:"vertical"===a&&x++),{id:t,html:i,winopts:s}},I=function(a){var n,r;n=b++,a.length>n?(n="number"==typeof a[n]?e.images[a[n]]:a[n])&&n.display===v?(n.displayImage("all"),void 0===i?(k(i=n.display.id,t),I(a)):(s="string"==typeof t.idbase?r=t.idbase+S++:i.replace(C,"")+"_sep"+e.uniqueID(),y[s]=n,$("#dhtmlwindowholder").arrive("#"+s,{onceOnly:!0},function(){r=$(this).attr("id"),window.setTimeout(function(){y[r].moveToDisplay(r),I(a)},0)}),n=T(i,s),r&&(n.id=r),e.LoadWindow(null,{id:n.id},"light",n.html,n.winopts))):I(a):e.globalOpts.extendedPlugins&&v.image&&v.image.xeqPlugins("image","onseparatedisplay")};if("string"==typeof t)try{t=JSON.parse(t)}catch(M){e.error("can't parse separate opts: "+t,M)}I((t=t||{}).images||e.images)},e.Display.prototype.nextImage=function(t){var i,s,a;if(t=t||1,this.image){for(a=this.image.pos,i=0;i<e.images.length&&this.image!==e.images[i];i++);for(s=i+t;s!==i&&(s>=e.images.length&&(s=0),0>s&&(s=e.images.length-1),e.images[s].display!==this);s+=t);return i!==s&&((t=e.images[s]).displayImage("all"),t.refreshLayers(),t.display.clearMessage(),a&&(a=t.displayToImagePos(a),t.valpos=null,t.valpos=t.updateValpos(a,!0))),this}},e.Display.prototype.loadSession=function(t,i){var s,a,n=this,r={},o=function(t){var i,s,o,l,c,h=function(){var i=this.canvas.getObjects();i&&void 0!==i.length&&(t.layers[this.layerName].nshape=i.length+1),e.Fabric.updateChildren(this,null,"objects"),t.refreshLayers()};if((c=r[t.file]||{}).blend&&(t.blend=$.extend(!0,{},c.blend)),c.tmp&&(t.tmp=$.extend(!0,{},c.tmp)),c.wcsim&&(t.wcsim=e.lookupImage(c.wcsim)),c.layers&&c.layers.length)for(i=0;i<c.layers.length;i++)if(l=(o=c.layers[i]).name,!(0<=$.inArray("regions",t.params.disable)&&"regions"===l)&&"crosshair"!==l&&"grid"!==l&&(s=n.newShapeLayer(l,o.dopts),t.addShapes(l,[]),s.canvas.loadFromJSON(o.json,h.bind(s)),o.catalog&&(t.layers[l].catalog=o.catalog),o.starbase))try{t.layers[l].starbase=JSON.parse(o.starbase)}catch(u){}t.tmp&&"active"===t.tmp.gridStatus&&t.displayCoordGrid(!0),e.notNull(a)&&0==--a&&e.images.sort(function(e,t){var i=0,s=0;return r[e.file]&&(i=r[e.file].i),r[t.file]&&(s=r[t.file].i),i-s}),c.xeqstash&&t.xeqStashCall(c.xeqstash),e.globalOpts.extendedPlugins&&e.images[0].xeqPlugins("image","onsessionload")},l=function(t){t.file||e.error("session does not contain a filename"),delete(s=$.extend(!0,{},t)).params.display,s.params.crosshair=!1,s.params.onload=o,t=s.file,s.sect&&(s.params.xcen=s.sect.xcen,s.params.ycen=s.sect.ycen,s.params.xdim=s.sect.xdim,s.params.ydim=s.sect.ydim,s.params.zoom=s.sect.zoom,delete s.sect),window.isElectron&&e.desktopOpts.sessionPath&&i.sessionPath&&"/"!==s.file.charAt(0)&&!s.file.match(e.URLEXP)&&(t=e.fixPath(i.sessionPath+s.file)),r[t]=s,e.Load(t,s.params,{display:n.id})},c=function(t){var i,s;if(t.globalOpts&&($.extend(!0,e.globalOpts,t.globalOpts),delete t.globalOpts),t.cmaps)for(i=0;i<t.cmaps.length;i++)e.AddColormap(t.cmaps[i]);if(t.images)for(a=t.images.length,i=0;i<t.images.length;i++)t.images[i].i=i,l(t.images[i]);else l(t);if(t.display)for(s in t.display)if(t.display.hasOwnProperty(s))switch(s){case"blendMode":e.BlendDisplay(t.display[s],{display:n});break;default:n[s]=t.display[s]}};return i=i||{},e.waiting(!0,this),"object"==typeof t?c(t):$.ajax({url:t,cache:!1,dataType:"json",mimeType:"application/json",async:!1,success:function(e){c(e)},error:function(i,s,a){e.error("could not load session: "+t,a)}}),this},e.Display.prototype.displayMessage=function(e,t,i){},e.Display.prototype.clearMessage=function(e){},e.Display.prototype.createMosaic=function(t,i){var s,a,n,r,o=this,l=function(){var t;for(t=0;t<r.length;t++)e.vunlink(r[t])},c=function(t,i){var s;0>i.search(/\[struct stat="OK"/)&&(e.waiting(!1),l(),(s=i.match(/msg="(.*)"/))&&s[1]?e.error(s[1]+" (from "+t+")"):e.error(i||"unknown "+t+" failure"))},h=function(t,i){var s;i=i||{},s=$.extend(!0,{},i),!1!==i.waiting&&e.waiting(!0,o),s.display=o.id,e.checkNew(new e.Image(t,s)),e.waiting(!1)},u=function(){var t;(i.verbose||1<e.DEBUG)&&(t=sprintf.apply(null,arguments),e.log(t))};if((i=i||{}).reduce=i.reduce||e.globalOpts.reduceMosaic,i.dim=i.dim||Math.max(e.globalOpts.image.xdim,e.globalOpts.image.ydim),t)if("string"==typeof t)if("current"===t)t=this.image?[this.image]:[];else if("all"===t)for(t=[],s=0;s<e.images.length;s++)e.images[s].display.id===o.id&&t.push(e.images[s]);else t=[t];else $.isArray(t)||e.error("unknown input type for createMosaic()");else t=this.image?[this.image]:[];for(t.length||e.error("no images specified for createMosaic()"),s=0;s<t.length;s++)"string"==typeof t[s]&&((a=e.lookupImage(t[s]))?t[s]=a:e.error("unknown image for mosaic: "+t[s])),(a=t[s]).raw.hdu&&a.raw.hdu.fits&&a.raw.hdu.fits.vfile||e.error("no virtual file available for mosaic: "+a.id);return e.waiting(!0,o),window.setTimeout(function(){var a,o,d,p,f,g,m,v,b,y,x,w=e.uniqueID();for(o=(x=function(e){return"mosaic_"+w+"_"+e})("in.lst"),f=x("in.tbl"),p=x("in.hdr"),d=x("bin.lst"),m=x("bin.tbl"),v=x("out.lst"),b=x("out.tbl"),y=x("out.hdr"),a=(x=t[0].id.replace(/\[.*\]/,"").replace(/\.fz$/i,"").replace(/\.gz$/i,"").replace(/\.fits$/i,"_mosaic.fits")).replace(/\.fits$/,"_area.fits"),r=[o,f,p,d,m,v,b,y,a],a=sprintf("%s\n%s\n","|                                                    fname|","|                                                     char|"),s=0;s<t.length;s++)a+=sprintf("%s\n",t[s].raw.hdu.fits.vfile);if(e.vfile(o,a),o=e.imgtbl(o,".",f,"-C"),c("mImgtbl",o),e.vsize(f)||e.error("no image data found with which to construct a mosaic"),o=e.makehdr(f,p,""),c("mMakeHdr",o),"js9"===i.reduce){for(a=e.vread(p).split("\n"),s=p=0;s<a.length;s++)switch(o=a[s].split("="),o[0].trim()){case"NAXIS1":p=Math.max(p,parseFloat(o[1].trim()));break;case"NAXIS2":p=Math.max(p,parseFloat(o[1].trim()))}for(n=Math.max(1,Math.floor(p/i.dim+.5)),a=sprintf("%s\n%s\n","|                                                    fname|","|                                                     char|"),(f=(f=e.vread(f)).trim().split("\n")).splice(0,3),s=0;s<f.length;s++)p=(o=f[s].trim().split(/\s+/))[o.length-2],o=o[o.length-1],p&&o&&(g=sprintf("%s[%s]",o,p),p=sprintf("bin_%s_%s",p,o.split("/").reverse()[0].replace(/\.(g|f)z$/,"")),r.push(p),o=sprintf("0@0,0@0,%s",n),u("bin %s [%s]",g,n),e.imsection(g,p,o,""),a+=sprintf("%s\n",p));e.vfile(d,a),o=e.imgtbl(d,".",m,"-C"),c("mImgtbl",o),e.vsize(m)||e.error("no image data found to construct a mosaic"),o=e.makehdr(m,y,""),c("mMakeHdr",o),f=e.vread(m)}else o=e.shrinkhdr(i.dim,p,y),c("mShrinkHdr",o),f=e.vread(f);for((f=f.trim().split("\n")).splice(0,3),a=sprintf("%s\n%s\n","|                                                    fname|","|                                                     char|"),s=0;s<f.length;s++)p=(o=f[s].trim().split(/\s+/))[o.length-2],o=o[o.length-1],p&&o&&(d="-a 1","shrink"===i.reduce&&(d+=sprintf(" -h %s",p)),d+=" "+e.globalOpts.reprojSwitches,m=sprintf("reproj_%s_%s",p,o.split("/").reverse()[0].replace(/\.(g|f)z$/,"")),a+=sprintf("%s\n",m),r.push(m),r.push(m.replace(/\.fits$/i,"_area.fits")),u("reproject: %s [%s] -> %s",o,p,m),o=e.reproject(o,m,y,d),c("mProjectPP",o));e.vfile(v,a),o=e.imgtbl(v,".",b,""),c("mImgtbl",o),e.vsize(b)||e.error("no FITS files were added to output table for mosaic"),u("create mosaic: %s",x),o=e.madd(b,y,x,""),c("mAdd",o),l(),(v=$.extend(!0,{},e.fits.options,i)).image={xdim:0,ydim:0},v.file=x,e.fits.handleFITSFile(x,v,h)},e.SPINOUT),this},e.Command=function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);t.name||e.error("command has no name"),t.get||t.set||e.error("command requires get and/or set routine"),e.commands.push(this),1<e.DEBUG&&e.log("JS9 command:  %s",this.name)},e.Command.prototype.getDisplayInfo=function(e){return e&&e.id&&(this.display=e,this.image=e.image),this},e.Command.prototype.getWhich=function(e){return this.get&&!this.set?"get":this.set&&!this.get?"set":this.which?this.which(e):0===e.length?"get":"set"},e.Helper=function(){"file:"===e.globalOpts.helperProtocol&&(e.globalOpts.helperProtocol="http:"),document.domain&&"localhost"!==document.domain||(e.globalOpts.htimeout=e.globalOpts.lhtimeout),e.globalOpts.helperProtocol+="//",this.helper=this.connected=!1,this.type=e.allinone&&!e.globalOpts.allinoneHelper?"none":e.globalOpts.helperType||"sock.io",this.pageid=null,this.connect()},e.Helper.prototype.connectinfo=function(){var t;return null===e.helper.connected?"notConfigured":e.helper.connected?(t=sprintf("connected %s %s",e.helper.type,e.helper.url),e.helper.pageid&&(t+="<p>"+e.helper.pageid),t):sprintf("notConnected %s",e.helper.type)},e.Helper.prototype.connect=function(t){var i=e.globalOpts.ehretries,s=e.globalOpts.ehtimeout,a=this,n=function(t,i,s){a.connected=!1,a.helper=!1,a.ready=!0,$(document).trigger("JS9:helperReady",{type:"socket.io",status:"error"}),s&&"timeout"!==s||(s="or connection refused"),s===(i=i||"timeout")&&(i=""),"error"===s&&(s="is the helper running?"),e.globalOpts.requireHelper?e.error("helper connect error: "+i+" "+s):e.DEBUG&&e.log(sprintf("JS9 helper connect error: %s (%s)",i,s))},r=function(t){$.ajax({url:t,dataType:"script",timeout:e.globalOpts.htimeout,success:function(){var t={reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:1e4,reconnectionAttempts:100,timeout:e.globalOpts.htimeout};"undefined"==typeof io?n(0,"socket io object is undefined",null):(a.socket=io.connect(a.url,t),a.socket.on("connect",function(){var t,i;for(a.connected=!0,a.helper=!0,i=[],t=0;t<e.displays.length;t++)i.push(e.displays[t].id);a.socket.emit("initialize",{displays:i,pageid:a.pageid},function(t){a.pageid=t.pageid,a.js9helper=t.js9helper,e.globalOpts.dataPathModify=t.dataPathModify,a.ready=!0,$(document).trigger("JS9:helperReady",{type:"socket.io",status:"OK"}),e.DEBUG&&e.log("JS9 helper: connect: "+a.type)}),$(document).trigger("JS9:connected",{type:"socket.io",status:"OK"})}),a.socket.on("connect_error",function(){a.connected=!1,a.helper=!1,1<e.DEBUG&&e.log("JS9 helper: connect error")}),a.socket.on("connect_timeout",function(){a.connected=!1,a.helper=!1,1<e.DEBUG&&e.log("JS9 helper: connect timeout")}),a.socket.on("disconnect",function(t){a.connected=!1,a.helper=!1,1<e.DEBUG&&e.log("JS9 helper: disconnect: "+t),"io server disconnect"===t&&(1<e.DEBUG&&e.log("JS9 helper: manual reconnect"),a.socket.connect())}),a.socket.on("reconnect",function(){a.connected=!0,a.helper=!0,1<e.DEBUG&&e.log("JS9 helper: reconnect")}),a.socket.on("msg",e.msgHandler))},error:function(e,t,i){n(0,t,i)}})},o=function(e,t,i){$.ajax({url:e,dataType:"jsonp",success:function(){r(t)},error:function(){0<--i?window.setTimeout(function(){o(e,t,i)},s):n()}})};if(t&&(this.type=t),this.socket){try{this.socket.disconnect()}catch(l){e.log("warning: can't disconnect from socket")}this.socket=null}switch(this.url=e.globalOpts.helperURL?0<=e.globalOpts.helperURL.search(/:\/\//)?e.globalOpts.helperURL:e.globalOpts.helperProtocol+e.globalOpts.helperURL:document.domain?location.origin?location.origin:e.globalOpts.helperProtocol+document.domain:e.globalOpts.helperProtocol+"localhost",this.baseurl=this.url,this.type){case"none":this.connected=null,this.ready=!0,$(document).trigger("JS9:helperReady",{type:"none",status:"OK"});break;case"get":case"post":e.globalOpts.helperCGI||e.error("cgi script name missing for helper"),this.url+="/"+e.globalOpts.helperCGI,this.helper=this.connected=!0,e.DEBUG&&e.log("JS9 helper: connect: "+this.type),this.ready=!0,$(document).trigger("JS9:helperReady",{type:"get",status:"OK"});break;case"sock.io":case"nodejs":e.globalOpts.helperPort||e.error("port missing for helper"),this.url=this.url.replace(/:[0-9][0-9]*$/,"")+":"+e.globalOpts.helperPort,this.sockurl=this.url+"/socket.io/socket.io.js",window.isElectron?(this.aliveurl=this.url+"/alive",o(this.aliveurl,this.sockurl,i)):r(this.sockurl);break;default:e.error("unknown helper type: "+this.type)}},e.Helper.prototype.send=function(t,i,s){if(!this.connected)return null;if(i&&"object"==typeof i){try{i.cookie=document.cookie}catch(a){delete i.cookie}e.globalOpts.dataPath&&!i.dataPath&&(i.dataPath=e.globalOpts.dataPath+":.")}else i={dataPath:"."};switch(e.TOROOT&&(i.dataPath+=":"+e.TOROOT),this.type){case"get":case"post":i.key=t,e.helper.pageid&&(i.pageid=e.helper.pageid),e.DEBUG&&e.log("JS9 cgi helper [%s, %s]: %s",this.type,JSON.stringify(i),this.url),$.ajax({url:this.url,type:this.type.toUpperCase(),data:i,dataType:"text",success:function(t){"string"==typeof t&&0<=t.search(e.analOpts.epattern)&&e.log(t),s&&s(t)},error:function(t,i,s){e.DEBUG&&e.log("JS9 helper: "+this.type+" failure: "+i+" "+s)}});break;case"sock.io":case"nodejs":e.helper.socket.emit(t,i,s)}return this},e.WebWorker=function(t){this.worker=new Worker(t),this.worker.onmessage=e.WebWorker.prototype.msgHandler.bind(this),this.handlers=[]},e.WebWorker.prototype.msgHandler=function(t){var i,s=t.data;switch(s.cmd){case"progress":e.progress(s.result.value,s.result.max);break;case"initsocketio":for(this.sockinit=!0,t=0;t<this.handlers.length;t++)if((i=this.handlers[t]).id===s.id){i.func(s.result),this.handlers.splice(t,1);break}break;case"uploadFITS":for(t=0;t<this.handlers.length;t++)if((i=this.handlers[t]).id===s.id){i.func(s.result),this.handlers.splice(t,1);break}break;case"connect_error":case"connect_timeout":1<e.DEBUG&&e.log("JS9 worker socketio: "+s.cmd);break;case"disconnect":e.waiting(!1),s.result?e.worker.postMessage("initsocketio",[e.helper.url,e.helper.pageid],function(){e.error(s.result)}):1<e.DEBUG&&e.log("JS9 worker socketio: disconnect");break;case"error":e.error(s.result||"in web worker")}},e.WebWorker.prototype.postMessage=function(t,i,s,a){var n=t+e.uniqueID(),r={id:n,cmd:t,args:i};s&&this.handlers.push({id:n,cmd:t,args:i=i||[],func:s}),a?this.worker.postMessage(r,a):this.worker.postMessage(r)},e.WebWorker.prototype.socketio=function(t){var i=e.helper;e.worker.sockinit?t&&t():e.worker.postMessage("initsocketio",[i.url,i.pageid],function(i){"OK"===i?t&&t():e.error("can't init  socket.io for JS9 worker: "+i)})},e.WebWorker.prototype.terminate=function(){this.worker.terminate()},fabric.major_version=parseFloat(fabric.version.split(".")[0]),fabric.minor_version=parseFloat(fabric.version.split(".")[1]),e.Fabric={},e.Fabric.elements="cornerSize cornerColor cornerStyle borderColor transparentCorners selectionLineWidth centeredScaling hasControls hasRotatingPoint lockMovementX lockMovementY lockRotation lockScalingX lockScalingY lockUniScaling selectable hasBorders params pub".split(" "),e.Fabric.opts={originX:"center",originY:"center",strokeWidth:2,selectionLineWidth:2,borderColor:"#00EEFF",cornerColor:"#00EEFF",cornerSize:fabric.isTouchSupported?10:6,cornerStyle:"circle",hasControls:!0,hasRotatingPoint:!0,hasBorders:!0,transparentCorners:!1,centeredScaling:!0,selectable:!0,padding:0,canvas:{selection:!0},fill:"transparent",objectCaching:!1},e.Fabric.rescaleStrokeWidth=function(t,i){t=t||1,t*=(this.scaleX+this.scaleY)/2,!i&&this.params&&(i=this.params.sw1),i&&("group"===this.type?this.forEachObject(function(s){e.Fabric.rescaleStrokeWidth.call(s,t,i)}):this.set("strokeWidth",i/t))},e.Fabric.rescaleEvenly=function(){var e;if(this.params&&this.scaleX!==this.scaleY)switch(this.params.shape){case"annulus":case"circle":this.scaleX!==(e=this.params.lastscale||1)?this.scaleY=this.scaleX:this.scaleY!==e&&(this.scaleX=this.scaleY),this.params.lastscale=this.scaleX}},fabric.Object.prototype.rescaleBorder=e.Fabric.rescaleStrokeWidth,fabric.Object.prototype.rescaleEvenly=e.Fabric.rescaleEvenly,e.Fabric.newShapeLayer=function(t,i,s){var a,n,r=function(t,i){if(t.params.sel=null,t.display.image&&(t.display.image.layer=null),i)switch(i.type){case"polyline":case"polygon":e.Fabric.removePolygonAnchors(t,i),t.canvas.renderAll()}},o=function(i,s){if(i.params.sel&&s.params&&i.params.sel!==s&&r(i,i.params.sel),s){switch(s.type){case"polyline":case"polygon":e.Fabric.addPolygonAnchors(i,s),i.canvas.renderAll()}s.polyparams?i.params.sel=s.polyparams.polygon:s.params&&(i.params.sel=s)}i.display.image&&(i.display.image.layer=t)};if(this&&t)return this.layers[t]?this.layers[t]:(this.layers[t]={},(n=this.layers[t]).layerName=t,n.params=[],n.params.sel=null,n.params.sellayer=null,s?n.dtype="other":(n.dtype="main",s=this.divjq),a=s.attr("id")+"-"+t.replace(/\s+/,"_")+"-shapeLayer",n.display=this,n.opts=$.extend(!0,{},i),n.opts.canvas=n.opts.canvas||{},void 0===n.opts.canvas.selection&&(n.opts.canvas.selection=!0),n.el=e.Fabric.elements,n.divjq=$("<div>").addClass("JS9Container").css("z-index",0).appendTo(s),n.canvasjq=$("<canvas>").addClass("JS9Layer").attr("id",a).attr("width",s.css("width")).attr("height",s.css("height")).appendTo(n.divjq),e.bugs.webkit_resize&&"main"===n.dtype&&n.canvasjq.attr("width",this.width).attr("height",this.height),n.canvas=new fabric.Canvas(n.canvasjq[0]),n.canvas.renderOnAddRemove=!1,n.canvas.preserveObjectStacking=!0,n.opts.movable?(n.opts.lockMovementX=!1,n.opts.lockMovementY=!1,n.opts.selectable=!0,n.opts.evented=!0):!1===n.opts.movable&&(n.opts.lockMovementX=!0,n.opts.lockMovementY=!0,n.opts.selectable=!1,n.opts.evented=!1),void 0===n.opts.changeable&&void 0!==n.opts.fixinplace&&(n.opts.changeable=!n.opts.fixinplace),n.opts.changeable?(n.opts.hasControls=!0,n.opts.hasRotatingPoint=!0,n.opts.hasBorders=!0,n.opts.lockMovementX=!1,n.opts.lockMovementY=!1,n.opts.lockRotation=!1,n.opts.lockScalingX=!1,n.opts.lockScalingY=!1,n.opts.lockUniScaling=!1,n.opts.selectable=!0,n.opts.evented=!0,n.opts.usekeyboard=!0):!1===n.opts.changeable&&(n.opts.hasControls=!1,n.opts.hasRotatingPoint=!1,n.opts.hasBorders=!1,n.opts.lockMovementX=!0,n.opts.lockMovementY=!0,n.opts.lockRotation=!0,n.opts.lockScalingX=!0,n.opts.lockScalingY=!0,n.opts.lockUniScaling=!0,n.opts.selectable=!1,n.opts.evented=!1,n.opts.usekeyboard=!1),n.opts.selectable&&(n.opts.canvas.selection=!0),n.opts.onmousedown||n.opts.onmouseup||n.opts.onmousemove||n.opts.tooltip||n.opts.onmouseover||n.opts.onmouseout?(n.opts.evented=!0,n.canvas.on("mouse:down",n.opts.onmousedown?function(i){n.display.image&&i.target?("main"===n.dtype&&(n.display.image.clickInRegion=!0,n.display.image.clickInLayer=t),n.opts.onmousedown.call(this,n.display.image,i.target.pub,i.e,i.target)):(this._selection=this.selection)&&(this.selection=e.specialKey(i.e))}:function(t){(this._selection=this.selection)&&(this.selection=e.specialKey(t.e))}),n.canvas.on("mouse:up",n.opts.onmouseup?function(e){n.display.image&&e.target&&n.opts.onmouseup.call(this,n.display.image,e.target.pub,e.e,e.target),this.selection=this._selection||this.selection}:function(){this.selection=this._selection||this.selection}),n.opts.onmousemove&&n.canvas.on("mouse:move",function(e){n.display.image&&e.target&&n.opts.onmousemove.call(this,n.display.image,e.target.pub,e.e,e.target)}),n.opts.onmouseover&&n.canvas.on("mouse:over",function(e){n.display.image&&e.target&&n.opts.onmouseover.call(this,n.display.image,e.target.pub,e.e,e.target)}),n.opts.onmouseout&&n.canvas.on("mouse:out",function(e){n.display.image&&e.target&&n.opts.onmouseout.call(this,n.display.image,e.target.pub,e.e,e.target)}),n.opts.tooltip&&(n.canvas.on("mouse:over",function(t){n.display.image&&t.target&&e.tooltip(t.target.left+t.target.width+2,t.target.top+t.target.height+2,n.opts.tooltip,n.display.image,t.target.pub,t.e,t.target)}),n.canvas.on("mouse:out",function(t){n.display.image&&t.target&&e.tooltip(t.target.left,t.target.top,null,n.display.image,t.target.pub,t.e,t.target)}))):(n.canvas.on("mouse:down",function(t){(this._selection=this.selection)&&(this.selection=e.specialKey(t.e))}),n.canvas.on("mouse:up",function(){this.selection=this._selection||this.selection})),"function"==typeof n.opts.ongroupcreate&&(n.opts.canvas.selection=!0,n.opts.selectable=!0,n.canvas.on("selection:created",function(e){var t=[],i=[];n.display.image&&e.target&&"group"===e.target.type&&(e.target.forEachObject(function(e){e.pub&&(i.push(e),t.push(e.pub))}),n.opts.ongroupcreate.call(this,n.display.image,t,e.e,i))})),n.canvas.on("object:modified",function(t){var i,s,a,r,o=[];if(t.target&&(e.Fabric.updateChildren(n,i=t.target,"deltas"),n.opts.sortOverlapping&&(i.setCoords(),n.canvas.forEachObject(function(e){e!==i&&i.intersectsWithObject(e)&&(1===fabric.major_version?(a=e.getWidth(),r=e.getHeight()):(a=e.getScaledWidth(),r=e.getScaledHeight()),o.push({obj:e,siz:a*r}))}),o.length)))for(1===fabric.major_version?(a=i.getWidth(),r=i.getHeight()):(a=i.getScaledWidth(),r=i.getScaledHeight()),o.push({obj:i,siz:a*r}),o.sort(function(e,t){return e.siz<t.siz?-1:e.siz>t.siz?1:0}),s=o.length,t=0;t<s;t++)try{o[t].obj.sendToBack()}catch(l){}}),n.canvas.on("object:scaling",function(t){t.target&&((t=t.target).rescaleEvenly(),t.rescaleBorder(),e.Fabric.updateChildren(n,t,"scaling"))}),n.canvas.on("object:moving",function(t){t.target&&e.Fabric.updateChildren(n,t.target,"moving")}),n.canvas.on("object:rotating",function(t){t.target&&e.Fabric.updateChildren(n,t.target,"rotating")}),1===fabric.major_version?n.canvas.on("object:selected",function(e){e.target&&o(n,e.target)}):(n.canvas.on("selection:created",function(e){e.target&&o(n,e.target)}),n.canvas.on("selection:updated",function(t){var i=n.canvas.getActiveObject();if("activeSelection"===i.type){var s,a,r,l=n.canvas.getActiveObjects(t);for(t=0;t<l.length;t++)if((a=l[t]).params){if(a.params.parent&&a.params.parent.obj&&(s=a.params.parent.obj,0>$.inArray(s,l)&&i.addWithUpdate(s)),a.params.children)for(s=0;s<a.params.children.length;s++)r=a.params.children[s].obj,0>$.inArray(r,l)&&i.addWithUpdate(r);switch(a.type){case"polyline":case"polygon":e.Fabric.removePolygonAnchors(n,a)}}n.canvas.renderAll()}else o(n,i)})),n.canvas.on("before:selection:cleared",function(e){e.target&&r(n,e.target)}),n.divjq.closest(e.lightOpts[e.LIGHTWIN].drag).length&&n.divjq.on(fabric.isTouchSupported?"touchstart":"mouseenter",function(){n.canvas.calcOffset()}),n)},e.Fabric.showShapeLayer=function(t,i,s){var a,n,r,o,l=this,c=0;if(n=this.getShapeLayer(t)){if(s=s||{},o=n.canvas,r=this.display.layers[t],i){for(a in s.local||(n.show=!0),n.json&&n.show&&o.loadFromJSON(n.json,function(){var i,s,a;for(i in e.Fabric.updateChildren(n.dlayer,null,"objects"),l.resize&&(o.getObjects().forEach(function(e){e.left+=l.resize.left,e.top+=l.resize.top,e.setCoords()}),o.calcOffset()),l.layers[t].opts.panzoom?(l.binning.obin=l.binning.bin,l.rgb.sect.ozoom=l.rgb.sect.zoom,l.refreshShapes(t)):o.renderAll(),o.selection=n.opts.canvas.selection,n.zindex=Math.abs(n.zindex),r.divjq.css("z-index",n.zindex),l.layers)l.layers.hasOwnProperty(i)&&t!==i&&l.layers[i].show&&(s=l.display.layers[i]).divjq.css("z-index")<n.zindex&&(a=s.canvas.getActiveObject())&&(e.Fabric.removePolygonAnchors(s,a),s.canvas.discardActiveObject())}),this.layers)this.layers.hasOwnProperty(a)&&this.layers[a].json&&c++;c||(this.resize=null),this.xeqPlugins("shape","onshapelayershow",t)}else{if(n.show){for(c=(i=o.getObjects()).length;c--;)(a=i[c]).params&&(a.params.winid&&(a.params.winid.close(),a.params.winid=null),a.params.anchors&&e.Fabric.removePolygonAnchors(n.dlayer,a));i=o.toJSON(n.dlayer.el),n.json=JSON.stringify(i),o.selection=!1,r&&(n.zindex=-Math.abs(n.zindex),r.divjq.css("z-index",n.zindex)),o.clear()}s.local||(n.show=!1),this.xeqPlugins("shape","onshapelayerhide",t)}return this}},e.Fabric.displayShapeLayers=function(){var e;if(this!==this.display.image){if(this.display.image&&this.display.image.layers)for(e in this.display.image.layers)this.display.image.layers.hasOwnProperty(e)&&this.display.image.showShapeLayer(e,!1,{local:!0});if(this.layers)for(e in this.layers)this.layers.hasOwnProperty(e)&&this.showShapeLayer(e,!0,{local:!0})}},e.Fabric.toggleShapeLayers=function(){var e,t;if(this.toggleLayers){for(e in this.layers)this.layers.hasOwnProperty(e)&&(t=this.layers[e])&&this.toggleLayers[e]&&this.showShapeLayer(e,!0);delete this.toggleLayers}else for(e in this.toggleLayers={},this.layers)this.layers.hasOwnProperty(e)&&"crosshair"!==e&&(t=this.layers[e])&&t.show&&"main"===t.dlayer.dtype&&(this.toggleLayers[e]=!0,this.showShapeLayer(e,!1))},e.Fabric.getShapeLayer=function(e,t){var i,s;if(!e)return null;if(!(s=this.layers[e])){if(!(i=this.display.layers[e]))return null;this.layers[e]={},(s=this.layers[e]).show=!0,s.nshape=0,s.dlayer=i,s.opts=s.dlayer.opts,s.canvas=s.dlayer.canvas,s.canvas.calcOffset()}return s},e.Fabric.activeShapeLayer=function(e){var t,i,s,a;if(e)if($.isArray(e)){for(t=0,i=this.zlayer-1;t<e.length;t++)"main"===(a=this.layers[e[t]]).dlayer.dtype&&(a.zindex=i--,a.show?s||(s=e[t]):a.zindex=-a.zindex,a.dlayer.divjq.css("z-index",a.zindex));e=s}else{if((a=this.layers[e])&&a.show){for(t in s=a.zindex,a.zindex=this.zlayer-1,a.dlayer.divjq.css("z-index",a.zindex),this.layers)this.layers.hasOwnProperty(t)&&(i=this.layers[t])!==a&&i.zindex===a.zindex&&"main"===i.dlayer.dtype&&(i.zindex=s,i.dlayer.divjq.css("z-index",i.zindex));this.xeqPlugins("shape","onshapelayeractive",e)}e=this}else{for(t in this.layers)this.layers.hasOwnProperty(t)&&"main"===(i=this.layers[t]).dlayer.dtype&&(void 0===a||i.zindex>a)&&(a=i.zindex,s=t);e=s}return e},e.Fabric._parseShapeOptions=function(t,i,s){var a,n,r,o,l,c,h={},u={};if(o="main"===this.display.layers[t].dtype?this.rgb.sect.zoom:1,i.remove)return{remove:i.remove};if(u.tags=[],delete i.parent,delete i.id,i.tags)if("string"==typeof i.tags)for(n=i.tags.toLowerCase().split(","),t=0;t<n.length;t++)u.tags[t]=n[t].trim();else if($.isArray(i.tags))for(t=0;t<i.tags.length;t++)u.tags[t]=i.tags[t].trim();switch(void 0!==i.angle&&(h.angle=-i.angle),void 0!==i.x&&void 0!==i.y&&(n=this.imageToDisplayPos(i),h.left=n.x,h.top=n.y),void 0!==i.px&&void 0!==i.py&&(n=this.logicalToDisplayPos({x:i.px,y:i.py}),h.left=n.x,h.top=n.y),"string"==typeof i.wcs&&(n=i.wcs.trim().split(/ +/),i.ra=n[0],i.dec=n[1],3<=n.length&&(i.wcssys=n[2])),void 0!==i.ra&&void 0!==i.dec&&0<this.raw.wcs&&(i.wcssys?(r=this.getWCSSys(),a=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(i.wcssys)):i._wcssys&&(r=this.getWCSSys(),a=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(i._wcssys),delete i._wcssys),"string"==typeof i.ra&&(i.ra=e.saostrtod(i.ra),":"===String.fromCharCode(e.saodtype())&&"galactic"!==this.params.wcssys&&"ecliptic"!==this.params.wcssys&&(i.ra*=15)),"string"==typeof i.dec&&(i.dec=e.saostrtod(i.dec)),n=e.wcs2pix(this.raw.wcs,i.ra,i.dec).trim().split(/ +/),r&&(this.setWCSSys(r),e.globalOpts.xeqPlugins=a),n=this.imageToDisplayPos({x:parseFloat(n[0]),y:parseFloat(n[1])}),h.left=n.x,h.top=n.y),void 0!==i.left&&(h.left=i.left),void 0!==i.top&&(h.top=i.top),void 0===h.left&&!0!==i.noLeftTop&&(h.left=s&&void 0!==s.left?s.left:this.display.canvasjq.attr("width")/2-1),void 0===h.top&&!0!==i.noLeftTop&&(h.top=s&&void 0!==s.top?s.top:this.display.canvasjq.attr("height")/2-1+1),i.dx&&(h.left+=i.dx),i.dy&&(h.top-=i.dy),i.shape){case"annulus":if(u.radii=[],void 0!==i.radii){if("string"==typeof i.radii)for(u.radii=i.radii.replace(/ /g,"").split(","),a=t=0;t<u.radii.length;t++)""!==u.radii[t]&&(i.sizeScale&&(u.radii[t]*=i.sizeScale),u.radii[a++]=this.wcs2imlen(u.radii[t]));else if(u.radii=i.radii,i.sizeScale)for(t=0;t<u.radii.length;t++)u.radii[t]*=i.sizeScale}else for(i.ireg&&e.SCALEIREG&&(e.notNull(i.iradius)&&(i.iradius/=o),e.notNull(i.oradius)&&(i.oradius/=o)),i.sizeScale&&(e.notNull(i.iradius)&&(i.iradius*=i.sizeScale),e.notNull(i.oradius)&&(i.oradius*=i.sizeScale)),o=(i.oradius-i.iradius)/i.nannuli,r=i.nannuli+1,t=0;t<r;t++)a=i.iradius+o*t,i.sizeScale&&(a*=i.sizeScale),u.radii.push(a);break;case"box":i.ireg&&e.SCALEIREG&&(e.notNull(i.width)&&(i.width/=o),e.notNull(i.height)&&(i.height/=o)),i.sizeScale&&(e.notNull(i.width)&&(i.width*=i.sizeScale),e.notNull(i.height)&&(i.height*=i.sizeScale));break;case"circle":i.ireg&&e.SCALEIREG&&e.notNull(i.radius)&&(i.radius/=o),i.sizeScale&&e.notNull(i.radius)&&(i.radius*=i.sizeScale);break;case"ellipse":i.ireg&&e.SCALEIREG&&(e.notNull(i.r1)&&(i.r1/=o),e.notNull(i.r2)&&(i.r2/=o)),i.sizeScale&&(e.notNull(i.r1)&&(i.r1*=i.sizeScale),e.notNull(i.r2)&&(i.r2*=i.sizeScale));break;case"point":switch(i.ptshape){case"box":i.width=2*i.ptsize,i.height=2*i.ptsize;break;case"circle":i.radius=i.ptsize;break;case"ellipse":i.rx=i.ptsize,i.ry=i.ptsize/2}i.lockRotation=!0,i.lockScalingX=!0,i.lockScalingY=!0,i.lockUniScaling=!0,i.hasControls=!1,i.hasRotatingPoint=!1,i.hasBorders=!0;break;case"line":case"polygon":if(void 0!==i.wcspts&&0<this.raw.wcs){for(i.pts=[],i.wcssys&&(r=this.getWCSSys(),a=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(i.wcssys)),t=0;t<i.wcspts.length;t++)n=e.wcs2pix(this.raw.wcs,i.wcspts[t].ra,i.wcspts[t].dec).trim().split(/ +/),i.pts.push({x:parseFloat(n[0]),y:parseFloat(n[1])});r&&(this.setWCSSys(r),e.globalOpts.xeqPlugins=a)}if(i.pts&&i.pts.length){if("string"==typeof i.pts){if(r=(n=i.pts.replace(/ /g,"").split(",")).length,"string"==typeof n[0])for(t=0;t<r;t++)n[t]=parseFloat(n[t]);for(i.pts=[],a=t=0;t<r;t+=2,a++)i.pts[a]={x:n[t],y:n[t+1]}}for(r=i.pts.length,t=0;t<r;t++)i.pts[t]=this.imageToDisplayPos(i.pts[t]);for(i.left&&i.top?a={x:i.left,y:i.top}:(a=e.centerPolygon(i.pts),h.left=a.x,h.top=a.y),i.points=[],t=0;t<r;t++)i.points.push(n={x:(i.pts[t].x-a.x)/o,y:(i.pts[t].y-a.y)/o})}else s&&s.points&&s.points.length||("polygon"===i.shape&&i.polypoints?i.points=i.polypoints:"line"===i.shape&&i.linepoints&&(i.points=i.linepoints));if(i.ireg&&e.SCALEIREG)for(r=i.points.length,t=0;t<r;t++)i.points[t].x/=o,i.points[t].y/=o}for(l in i)if(i.hasOwnProperty(l))switch(l){case"tags":case"x":case"y":case"px":case"py":case"dx":case"dy":case"ra":case"dec":case"pts":case"left":case"top":case"angle":case"radii":case"ireg":break;case"type":case"originX":case"originY":case"width":case"height":case"scaleX":case"scaleY":case"flipX":case"flipY":case"opacity":case"cornerSize":case"transparentCorners":case"hoverCursor":case"padding":case"borderColor":case"cornerColor":case"centeredScaling":case"centeredRotation":case"fill":case"fillRule":case"backgroundColor":case"stroke":case"strokeWidth":case"strokeDashArray":case"strokeLineCap":case"strokeLineJoin":case"strokeMiterLimit":case"shadow":case"borderOpacityWhenMoving":case"borderScaleFactor":case"borderDashArray":case"transformMatrix":case"minScaleLimit":case"selectable":case"evented":case"visible":case"hasControls":case"hasBorders":case"hasRotatingPoint":case"rotatingPointOffset":case"perPixelTargetFind":case"includeDefaultValues":case"clipTo":case"lockMovementX":case"lockMovementY":case"lockRotation":case"lockScalingX":case"lockScalingY":case"lockUniScaling":case"send":case"radius":case"rx":case"ry":case"points":case"selectionLineWidth":case"fontFamily":case"fontSize":case"fontStyle":case"fontWeight":case"text":case"textDecoration":case"textAlign":case"lineHeight":case"textBackgroundColor":case"textOpts":h[l]=i[l];break;case"shape":c=i[l];break;default:u[l]=i[l]}if(!(i=u.color||h.stroke)){var d,p;for(d in i=u.tags,l=(l=u.tagcolors)||{})if(l.hasOwnProperty(d)&&(t=d.split("_"),0===$(i).not(t).length&&0===$(t).not(i).length)){p=l[d];break}if(!p)for(d in l)if(l.hasOwnProperty(d)&&(t=d.split("_"),0===$(i).not(t).length)){p=l[d];break}if(!p)for(d in l)if(l.hasOwnProperty(d)&&(t=d.split("_"),0===$(t).not(i).length)){p=l[d];break}i=p=p||s&&s.get("stroke")||l.defcolor||e.globalOpts.defcolor||"#000000"}return h.stroke=i,h.selectColor=h.stroke,!0!==e.globalOpts.controlsMatchRegion&&"corner"!==e.globalOpts.controlsMatchRegion||(h.cornerColor=h.stroke),!0!==e.globalOpts.controlsMatchRegion&&"border"!==e.globalOpts.controlsMatchRegion||(h.borderColor=h.stroke),void 0===u.changeable&&void 0!==u.fixinplace&&(u.changeable=!u.fixinplace),void 0!==u.changeable&&(h.lockMovementX=s=!u.changeable,h.lockMovementY=s,h.lockRotation=s,h.lockScalingX=s,h.lockScalingY=s,h.hasControls=!s,h.hasRotatingPoint=!s,h.hasBorders=!s),void 0!==u.movable&&(h.lockMovementX=s=!u.movable,h.lockMovementY=s),void 0!==u.resizable&&(h.hasControls=s=u.resizable,h.hasBorders=s),void 0!==u.rotatable&&(s=!u.rotatable,void 0===h.lockRotation&&(h.lockRotation=s,h.hasRotatingPoint=!s)),{shape:c,opts:h,params:u}},e.Fabric._exportShapeOptions=function(e){return"object"!=typeof e?[]:Object.keys(e).filter(function(t){switch(t){case"top":case"left":case"width":case"height":case"radius":case"rx":case"ry":case"angle":case"panzoom":case"iradius":case"oradius":case"nannuli":case"aradius1":case"aradius2":case"configURL":case"sortOverlapping":case"tagcolors":case"pts":case"ptshape":case"ptsize":case"linepoints":case"polypoints":case"responseType":case"display":case"tags":case"r1":case"r2":case"x":case"y":case"dx":case"dy":case"px":case"py":case"shape":case"parent":case"rtn":case"_wcssys":case"file":return!1;case"text":return"text"!==e.shape;default:return!0}})},e.Fabric._handleChildText=function(t,i,s){var a,n,r;if("regions"===t)if(s=s||{},"text"===i.params.shape||!s.text||i.params.children&&i.params.children.length){if(i.params.children&&(s.text||s.textOpts))for(a=0;a<i.params.children.length;a++)r=i.params.children[a].obj,n=$.extend(!0,{},s.textOpts||{}),s.text&&(n.text=s.text),this.changeShapes(t,r.params.id,n)}else n=i.height*i.scaleX/2-12,n=1e-6>Math.abs(i.angle)?{x:i.left,y:i.top-n}:e.rotatePoint({x:i.left,y:i.top-n},i.angle,{x:i.left,y:i.top}),n={x:(r=this.displayToImagePos(n)).x,y:r.y,angle:-i.angle,color:i.stroke,text:s.text,parent:"TBD",rtn:"object"},s.textOpts&&(n=$.extend(!0,{},n,s.textOpts)),(a=e.Fabric.addShapes.call(this,t,"text",n)).params.parent={id:i.params.id,obj:i,dleft:i.left-a.left,dtop:i.top-a.top,lastscalex:i.scaleX,lastscaley:i.scaleY,lastangle:i.angle,textheight:12},e.Fabric._updateShape.call(this,t,a,null,"child",a.params),void 0!==s.strokeWidth&&(a.params.parent.strokeWidth=s.strokeWidth),r.x===n.x&&r.y===n.y||(a.params.parent.moved=!0),s.textOpts&&void 0!==s.textOpts.ra&&void 0!==s.textOpts.dec&&(a.params.hasTextOpts=!0),i.params.children.push({id:a.params.id,obj:a})},e.Fabric.addShapes=function(t,i,s){var a,n,r,o,l,c,h,u,d,p=[],f=[],g={};if(!(0<=$.inArray("regions",this.params.disable)&&"regions"===t)){if("string"==typeof s)try{s=JSON.parse(s)}catch(m){e.error("can't parse shape opts: "+s,m)}if(s=s||{},this.display.image!==this)this.delayedShapes=this.delayedShapes||[],this.delayedShapes.push({layer:t,shape:i,opts:s});else if((c=this.getShapeLayer(t))&&c.show){if(h=c.canvas,u="main"===this.display.layers[t].dtype?this.rgb.sect.zoom:1,"string"==typeof i)i="string"==typeof(a=this.parseRegions(i,s))?[{shape:a}]:a;else if(!$.isArray(i)){if("object"!=typeof i)return;i=[i]}if(!h.size()){if("main"===this.display.layers[t].dtype)switch(t){case e.Crosshair.LAYERNAME:case e.Grid.LAYERNAME:c.zindex=1;break;default:c.zindex=this.zlayer++}else c.zindex=e.SHAPEZINDEX;(r=this.display.layers[t]).divjq.css("z-index",c.zindex),this.xeqPlugins("shape","onshapelayercreate",t)}for(o=$.extend(!0,{},e.Fabric.opts,c.opts,s),r=0;r<i.length;r++)if(l=$.extend(!0,{},o,i[r]),(n=e.Fabric._parseShapeOptions.call(this,t,l)).remove&&(!0!==n.remove&&"true"!==n.remove||(n.remove="all"),!1!==n.remove&&"false"!==n.remove))this.removeShapes(t,n.remove);else if(n.shape){switch(l=n.opts,void 0===(g=n.params).id&&(g.id=++c.nshape),g.exports=e.Fabric._exportShapeOptions.call(this,s).concat(e.Fabric._exportShapeOptions.call(this,i[r])),g.parent=null,g.children=[],l.stroke&&(l.color=l.stroke,l.stroke=e.colorToHex(l.stroke)),n.shape){case"annulus":if(g.shape="annulus",n=l.top,d=l.left,l.top=0,l.left=0,g.radii)for(a=0;a<g.radii.length;a++)l.radius=g.radii[a],p.push(new fabric.Circle(l));l.top=n,l.left=d,l.width=2*l.radius,l.height=2*l.radius,a=new fabric.Group(p,l);break;case"box":g.shape="box",a=new fabric.Rect(l);break;case"circle":g.shape="circle",a=new fabric.Circle(l);break;case"ellipse":g.shape="ellipse",l.rx=g.r1,l.ry=g.r2,a=new fabric.Ellipse(l);break;case"point":switch(g.shape="point",g.ptshape){case"box":a=new fabric.Rect(l);break;case"circle":a=new fabric.Circle(l);break;case"ellipse":a=new fabric.Ellipse(l);break;default:a=new fabric.Rect(l)}break;case"line":g.shape="line",a=new fabric.Polyline(l.points,l);break;case"polygon":g.shape="polygon",a=new fabric.Polygon(l.points,l,!0);break;case"text":g.shape="text",g.text=l.text||"Double-click to add text here",l.fill=l.stroke,l.strokeWidth=0,a=new fabric.Text(g.text,l);break;default:e.error("unknown shape: "+n.shape)}if(h.add(a),g.layerName=t,g.sw1=Math.max(1,Math.floor(a.strokeWidth+.5)),g.listonchange=!1,a.params=g,c.opts.panzoom)switch(g.shape){case"point":case"text":break;default:a.scale(u)}if(a.rescaleBorder(),e.Fabric._handleChildText.call(this,t,a,l),"TBD"!==s.parent&&e.Fabric._updateShape.call(this,t,a,null,"add",g),s.onaddshapes&&a.pub)try{e.xeqByName(s.onaddshapes,this,this,a.pub)}catch(m){e.error("in onaddshapes callback",m,!1)}f.push(a)}return(void 0===g.redraw||g.redraw)&&h.renderAll(),"object"===s.rtn?a:"objs"===s.rtn?f:g.id}}},e.Fabric.selectShapes=function(t,i,s){var a,n,r,o,l,c;if(!this.layers||!t||!this.layers[t])return null;switch("string"==typeof(i=i||"all")&&/^[1-9]\d*$/.test(i)&&(i=parseInt(i,10)),r=this.layers[t].canvas,n=1===fabric.major_version?r.getActiveGroup():(t=r.getActiveObject())&&"activeSelection"===t.type?t:null,t={group:null},typeof i){case"object":i.params&&(n&&n.contains(i)&&(t.group=n),s.call(this,i,t));break;case"number":for(o=(r=r.getObjects()).length;o--;)(l=r[o]).params&&i===l.params.id&&(t.group=n&&n.contains(l)?n:null,s.call(this,l,t));break;case"string":if("selected"===i)if(1===fabric.major_version){if(r.getActiveObject())(i=r.getActiveObject()).params&&(t.group=null,s.call(this,i,t));else if(n)for(t.group=n,o=(r=n.getObjects()).length;o--;)(l=r[o]).params&&!l.params.parent&&s.call(this,l,t)}else for(t.group=n,o=(r=r.getActiveObjects()).length;o--;)(l=r[o]).params&&!l.params.parent&&s.call(this,l,t);else for(o=(r=r.getObjects()).length;o--;)if((l=r[o]).params&&("child"===i||!l.params.parent)&&("child"!==i||l.params.parent))if(a=l.stroke.toLowerCase(),t.group=n&&n.contains(l)?n:null,"all"===i)s.call(this,l,t);else if(i.toLowerCase()===a||e.colorToHex(i).toLowerCase()===a)s.call(this,l,t);else if(i===l.params.shape)s.call(this,l,t);else if(i===l.params.file)s.call(this,l,t);else if("child"===i&&l.params.parent)s.call(this,l,t);else if("parent"===i&&l.params.children&&l.params.children.length)s.call(this,l,t);else if(l.params.tags)for(a=0;a<l.params.tags.length;a++)c=l.params.tags[a],i.match(/^\/.*\/$/)&&c.match(new RegExp(i.slice(1,-1)))?s.call(this,l,t):i===c&&s.call(this,l,t)}return this},e.Fabric.updateShapes=function(t,i,s,a){var n=this;return this.selectShapes(t,i,function(i,r){e.Fabric._updateShape.call(n,t,i,r,s,a)}),this},e.Fabric._updateShape=function(t,i,s,a,n){var r,o,l,c,h,u,d,p,f,g,m,v={},b=this.layers[t];for(u=function(e){return e.toFixed(2)},s=s||{},n=n||{},l="main"===this.display.layers[t].dtype?this.rgb.sect.zoom:1,v.mode=a=a||"update",v.id=i.params.id,v.shape=i.params.shape,v.layer=t,v.color=i.color||i.stroke,v.tags=i.params.tags,v.parent=i.params.parent?i.params.parent.obj.params.id:null,d=i.getCenterPoint(),s.group&&(o=s.group.getCenterPoint(),d={x:d.x+o.x,y:d.y+o.y},s.group.angle&&(d=e.rotatePoint(d,s.group.angle,o))),d=this.displayToImagePos(d),v.x=d.x,v.y=d.y,v.lcs=this.imageToLogicalPos(d),"image"===this.params.wcssys?(v.imsys="image",c=v.x,h=v.y,g=1):(v.imsys=v.lcs.sys,c=v.lcs.x,h=v.lcs.y,g=this.lcs.physical.reverse[0][0]),v.angle=-i.angle,s.group&&(v.angle-=s.group.angle),m=v.angle,this.raw.wcsinfo&&this.raw.wcsinfo.crot&&(v.angle-=this.raw.wcsinfo.crot);0>v.angle;)v.angle+=360;for(;360<v.angle;)v.angle-=360;switch(o=i.scaleX/l,l=i.scaleY/l,s.group&&(o*=s.group.scaleX,l*=s.group.scaleY),v.shape){case"annulus":for(v.shape="annulus",v.radii=[],"image"!==v.imsys&&(v.lcs.radii=[]),v.imstr="annulus("+u(c)+", "+u(h)+", ",f="annulus "+v.x+" "+v.y+" ",l=(m=i.getObjects()).length,s=0;s<l;s++)v.imstr+=u(p=(c=m[s].radius*o)*g),f+=v.x+" "+v.y+" "+(v.x+c)+" "+v.y+" ",v.imstr=s===l-1?v.imstr+")":v.imstr+", ",v.radii.push(c),"image"!==v.imsys&&v.lcs.radii.push(p);break;case"box":v.shape="box",v.width=i.width*o,v.height=i.height*l,p=v.width*g,f=v.height*g,"image"!==v.imsys&&(v.lcs.width=p,v.lcs.height=f),v.imstr="box("+u(c)+", "+u(h)+", "+u(p)+", "+u(f)+", "+v.angle.toFixed(4)+")",f="box "+v.x+" "+v.y+" "+v.x+" "+v.y+" "+(v.x+v.width)+" "+v.y+" "+v.x+" "+v.y+" "+v.x+" "+(v.y+v.height)+" "+v.angle*Math.PI/180;break;case"circle":v.radius=i.radius*o,p=v.radius*g,"image"!==v.imsys&&(v.lcs.radius=p),v.imstr="circle("+u(c)+", "+u(h)+", "+u(p)+")",f="circle "+v.x+" "+v.y+" "+v.x+" "+v.y+" "+(v.x+v.radius)+" "+v.y;break;case"ellipse":v.r1=i.width*o/2,v.r2=i.height*l/2,p=v.r1*g,f=v.r2*g,"image"!==v.imsys&&(v.lcs.r1=p,v.lcs.r2=f),v.imstr="ellipse("+u(c)+", "+u(h)+", "+u(p)+", "+u(f)+", "+v.angle.toFixed(4)+")",f="ellipse "+v.x+" "+v.y+" "+v.x+" "+v.y+" "+(v.x+v.r1)+" "+v.y+" "+v.x+" "+v.y+" "+v.x+" "+(v.y+v.r2)+" "+v.angle*Math.PI/180;break;case"point":v.width=i.width*o,v.height=i.height*l,p=v.width*g,f=v.height*g,"image"!==v.imsys&&(v.lcs.width=p,v.lcs.height=f),v.imstr="point("+u(c)+", "+u(h)+")",f="point "+v.x+" "+v.y;break;case"line":case"polygon":for(v.imstr=v.shape+"(",f=v.shape+" ",v.pts=[],"image"!==v.imsys&&(v.lcs.pts=[]),s=0;s<i.points.length;s++)0<s&&(v.imstr+=", ",f+=" "),g=e.rotatePoint(g={x:v.x+i.points[s].x*o,y:v.y-i.points[s].y*l},m,{x:v.x,y:v.y}),"image"===this.params.wcssys?v.imstr+=u(g.x)+", "+u(g.y):(c=this.imageToLogicalPos(g),v.imstr+=u(c.x)+", "+u(c.y),v.lcs.pts.push({x:c.x,y:c.y})),f+=g.x+" "+g.y,v.pts.push(g),"line"===v.shape&&(0===s?p=0:(c=v.pts[s-1],p+=Math.sqrt((g.x-c.x)*(g.x-c.x)+(g.y-c.y)*(g.y-c.y))));"line"===v.shape&&e.notNull(p)?v.imstr+=') {"size":'+u(p)+',"units":"pixels"}':v.imstr+=")",v.angle=0;break;case"text":v.imstr="text("+u(c)+", "+u(h)+', "'+i.text+'", '+v.angle.toFixed(4)+")",f="text "+v.x+" "+v.y+' "'+i.text+'" '+v.angle*Math.PI/180,v.text=i.text}if(this.raw.wcs&&0<this.raw.wcs&&(r=e.pix2wcs(this.raw.wcs,d.x,d.y).trim().split(/\s+/),v.rastr=r[0],v.decstr=r[1],v.wcssys=r[2],":"===(u=e.strtoscaled(r[0])).dtype&&"galactic"!==r[2]&&"ecliptic"!==r[2]&&(u.dval*=15),d=e.strtoscaled(r[1]),v.ra=u.dval,v.dec=d.dval,!1!==n.updateWCS&&(n.updateWCS||b.opts.updateWCS))){for(v.wcsstr=e.reg2wcs(this.raw.wcs,f).replace(/;$/,""),r=v.wcsstr.replace(/.*\(/,"").replace(/\).*/,"").split(","),s=0;s<r.length;s++)r[s]=r[s].trim();switch(v.wcsposstr=[r[0],r[1]],v.shape){case"annulus":v.wcssizestr=[r[r.length-1]];break;case"box":v.wcssizestr=[r[2],r[3]];break;case"circle":v.wcssizestr=[r[2]];break;case"ellipse":v.wcssizestr=[r[2],r[3]];break;case"line":case"polygon":for(v.wcspts=[],s=0;s<r.length;s+=2)":"===(u=e.strtoscaled(r[s])).dtype&&"galactic"!==v.wcssys&&"ecliptic"!==v.wcssys&&(u.dval*=15),d=e.strtoscaled(r[s+1]),v.wcspts.push({ra:u.dval,dec:d.dval})}}if(v.data=i.params.data,i.set("pub",v),i.params.winid&&($(i.params.winid).is(":visible")?e.Regions.initConfigForm.call(this,i):i.params.winid=null),n.nocb)return v;if(!i.params.parent&&"child"!==a&&"move"!==a&&"mouseout"!==a){if(this.params.xeqonchange&&b.show&&b.opts.onchange)try{this.params.xeqonchange=!1,e.xeqByName(b.opts.onchange,window,this,v)}catch(y){e.log("error in onchange: %s [%s]\n%s",this.id,y.message,e.strace(y))}finally{this.params.xeqonchange=!0}this.xeqPlugins("shape","on"+t+"change",v)}if("regions"===t&&e.globalOpts.regionsToClipboard){switch(a){case"add":case"select":case"update":s=v.parent||v.id;break;default:s=null}if(e.notNull(s)){try{r=this.listRegions(s,{mode:1})}catch(y){r=null}r&&(e.clipboard=r)}}return v},e.Fabric.removeShapes=function(t,i,s){var a=[],n=this;if(s=this.getShapeLayer(t)){for(s=s.canvas,"regions"===t&&e.globalOpts.unremoveReg&&(this.regstack.push(this.listRegions(i,{mode:1},t)),this.regstack.length>e.globalOpts.unremoveReg&&(this.regstack=this.regstack.slice(0,e.globalOpts.unremoveReg))),this.selectShapes(t,i,function(i,s){var r,o;if(!1!==i.params.removable){if(e.Fabric._updateShape.call(n,t,i,s,"remove"),i.params.winid&&i.params.winid.close(),i.params.parent)for(r=(o=i.params.parent.obj).params.children.length-1;0<=r;r--)if(i===o.params.children[r].obj){o.params.children.splice(r,1);break}for(r=0;r<i.params.children.length;r++)a.push(o=i.params.children[r].obj);a.push(i)}}),i=0;i<a.length;i++)s.remove(a[i]);return 1===fabric.major_version?s.getActiveGroup()&&s.discardActiveGroup():s.discardActiveObject(),s.renderAll(),this}},e.Fabric.getShapes=function(t,i,s){var a=[],n={};if("string"==typeof s)try{s=JSON.parse(s)}catch(r){e.error("can't parse getShapes opts: "+s,r)}return s=s||{},"regions"===t&&"text"===s.format?this.listRegions(i,{mode:s.mode||1}):(this.selectShapes(t,i,function(e){n=e.pub||{},e.params.parent&&!s.includeChildren||(s.includeObj&&(n.obj=e),a.push(n))}),a)},e.Fabric.changeShapes=function(t,i,s){var a,n,r,o,l,c,h,u,d,p,f,g,m=[],v=this;if((l=this.getShapeLayer(t))&&s){if("string"==typeof s)try{s=JSON.parse(s)}catch(b){e.error("can't parse shape opts: "+s,b)}return f="main"===this.display.layers[t].dtype?this.rgb.sect.zoom:1,h=(c=l.canvas).getActiveObject(),this.selectShapes(t,i,function(i,b){if(s.radii&&(i.params.radii=[]),o=$.extend(!0,{},i.params,s),(r=e.Fabric._parseShapeOptions.call(this,t,o,i)).remove&&(!0!==r.remove&&"true"!==r.remove||(r.remove="all"),!1!==r.remove&&"false"!==r.remove))this.removeShapes(t,r.remove||"all");else{if(r.opts.send)switch(r.opts.send){case"front":c.sendToFront(h),c.discardActiveObject();break;case"back":c.sendToBack(h),c.discardActiveObject()}switch(g=e.Fabric._exportShapeOptions.call(this,s).filter(function(e){return!i.params.exports.hasOwnProperty(e)}),r.params.exports=i.params.exports.concat(g),r.opts.stroke&&(r.opts.color=r.opts.stroke,r.opts.stroke=e.colorToHex(r.opts.stroke)),i.params.shape){case"text":r.opts.stroke&&(r.opts.fill=r.opts.stroke),r.opts.strokeWidth=0}switch(i.set(r.opts),i.params=$.extend(!1,{},i.params,r.params),s.strokeWidth&&(i.params.sw1=s.strokeWidth),i.params.shape){case"annulus":if(s.radii&&s.radii.length){for(d=i.get("stroke"),i.forEachObject(function(e){m.push(e)}),u=m.length,a=0;a<u;a++)i.remove(m[a]),c.remove(m[a]);for(u=i.params.radii.length,a=p=0;a<u;a++)n=new fabric.Circle({radius:i.params.radii[a],stroke:d}),p=Math.max(p,i.params.radii[a]),i.add(n);i.scaleX=f,i.scaleY=f,i.width=2*p,i.height=2*p,h===i&&c.setActiveObject(i)}break;case"box":s.width&&(i.scaleX=f),s.height&&(i.scaleY=f);break;case"circle":s.radius&&(i.scaleX=f,i.scaleY=f);break;case"ellipse":s.r1&&(i.rx=i.params.r1,i.scaleX=f,i.width=2*i.rx),s.r2&&(i.ry=i.params.r2,i.scaleY=f,i.height=2*i.ry);break;case"line":case"polygon":(s.points&&s.points.length||s.pts&&s.pts.length)&&(i.scaleX=f,i.scaleY=f),h===i&&(e.Fabric.removePolygonAnchors(l.dlayer,i),e.Fabric.addPolygonAnchors(l.dlayer,i)),e.resetPolygonCenter(i);break;case"text":s.text&&(i.params.text=s.text)}if(i.rescaleBorder(),e.Fabric.updateChildren(l.dlayer,i,"moving"),e.Fabric.updateChildren(l.dlayer,i,"scaling"),e.Fabric.updateChildren(l.dlayer,i,"rotating"),e.Fabric.updateChildren(l.dlayer,i,"deltas"),i.setCoords(),e.Fabric._handleChildText.call(v,t,i,s),e.Fabric._updateShape.call(v,t,i,b,"update"),s.onchangeshapes&&i.pub)try{e.xeqByName(s.onchangeshapes,this,this,i.pub)}catch(y){e.error("in onchangeshapes callback",y,!1)}}}),(void 0===s.redraw||s.redraw)&&c.renderAll(),this}},e.Fabric.refreshShapes=function(t){var i,s,a,n,r,o,l,c,h=!1,u=this,d=this.raw.wcs;if(c=this.getShapeLayer(t))return"main"===this.display.layers[t].dtype&&(h=!0),h?(n=this.binning.obin/this.rgb.sect.ozoom*(a=this.rgb.sect.zoom)/(s=this.binning.bin),r=this.binning.obin/this.rgb.sect.ozoom*a/s):(s=1,r=n=a=this.rgb.sect.zoom),s=c.canvas,1===fabric.major_version?s.getActiveGroup()&&s.discardActiveGroup():s.discardActiveObject(),i=s.getActiveObject(),this.selectShapes(t,"all",function(t){var s,a,p,f;if(0<d&&t.pub.ra&&t.pub.dec?("string"==typeof t.pub.ra&&(t.pub.ra=e.saostrtod(t.pub.ra),":"===String.fromCharCode(e.saodtype())&&"galactic"!==this.params.wcssys&&"ecliptic"!==this.params.wcssys&&(t.pub.ra*=15)),"string"==typeof t.pub.dec&&(t.pub.dec=e.saostrtod(t.pub.dec)),a=e.wcs2pix(d,t.pub.ra,t.pub.dec).trim().split(/ +/),a=this.imageToDisplayPos({x:parseFloat(a[0]),y:parseFloat(a[1])})):a=u.logicalToDisplayPos(t.pub.lcs),t.set("left",a.x),t.set("top",a.y),("box"===t.params.shape||"ellipse"===t.params.shape||"text"===t.params.shape&&!t.params.parent)&&t.set("angle",u.raw.wcsinfo&&u.raw.wcsinfo.crot?-(t.pub.angle+u.raw.wcsinfo.crot):-t.pub.angle),!1!==t.params.zoomable)switch(t.params.shape){case"point":case"text":break;default:if(o=n,l=r,h&&(o*=t.scaleX,l*=t.scaleY),t.scaleX=o,t.scaleY=l,t.rescaleBorder(),t.points)if(p=t.getCenterPoint(),0<d&&t.pub.wcspts)for(f=t.pub.wcspts,s=0;s<f.length;s++)a=e.wcs2pix(d,f[s].ra,f[s].dec).trim().split(/ +/),a=this.imageToDisplayPos({x:parseFloat(a[0]),y:parseFloat(a[1])}),t.angle&&(a=e.rotatePoint(a,-t.angle,p)),t.points[s]={x:(a.x-p.x)/t.scaleX,y:(a.y-p.y)/t.scaleY};else if(t.pub.lcs.pts)for(f=t.pub.lcs.pts,s=0;s<f.length;s++)a=u.logicalToDisplayPos(t.pub.lcs.pts[s]),t.angle&&(a=e.rotatePoint(a,-t.angle,p)),t.points[s]={x:(a.x-p.x)/t.scaleX,y:(a.y-p.y)/t.scaleY}}switch(t.setCoords(),t.type){case"polyline":case"polygon":i===t&&(e.Fabric.removePolygonAnchors(c.dlayer,t),e.Fabric.addPolygonAnchors(c.dlayer,t))}e.Fabric.updateChildren(c.dlayer,t,"moving"),e.Fabric.updateChildren(c.dlayer,t,"scaling"),e.Fabric.updateChildren(c.dlayer,t,"rotating")}),s&&s.renderAll(),this},e.Fabric.addPolygonPoint=function(t,i,s){var a,n,r,o,l,c,h,u,d,p,f,g,m,v,b=Number.MAX_VALUE;if(i&&i.points){for(s=e.eventToDisplayPos(s),c=i.getCenterPoint().x,l=i.getCenterPoint().y,c=(s.x-c)/i.get("scaleX"),f=(s.y-l)/i.get("scaleY"),l=-i.get("angle")*Math.PI/180;l>2*Math.PI;)l-=2*Math.PI;for(s=Math.cos(l)*c-Math.sin(l)*f,f=Math.sin(l)*c+Math.cos(l)*f,c=i.points,l=0;l<c.length;l++)h=(o=c[l]).x<(n=c[(l+1)%c.length]).x?o.x:n.x,u=o.y<n.y?o.y:n.y,d=o.x>n.x?o.x:n.x,p=o.y>n.y?o.y:n.y,a=o.x-n.x,o=o.y-n.y,0!==(r=Math.sqrt(a*a+o*o))&&(a/=r,o/=r),(a=n.x+a*(r=(r=s-n.x)*a+(f-n.y)*o))<h?a=h:a>d&&(a=d),(n=n.y+o*r)<u?n=u:n>p&&(n=p),(h=(a-s)*(a-s)+(n-f)*(n-f))<b&&(b=h,g=a,m=n,v=l===c.length?0:l);if(t=this.getShapeLayer(t),e.Fabric.removePolygonAnchors(t.dlayer,i),c.splice(v+1,0,{x:g,y:m}),1===fabric.major_version)t.canvas.setActiveObject(i);else{switch(i.type){case"polyline":case"polygon":e.Fabric.addPolygonAnchors(t.dlayer,i),t.dlayer.canvas.renderAll()}i.polyparams?t.dlayer.params.sel=i.polyparams.polygon:i.params&&(t.dlayer.params.sel=i)}}},e.Fabric.removePolygonPoint=function(t,i){var s,a,n,r;i&&i.polyparams&&(n=(a=i.polyparams.polygon).points,"polygon"===a.type&&3>=n.length||"polyline"===a.type&&2>=n.length||(r=i.polyparams.point,delete i.polyparams.point,s=this.getShapeLayer(t),e.Fabric.removePolygonAnchors(s.dlayer,a),n.splice(r,1),e.resetPolygonCenter(a),s.canvas.setActiveObject(a)))},e.Fabric.addPolygonAnchors=function(t,i){var s,a,n={},r=t.canvas,o=function(){var i=this.polyparams.polygon,s=this.polyparams.point,a=i.get("points"),o=t.display.image;void 0!==s&&!1!==i.params.changeable&&(i.angle?n=e.rotatePoint({x:this.left,y:this.top},-i.angle,{x:i.left,y:i.top}):(n.x=this.left,n.y=this.top),a[s].x=(n.x-i.left)/i.scaleX,a[s].y=(n.y-i.top)/i.scaleY,e.resetPolygonCenter(i),e.Fabric._updateShape.call(o,i.params.layerName,i,null,"update"),o&&(o.params.listonchange||i.params.listonchange)&&o.listRegions(i,{mode:2}),r.renderAll())},l=function(t){var i,s={};for(i=0;i<t.params.anchors.length;i++)s.x=t.left+t.points[i].x*t.scaleX,s.y=t.top+t.points[i].y*t.scaleY,t.angle&&(s=e.rotatePoint(s,t.angle,{x:t.left,y:t.top})),t.params.anchors[i].set({left:s.x,top:s.y,angle:t.angle}),t.params.anchors[i].setCoords();t._calcDimensions(!0),r.renderAll()};if(!i.params.anchors&&!1!==i.params.changeable){for(i.params.anchors=[],s=0;s<i.points.length;s++)n.x=i.left+i.points[s].x*i.scaleX,n.y=i.top+i.points[s].y*i.scaleY,i.angle&&(n=e.rotatePoint(n,i.angle,i.getCenterPoint())),(a=new fabric.Rect({left:n.x,top:n.y,hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,selectable:!0,fill:i.get("stroke"),hoverCursor:"pointer",width:e.Fabric.opts.cornerSize+2,height:e.Fabric.opts.cornerSize+2,padding:2})).on("moving",o),a.polyparams={},a.polyparams.polygon=i,a.polyparams.point=s,i.params.anchors[s]=a,r.add(a);i.on("moving",function(){l(i)}),i.on("rotating",function(){l(i)}),i.on("scaling",function(){l(i)}),i.setCoords()}},e.Fabric.removePolygonAnchors=function(e,t){var i,s=e.canvas;if(t&&t.params&&t.params.anchors&&!1!==t.params.changeable){for(i=0;i<t.params.anchors.length;i++)s.remove(t.params.anchors[i]);delete t.params.anchors}},e.Fabric.updateChildren=function(t,i,s){var a,n,r,o,l,c;if("regions"===t.layerName)if("objects"===s)r={},t.canvas.getObjects().forEach(function(e){e.params&&(e.params.parent||e.params.children.length)&&(r[e.params.id]=e)}),t.canvas.getObjects().forEach(function(e){if(e.params)for(e.params.parent&&(e.params.parent.obj=r[e.params.parent.id]),a=0;a<e.params.children.length;a++)e.params.children[a].obj=r[e.params.children[a].id]});else if(i&&i.params)if("deltas"===s)i.params.parent&&((n=i.params.parent).dleft=n.obj.left-i.left,n.dtop=n.obj.top-i.top,n.moved=!0);else for(a=0;a<i.params.children.length;a++){switch(n=(o=i.params.children[a].obj).params.parent,s){case"moving":o.left=i.left-n.dleft,o.top=i.top-n.dtop;break;case"rotating":for(;0>i.angle;)i.angle+=360;for(;360<i.angle;)i.angle-=360;for(c=e.rotatePoint({x:o.left,y:o.top},l=i.angle-n.lastangle,{x:i.left,y:i.top}),o.left=c.x,o.top=c.y,n.dleft=i.left-o.left,n.dtop=i.top-o.top,o.angle+=l;0>o.angle;)o.angle+=360;for(;360<o.angle;)o.angle-=360;n.lastangle=i.angle;break;case"scaling":n.dleft*=i.scaleX/n.lastscalex,n.dtop=i.scaleY/n.lastscaley*(n.dtop-n.textheight)+n.textheight,n.lastscalex=i.scaleX,n.lastscaley=i.scaleY,n.moved=!0,o.left=i.left-n.dleft,o.top=i.top-n.dtop}o.setCoords(),t.display.image&&t.display.image.updateShapes(t.layerName,o,"child")}},e.resetPolygonCenter=function(t){var i,s,a,n;if(n={},1===fabric.major_version?(t._calcDimensions(),s=(t.minX+t.width/2)*t.scaleX,i=(t.minY+t.height/2)*t.scaleY):(s=((i=t._calcDimensions()).left+i.width/2)*t.scaleX,i=(i.top+i.height/2)*t.scaleY),t.angle?n=e.rotatePoint({x:t.left+s,y:t.top+i},t.angle,{x:t.left,y:t.top}):(n.x=t.left+s,n.y=t.top+i),1<fabric.major_version||5<=fabric.minor_version)for(s/=t.scaleX,a=i/t.scaleY,i=0;i<t.points.length;i++)t.points[i].x-=s,t.points[i].y-=a;t.left=n.x,t.top=n.y,1<fabric.major_version&&(n=t._calcDimensions(),t.width=n.width,t.height=n.height,t.pathOffset={x:n.left+t.width/2,y:n.top+t.height/2}),t.setCoords()},e.Fabric.print=function(t){var i,s,a,n,r,o,l=0,c=sprintf("width=%s,height=%s,menubar=1,toolbar=1,status=0,scrollbars=1,resizable=1",this.display.canvasjq.attr("width"),this.display.canvasjq.attr("height"));if("string"==typeof t)try{t=JSON.parse(t)}catch(h){e.error("can't parse print opts: "+t,h)}for(s in t=t||{},n=this.display.canvas.toDataURL("image/png"),i="<html><body style='padding: 0px; margin: 0px' onload='window.print(); return false'>",r=sprintf("<div style='position:absolute; left:%spx; top:%spx'>",0,l),i+=sprintf("%s<img src='%s'></div>",r,n),this.layers)this.layers.hasOwnProperty(s)&&"main"===(n=this.layers[s]).dlayer.dtype&&n.show&&(i+=sprintf("%s%s</div>",r,n.dlayer.canvas.toSVG()));(void 0===t.colorbar||t.colorbar)&&(t=this.display.pluginInstances.JS9Colorbar)&&t.isActive()&&(l+=2,n=t.colorbarjq[0].toDataURL("image/png"),r=sprintf("<div style='position:absolute; left:%spx; top:%spx'>",0,l+=this.display.height),i+=sprintf("%s<img src='%s'></div>",r,n),t.textjq&&t.textjq[0]&&(n=t.textjq[0].toDataURL("image/png"),r=sprintf("<div style='position:absolute; left:%spx; top:%spx'>",0,l+=t.colorbarjq.height()+1),i+=sprintf("%s<img style='width:%spx;'src='%s'></div>",r,this.display.width,n))),i+="</body></html>",window.isElectron&&(o="data:text/html,<html><body><script>window.addEventListener('message', function(ev){document.documentElement.innerHTML=ev.data; window.setTimeout(function(){window.print()}, 250);},false)<\/script><p>waiting for image ...</body></html>"),(a=window.open(o,this.id,c))?a.document?(a.document.open(),a.document.write(i),a.document.close()):a.postMessage?window.setTimeout(function(){a.postMessage(i,"*")},250):e.error("no method available for drawing image into print window"):e.error("could not create print window (check your pop-up blockers)")},e.Fabric.initGraphics=function(){var t;for(t in e.Display.prototype.newShapeLayer=e.Fabric.newShapeLayer,e.Image.prototype.addShapes=e.Fabric.addShapes,e.Image.prototype.selectShapes=e.Fabric.selectShapes,e.Image.prototype.updateShapes=e.Fabric.updateShapes,e.Image.prototype.updateShape=e.Fabric._updateShape,e.Image.prototype.getShapes=e.Fabric.getShapes,e.Image.prototype.changeShapes=e.Fabric.changeShapes,e.Image.prototype.removeShapes=e.Fabric.removeShapes,e.Image.prototype.refreshShapes=e.Fabric.refreshShapes,e.Image.prototype.getShapeLayer=e.Fabric.getShapeLayer,e.Image.prototype.showShapeLayer=e.Fabric.showShapeLayer,e.Image.prototype.activeShapeLayer=e.Fabric.activeShapeLayer,e.Image.prototype.displayShapeLayers=e.Fabric.displayShapeLayers,e.Image.prototype.toggleShapeLayers=e.Fabric.toggleShapeLayers,e.Image.prototype.print=e.Fabric.print,e.Fabric.opts)e.Fabric.opts.hasOwnProperty(t)&&(fabric.Object.prototype[t]=e.Fabric.opts[t])},e.Fabric.initGraphics(),e.MouseTouch={},e.MouseTouch.CLASS="JS9",e.MouseTouch.NAME="MouseTouch",e.MouseTouch.WIDTH=512,e.MouseTouch.HEIGHT=220,e.MouseTouch.BASE=e.MouseTouch.CLASS+e.MouseTouch.NAME,e.MouseTouch.mouseText=[],e.MouseTouch.mouseText[0]="move mouse, no buttons pressed:",e.MouseTouch.mouseText[1]="move mouse, primary button pressed:",e.MouseTouch.mouseText[2]="move mouse, secondary button pressed:",e.MouseTouch.touchText=[],e.MouseTouch.touchText[0]="touch move, with one finger:",e.MouseTouch.touchText[1]="touch move, with two fingers:",e.MouseTouch.touchText[2]="touch move, with three fingers:",e.MouseTouch.textHTML="<div style='float: left'>%s</div>",e.MouseTouch.actionHTML="<div style='float: left'><b>%s</b></div>",e.MouseTouch.actionid=function(e,t){return(e+"_"+t).replace(/[^A-Za-z0-9_]/g,"_")},e.MouseTouch.addText=function(t,i){var s;return s=sprintf(e.MouseTouch.textHTML,i),$("<div>").addClass(e.MouseTouch.BASE+"Text").html(s).appendTo(t)},e.MouseTouch.addAction=function(t,i,s){return i=e.MouseTouch.actionid(i,s),s=sprintf(e.MouseTouch.actionHTML,s),$("<div>").addClass(e.MouseTouch.BASE+"Action").attr("id",i).html(s).appendTo(t)},e.MouseTouch.isPinch=function(t,i){var s,a,n,r,o=e.globalOpts.pinchWait,l=e.globalOpts.pinchThresh;if(!t)return-1;if(!(a=t.display).mousetouchZoom||2!==t.pos.touches.length)return-1;switch(a.ispinch){case-1:case 1:return a.ispinch}if(s=Math.sqrt((t.pos.touches[0].x-t.pos.touches[1].x)*(t.pos.touches[0].x-t.pos.touches[1].x)+(t.pos.touches[0].y-t.pos.touches[1].y)*(t.pos.touches[0].y-t.pos.touches[1].y)),a.dist0||(a.dist0=s),a.deltas.push(Math.floor(s-a.dist0)),a.deltas.length>=o){for(s=1,r=n=0;s<o;s++)a.deltas[s]>a.deltas[s-1]?n++:a.deltas[s]<a.deltas[s-1]&&r++;return a.ispinch=n>=l||r>=l?1:-1,a.lastzoom=0,a.ispinch}return 0},e.MouseTouch.Actions={},e.MouseTouch.Actions["display value/position"]=function(t,i,s){!e.specialKey(s)&&e.globalOpts.internalValPos&&t&&i&&0<i.x&&0<i.y&&i.x<t.raw.width&&i.y<t.raw.height&&(t.valpos=t.updateValpos(i,!0))},e.MouseTouch.Actions["change contrast/bias"]=function(t,i,s){var a=t.display;e.globalOpts.internalContrastBias&&t&&i&&!(t.pos0&&t.pos&&Math.abs(t.pos0.x-t.pos.x)<e.NOMOVE&&Math.abs(t.pos0.y-t.pos.y)<e.NOMOVE||t.clickInRegion||e.specialKey(s)||t.rgbFile)&&(s=e.eventToDisplayPos(s,t.posOffset),i=Math.floor(s.x+.5),s=Math.floor(s.y+.5),e.globalOpts.containContrastBias&&(0>i||0>s||i>=a.canvas.width||s>=a.canvas.height)||(t.params.bias=i/a.canvas.width,t.params.contrast=s/a.canvas.height*10,e.bugs.firefox_linux?window.setTimeout(function(){t.displayImage("scaled",{blendMode:!1})},0):t.displayImage("scaled",{blendMode:!1}),t.xeqstash&&t.xeqstash.filterRGBImage&&delete t.xeqstash.filterRGBImage,e.globalOpts.extendedPlugins&&t.xeqPlugins("image","onchangecontrastbias")))},e.MouseTouch.Actions["change contrast/bias"].stop=function(e,t,i){e.display.blendMode&&e.displayImage("rgb")},e.MouseTouch.Actions["wheel zoom"]=function(t,i){var s;t&&t.display.mousetouchZoom&&(s=0<i.originalEvent.deltaY?Math.min(e.MAXZOOM,t.getZoom()+e.ADDZOOM):Math.max(e.MINZOOM,t.getZoom()-e.ADDZOOM),s=Math.round(100*(s+1e-5))/100,t.setZoom(s))},e.MouseTouch.Actions["pan the image"]=function(e,t,i){var s;e&&(t=(e.pos0.x-e.pos.x)/(s=e.rgb.sect).zoom,i=(e.pos0.y-e.pos.y)/s.zoom,1<=Math.abs(t)||1<=Math.abs(i))&&(e.setPan(s.xcen+t,s.ycen-i),e.pos0=e.pos)},e.MouseTouch.Actions.pinch=function(t,i,s){t&&(s=(i=t.display).zoom0*Math.sqrt((t.pos.touches[0].x-t.pos.touches[1].x)*(t.pos.touches[0].x-t.pos.touches[1].x)+(t.pos.touches[0].y-t.pos.touches[1].y)*(t.pos.touches[0].y-t.pos.touches[1].y))/i.dist0,(s=Math.max(e.MINZOOM,Math.min(e.MAXZOOM,Math.round(100*(s+1e-5))/100)))!==i.lastzoom&&t.setZoom(s),i.lastzoom=s)},e.MouseTouch.Actions.start=function(t,i,s){t&&((i=t.display).ispinch=0,i.dist0=0,i.zoom0=t.rgb.sect.zoom,i.deltas=[]),i=e.MouseTouch.getAction(t,s),e.MouseTouch.Actions[i]&&e.MouseTouch.Actions[i].start&&e.MouseTouch.Actions[i].start(t,t.ipos,s)},e.MouseTouch.Actions.stop=function(t,i,s){i=e.MouseTouch.getAction(t,s),e.MouseTouch.Actions[i]&&e.MouseTouch.Actions[i].stop&&e.MouseTouch.Actions[i].stop(t,t.ipos,s)},e.MouseTouch.getAction=function(t,i){var s,a;if(!t)return s;switch(a=t.display,t.clickState){case 0:s=a.mouseActions[0];break;case 1:s=a.mouseActions[1];break;case 2:s=a.mouseActions[2];break;case-1:s=a.touchActions[0];break;case-2:switch(e.MouseTouch.isPinch(t,i)){case-1:s=a.touchActions[1];break;case 1:s="pinch"}break;case-3:s=a.touchActions[2]}return s},e.MouseTouch.action=function(t,i,s){(s=s||e.MouseTouch.getAction(t,i))&&e.MouseTouch.Actions[s]&&e.MouseTouch.Actions[s](t,t.ipos,i)},e.MouseTouch.mousetouchzoom=function(t,i){var s=e.lookupDisplay(t);s&&(s.mousetouchZoom=i.checked)},e.MouseTouch.init=function(){var t,i,s=this;if(this.divjq.html(""),this.divjq.addClass("JS9PluginScrolling"),this.mousetouchContainer=$("<div>").addClass(e.MouseTouch.BASE+"Container").attr("id",this.id+"MouseTouchContainer").appendTo(this.divjq),i=sprintf("<div class='%s'><span><b>Drag an action to reconfigure JS9 mouse/touch events:</b></span><p>",e.MouseTouch.BASE+"Header"),this.mousetouchHeadContainer=$("<span style='float: left'>").addClass(e.MouseTouch.BASE+"Container").attr("id",this.id+"MouseTouchHeadContainer").html(i).appendTo(this.mousetouchContainer),this.mousetouchTextContainer=$("<span style='float: left'>").addClass(e.MouseTouch.BASE+"Container").attr("id",this.id+"MouseTouchTextContainer").appendTo(this.mousetouchContainer),this.mousetouchActionContainer=$("<span style='float: left'>").addClass(e.MouseTouch.BASE+"Container").attr("id",this.id+"MouseTouchActionContainer").appendTo(this.mousetouchContainer),e.TOUCHSUPPORTED){for(this.mousetouchTouchTextContainer=$("<div>").addClass(e.MouseTouch.BASE+"TextContainer").attr("id",this.id+"TouchTextContainer").html("").appendTo(this.mousetouchTextContainer),t=0;t<e.MouseTouch.touchText.length;t++)e.MouseTouch.addText.call(this,this.mousetouchTouchTextContainer,e.MouseTouch.touchText[t]);for(t=e.MouseTouch.touchText.length;t<this.display.touchActions.length;t++)e.MouseTouch.addText.call(this,this.mousetouchMouseTextContainer,"&nbsp;");for(this.mousetouchTouchContainer=$("<div>").addClass(e.MouseTouch.BASE+"ActionContainer").attr("id",this.id+"TouchContainer").html("").appendTo(this.mousetouchActionContainer),t=0;t<this.display.touchActions.length;t++)e.MouseTouch.addAction.call(this,this.mousetouchTouchContainer,"touch",i=this.display.touchActions[t]);this.mousetouchTouchContainer.sortable({start:function(e,t){this.oidx=t.item.index()},stop:function(e,t){var i=t.item.index(),a=s.display.touchActions.splice(this.oidx,1)[0];s.display.touchActions.splice(i,0,a)}})}if(!/iPad|iPhone|iPod/.test(navigator.platform)){for(this.mousetouchMouseTextContainer=$("<div>").addClass(e.MouseTouch.BASE+"TextContainer").attr("id",this.id+"MouseTextContainer").appendTo(this.mousetouchTextContainer),t=0;3>t;t++)e.MouseTouch.addText.call(this,this.mousetouchMouseTextContainer,e.MouseTouch.mouseText[t]);for(t=3;t<this.display.mouseActions.length;t++)e.MouseTouch.addText.call(this,this.mousetouchMouseTextContainer,"&nbsp;");for(this.mousetouchMouseContainer=$("<div>").addClass(e.MouseTouch.BASE+"ActionContainer").attr("id",this.id+"MouseContainer").html("").appendTo(this.mousetouchActionContainer),t=0;t<this.display.mouseActions.length;t++)e.MouseTouch.addAction.call(this,this.mousetouchMouseContainer,"mouse",i=this.display.mouseActions[t]);this.mousetouchMouseContainer.sortable({start:function(e,t){this.oidx=t.item.index()},stop:function(e,t){var i=t.item.index(),a=s.display.mouseActions.splice(this.oidx,1)[0];s.display.mouseActions.splice(i,0,a)}})}i=sprintf("<p><div class='%s'>use mouse wheel or pinch to zoom:&nbsp;&nbsp;<input type='checkbox' value='1' onclick='javascript:JS9.MouseTouch.mousetouchzoom(\"%s\", this);'></div>",e.MouseTouch.BASE+"Footer",this.display.id),this.mousetouchFootContainer=$("<span style='float: left'>").addClass(e.MouseTouch.BASE+"Container").attr("id",this.id+"MouseTouchFootContainer").html(i).appendTo(this.mousetouchContainer),this.display.mousetouchZoom&&this.mousetouchContainer.find("input").attr("checked",!0)},e.Regions={},e.Regions.CLASS="JS9",e.Regions.NAME="Regions",e.Regions.opts={updateWCS:!0,panzoom:!0,tags:"source,include",strokeWidth:2,iradius:0,oradius:30,nannuli:10,width:60,height:60,radius:30,r1:30,r2:20,ptshape:"box",ptsize:2,linepoints:[{x:-30,y:30},{x:30,y:-30}],polypoints:[{x:-30,y:30},{x:30,y:30},{x:0,y:-30}],fontFamily:"Helvetica",fontSize:14,fontStyle:"normal",fontWeight:300,textAlign:"left",angle:0,aradius1:4,aradius2:8,configURL:"./params/regionsconfig.html",sortOverlapping:!0,title:"Region Configuration",tagcolors:{include_source:"#00FF00",exclude_source:"#FF0000",include_background:"#FFD700",exclude_background:"#FF8C00",source:"#00FF00",background:"#FFD700",defcolor:"#00FF00"},onmousedown:function(t,i,s,a){var n;!e.specialKey(s)&&a.params&&(i=(new Date).getTime(),a.params.lasttime&&i-a.params.lasttime<e.DBLCLICK&&(n=!0),a.params.lasttime=i),n?a.params.winid||!1===a.params.changeable||e.Regions.displayConfigForm.call(t,a):e.specialKey(s)&&("polygon"===a.type||"polyline"===a.type?(e.Fabric.addPolygonPoint.call(t,a.params.layerName,a,s),e.Fabric._updateShape.call(t,a.params.layerName,a,null,"update")):a.polyparams&&a.polyparams.polygon&&(e.Fabric.removePolygonPoint.call(t,(s=a.polyparams.polygon).params.layerName,a),e.Fabric._updateShape.call(t,s.params.layerName,s,null,"update")))},onmouseup:function(){var e,t=[];for(this.getActiveObject()&&t.push(this.getActiveObject()),1===fabric.major_version?this.getActiveGroup()&&(t=this.getActiveGroup().getObjects()):t.push(this.getActiveObjects()),e=0;e<t.length;e++)t[e].polyparams&&this.setActiveObject(t[e].polyparams.polygon)},onchange:null},e.Regions.init=function(t){var i;return e.Image.prototype.parseRegions=e.Regions.parseRegions,e.Image.prototype.saveRegions=e.Regions.saveRegions,e.Image.prototype.listRegions=e.Regions.listRegions,e.Image.prototype.copyRegions=e.Regions.copyRegions,e.Image.prototype.editRegionTags=e.Regions.editRegionTags,e.Image.prototype.toggleRegionTags=e.Regions.toggleRegionTags,e.Image.prototype.unremoveRegions=e.Regions.unremoveRegions,(i=this.display.newShapeLayer(t||"regions",e.Regions.opts)).canvas.on("mouse:up",function(){var e,t,s=[];if(i.display.image)for(t=i.display.image,1===fabric.major_version?(this.getActiveObject()&&s.push(this.getActiveObject()),this.getActiveGroup()&&(s=this.getActiveGroup().getObjects())):s.push(this.getActiveObjects()),e=0;e<s.length;e++)if(s[e].params){t.params.listonchange?t.listRegions("all"===t.params.whichonchange?"all":"selected",{mode:2}):s[e].params.listonchange&&t.listRegions("selected",{mode:2});break}}),this},e.Regions.displayConfigForm=function(t){var i,s=this,a=e.Regions.opts.title;t&&($("#dhtmlwindowholder").arrive("#regionsConfigForm",{onceOnly:!0},function(){t.pub&&e.Regions.initConfigForm.call(s,t)}),i=e.allinone?e.allinone.regionsConfigHTML:e.InstallDir(e.Regions.opts.configURL),t.params.winid=s.displayAnalysis("regions",i,{title:a}))},e.Regions.initConfigForm=function(t){var i,s,a,n,r,o,l,c,h,u,d=this;u=(h=t.params).winid;var p="#"+$(u).attr("id")+" #regionsConfigForm ",f=function(e){if(void 0!==e)return"number"==typeof e&&0!=e%1&&(e=Math.round(1e4*(e+1e-5))/1e4),String(e)},g=function(e){return(e||"").replace(/\n/g,"\\n")};switch(s=$(p).data("wcssys"),$(p+"."+t.pub.shape).each(function(){$(this).removeClass("nodisplay")}),$(p+".val").each(function(){switch(n="",a=$(this).attr("name")){case"x":case"y":void 0!==t.pub.lcs&&void 0!==t.pub.lcs[a]?n=f(t.pub.lcs[a]):void 0!==t.pub[a]&&(n=f(t.pub[a]));break;case"radii":t.pub.radii&&(n="image"!==d.params.wcssys&&"physical"!==d.params.wcssys&&t.pub.wcsstr?t.pub.wcsstr.replace(/^annulus\(/,"").replace(/\)$/,"").split(",").slice(2).join(","):t.pub.imstr.replace(/^annulus\(/,"").replace(/\)$/,"").split(",").slice(2).join(","));break;case"pts":t.pub.pts?t.pub.pts.forEach(function(e){n&&(n+=", "),n+=sprintf("%s, %s",e.x.toFixed(2),e.y.toFixed(2))}):t.pub.imstr&&(n=t.pub.imstr.replace(/^.*\(/,"").replace(/\)$/,""));break;case"fontFamily":t.getFontFamily&&(n=t.getFontFamily());break;case"fontSize":t.getFontSize&&(n=t.getFontSize());break;case"fontStyle":t.getFontStyle&&(n=t.getFontStyle());break;case"fontWeight":t.getFontWeight&&(n=t.getFontWeight());break;case"strokeWidth":n=t.params.sw1;break;case"strokeDashes":t.strokeDashArray?(n=t.strokeDashArray.join(" ")).match(/NaN/)&&(n=""):n="";break;case"regstr":n="image"!==d.params.wcssys&&"physical"!==d.params.wcssys&&t.pub.wcsstr?t.pub.wcssys+"; "+t.pub.wcsstr:t.pub.imsys+"; "+t.pub.imstr;break;case"xpos":switch(d.params.wcssys){case"image":n=sprintf("%.1f",t.pub.x);break;case"physical":n=sprintf("%.1f",t.pub.lcs?t.pub.lcs.x:t.pub.x);break;default:n=void 0!==t.pub.ra?sprintf("%.6f",t.pub.ra):sprintf("%.1f",t.pub.x)}l=n;break;case"ypos":switch(d.params.wcssys){case"image":n=sprintf("%.1f",t.pub.y);break;case"physical":n=sprintf("%.1f",t.pub.lcs?t.pub.lcs.y:t.pub.y);break;default:n=void 0!==t.pub.dec?sprintf("%.6f",t.pub.dec):sprintf("%.1f",t.pub.y)}c=n;break;case"radius":case"oradius":case"length":case"width":case"r1":switch(d.params.wcssys){case"image":void 0!==t.pub[a]&&(n=f(t.pub[a]));break;case"physical":void 0!==t.pub.lcs[a]&&(n=f(t.pub.lcs[a]));break;default:n=f(t.pub.wcssizestr?t.pub.wcssizestr[0]:t.pub[a])}break;case"height":case"r2":switch(d.params.wcssys){case"image":void 0!==t.pub[a]&&(n=f(t.pub[a]));break;case"physical":void 0!==t.pub.lcs[a]&&(n=f(t.pub.lcs[a]));break;default:n=f(t.pub.wcssizestr?t.pub.wcssizestr[1]:t.pub[a])}break;case"wcssys":if(!(r=$(p).find("[name='"+a+"']")).find("option").length)for(i=0;i<e.wcssyss.length;i++)r.append("<option>"+(o=e.wcssyss[i])+"</option>");r.find("option").each(function(e,t){d.params.wcssys===t.value&&(n=t.value)});break;case"altwcssys":if(!(r=$(p).find("[name='"+a+"']")).find("option").length)for(i=0;i<e.wcssyss.length;i++)"image"!==(o=e.wcssyss[i])&&"physical"!==o&&r.append("<option>"+o+"</option>");(n=$(p).data("wcssys"))||r.find("option").each(function(e,t){d.params.wcssys===t.value&&(n=t.value)});break;case"wcsunits":t.pub.wcsunits&&(n=t.pub.wcsunits);break;case"childtext":0<t.params.children.length&&(n=g(t.params.children[0].obj.text));break;case"text":void 0!==t.pub[a]&&(n=g(f(t.pub[a])));break;case"id":n=t.pub.id;break;default:void 0!==t.pub[a]&&(n=f(t.pub[a]))}$(this).val(n)}),(!this.raw.wcs||0>this.raw.wcs)&&$(p).find("[name='wcssys']").hide(),"image"===this.params.wcssys||"physical"===this.params.wcssys||!this.raw.wcs||0>this.raw.wcs?$(p).find("[name='altwcssys']").hide():($(p).find("[name='altwcssys']").show(),s&&d.params.wcssys!==s&&(s=d.wcs2wcs(null,s,l,c).split(/\s+/),$(p).find("[name='xpos']").val(s[0]),$(p).find("[name='ypos']").val(s[1]))),"text"!==t.type&&($(p+".childtext").removeClass("nodisplay"),$(p+"[name='childtext']").prop("readonly",0<h.children.length)),void 0===h.listonchange&&(h.listonchange=!1),h.listonchange?$(p+"[name='listonchange']").prop("checked",!0):$(p+"[name='listonchange']").prop("checked",!1),void 0===h.changeable&&void 0!==h.fixinplace&&(h.changeable=!h.fixinplace),void 0===h.changeable&&(h.changeable=!0),h.changeable?$(p+"[name='changeable']").prop("checked",!0):$(p+"[name='changeable']").prop("checked",!1),$(p).find("input:text[readonly]").css("border-color","A5A5A5").css("background","#E9E9E9"),t.pub.shape){case"box":case"ellipse":$(p+".angle").removeClass("nodisplay");break;case"text":$(p+".textangle").removeClass("nodisplay")}$(p).data("im",this),$(p).data("shape",t),$(p).data("winid",u),$(p).data("tooltipInit")||($(p).data("tooltipInit",!0),e.BROWSER[3]?(h="touchstart",u="touchend"):(h="mouseover",u="mouseout"),$(".col_R").on(h,function(){var t;t=$(this).find("input").data("tooltip");var i=$(this).closest(".dhtmlwindow").find(".drag-handle");t&&i.length&&(t=e.Regions.opts.title+": "+t,$(i)[0].childNodes[0].nodeValue=t)}),$(".col_R").on(u,function(){var t=$(this).closest(".dhtmlwindow").find(".drag-handle");t.length&&($(t)[0].childNodes[0].nodeValue=e.Regions.opts.title)}))},e.Regions.processConfigForm=function(t,i,s,a){var n,r,o,l,c=a.length,h=1,u={},d=this.raw.wcsinfo||{cdelt1:1,cdelt2:1},p=function(e){if(void 0!==e)return"number"==typeof e&&0!=e%1&&(e=Math.round(1e4*(e+1e-5))/1e4),String(e)},f=function(e,t){return void 0!==e&&p(e)!==p(t)},g=function(t,i,s){return"remove"===i?"selected"===s:"childtext"===i?!(0<t.params.children.length)&&""!==s:"strokeDashes"===i?JSON.stringify(t.strokeDashArray)!==JSON.stringify(s):("tags"===i||""!==s)&&("misc"===i&&""!==s||("angle"===i?t.angle!==-parseFloat(s):"ix"===i?f(t.pub.x,e.saostrtod(s)):"iy"===i?f(t.pub.y,e.saostrtod(s)):"px"===i?f(t.pub.lcs.x,e.saostrtod(s)):"py"===i?f(t.pub.lcs.y,e.saostrtod(s)):"ra"===i?f(e.saostrtod(t.pub.wcsposstr[0]),e.saostrtod(s)):"dec"===i?f(e.saostrtod(t.pub.wcsposstr[1]),e.saostrtod(s)):void 0!==t.pub.lcs[i]?!!f(t.pub.lcs[i],s):!!(f(t.pub[i],s)||f(t.params[i],s)||f(t[i],s))))},m=function(t){return"true"===t||"false"!==t&&(e.isNumber(t)?parseFloat(t):t)},v=function(e){var t=String.fromCharCode(13,10);return(e||"").replace(/\\n/g,t)};for(this.lcs&&this.lcs.physical&&(h=this.lcs.physical.forward[0][0]||1),n=0;n<c;n++){if(o=a[n].value,"xpos"===(r=a[n].name)||"ypos"===r)switch(this.params.wcssys){case"image":r="i"+r.charAt(0);break;case"physical":r="p"+r.charAt(0);break;default:r=this.raw.wcs&&0<this.raw.wcs?"xpos"===r?"ra":"dec":"xpos"===r?"ix":"iy"}switch(r){case"text":"text"===i.type&&g(i,r,o)&&(u[r]=v(m(o)));break;case"strokeDashes":g(i,r,o=o.trim().split(/\s+/))&&(u.strokeDashArray=0===o.length?[]:o.map(function(e){return parseInt(e,10)}));break;case"childtext":"text"!==i.type&&g(i,r,o)&&(u.text=v(m(o)));break;case"ix":g(i,r,o)&&(u.x=m(o),void 0===u.y&&(u.y=i.pub.y));break;case"iy":g(i,r,o)&&(u.y=m(o),void 0===u.x&&(u.x=i.pub.x));break;case"px":g(i,r,o)&&(u.px=m(o),void 0===u.py&&(u.py=i.pub.lcs.y));break;case"py":g(i,r,o)&&(u.py=m(o),void 0===u.px&&(u.px=i.pub.lcs.x));break;case"ra":g(i,r,o)&&(u.ra=o,void 0===u.dec&&(u.dec=i.pub.wcsposstr[1]));break;case"dec":g(i,r,o)&&(u.dec=o,void 0===u.ra&&(u.ra=i.pub.wcsposstr[0]));break;case"wcssys":break;case"radius":case"length":case"width":case"r1":switch(this.params.wcssys){case"image":g(i,r,o)&&(u[r]=m(o));break;case"physical":g(i,r,o)&&(u[r]=m(o)*h);break;default:o="."===(o=e.strtoscaled(o)).dtype?o.dval:Math.abs(o.dval/d.cdelt1),g(i,r=r.replace("wcs",""),o)&&(u[r]=m(o))}break;case"height":case"r2":switch(this.params.wcssys){case"image":g(i,r,o)&&(u[r]=m(o));break;case"physical":g(i,r,o)&&(u[r]=m(o)*h);break;default:o="."===(o=e.strtoscaled(o)).dtype?o.dval:Math.abs(o.dval/d.cdelt2),g(i,r=r.replace("wcs",""),o)&&(u[r]=m(o))}break;case"remove":g(i,r,o)&&(u[r]=i.pub.id);break;case"misc":if(o.trim())try{l=JSON.parse(o),$.extend(u,l)}catch(b){e.error("invalid json: "+o)}break;default:g(i,r,o)&&(u[r]=m(o))}}u.ra&&u.dec&&(t=$(t).data("wcssys"))&&this.params.wcssys!==t&&(t=this.wcs2wcs(t,null,u.ra,u.dec).split(/\s+/),u.ra=t[0],u.dec=t[1]),this.changeShapes(i.pub.layer,i,u),e.Regions.initConfigForm.call(this,i,s)},e.Regions.pasteFromClipboard=function(t){var i,s,a,n,r=0,o=0;if(this){if((i=e.CopyFromClipboard().trim())||e.error(e.CLIPBOARDERROR),i.match(/(annulus|box|circle|ellipse|line|polygon|point|text) *\(/)){if(a=e.globalOpts.regionsToClipboard,e.globalOpts.regionsToClipboard=!1,n=this.addShapes("regions",i,{rtn:"objs"}),t){for(s=n.length,t=0;t<s;t++)r+=n[t].pub.x,o+=n[t].pub.y;for(r/=s,o/=s,t=0;t<s;t++)this.changeShapes("regions",n[t].pub.id,{x:n[t].pub.x-r+this.ipos.x,y:n[t].pub.y-o+this.ipos.y})}e.globalOpts.regionsToClipboard=a}else e.error(e.CLIPBOARDERROR2);return i}},e.Regions.listRegions=function(t,i,s){var a,n,r,o,l,c,h="",u="none",d=!1,p=[];r={};var f=function(e,t){var i,s,a,n={},r=e.params,o=r.children,l=r.exports;for(i=0;i<l.length;i++)if(("text"!==(a=l[i])||"text"===e.type)&&"textOpts"!==a){if("strokeDashArray"===a&&(""===(s=e.strokeDashArray.join(""))||s.match(/NaN/)))continue;"data"===a&&"object"==typeof r.data&&!1===r.data.doexport||("strokeWidth"===a&&r.sw1?n[a]=r.sw1:void 0!==e[a]?n[a]=e[a]:void 0!==r[a]?n[a]=r[a]:t&&void 0!==t[a]&&(n[a]=t[a]))}return 0<o.length&&o[0].obj.text&&(n.text=(i=o[0].obj).text,n.textOpts=f(i),e.angle!==i.angle?(n.textOpts.angle=-i.angle,("circle"===e.params.shape||"annulus"===e.params.shape)&&(i.params.hasTextOpts=!0)):0!==i.angle?"circle"!==e.params.shape&&"annulus"!==e.params.shape||(n.textOpts.angle=-i.angle,i.params.hasTextOpts=!0):0!==e.angle||0===e.pub.angle||"circle"!==e.params.shape&&"annulus"!==e.params.shape||(n.textOpts.angle=e.pub.angle,i.params.hasTextOpts=!0),(i.params.parent.moved||i.params.hasTextOpts)&&(i.pub.ra&&i.pub.dec?(n.textOpts.ra=i.pub.ra,n.textOpts.dec=i.pub.dec):i.pub.lcs?(n.textOpts.px=i.pub.lcs.x,n.textOpts.py=i.pub.lcs.y):(n.textOpts.x=i.pub.x,n.textOpts.y=i.pub.y)),n.textOpts.color===e.stroke&&delete n.textOpts.color,n.textOpts.text&&delete n.textOpts.text,Object.keys(n.textOpts).length||delete n.textOpts),n};if("string"==typeof i)try{i=JSON.parse(i)}catch(g){e.error("can't parse listRegions opts: "+i,g)}if(void 0===(i=(i=i||{}).mode)&&(i=3),void 0===s&&(s="regions"),a=(c=this.getShapes(s,t,{includeObj:!0})).length,i)for(t=0;t<a;t++)if((o=(s=c[t]).tags.join(","))&&"source,include"!==o&&"include,source"!==o){d=!0;break}for(n in e.Regions.opts.tagcolors)e.Regions.opts.tagcolors.hasOwnProperty(n)&&p.push(e.Regions.opts.tagcolors[n]);for(t=0;t<a;t++)r=(s=c[t]).obj,n=0<=(o=s.tags.join(",")).indexOf("exclude")?"-":"",r=f(r,s),s.color&&-1===p.indexOf(s.color)&&(r.color=s.color),d&&(l=" # "+o),s.wcsstr&&"image"!==this.params.wcssys&&"physical"!==this.params.wcssys?("wcs"!==u&&("none"!==u&&(h+="; "),h+=this.params.wcssys,u="wcs"),h+="; "+n+s.wcsstr):s.imstr&&(u!==s.imsys&&("none"!==u&&(h+="; "),h+=s.imsys,u=s.imsys),h+="; "+n+s.imstr),1==i%2&&0<Object.keys(r).length&&(h+=" "+JSON.stringify(r)),l&&(h+=l);return 1<i&&this.display.displayMessage("regions",h),h},e.Regions.copyRegions=function(t,i){var s,a,n=[];if("object"==typeof t)n.push(t);else if("all"===t)for(s=0;s<e.images.length;s++)this!==e.images[s]&&n.push(e.images[s]);else(s=e.lookupImage(t))&&n.push(s);if(n.length){for(i||(a=this.listRegions("selected",{mode:1})),a||(a=this.listRegions(i,{mode:1})),s=0;s<n.length;s++)n[s].addShapes("regions",a);return this}},e.Regions.parseRegions=function(t,i){var s,a,n,r,o,l,c,h,u,d,p,f,g,m=[],v=/^(annulus|box|circle|ellipse|line|polygon|point|text)$/,b=/^(fk4|fk5|icrs|galactic|ecliptic|image|physical|linear)$/,y=/^(image|physical)$/,x=/[dr:]/,w=/\(\s*([^)]+?)\s*\)/,S=/(\{.*\})/,C=/\s*,\s*/,A=/#(?![a-zA-Z0-9]{6}['"])/,_=function(e){return"0"!==e&&"false"!==e},k=function(e){var t,i,s,a={opts:{},args:[],isregion:0};if(a.cmd=0<=e.indexOf("(")?e.split("(")[0].trim().toLowerCase():0<=e.indexOf("{")?e.split("{")[0].trim().toLowerCase():0<=e.indexOf("#")?e.split("#")[0].trim().toLowerCase():e.trim().toLowerCase(),a.cmd&&(a.isregion=0<=a.cmd.search(v)),t=e.trim().split(A),(i=S.exec(t[0]))&&i[0])try{a.opts=JSON.parse(i[0].trim())}catch(n){a.opts={}}return a.comment=t[1],a.comment&&void 0!==(s=function(e){for(var t,i,s,a={},n=/([a-zA-Z][a-zA-Z0-9_]*)\s*=\s*(\d+(\s*\d+)*|[^ '"{]+|['"{][^'"}]*['"}])/g,r={color:function(e){return{color:e}},dash:function(e){if(e)return{strokeDashArray:[3,1]}},dashlist:function(e){var t;if(e){for(t=e.split(" "),e=0;e<t.length;e++)t[e]=parseFloat(t[e]);return{strokeDashArray:t}}},delete:function(e){return{removable:_(e)}},edit:function(e){return{selectable:_(e)}},fixed:function(e){return{zoomable:!_(e)}},font:function(e){var t={},i=(e=e.split(" ")).length;return 1<=i&&(t.fontFamily=e[0]),2<=i&&(t.fontSize=parseFloat(e[1])),3<=i&&(t.fontStyle=e[2]),4<=i&&(t.fontWeight=e[3]),t},highlite:function(e){return{hasControls:_(e),hasBorders:_(e),hasRotatingPoint:_(e)}},move:function(e){return{movable:_(e)}},rotate:function(e){return{rotatable:_(e)}},resize:function(e){return{resizable:_(e)}},changeable:function(e){return{changeable:_(e)}},select:function(e){return{selectable:_(e)}},text:function(e){return{text:e}},tag:function(e){return{tags:e}},width:function(e){return{strokeWidth:parseFloat(e)}}};null!==(t=n.exec(e));)if(i=t[1],t=t[2].replace(/^['"{]|['"}]$/g,""),r.hasOwnProperty(i)&&"function"==typeof r[i])for(s in i=r[i](t))i.hasOwnProperty(s)&&("tags"===s&&a.hasOwnProperty(s)?a[s]+=","+i[s]:a[s]=i[s]);else a[i]=t;return(e=e.replace(n,""))&&(a._comment=e.trim()),a}(a.comment.trim().toLowerCase()))._comment&&(a.comment=s._comment,delete s._comment),s&&(a.opts=$.extend({},s,a.opts)),(i=w.exec(e))&&i[1]&&(a.args=i[1].split(C)),a.isregion&&0===a.cmd.indexOf("-")&&(a.cmd=a.cmd.slice(1),a.comment=a.comment?a.comment+",exclude":"exclude"),a},T=function(t,i){var s,a;return a=e.strtoscaled(t),s=e.strtoscaled(i),!a.dtype.match(x)&&!s.dtype.match(x)||c.match(y)||(p=!0,u=c),d||p?(":"===a.dtype&&"galactic"!==u&&"ecliptic"!==u&&(a.dval*=15),"r"===a.dtype&&(a.dval=180*a.dval/Math.PI),"r"===s.dtype&&(s.dval=180*s.dval/Math.PI),s=e.wcs2pix(this.raw.wcs,a.dval,s.dval).split(/ +/),a=parseFloat(s[0]),s=parseFloat(s[1])):"physical"===u?(a=(s=this.logicalToImagePos({x:a.dval,y:s.dval})).x,s=s.y):(a=a.dval,s=s.dval),[a,s]},I=function(t,i){var s=e.strtoscaled(t),a=this.raw.wcsinfo||{cdelt1:1,cdelt2:1};return s.dtype.match(x)&&!c.match(y)&&(p=!0,u=c),d||p?("r"===s.dtype&&(s.dval=180*s.dval/Math.PI),s.dval=Math.abs(s.dval/a["cdelt"+i])):"physical"===u&&this.lcs&&this.lcs.physical&&(s.dval*=this.lcs.physical.forward[0][0]),s.dval},M=function(t){t=e.strtoscaled(t);var i=this.raw.wcsinfo||{crot:0};return i.crot&&(t.dval+=i.crot),t.dval};if(!(t=t.trim()).match(/(\(|\{|#|;|\n)/))return t;for(c=this.getWCSSys(),h=this.getWCSUnits(),d="image"!=(u="physical")&&"physical"!==u,r=t.split(/\n|;/),s=0;s<r.length;s++)if("#"!==r[s].trim().substr(0,1))if(p=!1,g=(l=k(r[s])).args.length,l.isregion){switch((o=$.extend(!0,{},l.opts)).shape=l.cmd,2<=g&&(f=T.call(this,l.args[0],l.args[1]),o.x=f[0],o.y=f[1]),o.textOpts&&void 0!==o.textOpts.ra&&void 0!==o.textOpts.dec&&(o.textOpts._wcssys=u),l.cmd){case"annulus":for(o.radii=[],a=2;a<g;a++)o.radii.push(I.call(this,l.args[a],1));break;case"box":3<=g&&(o.width=I.call(this,l.args[2],1)),4<=g&&(o.height=I.call(this,l.args[3],2)),5<=g&&(o.angle=M.call(this,l.args[4]));break;case"circle":3<=g&&(o.radius=I.call(this,l.args[2],1));break;case"ellipse":3<=g&&(o.r1=I.call(this,l.args[2],1)),4<=g&&(o.r2=I.call(this,l.args[3],2)),5<=g&&(o.angle=M.call(this,l.args[4]));break;case"line":case"polygon":for(o.pts=[],n=a=0;a<g;a+=2,n++)f=T.call(this,l.args[a],l.args[a+1]),o.pts[n]={x:f[0],y:f[1]};delete o.x,delete o.y;break;case"text":3<=g&&(o.text=l.args[2].replace(/^['"]/,"").replace(/["']$/,"")),4<=g&&(o.angle=M.call(this,l.args[3]))}l.comment&&(o.tags=l.comment),m.push(o)}else l.cmd.match(b)?(a=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(l.cmd),e.globalOpts.xeqPlugins=a,u=this.getWCSSys(),d="image"!==u&&"physical"!==u):"remove"!==l.cmd&&"delete"!==l.cmd||m.push({remove:!0});return a=e.globalOpts.xeqPlugins,e.globalOpts.xeqPlugins=!1,this.setWCSSys(c),this.setWCSUnits(h),e.globalOpts.xeqPlugins=a,m},e.Regions.saveRegions=function(t,i,s){var a,n,r,o,l,c;if(t&&(l=t.match(/\.([^.]*)$/))&&2<=l.length&&("reg"===l[1]||"svg"===l[1])&&(r=l[1]),"object"==typeof s)o=s,s=null;else if("string"==typeof s){try{o=JSON.parse(s)}catch(h){o=null}o&&(s=null)}switch(o&&(e.notNull(o.layer)&&(s=o.layer),e.notNull(o.type)&&(r=o.type)),r=r||"reg",this.layers[s=s||"regions"]||e.error("can't find layer for saveRegions: "+s),r){case"svg":try{e.globalOpts.svgBorder&&(c=this.addShapes(s,"box",{left:this.rgb.img.width/2,top:this.rgb.img.height/2,width:this.rgb.img.width,height:this.rgb.img.height,color:"black",strokeWidth:1,tags:"SVGBorder"})),n=this.layers[s].dlayer.canvas.toSVG(),e.globalOpts.svgBorder&&this.removeShapes(s,c)}catch(h){e.error("can't convert layer to SVG: "+s)}break;default:try{a=sprintf("# Region file format: JS9 version 1.0"),n=sprintf("%s\n%s\n",a,this.listRegions(i,{mode:1},s).replace(/; */g,"\n"))}catch(h){e.error("can't convert layer to region: "+s)}}return i=new Blob([n],{type:"text/plain;charset=utf-8"}),t||(t=s&&"regions"!==s?"js9_"+s+"."+r:"js9."+r),window.hasOwnProperty("saveAs")?saveAs(i,t):e.error("no saveAs function available to save region file"),t},e.Regions.editRegionTags=function(e,t,i){var s,a,n,r,o=[];if((n=this.getShapes("regions",e)).length){for(s=0;s<n.length;s++)for(r=n[s].tags,o.push(t),a=0;a<r.length;a++)r[a]!==i&&o.push(r[a]);this.changeShapes("regions",e,{tags:o})}},e.Regions.toggleRegionTags=function(e,t,i){var s,a,n,r,o;if((n=this.getShapes("regions",e)).length){for(s=0;s<n.length;s++)for(r=n[s].tags,o="",a=0;a<r.length;a++){if(r[a]===t){o=r[a]=i;break}if(r[a]===i){o=r[a]=t;break}}o&&this.changeShapes("regions",e,{tags:r})}},e.Regions.unremoveRegions=function(){var e=this.regstack.pop();return e?this.addShapes("regions",e):null},e.Catalogs={},e.Catalogs.CLASS="JS9",e.Catalogs.NAME="Catalogs",e.Catalogs.opts={hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,selectable:!1,canvas:{selection:!1},updateWCS:!1,panzoom:!0,shape:"circle",strokeWidth:2,width:10,height:10,radius:5,eradius:{x:5,y:3},angle:0,tagcolors:{defcolor:"#00FF00"},sortOverlapping:!1},e.Crosshair={},e.Crosshair.CLASS="JS9",e.Crosshair.NAME="Crosshair",e.Crosshair.LAYERNAME="crosshair",e.Crosshair.opts={hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,selectable:!1,canvas:{selection:!1},updateWCS:!1,panzoom:!1,arrowSize:20,strokeWidth:1,color:"#00FF00",sortOverlapping:!1,hiddenPts:{pts:[{x:-9999,y:-9999},{x:-9999,y:-9900}]}},e.Crosshair.display=function(t,i,s){var a,n,r,o,l,c,h,u=e.Crosshair.LAYERNAME;if(s=!!/iPad|iPhone|iPod/.test(navigator.platform)||s.shiftKey,(t.tmp.arrowCrosshair||s&&t&&!t.tmp.shiftKey&&t.crosshair&&t.params.crosshair)&&(t.tmp.arrowCrosshair&&!t.params.crosshair?(s=i.x-(r=e.Crosshair.opts.arrowSize/t.rgb.sect.zoom),c=i.x+r,n=i.y-r,h=i.y+r):(s=0,c=t.raw.width,n=0,h=t.raw.height),t.changeShapes(u,t.crosshair.h,c={pts:[{x:s,y:i.y},{x:c,y:i.y}],redraw:!1}),t.changeShapes(u,t.crosshair.v,s={pts:[{x:i.x,y:n},{x:i.x,y:h}],redraw:!0}),t.crosshair.visible=!0,e.globalOpts.wcsCrosshair&&t&&t.raw.wcs&&0<t.raw.wcs))for(n=e.pix2wcs(t.raw.wcs,i.x,i.y).trim().split(/\s+/),o=e.saostrtod(n[0]),":"===String.fromCharCode(e.saodtype())&&"galactic"!==t.params.wcssys&&"ecliptic"!==t.params.wcssys&&(o*=15),l=e.saostrtod(n[1]),i=0;i<e.displays.length;i++)if((r=e.displays[i].image)&&r!==t&&r.crosshair&&r.params.crosshair&&0<r.raw.wcs){c=r.raw.width,h=r.raw.height;try{a=e.wcs2pix(r.raw.wcs,o,l)}catch(d){a=null}a&&(n=a.trim().split(/\s+/),s=parseFloat(n[0]),n=parseFloat(n[1]),0<s&&s<c&&0<n&&n<h&&(r.changeShapes(u,r.crosshair.h,c={pts:[{x:0,y:n},{x:c,y:n}],redraw:!1}),r.changeShapes(u,r.crosshair.v,s={pts:[{x:s,y:0},{x:s,y:h}],redraw:!0}),r.crosshair.visible=!0))}},e.Crosshair.hide=function(t,i,s){i=e.Crosshair.LAYERNAME,s=e.Crosshair.opts.hiddenPts,(t&&t.crosshair&&t.crosshair.visible||t.tmp.arrowCrosshairVisible)&&(t.changeShapes(i,t.crosshair.h,s),t.changeShapes(i,t.crosshair.v,s),t.crosshair.visible=!1,delete t.tmp.arrowCrosshairVisible)},e.Crosshair.create=function(t){var i=e.Crosshair.opts.hiddenPts,s=e.Crosshair.LAYERNAME;t&&!t.crosshair&&(t.crosshair={},t.crosshair.h=t.addShapes(s,"line",i),t.crosshair.v=t.addShapes(s,"line",i),t.crosshair.visible=!1)},e.Crosshair.keyaction=function(e,t,i){e&&i&&i.shiftKey&&(e.tmp.shiftKey=!0)},e.Crosshair.keyup=function(e,t,i){e&&e.tmp.shiftKey&&i&&!i.shiftKey&&delete e.tmp.shiftKey},e.Crosshair.init=function(){var t,i=e.Crosshair.LAYERNAME;for(t=0;t<e.displays.length;t++)e.displays[t].layers.crosshair||e.displays[t].newShapeLayer(i,e.Crosshair.opts);return this},e.Image.prototype.toggleCrosshair=function(){this.params.crosshair=!this.params.crosshair,this.params.crosshair||e.Crosshair.hide(this)},e.Image.prototype.toggleWCSCrosshair=function(){e.globalOpts.wcsCrosshair=!e.globalOpts.wcsCrosshair},e.Grid={},e.Grid.CLASS="JS9",e.Grid.NAME="Grid",e.Grid.LAYERNAME="grid",e.Grid.opts={movable:!1,cover:"display",reduceDims:!0,strokeWidth:1,margin:0,labelMargin:10,stride:32,raLines:8,raSkip:0,raAngle:0,decLines:8,decSkip:0,decAngle:90,sexaPrec:1,degPrec:3,lineColor:"#00FFFF",labelColor:"#00FFFF",labelFontFamily:"Helvetica, sans-serif",labelFontSize:11,labelFontStyle:"normal",labelFontWeight:300,labelRAOffx:3,labelRAOffy:-1,labelDecOffx:-14,labelDecOffy:6},e.Grid.limits=function(e,t,i,s){return e=1<(e=i-t)?10:.1<e?100:.01<e?1e3:.001<e?1e4:1e-4<e?1e5:1e6,{lo:t=Math.floor(t*e)/e,hi:i=Math.ceil(i*e)/e,inc:Math.ceil((i-t)/s*e)/e}},e.Grid.getLabel=function(t,i,s){var a,n,r=!1;switch(t.wcsunits){case"sexagesimal":if("ra"===s&&"galactic"!==t.wcssys&&"ecliptic"!==t.wcssys&&(i/=15),n=(i=e.saodtostr(i,":",t.sexaPrec)).split(":"),t.last[s])for(i="",a=0;a<n.length;a++)i&&(i+=":"),(r||n[a]!==t.last[s][a])&&(i+=n[a],r=!0);t.last[s]=$.extend({},n);break;default:i=i.toFixed(t.degPrec)}return 0>(t=(i=i.replace(/0+$/,"")).indexOf("."))?i+=".0":t===i.length-1&&(i+="0"),i.replace(/:\.0/,":0.0")},e.Grid.display=function(t,i){var s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y,x,w,S,C,A;p=this.display;var _=this.raw;if(m=[{ra:0,dec:0},{ra:0,dec:0},{ra:0,dec:0},{ra:0,dec:0}],e.isNull(t))switch(this.tmp.gridStatus){case"inactive":case void 0:return!1;case"active":case"processing":default:return!0}if(this.removeShapes(e.Grid.LAYERNAME),!1===t||!this.raw.wcs||0>=this.raw.wcs)this.tmp.gridStatus="inactive";else{if("string"==typeof(i=i||{}))try{i=JSON.parse(i)}catch(k){e.error("can't parse displayCoordGrid JSON",k)}for(this.tmp.gridStatus="processing",(x=$.extend(!0,{},e.Grid.opts,i)).wcsunits=this.getWCSUnits(),x.wcssys=this.getWCSSys(),x.last={},e.wcsunits(this.raw.wcs,"degrees"),"image"===x.cover?(r=[Math.max(1,Math.floor(_.width/p.width)),Math.max(1,Math.floor(_.height/p.height))],d=[{x:0,y:0},{x:_.width-1,y:_.height-1}]):(r=x.reduceDims?_.width<_.height?[_.width/_.height,1]:_.height<_.width?[1,_.height/_.width]:[1,1]:[1,1],d=[],f=this.displayToImagePos(a={x:this.ix+x.margin,y:this.iy-x.margin}),d[0]={x:f.x,y:f.y},f=this.displayToImagePos(a={x:p.width-this.ix-x.margin,y:p.height-this.iy-x.margin}),d[1]={x:f.x,y:f.y}),s=e.pix2wcs(_.wcs,d[0].x,d[0].y).trim().split(/\s+/),m[0].ra=e.saostrtod(s[0]),m[0].dec=e.saostrtod(s[1]),s=e.pix2wcs(_.wcs,d[0].x,d[1].y).trim().split(/\s+/),m[1].ra=e.saostrtod(s[0]),m[1].dec=e.saostrtod(s[1]),s=e.pix2wcs(_.wcs,d[1].x,d[0].y).trim().split(/\s+/),m[2].ra=e.saostrtod(s[0]),m[2].dec=e.saostrtod(s[1]),s=e.pix2wcs(_.wcs,d[1].x,d[1].y).trim().split(/\s+/),m[3].ra=e.saostrtod(s[0]),m[3].dec=e.saostrtod(s[1]),d=m[0].ra,f=m[0].dec,p=m[0].ra,g=m[0].dec,s=1;4>s;s++)d=Math.min(d,m[s].ra),f=Math.min(f,m[s].dec),p=Math.max(p,m[s].ra),g=Math.max(g,m[s].dec);for(d=(s=e.Grid.limits.call(this,x,d,p,x.raLines*r[0])).lo,p=s.hi,m=s.inc,f=(s=e.Grid.limits.call(this,x,f,g,x.decLines*r[1])).lo,g=s.hi,v=s.inc,e.wcsunits(this.raw.wcs,x.wcsunits),w=p-(y=(b=Math.abs(this.raw.wcsinfo.cdelt1))*e.Grid.opts.stride),A=g-(C=(S=Math.abs(this.raw.wcsinfo.cdelt2))*e.Grid.opts.stride),s="image;",h=d;h<=p;h+=m){for(n="line(",c=S,a=l=0,u=f;u<=g;u+=c)(o=e.wcs2pix(_.wcs,h,u).trim().split(/ +/))&&o.length&&(r=parseFloat(o[0]),o=parseFloat(o[1]),r>=-x.margin&&r<=_.width+x.margin&&o>=-x.margin&&o<=_.height+x.margin?(n+=String(r+1+","+o+"1, "),a++,0===l?(l=1,u<A&&(c=C)):1===l&&u>A&&(l=2,c=S)):1===l&&(l=2,u-=c,c=S));1<a&&(s+=n.replace(/,\s+$/,") "),s+=sprintf(' {"color": "%s"};',x.lineColor))}for(u=f;u<=g;u+=v){for(n="line(",c=b,a=l=0,h=d;h<=p;h+=c)(o=e.wcs2pix(_.wcs,h,u).trim().split(/ +/))&&o.length&&(r=parseFloat(o[0]),o=parseFloat(o[1]),r>=-x.margin&&r<=_.width+x.margin&&o>=-x.margin&&o<=_.height+x.margin?(n+=String(r+1+","+o+"1, "),a++,0===l?(l=1,h<w&&(c=y)):1===l&&h>w&&(l=2,c=b)):1===l&&(l=2,h-=c,c=b));1<a&&(s+=n.replace(/,\s+$/,") "),s+=sprintf(' {"color": "%s"};',x.lineColor))}for(l=x.labelDecOffx/this.rgb.sect.zoom,c=x.labelDecOffy/this.rgb.sect.zoom,b=0,h=y=d,n=0;h<=p;h+=m){for(u=f;u<=g;u+=v)(o=e.wcs2pix(_.wcs,h,u).trim().split(/ +/))&&o.length&&(r=parseFloat(o[0]),o=parseFloat(o[1]),(a=this.imageToDisplayPos({x:r,y:o})).x>this.ix+x.labelMargin&&a.x<this.rgb.img.width+this.ix-x.labelMargin&&a.y>this.iy+x.labelMargin&&a.y<this.rgb.img.height+this.iy-x.labelMargin&&(b>=x.decSkip?(s+=sprintf('text(%s,%s,%s,%s) {"color":"%s", "fontFamily":"%s", "fontSize":%s, "fontStyle":"%s", "fontWeight":"%s", "originX":"left", "originY":"top"};',r+l,o+c,e.Grid.getLabel.call(this,x,u,"dec"),x.decAngle,x.labelColor,x.labelFontFamily,x.labelFontSize,x.labelFontStyle,x.labelFontWeight),n++):(h!==y&&b++,y=h)));if(n)break}for(l=x.labelRAOffx/this.rgb.sect.zoom,c=x.labelRAOffy/this.rgb.sect.zoom,b=0,u=y=f,n=0;u<=g;u+=v){for(h=d;h<=p;h+=m)(o=e.wcs2pix(_.wcs,h,u).trim().split(/ +/))&&o.length&&(r=parseFloat(o[0]),o=parseFloat(o[1]),(a=this.imageToDisplayPos({x:r,y:o})).x>this.ix+x.labelMargin&&a.x<this.rgb.img.width+this.ix-x.labelMargin&&a.y>this.iy+x.labelMargin&&a.y<this.rgb.img.height+this.iy-x.labelMargin&&(b>=x.raSkip?(s+=sprintf('text(%s,%s,%s,%s) {"color":"%s", "fontFamily":"%s", "fontSize":%s, "fontStyle":"%s", "fontWeight":"%s", "originX":"left", "originY":"top"};',r+l,o+c,e.Grid.getLabel.call(this,x,h,"ra"),x.raAngle,x.labelColor,x.labelFontFamily,x.labelFontSize,x.labelFontStyle,x.labelFontWeight),n++):(u!==y&&b++,y=u)));if(n)break}this.addShapes(e.Grid.LAYERNAME,s,x),this.tmp.gridStatus="active"}},e.Grid.toggle=function(e){if(e)switch(e.tmp.gridStatus){case void 0:case null:case"inactive":e.displayCoordGrid(!0);break;case"active":e.displayCoordGrid(!1)}},e.Grid.regrid=function(e){e&&"active"===e.tmp.gridStatus&&"complete"===e.status.load&&e.displayCoordGrid(!0)},e.Grid.init=function(t){t=$.extend(!0,{},e.Catalogs.opts,e.Grid.opts,t),this.display.newShapeLayer(e.Grid.LAYERNAME,t).canvas.on("mouse:up",function(){return!1})},e.Image.prototype.displayCoordGrid=e.Grid.display,e.Dysel={},e.Dysel.CLASS="JS9",e.Dysel.NAME="Dysel",e.Dysel.display=null,e.Dysel.plugins=[],e.Dysel.init=function(e){},e.Dysel.unhighlightSelection=function(){e.bugs.webkit_resize?$(".JS9").find(".JS9Image").removeClass("JS9Highlight"):$(".JS9").removeClass("JS9Highlight")},e.Dysel.highlightSelection=function(t){t&&e.Dysel.retrievePlugins().length&&1!==e.displays.length&&(e.Dysel.unhighlightSelection(),t=t.display,e.bugs.webkit_resize?$(t.divjq).find(".JS9Image").addClass("JS9Highlight"):$(t.divjq).addClass("JS9Highlight"))},e.Dysel.addPlugins=function(t){e.Dysel.plugins.push(t)},e.Dysel.retrievePlugins=function(){return e.Dysel.plugins},e.Dysel.getDisplay=function(t){return e.Dysel.retrievePlugins().length?"previous"===t?e.Dysel.odisplay:e.Dysel.display:null},e.Dysel.getDisplayOr=function(t){return"previous"===t?e.Dysel.getDisplay(t):e.Dysel.getDisplay()||t},e.Dysel.select=function(t){t&&e.Dysel.retrievePlugins().length&&(e.Dysel.odisplay=e.Dysel.display,e.Dysel.display=t,t.image&&(e.Dysel.highlightSelection(t.image),t.image.xeqPlugins("image","ondynamicselect",null)))},e.Dysel.imageload=function(t){t&&e.Dysel.select(t.display)},e.Dysel.imageclose=function(t){var i,s;if(t&&(s=e.Dysel.getDisplay())&&s.image===t){for(s=i=0;i<e.images.length;i++)t.display===e.images[i].display&&s++;if(1>=s)for(i=0;i<e.displays.length;i++)if(t.display!==(s=e.displays[i])&&s.image){e.Dysel.select(e.displays[i]);break}}},e.getDynamicDisplayOr=e.Dysel.getDisplayOr,Math.log10=Math.log10||function(e){return Math.log(e)/Math.LN10},"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),Math.asinh=Math.asinh||function(e){return-1/0===e?e:Math.log(e+Math.sqrt(e*e+1))},Math.sinh=Math.sinh||function(e){return(Math.exp(e)-Math.exp(-e))/2},e.jupyterFocus=function(e,t){window.hasOwnProperty("Jupyter")&&(e instanceof jQuery?e:$(e)).find(t||"input, textarea").each(function(){Jupyter.keyboard_manager.register_events($(this))})},e.getImageID=function(t,i,s){var a,n,r=0,o=1,l=e.images.length,c=/.*<([0-9][0-9]*)>$/,h=/<[0-9][0-9]*>/;for(t=t.replace(h,""),a=0;a<l;a++)(n=e.images[a]).display.id===i&&n!==s&&t===n.id0.replace(h,"")&&(n.id&&0<=n.id.search(c)&&(n=n.id.replace(c,"$1"),o=Math.max(o,parseInt(n,10))),r++);return r?t+"<"+String(o+1)+">":t},e.uniqueID=function(){var e=1;return function(){return e++}}(),e.waiting=function(t,i){var s,a;switch(t){case!0:window.hasOwnProperty("Spinner")&&"spinner"===e.globalOpts.waitType?(i&&("object"==typeof i?s=i.divjq[0]:"string"==typeof i&&(a=e.lookupDisplay(i))&&(s=a.divjq[0])),s||(s=$("body").get(0)),e.spinner||(e.spinner={},a={color:e.globalOpts.spinColor,opacity:e.globalOpts.spinOpacity},e.spinner.spinner=new Spinner(a)),e.spinner.spinner.spin(s)):$("body").addClass("waiting");break;case!1:window.hasOwnProperty("Spinner")&&"spinner"===e.globalOpts.waitType?e.spinner&&e.spinner.spinner.stop():$("body").removeClass("waiting")}},e.progress=function(t,i){if("boolean"==typeof t||"string"==typeof t)switch(t){case!0:case"indeterminate":i&&(e.progress.display=i,e.progress.display.displayMessage("progress",t));break;case!1:case"":e.progress.display&&(e.progress.display.clearMessage("progress"),delete e.progress.display)}else"number"==typeof t&&e.progress.display&&e.progress.display.displayMessage("progress",[t,i])},e.msgHandler=function(t,i){var s,a,n,r=[],o=t.cmd,l=t.id,c=e.globalOpts.alerts,h=e.globalOpts.quietReturn?"":"OK";if(i&&(e.globalOpts.alerts=!1),e.publics[o]){if($.isArray(t.args)||(t.args=[t.args]),r=$.extend(!0,[],t.args),l)if(0<r.length){if("string"==typeof(s=r[r.length-1]))try{a=JSON.parse(s)}catch(u){a=null}else"object"==typeof s&&(a=s);a&&"object"==typeof a&&a.hasOwnProperty("display")&&1===Object.keys(a).length?"string"==typeof s&&(r.pop(),r.push(a)):r.push({display:l})}else r.push({display:l});"RunAnalysis"===o&&i&&(1===r.length&&r.push(null),r.push(i),i=null);try{n=e.publics[o].apply(null,r)}catch(u){n=sprintf("ERROR: %s",u.message)}return i&&(e.globalOpts.alerts=c,(n instanceof e.Display||n instanceof e.Image)&&(n=n.id),i(n)),n}if(o&&"#"!==o){if(a=e.lookupCommand(o),s=e.lookupDisplay(l),a&&s)switch(a.getDisplayInfo(s),t.args?r=$.extend(!0,[],t.args):t.paramlist&&(r=t.paramlist.split(/ +/)),a.getWhich(r)){case"get":try{n=a.get(r)||""}catch(u){n="ERROR: "+u.message}break;case"set":try{n=a.set(r)||h}catch(u){n="ERROR: "+u.message}break;default:n=sprintf("ERROR: unknown cmd type for '%s'",o)}else a||(n=sprintf("ERROR: unknown cmd '%s'",o)),s||(n=sprintf("ERROR: unknown display (%s)",l));return i&&(e.globalOpts.alerts=c,(n instanceof e.Display||n instanceof e.Image)&&(n=n.id),i(n)),n}i&&i(""),i&&(e.globalOpts.alerts=c)},e.lightWin=function(t,i,s,a,n){var r;switch(e.LIGHTWIN){case"dhtml":r=dhtmlwindow.open(t,i,s,a,n),/iPad|iPhone|iPod/.test(navigator.platform)&&$("#"+t+" "+e.lightOpts.dhtml.drag).css("-webkit-overflow-scrolling","touch").css("overflow-y","scroll"),$("#"+t+" ."+e.lightOpts.dhtml.dragBar).doubletap(function(){r.close()},null,400),$("#"+t+" ."+e.lightOpts.dhtml.dragBar).on("touchend",this,function(){dhtmlwindow.distancex||dhtmlwindow.distancey?0<e.lightOpts.nclick&&(e.lightOpts.nclick=0):2<=e.lightOpts.nclick?(alert("trouble closing this window? double-tap the window handle"),e.lightOpts.nclick=-1):0<=e.lightOpts.nclick&&e.lightOpts.nclick++})}return r},e.checkNew=function(t){t||e.error("internal failure in a JS9 constructor")},e.specialKey=function(e){return e.metaKey||e.ctrlKey},e.strace=function(t){var i="";return 1<e.DEBUG&&(i=t.stack||t.stacktrace||""),i},e.floatToString=function(t){return sprintf("%g",parseFloat(t.toFixed(e.globalOpts.floatPrecision)))},e.floatPrecision=function(e,t){var i,s;return(i=Math.floor(Math.log10(Math.abs(e))))!==(s=Math.floor(Math.log10(Math.abs(t))))?i>s?i:s:1},e.floatFormattedString=function(e,t,i){var s="";return void 0===e?s:s=-2>t?sprintf(t="%."+String(2+i)+"e",e):0>t?e.toFixed(Math.abs(t)+3+i):2>t?sprintf(t="%."+String(t+i)+"f",e):5>t?e.toFixed(0+i):sprintf(t="%."+String(2+i)+"e",e)},e.centerPolygon=function(e){var t,i,s,a,n,r;if(e&&e.length){for(i=e.length,t=0;t<i;t++)(void 0===s||e[t].x<s)&&(s=e[t].x),(void 0===a||e[t].x>a)&&(a=e[t].x),(void 0===n||e[t].y<n)&&(n=e[t].y),(void 0===r||e[t].y>r)&&(r=e[t].y);return{x:(s+a)/2,y:(n+r)/2}}},e.centroidPolygon=function(e){var t,i,s=0,a=0;if(e&&e.length){for(i=e.length,t=0;t<i;t++)s+=e[t].x,a+=e[t].y;return{x:s/i,y:a/i}}},e.lookupImage=function(t,i){var s,a,n,r=e.images.length;if(!t)return null;for(s=0;s<r;s++)if((t===(a=e.images[s])||t===a.id||t===a.id0||t===a.id0.replace(/\[.*\]$/,"")||t===a.file||t===a.file.replace(/\[.*\]$/,"")||t===a.file0||t===e.TOROOT+a.file||a.fitsFile&&t===a.fitsFile)&&0<$("#"+a.display.id).length&&(n=a.display.id,!i||"string"==typeof i&&i===n||"object"==typeof i&&i.id===n))return a;return null},e.lookupDisplay=function(t,i){var s,a=new RegExp(sprintf("[-_]?(%s)$",e.PLUGINS));if(void 0===i&&(i=!0),t&&0>t.toString().search(e.SUPERMENU)){for(s=0;s<e.displays.length;s++)if(t===e.displays[s]||t===e.displays[s].id||t===e.displays[s].oid)return e.displays[s];if("string"==typeof t)for(t=t.replace(a,""),s=0;s<e.displays.length;s++)if(t===e.displays[s]||t===e.displays[s].id||t===e.displays[s].oid)return e.displays[s];if(!i)return null;e.error("can't find JS9 display with id: "+t)}return e.displays[0]},e.getImage=function(t){var i;return!(i=e.lookupImage(t))&&(t=e.lookupDisplay(t))&&(i=t.image),i},e.lookupVfile=function(t){var i,s,a,n,r=[];if(!t)return r;for(i=0;i<e.images.length;i++)for(a=e.images[i],s=0;s<a.raws.length;s++)(n=a.raws[s]).hdu&&n.hdu.fits&&t===n.hdu.fits.vfile&&r.push({im:a,raw:n,idx:s});return r},e.loadScript=function(e,t,i){var s=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",t&&(a.onload=t),i&&(a.onerror=i),a.src=e,s.appendChild(a)},e.fetchURL=function(t,i,s,a){var n,r=new XMLHttpRequest;s=s||{},t||i||e.error("invalid url specification for fetchURL"),i||(t=/([^\\\/]+)$/.exec(i=t)[1]),t||(t=/([^\\\/]+)$/.exec(i)[1]),n=(n=s.allowCache||i.match(/\?/)?i:i+"?r="+Math.random()).replace(/^\${JS9_DIR}\//,e.INSTALLDIR),r.open("GET",n,!0),r.responseType=s.responseType?s.responseType:"blob",e.globalOpts.xtimeout&&(r.timeout=e.globalOpts.xtimeout),r.onload=function(){var n;4===this.readyState&&(200===this.status||0===this.status?"blob"===r.responseType?((n=new Blob([this.response])).name=t.match("://")?t.split("/").reverse()[0].replace(/\?.*$/,""):t,"uc"===n.name&&(n.name="google_"+e.uniqueID()+".fits"),a?a(n,s):e.Load(n,s)):s.display?a(this.response,s,{display:s.display}):a(this.response,s):e.error(404===this.status?"could not find "+i:sprintf("can't load: %s %s (%s)  ",i,r.statusText,r.status)))},r.onerror=function(){e.error(sprintf("cannot load: %s %s .. please check the url/pathname",i,r.statusText))},r.ontimeout=function(){e.error("timeout awaiting response from server: "+i)};try{r.send()}catch(o){e.error("request to load "+i+" failed",o)}},e.fitsLibrary=function(t){var i;if(!t)return e.fits.name;switch(i=t.toLowerCase()){case"fitsy":e.fits=Fitsy,e.fits.datahandler(e.NewFitsImage),e.fits.options=e.userOpts.fits||e.fits.options||{};break;case"astroem":case"cfitsio":e.fits=Astroem,e.fits.options=e.fits.options||{},e.fits.options.handler=e.NewFitsImage,e.fits.options.error=e.error,e.userOpts.fits?(e.fits.options.extlist=e.userOpts.fits.extlist,e.fits.options.table={xdim:e.userOpts.fits.xdim,ydim:e.userOpts.fits.ydim,bin:e.userOpts.fits.bin||1},e.fits.options.image={xdim:e.userOpts.fits.ixdim||e.userOpts.fits.xmax,ydim:e.userOpts.fits.iydim||e.userOpts.fits.ymax,bin:e.userOpts.fits.ibin||1}):(e.fits.options.extlist=e.globalOpts.extlist,e.fits.options.table={bin:e.globalOpts.table.bin||1},e.notNull(e.globalOpts.table.xdim)?e.fits.options.table.xdim=e.globalOpts.table.xdim:e.notNull(e.globalOpts.dims)&&(e.fits.options.table.xdim=e.globalOpts.dims[0]),e.notNull(e.globalOpts.table.ydim)?e.fits.options.table.ydim=e.globalOpts.table.ydim:e.notNull(e.globalOpts.dims)&&(e.fits.options.table.ydim=e.globalOpts.dims[1]),e.fits.options.image={bin:e.globalOpts.image.bin||1},e.notNull(e.globalOpts.image.xdim)?e.fits.options.image.xdim=e.globalOpts.image.xdim:e.notNull(e.globalOpts.xmax)&&(e.fits.options.image.xdim=e.globalOpts.xmax),e.notNull(e.globalOpts.image.ydim)?e.fits.options.image.ydim=e.globalOpts.image.ydim:e.notNull(e.globalOpts.ymax)&&(e.fits.options.image.ydim=e.globalOpts.ymax)),e.fits.maxFITSMemory&&e.globalOpts.maxMemory&&e.fits.maxFITSMemory(e.globalOpts.maxMemory);break;default:e.error("unknown fits library: "+t)}return e.fits.ready=!0,e.fits.name=i,e.fits.options.error=e.error,e.fits.options.waiting=e.waiting,i},e.handleFITSFile=function(t,i,s){e.fits.handleFITSFile?e.fits.handleFITSFile(t,i,s):e.error("no FITS module available to process FITS file")},e.cleanupFITSFile=function(t,i){return!!(e.fits.cleanupFITSFile&&t&&t.hdu&&t.hdu.fits)&&(e.fits.cleanupFITSFile(t.hdu.fits,i),!0)},e.handleImageFile=function(t,i,s){var a=new FileReader;i=$.extend(!0,{},e.fits.options,i),s=s||e.Load,a.onload=function(e){var a,n,r,o=new Image;o.onload=function(){var e,l,c=0;l=(e=document.createElement("canvas")).getContext("2d");var h=o.height,u=o.width;for(e.width=u,e.height=h,l.drawImage(o,0,0),a=l.getImageData(0,0,u,h).data,n=new Float32Array(h*u),l=0;l<h;l++)for(e=0;e<u;e++)n[(h-l)*u+e]=.299*a[c]+.587*a[c+1]+.114*a[c+2],c+=4;for((r={head:{SIMPLE:!0,BITPIX:-32,NAXIS:2,NAXIS1:u,NAXIS2:h},filename:t.name,filedata:n,naxis:2,axis:[0,u,h],bitpix:-32,bin:1,data:n}).dmin=Number.MAX_VALUE,r.dmax=Number.MIN_VALUE,c=0;c<h*u;c++)isNaN(r.data[c])||(r.dmin=Math.min(r.dmin,r.data[c]),r.dmax=Math.max(r.dmax,r.data[c]));s(r,i)},o.src=e.target.result},a.readAsDataURL(t)},e.getFITSImage=function(t,i,s,a){e.fits.getFITSImage?e.fits.getFITSImage(t,i,s,a):e.error("no FITS module available to process FITS image")},e.fits2RepFile=function(t,i,s,a,n){var r,o,l,c,h,u={},d="fits2"+a;if(!0===(r=s[d]||void 0===s[d]&&e.globalOpts[d])?r="always":!1===r&&(r="never"),r.match(/never/i))return!1;if(!e.helper.connected||"nodejs"!==e.helper.type&&"socket.io"!==e.helper.type)return"always"===r&&e.globalOpts.requireFits2Fits&&e.error("can't run fits2fits without connected JS9 helper"),!1;if(!e.helper.js9helper){if(!e.globalOpts.requireFits2Fits)return!1;e.error("js9helper not found for fits2fits processing")}switch(d){case"fits2png":break;case"fits2fits":if(!e.globalOpts.workDir)return e.globalOpts.requireFits2Fits&&e.error("can't run fits2fits without a workdir"),!1;for(a=s.xdim||e.fits.options.image.xdim||e.fits.options.table.xdim,o=s.ydim||e.fits.options.image.ydim||e.fits.options.table.ydim,c="a"===(c=s.binMode||e.globalOpts.binMode)?"a":"","string"==typeof(l=s.bin||e.fits.options.image.bin||e.fits.options.table.bin)&&(l.match(/[as]$/)&&(c=l.slice(-1)),l=parseInt(l,10)),l=Math.max(1,l||1),u.sect=void 0!==s.xcen&&void 0!==s.ycen?sprintf("%s@%s,%s@%s,%s%s",a,s.xcen,o,s.ycen,l,c):sprintf("%s,%s,%s%s",a,o,l,c),a=r.toLowerCase().split(/[>,]/),r=0;r<a.length;r++)switch(a[r]){case"size":a[r+1]&&(e.isNumber(a[r+1])&&(u.maxsize=1e6*parseFloat(a[r+1])),r++)}break;default:e.error("unknown FITS representation type: "+a)}return u.fits=e.cleanPath(i),u.parent=!0,e.waiting(!0,t),e.helper.send(d,u,function(i){var a,r;if((i="object"==typeof i?i:0<=i.search(e.analOpts.epattern)?{stderr:i}:{stdout:i}).stderr&&e.error(i.stderr,e.analOpts.epattern),i.stdout)switch(d){case"fits2png":"png"===(a=(i=i.stdout.replace(/\n*$/,"").split("\n").pop()).split(".").pop().toLowerCase())?(s.source="fits2png",e.checkNew(new e.Image(i,s,n))):e.error("fits2png conversion failed: "+i);break;case"fits2fits":if(i.stdout.match(/^ERROR:/)&&(e.globalOpts.requireFits2Fits?e.error(i.stdout):i.stdout=u.fits),r=i.stdout.split(/\n/),(i=e.cleanPath(r[0]))===u.fits)a=$.extend(!0,{},s);else{if("/"!==i.charAt(0)&&(i=e.InstallDir(i)),delete(a=$.extend(!0,{},s)).xcen,delete a.ycen,delete a.bin,void 0!==a.xdim&&(a.xdim=0),void 0!==a.ydim&&(a.ydim=0),a.source="fits2fits",a.proxyFile=i,r[1]){try{h=JSON.parse(r[1])}catch(o){}h&&(a.extname=h.extname,a.extnum=h.extnum,a.hdus=h.hdus,a.parent=h)}r[2]&&(r=e.cleanPath(r[2]),a.parentFile=r,a.extname?(a.parentFile=a.parentFile.replace(/\[.*\]/,""),a.parentFile+=sprintf("[%s]",a.extname)):a.extnum&&0<a.extnum&&(a.parentFile=a.parentFile.replace(/\[.*\]/,""),a.parentFile.file+=sprintf("[%s]",a.extnum))),n&&(a.onload=n)}a.fits2fits=!1,e.Load(i,a,{display:t})}}),!0},e.lookupColormap=function(t,i){var s;if(void 0===i&&(i=!0),t||(t=e.imageOpts.colormap),t)for(s=0;s<e.colormaps.length;s++)if(e.colormaps[s].name===t)return e.colormaps[s];if(!i)return null;e.error("unknown colormap '"+t+"'")},e.lookupCommand=function(t){var i,s;if(t)for(s=t.toLowerCase(),i=0;i<e.commands.length;i++)if((t=e.commands[i]).name===s||t.alias===s||t.alias2===s)return t;return null},e.error=function(t,i,s){var a,n,r="",o="",l=!0;if(e.waiting(!1),"string"==typeof i?(n=t.match(i))?n[1]?t=n[1]:n[0]&&(t=n[0]):l=!1:"object"==typeof i&&(a=i),3>arguments.length&&(s=!0),l&&(a&&a.message?t+=sprintf(" (%s)",a.message):t&&(a=Error(t)),(n=e.strace(a))&&(o="\n\nStacktrace:\n"+n),e.globalOpts.alerts&&(t&&"string"==typeof t&&0>t.search(/ERROR/)&&(r="JS9 ERROR: "),alert(r+(t+o))),s))throw a},e.eventToCharStr=function(t){var i,s,a={37:"leftArrow",38:"upArrow",39:"rightArrow",40:"downArrow",8:"delete",46:"delete"},n={188:"44",109:"45",190:"46",191:"47",192:"96",220:"92",222:"39",221:"93",219:"91",173:"45",187:"61",186:"59",189:"45"},r={96:"~",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",48:")",45:"_",61:"+",91:"{",93:"}",92:"|",59:":",39:'"',44:"<",46:">",47:"?"};return i="number"==typeof t?t:t.which||t.keyCode,s=String(i),n.hasOwnProperty(s)&&(i=n[s]),i=!t.shiftKey&&65<=i&&90>=i?String.fromCharCode(i+32):!t.shiftKey&&a.hasOwnProperty(i)?a[i]:t.shiftKey&&r.hasOwnProperty(i)?r[i]:String.fromCharCode(i),e.specialKey(t)&&(i="M-"+i),i},e.eventToDisplayPos=function(e,t){var i,s,a,n,r;if(e||(e=window.event),e.target?s=e.target:e.srcElement&&(s=e.srcElement),3===s.nodeType&&(s=s.parentNode),t=t||$(s).offset(),e.originalEvent?e.originalEvent.touches&&e.originalEvent.touches.length?(i=(r=e.originalEvent.touches)[0].pageX,a=r[0].pageY):e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length?(i=(r=e.originalEvent.changedTouches)[0].pageX,a=r[0].pageY):(i=e.pageX,a=e.pageY):(i=e.pageX,a=e.pageY),s=t.left+1,n=t.top+1,a={x:Math.floor(i-s),y:Math.floor(a-n)},r&&r.length)for(a.touches=[{x:a.x,y:a.y}],i=1;i<r.length;i++)a.touches[i]={x:Math.floor(r[i].pageX-s),y:Math.floor(r[i].pageY-n)};return a},e.pix2pix=function(t,i,s){var a,n,r;return t&&i&&t.raw.wcs&&i.raw.wcs?(a=e.pix2wcs(t.raw.wcs,r=s.x,s=s.y).trim().split(/\s+/),n=e.saostrtod(a[0]),":"===String.fromCharCode(e.saodtype())&&"galactic"!==t.params.wcssys&&"ecliptic"!==t.params.wcssys&&(n*=15),t=e.saostrtod(a[1]),a=e.wcs2pix(i.raw.wcs,n,t).trim().split(/\s+/),i=parseFloat(a[0]),t=parseFloat(a[1]),.5>Math.abs(i-r)&&(i=r),.5>Math.abs(t-s)&&(t=s),{x:i,y:t}):s},e.rotatePoint=function(e,t,i){var s;return i=i||{x:0,y:0},t=Math.PI*t/180,s=Math.cos(t),t=Math.sin(t),{x:s*(e.x-i.x)-t*(e.y-i.y)+i.x,y:t*(e.x-i.x)+s*(e.y-i.y)+i.y}},e.invertMatrix3=function(e){var t,i,s=0,a=0,n=[[0,0,0],[0,0,0],[0,0,0]],r=e[0][0]*e[1][1];for(t=0;3>t;t++)for(i=0;2>i;i++)if(void 0===e[t][i]||isNaN(e[t][i]))return null;return 0<=r?s+=r:a+=r,0<=(r=-e[0][1]*e[1][0])?s+=r:a+=r,0===(t=s+a)||1e-15>Math.abs(t/(s-a))?null:(n[0][0]=e[1][1]*(t=1/t),n[1][0]=-e[1][0]*t,n[0][1]=-e[0][1]*t,n[1][1]=e[0][0]*t,n[2][0]=-(e[2][0]*n[0][0]+e[2][1]*n[1][0]),n[2][1]=-(e[2][0]*n[0][1]+e[2][1]*n[1][1]),n)},e.log=function(){if(void 0!==window.console&&void 0!==window.console.log)try{console.log.apply(console,arguments)}catch(e){Function.prototype.bind.call(console.log,console).apply(console,arguments)}},e.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},e.notNull=function(e){return null!=e},e.isNull=function(e){return null==e},e.cardpars=function(t){var i;return"HISTORY"===(i=t.slice(0,8).trim())||"COMMENT"===i?[i,t.slice(9).trim()]:"="===t[8]?("T"===(t=t.slice(10).replace(/\'/g," ").replace(/ \/.*/,"").trim())?t=!0:"F"===t?t=!1:e.isNumber(t)&&(t=parseFloat(t)),[i,t]):void 0},e.raw2FITS=function(t,i){var s,a,n,r,o,l=!1,c="",h={};if(n=function(e,t,i,s){var a,n=e;return"XTENSION"!==t||i?(a=new RegExp(t+" *= *(-?[-+]?[0-9]*.?[0-9]*([eE][-+]?[0-9]+)?) *"),e?(e=e.replace(a,"$1"),e=parseFloat(e)):e=void 0,e!==i&&(n=sprintf("%-8s= %20s / %-47s",t,i,s||""))):n=sprintf("%s  = %20s / %-47s","SIMPLE","T","file does conform to FITS standard"),h[t]=!0,n},!t)return c;if("boolean"==typeof(i=i||{})&&(i={addcr:i}),t.card||t.cardstr){for(o=t.header||{},a=t.card?t.card.length:t.ncard,s=0;s<a;s++)if(r=t.card?t.card[s].slice(0,80):t.cardstr.slice(80*s,80*(s+1)),!i.notab||!r.match(/^TAB(TYP|MIN|MAX|DIM)[1,2]/)){if(r.match(/^XTENSION/)&&0===s&&i.simple)c+=n(r,"XTENSION");else if(r.match(/^BITPIX /)&&t.bitpix)c+=n(r,"BITPIX",t.bitpix,"bits/pixel");else if(r.match(/^NAXIS1 /)&&t.width)c+=n(r,"NAXIS1",t.width,"x image dim");else if(r.match(/^NAXIS2 /)&&t.height)c+=n(r,"NAXIS2",t.height,"y image dim");else if(r.match(/^CRPIX1 /)&&e.notNull(o.CRPIX1))c+=n(r,"CRPIX1",o.CRPIX1,"ref point");else if(r.match(/^CRPIX2 /)&&e.notNull(o.CRPIX2))c+=n(r,"CRPIX2",o.CRPIX2,"ref point");else if(r.match(/^CDELT1 /)&&e.notNull(o.CDELT1))c+=n(r,"CDELT1",o.CDELT1,"deg/pixel");else if(r.match(/^CDELT2 /)&&e.notNull(o.CDELT2))c+=n(r,"CDELT2",o.CDELT2,"deg/pixel");else if(r.match(/^CD1_1 /)&&e.notNull(o.CD1_1))c+=n(r,"CD1_1",o.CD1_1,"WCS matrix value");else if(r.match(/^CD1_2 /)&&e.notNull(o.CD1_2))c+=n(r,"CD1_2",o.CD1_2,"WCS matrix value");else if(r.match(/^CD2_1 /)&&e.notNull(o.CD2_1))c+=n(r,"CD2_1",o.CD2_1,"WCS matrix value");else if(r.match(/^CD2_2 /)&&e.notNull(o.CD2_2))c+=n(r,"CD2_2",o.CD2_2,"WCS matrix value");else if(r.match(/^LTV1 /)&&e.notNull(o.LTV1))c+=n(r,"LTV1",o.LTV1,"IRAF ref. point");else if(r.match(/^LTV2 /)&&e.notNull(o.LTV2))c+=n(r,"LTV2",o.LTV2,"IRAF ref. point");else if(r.match(/^LTM1_1 /)&&e.notNull(o.LTM1_1))c+=n(r,"LTM1_1",o.LTM1_1,"IRAF matrix value");else if(r.match(/^LTM1_2 /)&&e.notNull(o.LTM1_2))c+=n(r,"LTM1_2",o.LTM1_2,"IRAF matrix value");else if(r.match(/^LTM2_1 /)&&e.notNull(o.LTM2_1))c+=n(r,"LTM2_1",o.LTM2_1,"IRAF matrix value");else if(r.match(/^LTM2_2 /)&&e.notNull(o.LTM2_2))c+=n(r,"LTM2_2",o.LTM2_2,"IRAF matrix value");else if(i.twoaxes&&r.match(/^NAXIS /))c+=n(r,"NAXIS",2,"number of data axes");else{if(i.twoaxes&&r.match(/^(NAXIS|CRPIX|CRVAL|CTYPE|CUNIT|CDELT)[34567]/))continue;if(i.twoaxes&&r.match(/^(DATASUM|CHECKSUM)/))continue;"END "===r.substring(0,4)?(e.notNull(o.LTV1)&&!h.LTV1&&(c+=n(null,"LTV1",o.LTV1,"IRAF ref. point"),i.addcr&&(c+="\n")),e.notNull(o.LTV2)&&!h.LTV2&&(c+=n(null,"LTV2",o.LTV2,"IRAF ref. point"),i.addcr&&(c+="\n")),e.notNull(o.LTM1_1)&&!h.LTM1_1&&(c+=n(null,"LTM1_1",o.LTM1_1,"IRAF matrix value"),i.addcr&&(c+="\n")),e.notNull(o.LTM1_2)&&!h.LTM1_2&&(c+=n(null,"LTM1_2",o.LTM1_2,"IRAF matrix value"),i.addcr&&(c+="\n")),e.notNull(o.LTM2_1)&&!h.LTM2_1&&(c+=n(null,"LTM2_1",o.LTM2_1,"IRAF matrix value"),i.addcr&&(c+="\n")),e.notNull(o.LTM2_2)&&!h.LTM2_2&&(c+=n(null,"LTM2_2",o.LTM2_2,"IRAF matrix value"),i.addcr&&(c+="\n")),c+=r,l=!0):c+=r}i.addcr&&(c+="\n")}}else if(t.header||t.BITPIX)for(r in void 0===(n=t.header?t.header:t).SIMPLE&&void 0===n.simple||(!0===(s=void 0!==n.SIMPLE?n.SIMPLE:n.simple)?s="T":!1===s&&(s="F"),c+=sprintf("%-8s= %20s / %-47s","SIMPLE",s,"conforms to FITS standard"),i.addcr&&(c+="\n")),void 0===n.BITPIX&&void 0===n.bitpix||(c+=sprintf("%-8s= %20s / %-47s","BITPIX",s=void 0!==n.BITPIX?n.BITPIX:n.bitpix,"bits/pixel"),i.addcr&&(c+="\n")),n)if(n.hasOwnProperty(r)&&"js9Protocol"!==r&&"js9Endian"!==r&&"SIMPLE"!==r&&"simple"!==r&&"BITPIX"!==r&&"bitpix"!==r){if("END"===r&&(l=!0),r.match(/HISTORY__[0-9]+/))c+=sprintf("HISTORY %-72s",n[r]);else if(r.match(/COMMENT__[0-9]+/))c+=sprintf("COMMENT %-72s",n[r]);else{if(!0===(s=n[r])?s="T":!1===s?s="F":""===s?s="' '":e.isNumber(s)||"'"===s.charAt(0)||(s="'"+s+"'"),0<(o=80-(a=sprintf("%-8s= %20s",r,s)).length))for(s=0;s<o;s++)a+=" ";c+=a}i.addcr&&(c+="\n")}return l||(c+=sprintf("%-8s%-72s","END"," "),i.addcr&&(c+="\n")),c},e.hdus2Str=function(e){var t,i,s,a="";if(!e)return a;for(t=0;t<e.length;t++){switch(a+=sprintf("<b>#%d</b>:&#09;<b>name</b>: %s&#09;<b>type</b>: %s",(s=e[t]).hdu,i=s.name?s.name:0===t?"Primary":"N/A",s.type),s.type){case"image":if(a+=sprintf("&#09;<b>bitpix</b>: %d&#09;<b>naxis</b>: %d",s.bitpix,s.naxis),s.naxes.length){for(a+="&#09;<b>axes</b>: [",i=0;i<s.naxes.length;i++)a+=sprintf("%d",s.naxes[i]),i!==s.naxes.length-1&&(a+=", ");a+="]"}break;case"table":case"ascii":for(i="&#09;",9>=s.rows&&(i+="&#09;"),a+=sprintf("&#09;<b>rows</b>: %d%s<b>cols</b>: [",s.rows,i),i=0;i<s.cols.length;i++)a+=sprintf("%s",s.cols[i].name),i!==s.cols.length-1&&(a+=", ");a+="]"}a+="\n\n"}return a},CanvasRenderingContext2D.prototype.clear=CanvasRenderingContext2D.prototype.clear||function(e){e&&(this.save(),this.setTransform(1,0,0,1,0,0)),this.clearRect(0,0,this.canvas.width,this.canvas.height),e&&this.restore()},e.tooltip=function(t,i,s,a,n,r){var o;o=function(t){return t.replace(/\$([a-zA-Z0-9_.\/]+)/g,function(t,i,s){switch((i=i.split("."))[0]){case"im":s=a;break;case"xreg":s=n;break;case"evt":s=r;break;default:return t}for(t=1;t<i.length;t++)s=e.isNumber(s=s[i[t]])?s.toFixed(6):s;return void 0===s&&(s=""),s})},s?(s=o(s),a.display.tooltip.html(s),o=a.display.tooltip.width(),s=a.display.tooltip.height(),t=Math.max(2,Math.min(t,a.display.width-(o+10))),i=Math.max(2,Math.min(i,a.display.height-(s+10))),a.display.tooltip.css({left:t,top:i,display:"inline-block"})):a.display.tooltip.html("").css({left:-9999,display:"none"})},e.xeqByName=function(t,i){var s,a,n,r;switch(a=Array.prototype.slice.call(arguments,2),s=typeof t){case"function":return t.apply(i,a);case"string":for(r=(n=t.split(".")).pop(),s=0;s<n.length;s++)i=i[n[s]];return i[r].apply(i,a);default:e.error("unknown function type: "+s)}},e.varByName=function(t,i){var s,a,n;for(i=i||e,n=(a=t.split(".")).pop(),s=0;s<a.length;s++)if(!(i=i[a[s]]))return null;return i[n]},e.mergePrefs=function(t){var i,s,a;for(a in t)if(t.hasOwnProperty(a)&&e.hasOwnProperty(a)&&((s=typeof e[a])==(i=typeof t[a])||"string"===i))switch(s){case"object":$.isArray(t[a])?e[a]=t[a]:$.extend(e[a],t[a]);break;case"number":case"string":e[a]=t[a]}},e.loadPrefs=function(t,i){$.ajax({url:t,cache:!1,dataType:"json",mimeType:"application/json",async:!1,success:function(t){e.mergePrefs(t)},error:function(s,a,n){i&&(e.CHROMEFILEWARNING&&"Chrome"===e.BROWSER[0]&&""===document.domain&&n&&n.message&&n.message.match(/Failed to execute 'send' on 'XMLHttpRequest'/)?(alert("When using the file:// URI, Chrome must be run with the --allow-file-access-from-files switch to permit JS9 to access the preference file (and data files)."),e.CHROMEFILEWARNING=!1):e.log("JS9 prefs file not available: %s",t))}})},e.isTypedArray=function(e){return e=Object.prototype.toString.call(e),{"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0}.hasOwnProperty(e)},e.Starbase=function(e,t){var i,s,a,n,r,o=0;if(r=function(e){var t;for(t=0;t<e.length;t++)if(null===e[t].match(/^-+$/))return 0;return t},s=function(e){return e},this.head={},this.convFuncs=[],this.data=[],this.delims=[],e){if(t=t||{},n=e.replace(/\s+$/,"").split("\n"),t.skip&&(a=t.skip.split(""))&&a.length)for(;o<n.length&&(a[0]===n[o][0]||"\n"===a[1]&&""===n[o]);o++);if(void 0!==n[o]&&void 0!==n[o+1]){for(this.headline=n[o++].trim().split(/ *\t */),t.units&&(this.unitline=n[o++].trim().split(/ *\t */)),this.dashline=n[o++].trim().split(/ *\t */),i=r(this.dashline);0===i||i!==this.headline.length;)t.units?(this.headline=this.unitline,this.unitline=this.dashline):this.headline=this.dashline,this.dashline=n[o++].trim().split(/ *\t */),i=r(this.dashline);for(i=0;i<this.headline.length;i++)this.headline[i]=this.headline[i].replace(/\./g,"_"),this.convFuncs[i]=t.convFuncs&&t.convFuncs[this.headline[i]]?t.convFuncs[this.headline[i]]:t.convFuncs&&t.convFuncs.def?t.convFuncs.def:s;for(s=0;o<n.length&&(!a||!a.length||a[0]!==n[o][0]&&("\n"!==a[1]||""!==n[o]));o++,s++)for(this.data[s]=n[o].split("\t"),i=0;i<this.data[s].length;i++)r=this.convFuncs[i](this.data[s][i]),this.data[s][i]=r.val,this.delims[i]=r.delim||null;for(i=0;i<this.headline.length;i++)this[this.headline[i]]=i}}},e.colorToHex=function(e){var t,i;return e?void 0!==(t={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd3",antiquewhite1:"#ffefdb",antiquewhite2:"#eedfcc",antiquewhite3:"#cdc0b0",antiquewhite4:"#8b8378",cadetblue1:"#98f5ff",cadetblue2:"#8ee5ee",cadetblue3:"#7ac5cd",cadetblue4:"#53868b",darkgoldenrod1:"#ffb90f",darkgoldenrod2:"#eead0e",darkgoldenrod3:"#cd950c",darkgoldenrod4:"#8b6508",darkgrey:"#a9a9a9",darkolivegreen1:"#caff70",darkolivegreen2:"#bcee68",darkolivegreen3:"#a2cd5a",darkolivegreen4:"#6e8b3d",darkorange1:"#ff7f00",darkorange2:"#ee7600",darkorange3:"#cd6600",darkorange4:"#8b4500",darkorchid1:"#bf3eff",darkorchid2:"#b23aee",darkorchid3:"#9a32cd",darkorchid4:"#68228b",darkseagreen1:"#c1ffc1",darkseagreen2:"#b4eeb4",darkseagreen3:"#9bcd9b",darkseagreen4:"#698b69",darkslategray1:"#97ffff",darkslategray2:"#8deeee",darkslategray3:"#79cdcd",darkslategray4:"#528b8b",darkslategrey:"#2f4f4f",deeppink1:"#ff1493",deeppink2:"#ee1289",deeppink3:"#cd1076",deeppink4:"#8b0a50",deepskyblue1:"#00bfff",deepskyblue2:"#00b2ee",deepskyblue3:"#009acd",deepskyblue4:"#00688b",dimgrey:"#696969",dodgerblue1:"#1e90ff",dodgerblue2:"#1c86ee",dodgerblue3:"#1874cd",dodgerblue4:"#104e8b",hotpink1:"#ff6eb4",hotpink2:"#ee6aa7",hotpink3:"#cd6090",hotpink4:"#8b3a62",indianred:"#cd5c5c",indianred1:"#ff6a6a",indianred2:"#ee6363",indianred3:"#cd5555",indianred4:"#8b3a3a",lavenderblush1:"#fff0f5",lavenderblush2:"#eee0e5",lavenderblush3:"#cdc1c5",lavenderblush4:"#8b8386",lemonchiffon1:"#fffacd",lemonchiffon2:"#eee9bf",lemonchiffon3:"#cdc9a5",lemonchiffon4:"#8b8970",lightblue1:"#bfefff",lightblue2:"#b2dfee",lightblue3:"#9ac0cd",lightblue4:"#68838b",lightcyan1:"#e0ffff",lightcyan2:"#d1eeee",lightcyan3:"#b4cdcd",lightcyan4:"#7a8b8b",lightgoldenrod:"#eedd82",lightgoldenrod1:"#ffec8b",lightgoldenrod2:"#eedc82",lightgoldenrod3:"#cdbe70",lightgoldenrod4:"#8b814c",lightgray:"#d3d3d3",lightpink1:"#ffaeb9",lightpink2:"#eea2ad",lightpink3:"#cd8c95",lightpink4:"#8b5f65",lightsalmon1:"#ffa07a",lightsalmon2:"#ee9572",lightsalmon3:"#cd8162",lightsalmon4:"#8b5742",lightskyblue1:"#b0e2ff",lightskyblue2:"#a4d3ee",lightskyblue3:"#8db6cd",lightskyblue4:"#607b8b",lightslateblue:"#8470ff",lightslategrey:"#778899",lightsteelblue1:"#cae1ff",lightsteelblue2:"#bcd2ee",lightsteelblue3:"#a2b5cd",lightsteelblue4:"#6e7b8b",lightyellow1:"#ffffe0",lightyellow2:"#eeeed1",lightyellow3:"#cdcdb4",lightyellow4:"#8b8b7a",mediumorchid1:"#e066ff",mediumorchid2:"#d15fee",mediumorchid3:"#b452cd",mediumorchid4:"#7a378b",mediumpurple1:"#ab82ff",mediumpurple2:"#9f79ee",mediumpurple3:"#8968cd",mediumpurple4:"#5d478b",mistyrose1:"#ffe4e1",mistyrose2:"#eed5d2",mistyrose3:"#cdb7b5",mistyrose4:"#8b7d7b",navajowhite1:"#ffdead",navajowhite2:"#eecfa1",navajowhite3:"#cdb38b",navajowhite4:"#8b795e",navyblue:"#000080",olivedrab1:"#c0ff3e",olivedrab2:"#b3ee3a",olivedrab3:"#9acd32",olivedrab4:"#698b22",orangered1:"#ff4500",orangered2:"#ee4000",orangered3:"#cd3700",orangered4:"#8b2500",palegreen1:"#9aff9a",palegreen2:"#90ee90",palegreen3:"#7ccd7c",palegreen4:"#548b54",paleturquoise1:"#bbffff",paleturquoise2:"#aeeeee",paleturquoise3:"#96cdcd",paleturquoise4:"#668b8b",palevioletred1:"#ff82ab",palevioletred2:"#ee799f",palevioletred3:"#cd6889",palevioletred4:"#8b475d",peachpuff1:"#ffdab9",peachpuff2:"#eecbad",peachpuff3:"#cdaf95",peachpuff4:"#8b7765",rosybrown1:"#ffc1c1",rosybrown2:"#eeb4b4",rosybrown3:"#cd9b9b",rosybrown4:"#8b6969",royalblue1:"#4876ff",royalblue2:"#436eee",royalblue3:"#3a5fcd",royalblue4:"#27408b",seagreen1:"#54ff9f",seagreen2:"#4eee94",seagreen3:"#43cd80",seagreen4:"#2e8b57",skyblue1:"#87ceff",skyblue2:"#7ec0ee",skyblue3:"#6ca6cd",skyblue4:"#4a708b",slateblue1:"#836fff",slateblue2:"#7a67ee",slateblue3:"#6959cd",slateblue4:"#473c8b",slategray1:"#c6e2ff",slategray2:"#b9d3ee",slategray3:"#9fb6cd",slategray4:"#6c7b8b",slategrey:"#708090",springgreen1:"#00ff7f",springgreen2:"#00ee76",springgreen3:"#00cd66",springgreen4:"#008b45",steelblue1:"#63b8ff",steelblue2:"#5cacee",steelblue3:"#4f94cd",steelblue4:"#36648b",violetred:"#d02090",violetred1:"#ff3e96",violetred2:"#ee3a8c",violetred3:"#cd3278",violetred4:"#8b2252",webgray:"#808080",webgreen:"#008000",webgrey:"#808080",webmaroon:"#800000",webpurple:"#800080",x11gray:"#bebebe",x11green:"#00ff00",x11grey:"#bebebe",x11maroon:"#b03060",x11purple:"#a020f0",aquamarine1:"#7fffd4",aquamarine2:"#76eec6",aquamarine3:"#66cdaa",aquamarine4:"#458b74",azure1:"#f0ffff",azure2:"#e0eeee",azure3:"#c1cdcd",azure4:"#838b8b",bisque1:"#ffe4c4",bisque2:"#eed5b7",bisque3:"#cdb79e",bisque4:"#8b7d6b",blue1:"#0000ff",blue2:"#0000ee",blue3:"#0000cd",blue4:"#00008b",brown1:"#ff4040",brown2:"#ee3b3b",brown3:"#cd3333",brown4:"#8b2323",burlywood1:"#ffd39b",burlywood2:"#eec591",burlywood3:"#cdaa7d",burlywood4:"#8b7355",chartreuse1:"#7fff00",chartreuse2:"#76ee00",chartreuse3:"#66cd00",chartreuse4:"#458b00",chocolate1:"#ff7f24",chocolate2:"#ee7621",chocolate3:"#cd661d",chocolate4:"#8b4513",coral1:"#ff7256",coral2:"#ee6a50",coral3:"#cd5b45",coral4:"#8b3e2f",cornsilk1:"#fff8dc",cornsilk2:"#eee8cd",cornsilk3:"#cdc8b1",cornsilk4:"#8b8878",cyan1:"#00ffff",cyan2:"#00eeee",cyan3:"#00cdcd",cyan4:"#008b8b",firebrick1:"#ff3030",firebrick2:"#ee2c2c",firebrick3:"#cd2626",firebrick4:"#8b1a1a",gold1:"#ffd700",gold2:"#eec900",gold3:"#cdad00",gold4:"#8b7500",goldenrod1:"#ffc125",goldenrod2:"#eeb422",goldenrod3:"#cd9b1d",goldenrod4:"#8b6914",gray0:"#000000",gray1:"#030303",gray10:"#1a1a1a",gray100:"#ffffff",gray11:"#1c1c1c",gray12:"#1f1f1f",gray13:"#212121",gray14:"#242424",gray15:"#262626",gray16:"#292929",gray17:"#2b2b2b",gray18:"#2e2e2e",gray19:"#303030",gray2:"#050505",gray20:"#333333",gray21:"#363636",gray22:"#383838",gray23:"#3b3b3b",gray24:"#3d3d3d",gray25:"#404040",gray26:"#424242",gray27:"#454545",gray28:"#474747",gray29:"#4a4a4a",gray3:"#080808",gray30:"#4d4d4d",gray31:"#4f4f4f",gray32:"#525252",gray33:"#545454",gray34:"#575757",gray35:"#595959",gray36:"#5c5c5c",gray37:"#5e5e5e",gray38:"#616161",gray39:"#636363",gray4:"#0a0a0a",gray40:"#666666",gray41:"#696969",gray42:"#6b6b6b",gray43:"#6e6e6e",gray44:"#707070",gray45:"#737373",gray46:"#757575",gray47:"#787878",gray48:"#7a7a7a",gray49:"#7d7d7d",gray5:"#0d0d0d",gray50:"#7f7f7f",gray51:"#828282",gray52:"#858585",gray53:"#878787",gray54:"#8a8a8a",gray55:"#8c8c8c",gray56:"#8f8f8f",gray57:"#919191",gray58:"#949494",gray59:"#969696",gray6:"#0f0f0f",gray60:"#999999",gray61:"#9c9c9c",gray62:"#9e9e9e",gray63:"#a1a1a1",gray64:"#a3a3a3",gray65:"#a6a6a6",gray66:"#a8a8a8",gray67:"#ababab",gray68:"#adadad",gray69:"#b0b0b0",gray7:"#121212",gray70:"#b3b3b3",gray71:"#b5b5b5",gray72:"#b8b8b8",gray73:"#bababa",gray74:"#bdbdbd",gray75:"#bfbfbf",gray76:"#c2c2c2",gray77:"#c4c4c4",gray78:"#c7c7c7",gray79:"#c9c9c9",gray8:"#141414",gray80:"#cccccc",gray81:"#cfcfcf",gray82:"#d1d1d1",gray83:"#d4d4d4",gray84:"#d6d6d6",gray85:"#d9d9d9",gray86:"#dbdbdb",gray87:"#dedede",gray88:"#e0e0e0",gray89:"#e3e3e3",gray9:"#171717",gray90:"#e5e5e5",gray91:"#e8e8e8",gray92:"#ebebeb",gray93:"#ededed",gray94:"#f0f0f0",gray95:"#f2f2f2",gray96:"#f5f5f5",gray97:"#f7f7f7",gray98:"#fafafa",gray99:"#fcfcfc",green1:"#00ff00",green2:"#00ee00",green3:"#00cd00",green4:"#008b00",grey:"#bebebe",grey0:"#000000",grey1:"#030303",grey10:"#1a1a1a",grey100:"#ffffff",grey11:"#1c1c1c",grey12:"#1f1f1f",grey13:"#212121",grey14:"#242424",grey15:"#262626",grey16:"#292929",grey17:"#2b2b2b",grey18:"#2e2e2e",grey19:"#303030",grey2:"#050505",grey20:"#333333",grey21:"#363636",grey22:"#383838",grey23:"#3b3b3b",grey24:"#3d3d3d",grey25:"#404040",grey26:"#424242",grey27:"#454545",grey28:"#474747",grey29:"#4a4a4a",grey3:"#080808",grey30:"#4d4d4d",grey31:"#4f4f4f",grey32:"#525252",grey33:"#545454",grey34:"#575757",grey35:"#595959",grey36:"#5c5c5c",grey37:"#5e5e5e",grey38:"#616161",grey39:"#636363",grey4:"#0a0a0a",grey40:"#666666",grey41:"#696969",grey42:"#6b6b6b",grey43:"#6e6e6e",grey44:"#707070",grey45:"#737373",grey46:"#757575",grey47:"#787878",grey48:"#7a7a7a",grey49:"#7d7d7d",grey5:"#0d0d0d",grey50:"#7f7f7f",grey51:"#828282",grey52:"#858585",grey53:"#878787",grey54:"#8a8a8a",grey55:"#8c8c8c",grey56:"#8f8f8f",grey57:"#919191",grey58:"#949494",grey59:"#969696",grey6:"#0f0f0f",grey60:"#999999",grey61:"#9c9c9c",grey62:"#9e9e9e",grey63:"#a1a1a1",grey64:"#a3a3a3",grey65:"#a6a6a6",grey66:"#a8a8a8",grey67:"#ababab",grey68:"#adadad",grey69:"#b0b0b0",grey7:"#121212",grey70:"#b3b3b3",grey71:"#b5b5b5",grey72:"#b8b8b8",grey73:"#bababa",grey74:"#bdbdbd",grey75:"#bfbfbf",grey76:"#c2c2c2",grey77:"#c4c4c4",grey78:"#c7c7c7",grey79:"#c9c9c9",grey8:"#141414",grey80:"#cccccc",grey81:"#cfcfcf",grey82:"#d1d1d1",grey83:"#d4d4d4",grey84:"#d6d6d6",grey85:"#d9d9d9",grey86:"#dbdbdb",grey87:"#dedede",grey88:"#e0e0e0",grey89:"#e3e3e3",grey9:"#171717",grey90:"#e5e5e5",grey91:"#e8e8e8",grey92:"#ebebeb",grey93:"#ededed",grey94:"#f0f0f0",grey95:"#f2f2f2",grey96:"#f5f5f5",grey97:"#f7f7f7",grey98:"#fafafa",grey99:"#fcfcfc",honeydew1:"#f0fff0",honeydew2:"#e0eee0",honeydew3:"#c1cdc1",honeydew4:"#838b83",ivory1:"#fffff0",ivory2:"#eeeee0",ivory3:"#cdcdc1",ivory4:"#8b8b83",khaki1:"#fff68f",khaki2:"#eee685",khaki3:"#cdc673",khaki4:"#8b864e",magenta1:"#ff00ff",magenta2:"#ee00ee",magenta3:"#cd00cd",magenta4:"#8b008b",maroon1:"#ff34b3",maroon2:"#ee30a7",maroon3:"#cd2990",maroon4:"#8b1c62",orange1:"#ffa500",orange2:"#ee9a00",orange3:"#cd8500",orange4:"#8b5a00",orchid1:"#ff83fa",orchid2:"#ee7ae9",orchid3:"#cd69c9",orchid4:"#8b4789",pink1:"#ffb5c5",pink2:"#eea9b8",pink3:"#cd919e",pink4:"#8b636c",plum1:"#ffbbff",plum2:"#eeaeee",plum3:"#cd96cd",plum4:"#8b668b",purple1:"#9b30ff",purple2:"#912cee",purple3:"#7d26cd",purple4:"#551a8b",red1:"#ff0000",red2:"#ee0000",red3:"#cd0000",red4:"#8b0000",salmon1:"#ff8c69",salmon2:"#ee8262",salmon3:"#cd7054",salmon4:"#8b4c39",seashell1:"#fff5ee",seashell2:"#eee5de",seashell3:"#cdc5bf",seashell4:"#8b8682",sienna1:"#ff8247",sienna2:"#ee7942",sienna3:"#cd6839",sienna4:"#8b4726",snow1:"#fffafa",snow2:"#eee9e9",snow3:"#cdc9c9",snow4:"#8b8989",tan1:"#ffa54f",tan2:"#ee9a49",tan3:"#cd853f",tan4:"#8b5a2b",thistle1:"#ffe1ff",thistle2:"#eed2ee",thistle3:"#cdb5cd",thistle4:"#8b7b8b",tomato1:"#ff6347",tomato2:"#ee5c42",tomato3:"#cd4f39",tomato4:"#8b3626",turquoise1:"#00f5ff",turquoise2:"#00e5ee",turquoise3:"#00c5cd",turquoise4:"#00868b",wheat1:"#ffe7ba",wheat2:"#eed8ae",wheat3:"#cdba96",wheat4:"#8b7e66",yellow1:"#ffff00",yellow2:"#eeee00",yellow3:"#cdcd00",yellow4:"#8b8b00"})[i=e.toLowerCase()]?t[i]:(t=e.match(/rgb\((\d+)[,\s]+(\d+)[,\s]+(\d+)\)/i))?sprintf("#%02x%02x%02x",t[1],t[2],t[3]):e:""},e.strtoscaled=function(t){t=e.saostrtod(t);var i=String.fromCharCode(e.saodtype());switch(i){case'"':t/=3600;break;case"'":t/=60;break;case"r":t*=180/Math.PI}return{dval:t,dtype:i}},e.cleanPath=function(e){return e?e.trim().replace(/\/\.\//,"/").replace(/^\.\//,""):""},e.fixPath=function(t,i){return i=i||{},window.isElectron&&window.currentDir&&e.desktopOpts.currentPath&&!1!==i.fixpath&&"/"!==t.charAt(0)&&!t.match(e.URLEXP)&&(t=window.currentDir+"/"+t),t},e.dirname=function(e){return e&&-1!==e.indexOf("/")?e.match(/.*\//)[0]:""},e.mouseDownCB=function(t){var i=t.data,s=i.image;if(s){if(t.target&&(s.posOffset=$(t.target).offset()),s.pos0=e.eventToDisplayPos(t,s.posOffset),s.pos=s.pos0,s.ipos0=s.displayToImagePos(s.pos),s.ipos=s.ipos0,i.resizing=i.inResize(s.pos),!i.resizing){if(t.preventDefault(),e.hasOwnProperty("MouseTouch")&&e.MouseTouch.action(s,t,"start"),s.clickInRegion&&"regions"===s.clickInLayer)return void s.display.clearMessage("regions");e.specialKey(t)||s.xeqPlugins("mouse","onmousedown",t)}switch(s.clickState=t.which,t.which){case 3:s.clickState=2}t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length&&(s.clickState=-t.originalEvent.touches.length),$(document).on("mousemove."+i.id,i,function(t){return e.mouseMoveCB(t)}),$(document).on("mouseup."+i.id,i,function(t){return e.mouseUpCB(t)})}},e.mouseUpCB=function(t){var i,s,a=t.data;if(i=a.image)for(i.pos=e.eventToDisplayPos(t,i.posOffset),i.ipos=i.displayToImagePos(i.pos),s=Math.abs(i.pos0.x-i.pos.x)<e.NOMOVE&&Math.abs(i.pos0.y-i.pos.y)<e.NOMOVE,a.inResize(i.pos)||t.preventDefault(),e.hasOwnProperty("MouseTouch")&&e.MouseTouch.action(i,t,"stop"),i.clickInRegion&&i.clickInLayer&&i.updateShapes(i.clickInLayer,"selected",s?"select":"update"),e.specialKey(t)||(i.xeqPlugins("mouse","onmouseup",t),s&&(i.xeqPlugins("mouse","onclick",t),e.hasOwnProperty("Menubar"))&&e.Menubar.onclick(i.display),"click"===e.globalOpts.dynamicSelect&&e.Dysel.getDisplayOr(a)!==a&&e.Dysel.select(a)),i.clickInRegion=!1,i.clickInLayer=null,i.clickState=0,i.posOffset=null,a.resizing&&(a.resizing=!1,e.bugs.webkit_resize&&(t=parseInt(a.divjq.css("width"),10),s=parseInt(a.divjq.css("height"),10),t<a.owidth&&a.divjq.css("width",a.owidth+e.RESIZEFUDGE),s<a.oheight&&a.divjq.css("height",a.oheight+e.RESIZEFUDGE)),e.globalOpts.resizeRedisplay||(i.displayImage("all"),i.refreshLayers())),$(document).off("mouseup."+a.id),$(document).off("mousemove."+a.id),i=0;i<e.displays.length;i++)(t=e.displays[i])!==a&&t.image&&t.image.clickState&&t.divjq.trigger("mouseup");else e.hasOwnProperty("Menubar")&&e.Menubar.onclick(t.data)},e.mouseMoveCB=function(t){var i,s=(i=t.data).image;!s||e.specialKey(t)||(s.pos=e.eventToDisplayPos(t,s.posOffset),s.ipos=s.displayToImagePos(s.pos),s.pos0||(s.pos0=s.pos),s.ipos0||(s.ipos0=s.ipos),i.resizing)||(t.preventDefault(),s.valpos=null,s.clickInRegion&&"regions"===s.clickInLayer&&(i=s.display.layers.regions.params.sel)&&((s.params.listonchange||i.params.listonchange||e.globalOpts.intensivePlugins)&&s.updateShape("regions",i,null,"move"),(s.params.listonchange||i.params.listonchange)&&s.listRegions("selected",{mode:2}),e.globalOpts.intensivePlugins&&s.xeqPlugins("region","onregionsmove",i.pub)),e.hasOwnProperty("MouseTouch")&&e.MouseTouch.action(s,t),e.hasOwnProperty("Crosshair")&&s.tmp.arrowCrosshairVisible&&!s.params.crosshair&&e.Crosshair.hide(s,s.ipos,t),s.valpos||(s.valpos=s.updateValpos(s.ipos,!1)),e.specialKey(t)||s.xeqPlugins("mouse","onmousemove",t))},e.mouseEnterCB=function(t){var i=t.data,s=i.image;t.preventDefault(),s&&(e.specialKey(t)||"move"===e.globalOpts.dynamicSelect&&e.Dysel.getDisplayOr(i)!==i&&e.Dysel.select(i))},e.mouseOverCB=function(t){var i=t.data.image,s=$(document).scrollLeft(),a=$(document).scrollTop();t.preventDefault(),i&&(i.display.displayConjq.focus(),window.scrollTo(s,a),e.specialKey(t)||(i.pos=e.eventToDisplayPos(t),i.ipos=i.displayToImagePos(i.pos),e.specialKey(t)||i.xeqPlugins("mouse","onmouseover",t)))},e.mouseOutCB=function(t){var i=t.data.image;t.preventDefault(),i&&(i.display.displayConjq.blur(),i.clickInRegion&&i.clickInLayer&&i.updateShapes(i.clickInLayer,"selected","mouseout"),e.specialKey(t)||(i.pos=e.eventToDisplayPos(t),i.ipos=i.displayToImagePos(i.pos),e.specialKey(t)||i.xeqPlugins("mouse","onmouseout",t)))},e.wheelCB=function(t){var i=t.data,s=i.image;i.mousetouchZoom&&s&&e.hasOwnProperty("MouseTouch")&&e.MouseTouch.Actions["wheel zoom"]&&(e.MouseTouch.Actions["wheel zoom"](s,t),t.preventDefault())},e.keyPressCB=function(e){var t=e.data.image;e.preventDefault(),t&&t.xeqPlugins("keypress","onkeypress",e)},e.keyDownCB=function(t){var i=t.data.image;t.preventDefault(),e.hasOwnProperty("Keyboard")&&e.Keyboard.action(i,i?i.ipos:{x:null,y:null},t),i&&i.xeqPlugins("keypress","onkeydown",t)},e.keyUpCB=function(e){var t=e.data.image;t&&t.xeqPlugins("keypress","onkeyup",e)},e.dragenterCB=function(e,t){t.stopPropagation(),t.preventDefault()},e.dragoverCB=function(e,t){t.stopPropagation(),t.preventDefault()},e.dragexitCB=function(e,t){t.stopPropagation(),t.preventDefault()},e.dragdropCB=function(t,i){var s,a,n,r,o;i.originalEvent&&(i=i.originalEvent),i.stopPropagation(),i.preventDefault(),(n=$.extend(!0,{},e.fits.options)).display=n.display||t,n.extlist=n.extlist||e.globalOpts.extlist,r=i.target.files||i.dataTransfer.files,o=e.lookupDisplay(n.display),r.length?window.setTimeout(function(){var t,i;for(s=0;s<r.length;s++)(i=(t=r[s]).path||t.name||"").match(/\.reg$/)?e.LoadRegions(t,{display:n.display}):i.match(/\.cat$/)?e.LoadCatalog(null,t,{display:n.display}):i.match(/\.ses$/)?e.LoadSession(t,{display:n.display}):i.match(/\.js9ses$/)?e.LoadSession(t,{display:n.display}):i.match(/\.cmap$/)?e.LoadColormap(t):(e.waiting(!0,o),n.refresh=e.globalOpts.refreshDragDrop,e.Load(t,n,{display:n.display}))},e.SPINOUT):(a=i.dataTransfer.getData("text")).match(e.URLEXP)&&e.globalOpts.loadProxy&&e.LoadProxy(a,{display:n.display})},e.RegisterPlugin=function(t,i,s,a){var n,r;t&&i&&s&&(n=t+i,a?(a.viewMenuItem&&(a.menuItem=a.viewMenuItem),a.menuItem&&!a.menu&&(a.menu="view"),a.menu&&(a.menu=a.menu.toLowerCase())):a=[],e.PLUGINS&&(e.PLUGINS+="|"),e.PLUGINS+=n.replace(/JS9/,""),e.PLUGINS+="|",e.PLUGINS+=i,e.plugins.push({xclass:t,xname:i,name:n,opts:a,func:s,instances:[]}),a.help&&((s=a.help.match(/^.*[\\\/]/))[0]&&(r="plugins/"+s[0].replace(/[\\\/]+$/,"")),s=a.help.replace(/^.*[\\\/]/,""),e.helpOpts[i]={type:r,url:s,heading:t,title:a=a.menuItem?a.menuItem:n}),e.inited&&e.instantiatePlugins())},e.instantiatePlugin=function(t,i,s,a){var n,r,o,l,c="visible";if("string"==typeof i){for(n=0;n<e.plugins.length;n++)if((r=e.plugins[n]).name===i){i=r;break}"string"==typeof i&&e.error("unknown plugin: "+i)}if((r=Object.create(i.func.prototype)).name=i.name,r.isActive=function(e){if("active"!==this.status||e&&!this.plugin.opts.hasOwnProperty(e))return!1;switch(this.winType){case"virtual":return!0;default:return this.divjq.is(":visible")}},r.errLog=function(t,i){e.log("error in %s: %s [%s]\n%s",t,this.name,i.message,e.strace(i))},t){for(o=t instanceof jQuery?t:"object"==typeof t?$(t):$("#"+t),n=0;n<i.instances.length;n++)if(o.is(i.instances[n].odivjq))return i.instances[n]}else o=$("div");if(t?s?(r.id=o.attr("id")||i.name,r.winType="light",r.winHandle=s,r.odivjq=o,r.divjq=o,r.outerdivjq=r.divjq.closest(e.lightOpts[e.LIGHTWIN].top)):(r.id=o.attr("id")||i.name,r.winType="div",0<=$.inArray(r.name,e.globalOpts.hiddenPluginDivs)&&(c="hidden"),o.wrap(sprintf("<div class='JS9PluginContainer' style='visibility: %s'>",c)),r.odivjq=o,r.divjq=o,r.divjq.addClass(i.xclass+"Plugin").addClass("JS9Plugin"),r.odivjq.attr("id")||r.odivjq.attr("id",r.id),r.outerdivjq=r.divjq.closest(".JS9PluginContainer"),!1!==o.data("toolbarseparate")&&(i.opts.toolbarSeparate||o.data("toolbarseparate"))&&(s="<div class='"+e.lightOpts[e.LIGHTWIN].dragBar+"'>",$(s).insertBefore(r.divjq))):(r.id=i.name,r.winType="virtual"),r.plugin=i,r.el=t,r.status="active",i.instances.push(r),"virtual"===r.winType)for(n=0;n<e.displays.length;n++)e.displays[n].pluginInstances[i.name]||(r.div=null,r.display=e.displays[n],i.func.apply(r,a),e.displays[n].pluginInstances[i.name]=r);else if(r.div=r.divjq[0],r.outerdiv=r.outerdivjq[0],!i.opts.winDims||r.divjq.width()&&r.divjq.height()||(r.divjq.css("width",i.opts.winDims[0]),r.divjq.css("height",i.opts.winDims[1])),"*"===(t=r.divjq.data("js9id")||r.id)?i.opts.dynamicSelect?(r.display=e.displays[0],r.isDynamic=!0,e.Dysel.addPlugins(i.name),l="*"):e.error(i.name+" is not a dynamically selectable plugin"):(r.display=e.lookupDisplay(t),l=r.display.id),(o=o.data("toolbarhtml")||i.opts.toolbarHTML)&&(o=e.Image.prototype.expandMacro.call(null,o,[{name:"title",value:i.opts.winTitle||""}]),0===(t=r.divjq.closest(e.lightOpts[e.LIGHTWIN].drag)).length&&(t=r.divjq),$("<div class='JS9PluginToolbar-"+r.winType+"'>").css("z-index",e.BTNZINDEX).html(o).data("displayid",l).insertAfter(t)),r.display.pluginInstances[i.name]=r,i.func.apply(r,a),"*"===l)for(n=0;n<e.displays.length;n++)e.displays[n].pluginInstances[i.name]?r.display=e.displays[n]:e.displays[n].pluginInstances[i.name]=r;return r},e.instantiatePlugins=function(){var t,i=function(t){var i,s,a;for($("div."+t.name).each(function(){e.instantiatePlugin($(this),t,null,t.opts.divArgs)}),t.opts.menuItem||!t.opts.winDims||t.opts.winDims[0]||t.opts.winDims[1]||e.instantiatePlugin(null,t,null,t.opts.divArgs),i=0;i<t.instances.length;i++)if((a=t.instances[i]).isDynamic)for(s=0;s<e.displays.length;s++)e.displays[s].pluginInstances[t.name]||(e.displays[s].pluginInstances[t.name]=a)};for(t=0;t<e.plugins.length;t++)i(e.plugins[t])},e.initEmscripten=function(){var t;if(!window.hasOwnProperty("Astroem"))if(t={responseType:"arraybuffer",allowCache:!0},e.globalOpts.useWasm&&"object"==typeof WebAssembly&&("file:"!==location.protocol||e.globalOpts.allowFileWasm))e.globalOpts.astroemWasm=e.InstallDir(Module.wasmBinaryFile||"astroemw.wasm"),e.fetchURL(e.globalOpts.astroemWasm,null,t,function(t){Module.wasmBinary=t,e.globalOpts.astroemURL=e.InstallDir("astroemw.js");try{e.loadScript(e.globalOpts.astroemURL)}catch(i){e.error("can't find "+e.globalOpts.astroemURL)}});else{e.globalOpts.astroemURL=e.InstallDir("astroem.js");try{e.loadScript(e.globalOpts.astroemURL)}catch(i){e.error("can't find "+e.globalOpts.astroemURL)}}},e.initFITS=function(){window.hasOwnProperty("Astroem")?(e.vmalloc=Astroem.vmalloc,e.vfree=Astroem.vfree,e.vheap=Astroem.vheap,e.vmemcpy=Astroem.vmemcpy,e.vfile=Astroem.vfile,e.vread=Astroem.vread,e.vunlink=Astroem.vunlink,e.vsize=Astroem.vsize,e.vmount=Astroem.vmount,e.arrfile=Astroem.arrfile,e.listhdu=Astroem.listhdu,e.initwcs=Astroem.initwcs,e.freewcs=Astroem.freewcs,e.wcsinfo=Astroem.wcsinfo,e.wcssys=Astroem.wcssys,e.wcsunits=Astroem.wcsunits,e.pix2wcs=Astroem.pix2wcs,e.wcs2pix=Astroem.wcs2pix,e.reg2wcs=Astroem.reg2wcs,e.saostrtod=Astroem.saostrtod,e.saodtostr=Astroem.saodtostr,e.saodtype=Astroem.saodtype,e.zscale=Astroem.zscale,e.tanhdr=Astroem.tanhdr,e.reproject=Astroem.reproject,e.madd=Astroem.madd,e.imgtbl=Astroem.imgtbl,e.makehdr=Astroem.makehdr,e.shrinkhdr=Astroem.shrinkhdr,e.imsection=Astroem.imsection,e.regcnts=Astroem.regcnts,e.fitsLibrary("cfitsio")):window.hasOwnProperty("Fitsy")&&e.fitsLibrary("fitsy")},e.initColormaps=function(){e.hasOwnProperty("Colormap")&&(e.checkNew(new e.Colormap("grey",[[0,0],[1,1]],[[0,0],[1,1]],[[0,0],[1,1]])),e.checkNew(new e.Colormap("red",[[0,0],[1,1]],[[0,0],[0,0]],[[0,0],[0,0]])),e.checkNew(new e.Colormap("green",[[0,0],[0,0]],[[0,0],[1,1]],[[0,0],[0,0]])),e.checkNew(new e.Colormap("blue",[[0,0],[0,0]],[[0,0],[0,0]],[[0,0],[1,1]])),e.checkNew(new e.Colormap("heat",[[0,0],[.34,1],[1,1]],[[0,0],[1,1]],[[0,0],[.65,0],[.98,1],[1,1]])),e.checkNew(new e.Colormap("cool",[[0,0],[.29,0],[.76,.1],[1,1]],[[0,0],[.22,0],[.96,1],[1,1]],[[0,0],[.53,1],[1,1]])),e.checkNew(new e.Colormap("viridis",[[.267004,.004874,.329415],[.26851,.009605,.335427],[.269944,.014625,.341379],[.271305,.019942,.347269],[.272594,.025563,.353093],[.273809,.031497,.358853],[.274952,.037752,.364543],[.276022,.044167,.370164],[.277018,.050344,.375715],[.277941,.056324,.381191],[.278791,.062145,.386592],[.279566,.067836,.391917],[.280267,.073417,.397163],[.280894,.078907,.402329],[.281446,.08432,.407414],[.281924,.089666,.412415],[.282327,.094955,.417331],[.282656,.100196,.42216],[.28291,.105393,.426902],[.283091,.110553,.431554],[.283197,.11568,.436115],[.283229,.120777,.440584],[.283187,.125848,.44496],[.283072,.130895,.449241],[.282884,.13592,.453427],[.282623,.140926,.457517],[.28229,.145912,.46151],[.281887,.150881,.465405],[.281412,.155834,.469201],[.280868,.160771,.472899],[.280255,.165693,.476498],[.279574,.170599,.479997],[.278826,.17549,.483397],[.278012,.180367,.486697],[.277134,.185228,.489898],[.276194,.190074,.493001],[.275191,.194905,.496005],[.274128,.199721,.498911],[.273006,.20452,.501721],[.271828,.209303,.504434],[.270595,.214069,.507052],[.269308,.218818,.509577],[.267968,.223549,.512008],[.26658,.228262,.514349],[.265145,.232956,.516599],[.263663,.237631,.518762],[.262138,.242286,.520837],[.260571,.246922,.522828],[.258965,.251537,.524736],[.257322,.25613,.526563],[.255645,.260703,.528312],[.253935,.265254,.529983],[.252194,.269783,.531579],[.250425,.27429,.533103],[.248629,.278775,.534556],[.246811,.283237,.535941],[.244972,.287675,.53726],[.243113,.292092,.538516],[.241237,.296485,.539709],[.239346,.300855,.540844],[.237441,.305202,.541921],[.235526,.309527,.542944],[.233603,.313828,.543914],[.231674,.318106,.544834],[.229739,.322361,.545706],[.227802,.326594,.546532],[.225863,.330805,.547314],[.223925,.334994,.548053],[.221989,.339161,.548752],[.220057,.343307,.549413],[.21813,.347432,.550038],[.21621,.351535,.550627],[.214298,.355619,.551184],[.212395,.359683,.55171],[.210503,.363727,.552206],[.208623,.367752,.552675],[.206756,.371758,.553117],[.204903,.375746,.553533],[.203063,.379716,.553925],[.201239,.38367,.554294],[.19943,.387607,.554642],[.197636,.391528,.554969],[.19586,.395433,.555276],[.1941,.399323,.555565],[.192357,.403199,.555836],[.190631,.407061,.556089],[.188923,.41091,.556326],[.187231,.414746,.556547],[.185556,.41857,.556753],[.183898,.422383,.556944],[.182256,.426184,.55712],[.180629,.429975,.557282],[.179019,.433756,.55743],[.177423,.437527,.557565],[.175841,.44129,.557685],[.174274,.445044,.557792],[.172719,.448791,.557885],[.171176,.45253,.557965],[.169646,.456262,.55803],[.168126,.459988,.558082],[.166617,.463708,.558119],[.165117,.467423,.558141],[.163625,.471133,.558148],[.162142,.474838,.55814],[.160665,.47854,.558115],[.159194,.482237,.558073],[.157729,.485932,.558013],[.15627,.489624,.557936],[.154815,.493313,.55784],[.153364,.497,.557724],[.151918,.500685,.557587],[.150476,.504369,.55743],[.149039,.508051,.55725],[.147607,.511733,.557049],[.14618,.515413,.556823],[.144759,.519093,.556572],[.143343,.522773,.556295],[.141935,.526453,.555991],[.140536,.530132,.555659],[.139147,.533812,.555298],[.13777,.537492,.554906],[.136408,.541173,.554483],[.135066,.544853,.554029],[.133743,.548535,.553541],[.132444,.552216,.553018],[.131172,.555899,.552459],[.129933,.559582,.551864],[.128729,.563265,.551229],[.127568,.566949,.550556],[.126453,.570633,.549841],[.125394,.574318,.549086],[.124395,.578002,.548287],[.123463,.581687,.547445],[.122606,.585371,.546557],[.121831,.589055,.545623],[.121148,.592739,.544641],[.120565,.596422,.543611],[.120092,.600104,.54253],[.119738,.603785,.5414],[.119512,.607464,.540218],[.119423,.611141,.538982],[.119483,.614817,.537692],[.119699,.61849,.536347],[.120081,.622161,.534946],[.120638,.625828,.533488],[.12138,.629492,.531973],[.122312,.633153,.530398],[.123444,.636809,.528763],[.12478,.640461,.527068],[.126326,.644107,.525311],[.128087,.647749,.523491],[.130067,.651384,.521608],[.132268,.655014,.519661],[.134692,.658636,.517649],[.137339,.662252,.515571],[.14021,.665859,.513427],[.143303,.669459,.511215],[.146616,.67305,.508936],[.150148,.676631,.506589],[.153894,.680203,.504172],[.157851,.683765,.501686],[.162016,.687316,.499129],[.166383,.690856,.496502],[.170948,.694384,.493803],[.175707,.6979,.491033],[.180653,.701402,.488189],[.185783,.704891,.485273],[.19109,.708366,.482284],[.196571,.711827,.479221],[.202219,.715272,.476084],[.20803,.718701,.472873],[.214,.722114,.469588],[.220124,.725509,.466226],[.226397,.728888,.462789],[.232815,.732247,.459277],[.239374,.735588,.455688],[.24607,.73891,.452024],[.252899,.742211,.448284],[.259857,.745492,.444467],[.266941,.748751,.440573],[.274149,.751988,.436601],[.281477,.755203,.432552],[.288921,.758394,.428426],[.296479,.761561,.424223],[.304148,.764704,.419943],[.311925,.767822,.415586],[.319809,.770914,.411152],[.327796,.77398,.40664],[.335885,.777018,.402049],[.344074,.780029,.397381],[.35236,.783011,.392636],[.360741,.785964,.387814],[.369214,.788888,.382914],[.377779,.791781,.377939],[.386433,.794644,.372886],[.395174,.797475,.367757],[.404001,.800275,.362552],[.412913,.803041,.357269],[.421908,.805774,.35191],[.430983,.808473,.346476],[.440137,.811138,.340967],[.449368,.813768,.335384],[.458674,.816363,.329727],[.468053,.818921,.323998],[.477504,.821444,.318195],[.487026,.823929,.312321],[.496615,.826376,.306377],[.506271,.828786,.300362],[.515992,.831158,.294279],[.525776,.833491,.288127],[.535621,.835785,.281908],[.545524,.838039,.275626],[.555484,.840254,.269281],[.565498,.84243,.262877],[.575563,.844566,.256415],[.585678,.846661,.249897],[.595839,.848717,.243329],[.606045,.850733,.236712],[.616293,.852709,.230052],[.626579,.854645,.223353],[.636902,.856542,.21662],[.647257,.8584,.209861],[.657642,.860219,.203082],[.668054,.861999,.196293],[.678489,.863742,.189503],[.688944,.865448,.182725],[.699415,.867117,.175971],[.709898,.868751,.169257],[.720391,.87035,.162603],[.730889,.871916,.156029],[.741388,.873449,.149561],[.751884,.874951,.143228],[.762373,.876424,.137064],[.772852,.877868,.131109],[.783315,.879285,.125405],[.79376,.880678,.120005],[.804182,.882046,.114965],[.814576,.883393,.110347],[.82494,.88472,.106217],[.83527,.886029,.102646],[.845561,.887322,.099702],[.85581,.888601,.097452],[.866013,.889868,.095953],[.876168,.891125,.09525],[.886271,.892374,.095374],[.89632,.893616,.096335],[.906311,.894855,.098125],[.916242,.896091,.100717],[.926106,.89733,.104071],[.935904,.89857,.108131],[.945636,.899815,.112838],[.9553,.901065,.118128],[.964894,.902323,.123941],[.974417,.90359,.130215],[.983868,.904867,.136897],[.993248,.906157,.143936]])),e.checkNew(new e.Colormap("magma",[[.001462,466e-6,.013866],[.002258,.001295,.018331],[.003279,.002305,.023708],[.004512,.00349,.029965],[.00595,.004843,.03713],[.007588,.006356,.044973],[.009426,.008022,.052844],[.011465,.009828,.06075],[.013708,.011771,.068667],[.016156,.01384,.076603],[.018815,.016026,.084584],[.021692,.01832,.09261],[.024792,.020715,.100676],[.028123,.023201,.108787],[.031696,.025765,.116965],[.03552,.028397,.125209],[.039608,.03109,.133515],[.04383,.03383,.141886],[.048062,.036607,.150327],[.05232,.039407,.158841],[.056615,.04216,.167446],[.060949,.044794,.176129],[.06533,.047318,.184892],[.069764,.049726,.193735],[.074257,.052017,.20266],[.078815,.054184,.211667],[.083446,.056225,.220755],[.088155,.058133,.229922],[.092949,.059904,.239164],[.097833,.061531,.248477],[.102815,.06301,.257854],[.107899,.064335,.267289],[.113094,.065492,.276784],[.118405,.066479,.286321],[.123833,.067295,.295879],[.12938,.067935,.305443],[.135053,.068391,.315],[.140858,.068654,.324538],[.146785,.068738,.334011],[.152839,.068637,.343404],[.159018,.068354,.352688],[.165308,.067911,.361816],[.171713,.067305,.370771],[.178212,.066576,.379497],[.184801,.065732,.387973],[.19146,.064818,.396152],[.198177,.063862,.404009],[.204935,.062907,.411514],[.211718,.061992,.418647],[.218512,.061158,.425392],[.225302,.060445,.431742],[.232077,.059889,.437695],[.238826,.059517,.443256],[.245543,.059352,.448436],[.25222,.059415,.453248],[.258857,.059706,.45771],[.265447,.060237,.46184],[.271994,.060994,.46566],[.278493,.061978,.46919],[.284951,.063168,.472451],[.291366,.064553,.475462],[.29774,.066117,.478243],[.304081,.067835,.480812],[.310382,.069702,.483186],[.316654,.07169,.48538],[.322899,.073782,.487408],[.329114,.075972,.489287],[.335308,.078236,.491024],[.341482,.080564,.492631],[.347636,.082946,.494121],[.353773,.085373,.495501],[.359898,.087831,.496778],[.366012,.090314,.49796],[.372116,.092816,.499053],[.378211,.095332,.500067],[.384299,.097855,.501002],[.390384,.100379,.501864],[.396467,.102902,.502658],[.402548,.10542,.503386],[.408629,.10793,.504052],[.414709,.110431,.504662],[.420791,.11292,.505215],[.426877,.115395,.505714],[.432967,.117855,.50616],[.439062,.120298,.506555],[.445163,.122724,.506901],[.451271,.125132,.507198],[.457386,.127522,.507448],[.463508,.129893,.507652],[.46964,.132245,.507809],[.47578,.134577,.507921],[.481929,.136891,.507989],[.488088,.139186,.508011],[.494258,.141462,.507988],[.500438,.143719,.50792],[.506629,.145958,.507806],[.512831,.148179,.507648],[.519045,.150383,.507443],[.52527,.152569,.507192],[.531507,.154739,.506895],[.537755,.156894,.506551],[.544015,.159033,.506159],[.550287,.161158,.505719],[.556571,.163269,.50523],[.562866,.165368,.504692],[.569172,.167454,.504105],[.57549,.16953,.503466],[.581819,.171596,.502777],[.588158,.173652,.502035],[.594508,.175701,.501241],[.600868,.177743,.500394],[.607238,.179779,.499492],[.613617,.181811,.498536],[.620005,.18384,.497524],[.626401,.185867,.496456],[.632805,.187893,.495332],[.639216,.189921,.49415],[.645633,.191952,.49291],[.652056,.193986,.491611],[.658483,.196027,.490253],[.664915,.198075,.488836],[.671349,.200133,.487358],[.677786,.202203,.485819],[.684224,.204286,.484219],[.690661,.206384,.482558],[.697098,.208501,.480835],[.703532,.210638,.479049],[.709962,.212797,.477201],[.716387,.214982,.47529],[.722805,.217194,.473316],[.729216,.219437,.471279],[.735616,.221713,.46918],[.742004,.224025,.467018],[.748378,.226377,.464794],[.754737,.228772,.462509],[.761077,.231214,.460162],[.767398,.233705,.457755],[.773695,.236249,.455289],[.779968,.238851,.452765],[.786212,.241514,.450184],[.792427,.244242,.447543],[.798608,.24704,.444848],[.804752,.249911,.442102],[.810855,.252861,.439305],[.816914,.255895,.436461],[.822926,.259016,.433573],[.828886,.262229,.430644],[.834791,.26554,.427671],[.840636,.268953,.424666],[.846416,.272473,.421631],[.852126,.276106,.418573],[.857763,.279857,.415496],[.86332,.283729,.412403],[.868793,.287728,.409303],[.874176,.291859,.406205],[.879464,.296125,.403118],[.884651,.30053,.400047],[.889731,.305079,.397002],[.8947,.309773,.393995],[.899552,.314616,.391037],[.904281,.31961,.388137],[.908884,.324755,.385308],[.913354,.330052,.382563],[.917689,.3355,.379915],[.921884,.341098,.377376],[.925937,.346844,.374959],[.929845,.352734,.372677],[.933606,.358764,.370541],[.937221,.364929,.368567],[.940687,.371224,.366762],[.944006,.377643,.365136],[.94718,.384178,.363701],[.95021,.39082,.362468],[.953099,.397563,.361438],[.955849,.4044,.360619],[.958464,.411324,.360014],[.960949,.418323,.35963],[.96331,.42539,.359469],[.965549,.432519,.359529],[.967671,.439703,.35981],[.96968,.446936,.360311],[.971582,.45421,.36103],[.973381,.46152,.361965],[.975082,.468861,.363111],[.97669,.476226,.364466],[.97821,.483612,.366025],[.979645,.491014,.367783],[.981,.498428,.369734],[.982279,.505851,.371874],[.983485,.51328,.374198],[.984622,.520713,.376698],[.985693,.528148,.379371],[.9867,.535582,.38221],[.987646,.543015,.38521],[.988533,.550446,.388365],[.989363,.557873,.391671],[.990138,.565296,.395122],[.990871,.572706,.398714],[.991558,.580107,.402441],[.992196,.587502,.406299],[.992785,.594891,.410283],[.993326,.602275,.41439],[.993834,.609644,.418613],[.994309,.616999,.42295],[.994738,.62435,.427397],[.995122,.631696,.431951],[.99548,.639027,.436607],[.99581,.646344,.441361],[.996096,.653659,.446213],[.996341,.660969,.45116],[.99658,.668256,.456192],[.996775,.675541,.461314],[.996925,.682828,.466526],[.997077,.690088,.471811],[.997186,.697349,.477182],[.997254,.704611,.482635],[.997325,.711848,.488154],[.997351,.719089,.493755],[.997351,.726324,.499428],[.997341,.733545,.505167],[.997285,.740772,.510983],[.997228,.747981,.516859],[.997138,.75519,.522806],[.997019,.762398,.528821],[.996898,.769591,.534892],[.996727,.776795,.541039],[.996571,.783977,.547233],[.996369,.791167,.553499],[.996162,.798348,.55982],[.995932,.805527,.566202],[.99568,.812706,.572645],[.995424,.819875,.57914],[.995131,.827052,.585701],[.994851,.834213,.592307],[.994524,.841387,.598983],[.994222,.84854,.605696],[.993866,.855711,.612482],[.993545,.862859,.619299],[.99317,.870024,.626189],[.992831,.877168,.633109],[.99244,.88433,.640099],[.992089,.89147,.647116],[.991688,.898627,.654202],[.991332,.905763,.661309],[.99093,.912915,.668481],[.99057,.920049,.675675],[.990175,.927196,.682926],[.989815,.934329,.690198],[.989434,.94147,.697519],[.989077,.948604,.704863],[.988717,.955742,.712242],[.988367,.962878,.719649],[.988033,.970012,.727077],[.987691,.977154,.734536],[.987387,.984288,.742002],[.987053,.991438,.749504]])),e.checkNew(new e.Colormap("inferno",[[.001462,466e-6,.013866],[.002267,.00127,.01857],[.003299,.002249,.024239],[.004547,.003392,.030909],[.006006,.004692,.038558],[.007676,.006136,.046836],[.009561,.007713,.055143],[.011663,.009417,.06346],[.013995,.011225,.071862],[.016561,.013136,.080282],[.019373,.015133,.088767],[.022447,.017199,.097327],[.025793,.019331,.10593],[.029432,.021503,.114621],[.033385,.023702,.123397],[.037668,.025921,.132232],[.042253,.028139,.141141],[.046915,.030324,.150164],[.051644,.032474,.159254],[.056449,.034569,.168414],[.06134,.03659,.177642],[.066331,.038504,.186962],[.071429,.040294,.196354],[.076637,.041905,.205799],[.081962,.043328,.215289],[.087411,.044556,.224813],[.09299,.045583,.234358],[.098702,.046402,.243904],[.104551,.047008,.25343],[.110536,.047399,.262912],[.116656,.047574,.272321],[.122908,.047536,.281624],[.129285,.047293,.290788],[.135778,.046856,.299776],[.142378,.046242,.308553],[.149073,.045468,.317085],[.15585,.044559,.325338],[.162689,.043554,.333277],[.169575,.042489,.340874],[.176493,.041402,.348111],[.183429,.040329,.354971],[.190367,.039309,.361447],[.197297,.0384,.367535],[.204209,.037632,.373238],[.211095,.03703,.378563],[.217949,.036615,.383522],[.224763,.036405,.388129],[.231538,.036405,.3924],[.238273,.036621,.396353],[.244967,.037055,.400007],[.25162,.037705,.403378],[.258234,.038571,.406485],[.26481,.039647,.409345],[.271347,.040922,.411976],[.27785,.042353,.414392],[.284321,.043933,.416608],[.290763,.045644,.418637],[.297178,.04747,.420491],[.303568,.049396,.422182],[.309935,.051407,.423721],[.316282,.05349,.425116],[.32261,.055634,.426377],[.328921,.057827,.427511],[.335217,.06006,.428524],[.3415,.062325,.429425],[.347771,.064616,.430217],[.354032,.066925,.430906],[.360284,.069247,.431497],[.366529,.071579,.431994],[.372768,.073915,.4324],[.379001,.076253,.432719],[.385228,.078591,.432955],[.391453,.080927,.433109],[.397674,.083257,.433183],[.403894,.08558,.433179],[.410113,.087896,.433098],[.416331,.090203,.432943],[.422549,.092501,.432714],[.428768,.09479,.432412],[.434987,.097069,.432039],[.441207,.099338,.431594],[.447428,.101597,.43108],[.453651,.103848,.430498],[.459875,.106089,.429846],[.4661,.108322,.429125],[.472328,.110547,.428334],[.478558,.112764,.427475],[.484789,.114974,.426548],[.491022,.117179,.425552],[.497257,.119379,.424488],[.503493,.121575,.423356],[.50973,.123769,.422156],[.515967,.12596,.420887],[.522206,.12815,.419549],[.528444,.130341,.418142],[.534683,.132534,.416667],[.54092,.134729,.415123],[.547157,.136929,.413511],[.553392,.139134,.411829],[.559624,.141346,.410078],[.565854,.143567,.408258],[.572081,.145797,.406369],[.578304,.148039,.404411],[.584521,.150294,.402385],[.590734,.152563,.40029],[.59694,.154848,.398125],[.603139,.157151,.395891],[.60933,.159474,.393589],[.615513,.161817,.391219],[.621685,.164184,.388781],[.627847,.166575,.386276],[.633998,.168992,.383704],[.640135,.171438,.381065],[.64626,.173914,.378359],[.652369,.176421,.375586],[.658463,.178962,.372748],[.66454,.181539,.369846],[.670599,.184153,.366879],[.676638,.186807,.363849],[.682656,.189501,.360757],[.688653,.192239,.357603],[.694627,.195021,.354388],[.700576,.197851,.351113],[.7065,.200728,.347777],[.712396,.203656,.344383],[.718264,.206636,.340931],[.724103,.20967,.337424],[.729909,.212759,.333861],[.735683,.215906,.330245],[.741423,.219112,.326576],[.747127,.222378,.322856],[.752794,.225706,.319085],[.758422,.229097,.315266],[.76401,.232554,.311399],[.769556,.236077,.307485],[.775059,.239667,.303526],[.780517,.243327,.299523],[.785929,.247056,.295477],[.791293,.250856,.29139],[.796607,.254728,.287264],[.801871,.258674,.283099],[.807082,.262692,.278898],[.812239,.266786,.274661],[.817341,.270954,.27039],[.822386,.275197,.266085],[.827372,.279517,.26175],[.832299,.283913,.257383],[.837165,.288385,.252988],[.841969,.292933,.248564],[.846709,.297559,.244113],[.851384,.30226,.239636],[.855992,.307038,.235133],[.860533,.311892,.230606],[.865006,.316822,.226055],[.869409,.321827,.221482],[.873741,.326906,.216886],[.878001,.33206,.212268],[.882188,.337287,.207628],[.886302,.342586,.202968],[.890341,.347957,.198286],[.894305,.353399,.193584],[.898192,.358911,.18886],[.902003,.364492,.184116],[.905735,.37014,.17935],[.90939,.375856,.174563],[.912966,.381636,.169755],[.916462,.387481,.164924],[.919879,.393389,.16007],[.923215,.399359,.155193],[.92647,.405389,.150292],[.929644,.411479,.145367],[.932737,.417627,.140417],[.935747,.423831,.13544],[.938675,.430091,.130438],[.941521,.436405,.125409],[.944285,.442772,.120354],[.946965,.449191,.115272],[.949562,.45566,.110164],[.952075,.462178,.105031],[.954506,.468744,.099874],[.956852,.475356,.094695],[.959114,.482014,.089499],[.961293,.488716,.084289],[.963387,.495462,.079073],[.965397,.502249,.073859],[.967322,.509078,.068659],[.969163,.515946,.063488],[.970919,.522853,.058367],[.97259,.529798,.053324],[.974176,.53678,.048392],[.975677,.543798,.043618],[.977092,.55085,.03905],[.978422,.557937,.034931],[.979666,.565057,.031409],[.980824,.572209,.028508],[.981895,.579392,.02625],[.982881,.586606,.024661],[.983779,.593849,.02377],[.984591,.601122,.023606],[.985315,.608422,.024202],[.985952,.61575,.025592],[.986502,.623105,.027814],[.986964,.630485,.030908],[.987337,.63789,.034916],[.987622,.64532,.039886],[.987819,.652773,.045581],[.987926,.66025,.05175],[.987945,.667748,.058329],[.987874,.675267,.065257],[.987714,.682807,.072489],[.987464,.690366,.07999],[.987124,.697944,.087731],[.986694,.70554,.095694],[.986175,.713153,.103863],[.985566,.720782,.112229],[.984865,.728427,.120785],[.984075,.736087,.129527],[.983196,.743758,.138453],[.982228,.751442,.147565],[.981173,.759135,.156863],[.980032,.766837,.166353],[.978806,.774545,.176037],[.977497,.782258,.185923],[.976108,.789974,.196018],[.974638,.797692,.206332],[.973088,.805409,.216877],[.971468,.813122,.227658],[.969783,.820825,.238686],[.968041,.828515,.249972],[.966243,.836191,.261534],[.964394,.843848,.273391],[.962517,.851476,.285546],[.960626,.859069,.29801],[.95872,.866624,.31082],[.956834,.874129,.323974],[.954997,.881569,.337475],[.953215,.888942,.351369],[.951546,.896226,.365627],[.950018,.903409,.380271],[.948683,.910473,.395289],[.947594,.917399,.410665],[.946809,.924168,.426373],[.946392,.930761,.442367],[.946403,.937159,.458592],[.946903,.943348,.47497],[.947937,.949318,.491426],[.949545,.955063,.50786],[.95174,.960587,.524203],[.954529,.965896,.540361],[.957896,.971003,.556275],[.961812,.975924,.571925],[.966249,.980678,.587206],[.971162,.985282,.602154],[.976511,.989753,.61676],[.982257,.994109,.631017],[.988362,.998364,.644924]])),e.checkNew(new e.Colormap("plasma",[[.050383,.029803,.527975],[.063536,.028426,.533124],[.075353,.027206,.538007],[.086222,.026125,.542658],[.096379,.025165,.547103],[.10598,.024309,.551368],[.115124,.023556,.555468],[.123903,.022878,.559423],[.132381,.022258,.56325],[.140603,.021687,.566959],[.148607,.021154,.570562],[.156421,.020651,.574065],[.16407,.020171,.577478],[.171574,.019706,.580806],[.17895,.019252,.584054],[.186213,.018803,.587228],[.193374,.018354,.59033],[.200445,.017902,.593364],[.207435,.017442,.596333],[.21435,.016973,.599239],[.221197,.016497,.602083],[.227983,.016007,.604867],[.234715,.015502,.607592],[.241396,.014979,.610259],[.248032,.014439,.612868],[.254627,.013882,.615419],[.261183,.013308,.617911],[.267703,.012716,.620346],[.274191,.012109,.622722],[.280648,.011488,.625038],[.287076,.010855,.627295],[.293478,.010213,.62949],[.299855,.009561,.631624],[.30621,.008902,.633694],[.312543,.008239,.6357],[.318856,.007576,.63764],[.32515,.006915,.639512],[.331426,.006261,.641316],[.337683,.005618,.643049],[.343925,.004991,.64471],[.35015,.004382,.646298],[.356359,.003798,.64781],[.362553,.003243,.649245],[.368733,.002724,.650601],[.374897,.002245,.651876],[.381047,.001814,.653068],[.387183,.001434,.654177],[.393304,.001114,.655199],[.399411,859e-6,.656133],[.405503,678e-6,.656977],[.41158,577e-6,.65773],[.417642,564e-6,.65839],[.423689,646e-6,.658956],[.429719,831e-6,.659425],[.435734,.001127,.659797],[.441732,.00154,.660069],[.447714,.00208,.66024],[.453677,.002755,.66031],[.459623,.003574,.660277],[.46555,.004545,.660139],[.471457,.005678,.659897],[.477344,.00698,.659549],[.48321,.00846,.659095],[.489055,.010127,.658534],[.494877,.01199,.657865],[.500678,.014055,.657088],[.506454,.016333,.656202],[.512206,.018833,.655209],[.517933,.021563,.654109],[.523633,.024532,.652901],[.529306,.027747,.651586],[.534952,.031217,.650165],[.54057,.03495,.64864],[.546157,.038954,.64701],[.551715,.043136,.645277],[.557243,.047331,.643443],[.562738,.051545,.641509],[.568201,.055778,.639477],[.573632,.060028,.637349],[.579029,.064296,.635126],[.584391,.068579,.632812],[.589719,.072878,.630408],[.595011,.07719,.627917],[.600266,.081516,.625342],[.605485,.085854,.622686],[.610667,.090204,.619951],[.615812,.094564,.61714],[.620919,.098934,.614257],[.625987,.103312,.611305],[.631017,.107699,.608287],[.636008,.112092,.605205],[.640959,.116492,.602065],[.645872,.120898,.598867],[.650746,.125309,.595617],[.65558,.129725,.592317],[.660374,.134144,.588971],[.665129,.138566,.585582],[.669845,.142992,.582154],[.674522,.147419,.578688],[.67916,.151848,.575189],[.683758,.156278,.57166],[.688318,.160709,.568103],[.69284,.165141,.564522],[.697324,.169573,.560919],[.701769,.174005,.557296],[.706178,.178437,.553657],[.710549,.182868,.550004],[.714883,.187299,.546338],[.719181,.191729,.542663],[.723444,.196158,.538981],[.72767,.200586,.535293],[.731862,.205013,.531601],[.736019,.209439,.527908],[.740143,.213864,.524216],[.744232,.218288,.520524],[.748289,.222711,.516834],[.752312,.227133,.513149],[.756304,.231555,.509468],[.760264,.235976,.505794],[.764193,.240396,.502126],[.76809,.244817,.498465],[.771958,.249237,.494813],[.775796,.253658,.491171],[.779604,.258078,.487539],[.783383,.2625,.483918],[.787133,.266922,.480307],[.790855,.271345,.476706],[.794549,.27577,.473117],[.798216,.280197,.469538],[.801855,.284626,.465971],[.805467,.289057,.462415],[.809052,.293491,.45887],[.812612,.297928,.455338],[.816144,.302368,.451816],[.819651,.306812,.448306],[.823132,.311261,.444806],[.826588,.315714,.441316],[.830018,.320172,.437836],[.833422,.324635,.434366],[.836801,.329105,.430905],[.840155,.33358,.427455],[.843484,.338062,.424013],[.846788,.342551,.420579],[.850066,.347048,.417153],[.853319,.351553,.413734],[.856547,.356066,.410322],[.85975,.360588,.406917],[.862927,.365119,.403519],[.866078,.36966,.400126],[.869203,.374212,.396738],[.872303,.378774,.393355],[.875376,.383347,.389976],[.878423,.387932,.3866],[.881443,.392529,.383229],[.884436,.397139,.37986],[.887402,.401762,.376494],[.89034,.406398,.37313],[.89325,.411048,.369768],[.896131,.415712,.366407],[.898984,.420392,.363047],[.901807,.425087,.359688],[.904601,.429797,.356329],[.907365,.434524,.35297],[.910098,.439268,.34961],[.9128,.444029,.346251],[.915471,.448807,.34289],[.918109,.453603,.339529],[.920714,.458417,.336166],[.923287,.463251,.332801],[.925825,.468103,.329435],[.928329,.472975,.326067],[.930798,.477867,.322697],[.933232,.48278,.319325],[.93563,.487712,.315952],[.93799,.492667,.312575],[.940313,.497642,.309197],[.942598,.502639,.305816],[.944844,.507658,.302433],[.947051,.512699,.299049],[.949217,.517763,.295662],[.951344,.52285,.292275],[.953428,.52796,.288883],[.95547,.533093,.28549],[.957469,.53825,.282096],[.959424,.543431,.278701],[.961336,.548636,.275305],[.963203,.553865,.271909],[.965024,.559118,.268513],[.966798,.564396,.265118],[.968526,.5697,.261721],[.970205,.575028,.258325],[.971835,.580382,.254931],[.973416,.585761,.25154],[.974947,.591165,.248151],[.976428,.596595,.244767],[.977856,.602051,.241387],[.979233,.607532,.238013],[.980556,.613039,.234646],[.981826,.618572,.231287],[.983041,.624131,.227937],[.984199,.629718,.224595],[.985301,.63533,.221265],[.986345,.640969,.217948],[.987332,.646633,.214648],[.98826,.652325,.211364],[.989128,.658043,.2081],[.989935,.663787,.204859],[.990681,.669558,.201642],[.991365,.675355,.198453],[.991985,.681179,.195295],[.992541,.68703,.19217],[.993032,.692907,.189084],[.993456,.69881,.186041],[.993814,.704741,.183043],[.994103,.710698,.180097],[.994324,.716681,.177208],[.994474,.722691,.174381],[.994553,.728728,.171622],[.994561,.734791,.168938],[.994495,.74088,.166335],[.994355,.746995,.163821],[.994141,.753137,.161404],[.993851,.759304,.159092],[.993482,.765499,.156891],[.993033,.77172,.154808],[.992505,.777967,.152855],[.991897,.784239,.151042],[.991209,.790537,.149377],[.990439,.796859,.14787],[.989587,.803205,.146529],[.988648,.809579,.145357],[.987621,.815978,.144363],[.986509,.822401,.143557],[.985314,.828846,.142945],[.984031,.835315,.142528],[.982653,.841812,.142303],[.98119,.848329,.142279],[.979644,.854866,.142453],[.977995,.861432,.142808],[.976265,.868016,.143351],[.974443,.874622,.144061],[.97253,.88125,.144923],[.970533,.887896,.145919],[.968443,.894564,.147014],[.966271,.901249,.14818],[.964021,.90795,.14937],[.961681,.914672,.15052],[.959276,.921407,.151566],[.956808,.928152,.152409],[.954287,.934908,.152921],[.951726,.941671,.152925],[.949151,.948435,.152178],[.946602,.95519,.150328],[.944152,.961916,.146861],[.941896,.96859,.140956],[.940015,.975158,.131326]])),e.checkNew(new e.Colormap("i8",[[0,0,0],[0,1,0],[0,0,1],[0,1,1],[1,0,0],[1,1,0],[1,0,1],[1,1,1]])),e.checkNew(new e.Colormap("aips0",[[.196,.196,.196],[.475,0,.608],[0,0,.785],[.373,.655,.925],[0,.596,0],[0,.965,0],[1,1,0],[1,.694,0],[1,0,0]])),e.checkNew(new e.Colormap("sls",[[0,0,0],[.043442,0,.052883],[.086883,0,.105767],[.130325,0,.15865],[.173767,0,.211533],[.217208,0,.264417],[.26065,0,.3173],[.304092,0,.370183],[.347533,0,.423067],[.390975,0,.47595],[.434417,0,.528833],[.477858,0,.581717],[.5213,0,.6346],[.506742,0,.640217],[.492183,0,.645833],[.477625,0,.65145],[.463067,0,.657067],[.448508,0,.662683],[.43395,0,.6683],[.419392,0,.673917],[.404833,0,.679533],[.390275,0,.68515],[.375717,0,.690767],[.361158,0,.696383],[.3466,0,.702],[.317717,0,.712192],[.288833,0,.722383],[.25995,0,.732575],[.231067,0,.742767],[.202183,0,.752958],[.1733,0,.76315],[.144417,0,.773342],[.115533,0,.783533],[.08665,0,.793725],[.057767,0,.803917],[.028883,0,.814108],[0,0,.8243],[0,.019817,.838942],[0,.039633,.853583],[0,.05945,.868225],[0,.079267,.882867],[0,.099083,.897508],[0,.1189,.91215],[0,.138717,.926792],[0,.158533,.941433],[0,.17835,.956075],[0,.198167,.970717],[0,.217983,.985358],[0,.2378,1],[0,.268533,1],[0,.299267,1],[0,.33,1],[0,.360733,1],[0,.391467,1],[0,.4222,1],[0,.452933,1],[0,.483667,1],[0,.5144,1],[0,.545133,1],[0,.575867,1],[0,.6066,1],[0,.631733,.9753],[0,.656867,.9506],[0,.682,.9259],[0,.707133,.9012],[0,.732267,.8765],[0,.7574,.8518],[0,.782533,.8271],[0,.807667,.8024],[0,.8328,.7777],[0,.857933,.753],[0,.883067,.7283],[0,.9082,.7036],[0,.901908,.676675],[0,.895617,.64975],[0,.889325,.622825],[0,.883033,.5959],[0,.876742,.568975],[0,.87045,.54205],[0,.864158,.515125],[0,.857867,.4882],[0,.851575,.461275],[0,.845283,.43435],[0,.838992,.407425],[0,.8327,.3805],[0,.832308,.354858],[0,.831917,.329217],[0,.831525,.303575],[0,.831133,.277933],[0,.830742,.252292],[0,.83035,.22665],[0,.829958,.201008],[0,.829567,.175367],[0,.829175,.149725],[0,.828783,.124083],[0,.828392,.098442],[0,.828,.0728],[.033167,.834167,.066733],[.066333,.840333,.060667],[.0995,.8465,.0546],[.132667,.852667,.048533],[.165833,.858833,.042467],[.199,.865,.0364],[.232167,.871167,.030333],[.265333,.877333,.024267],[.2985,.8835,.0182],[.331667,.889667,.012133],[.364833,.895833,.006067],[.398,.902,0],[.43095,.902,0],[.4639,.902,0],[.49685,.902,0],[.5298,.902,0],[.56275,.902,0],[.5957,.902,0],[.62865,.902,0],[.6616,.902,0],[.69455,.902,0],[.7275,.902,0],[.76045,.902,0],[.7934,.902,0],[.810617,.897133,.003983],[.827833,.892267,.007967],[.84505,.8874,.01195],[.862267,.882533,.015933],[.879483,.877667,.019917],[.8967,.8728,.0239],[.913917,.867933,.027883],[.931133,.863067,.031867],[.94835,.8582,.03585],[.965567,.853333,.039833],[.982783,.848467,.043817],[1,.8436,.0478],[.995725,.824892,.0516],[.99145,.806183,.0554],[.987175,.787475,.0592],[.9829,.768767,.063],[.978625,.750058,.0668],[.97435,.73135,.0706],[.970075,.712642,.0744],[.9658,.693933,.0782],[.961525,.675225,.082],[.95725,.656517,.0858],[.952975,.637808,.0896],[.9487,.6191,.0934],[.952975,.600408,.085617],[.95725,.581717,.077833],[.961525,.563025,.07005],[.9658,.544333,.062267],[.970075,.525642,.054483],[.97435,.50695,.0467],[.978625,.488258,.038917],[.9829,.469567,.031133],[.987175,.450875,.02335],[.99145,.432183,.015567],[.995725,.413492,.007783],[1,.3948,0],[.998342,.3619,0],[.996683,.329,0],[.995025,.2961,0],[.993367,.2632,0],[.991708,.2303,0],[.99005,.1974,0],[.988392,.1645,0],[.986733,.1316,0],[.985075,.0987,0],[.983417,.0658,0],[.981758,.0329,0],[.9801,0,0],[.955925,0,0],[.93175,0,0],[.907575,0,0],[.8834,0,0],[.859225,0,0],[.83505,0,0],[.810875,0,0],[.7867,0,0],[.762525,0,0],[.73835,0,0],[.714175,0,0],[.69,0,0],[.715833,.083333,.083333],[.741667,.166667,.166667],[.7675,.25,.25],[.793333,.333333,.333333],[.819167,.416667,.416667],[.845,.5,.5],[.870833,.583333,.583333],[.896667,.666667,.666667],[.9225,.75,.75],[.948333,.833333,.833333],[.974167,.916667,.916667],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1],[1,1,1]])),e.checkNew(new e.Colormap("a",[[0,0],[.25,0],[.5,1],[1,1]],[[0,0],[.25,1],[.5,0],[.77,0],[1,1]],[[0,0],[.125,0],[.5,1],[.64,.5],[.77,0],[1,0]])),e.checkNew(new e.Colormap("b",[[0,0],[.25,0],[.5,1],[1,1]],[[0,0],[.5,0],[.75,1],[1,1]],[[0,0],[.25,1],[.5,0],[.75,0],[1,1]])),e.checkNew(new e.Colormap("bb",[[0,0],[.5,1],[1,1]],[[0,0],[.25,0],[.75,1],[1,1]],[[0,0],[.5,0],[1,1]])),e.checkNew(new e.Colormap("he",[[0,0],[.015,.5],[.25,.5],[.5,.75],[1,1]],[[0,0],[.065,0],[.125,.5],[.25,.75],[.5,.81],[1,1]],[[0,0],[.015,.125],[.03,.375],[.065,.625],[.25,.25],[1,1]])),e.checkNew(new e.Colormap("hsv",function(){var e,t,i,s,a,n,r,o=[],l=0;for(e=0;200>e;e++,l++){for(i=360*(t=1-e/199)+270,s=Math.abs(Math.sin(3.1416*t)),t=Math.pow(1-t,1/3);360<=i;)i-=360;switch(a=(i/=60)-(r=Math.floor(i)),i=t*(1-s),n=t*(1-s*a),s=t*(1-s*(1-a)),o[l]=[],r){case 0:o[l].push(t),o[l].push(s),o[l].push(i);break;case 1:o[l].push(n),o[l].push(t),o[l].push(i);break;case 2:o[l].push(i),o[l].push(t),o[l].push(s);break;case 3:o[l].push(i),o[l].push(n),o[l].push(t);break;case 4:o[l].push(s),o[l].push(i),o[l].push(t);break;case 5:o[l].push(t),o[l].push(i),o[l].push(n)}}return o}())),e.checkNew(new e.Colormap("rainbow",[[0,1],[.2,0],[.6,0],[.8,1],[1,1]],[[0,0],[.2,0],[.4,1],[.8,1],[1,0]],[[0,1],[.4,1],[.6,0],[1,0]])),e.checkNew(new e.Colormap("standard",[[0,0],[.333,.3],[.333,0],[.666,.3],[.666,.3],[1,1]],[[0,0],[.333,.3],[.333,.3],[.666,1],[.666,0],[1,.3]],[[0,0],[.333,1],[.333,0],[.666,.3],[.666,0],[1,.3]])),e.checkNew(new e.Colormap("staircase",function(){var e,t,i=[],s=0;for(e=1;5>=e;e++,s++)t=e/5,i[s]=[],i[s].push(.3*t),i[s].push(.3*t),i[s].push(t);for(e=1;5>=e;e++,s++)t=e/5,i[s]=[],i[s].push(.3*t),i[s].push(t),i[s].push(.3*t);for(e=1;5>=e;e++,s++)t=e/5,i[s]=[],i[s].push(t),i[s].push(.3*t),i[s].push(.3*t);return i}())),e.checkNew(new e.Colormap("color",[[0,0,0],[.18431,.18431,.18431],[.37255,.37255,.37255],[.56078,.56078,.56078],[.74902,.74902,.74902],[.93725,.93725,.93725],[0,.18431,.93725],[0,.37255,.74902],[0,.49804,.49804],[0,.74902,.3098],[0,.93725,0],[.3098,.62353,0],[.49804,.49804,0],[.62353,.3098,0],[.93725,0,0],[.74902,0,.3098]])))},e.initCommands=function(){e.hasOwnProperty("Command")&&(e.checkNew(new e.Command({name:"analysis",alias:"run",help:"list/run analysis for current image",get:function(){var e,t,i,s,a="",n=this.image;if(n&&n.analysisPackages)for(t=0;t<n.analysisPackages.length;t++){for(s=n.analysisPackages[t],e=0;e<s.length;e++)a&&(a+=", "),a+=sprintf("%s (%s)",(i=s[e]).title,i.xclass?i.xclass+":"+i.name:i.name);t<n.analysisPackages.length-1&&(a+="\n")}return a},set:function(t){var i,s=this.image;s&&((i=s.lookupAnalysis(t[0]))?i.purl?(t=s.displayAnalysis("params",e.InstallDir(i.purl),{title:i.title+": "+s.fitsFile}),$(t).data("dispid",s.display.id).data("aname",i.name)):s.runAnalysis(i.name):e.error("unknown analysis command '"+t[0]+"'"))}})),e.checkNew(new e.Command({name:"colormap",alias:"cmap",help:"set/get colormap for current image",get:function(){var e;if(e=this.image)return sprintf("%s %s %s",(e=e.getColormap()).colormap,e.contrast,e.bias)},set:function(e){var t=this.image;t&&t.setColormap.apply(t,e)}})),e.checkNew(new e.Command({name:"colormaps",alias:"cmaps",help:"get list of available colormaps",get:function(){var t,i="";for(t=0;t<e.colormaps.length;t++)i&&(i+=", "),i+=e.colormaps[t].name;return i}})),e.checkNew(new e.Command({name:"grid",help:"set/get coordinate grid for current image",get:function(){var e,t=this.image;return t&&(e=t.displayCoordGrid()),e?"true":"false"},set:function(e){var t,i=this.image;i&&(t=!!e[0].match(/true/i),i.displayCoordGrid(t,e[1]))}})),e.checkNew(new e.Command({name:"help",help:"get list of available commmands",get:function(){var t,i,s;for(s="<table>",t=0;t<e.commands.length;t++)s+="<tr><td>"+(i=e.commands[t]).name+"</td><td>"+i.help,i.alias&&(s+=" ("+i.alias,i.alias2&&(s+=", "+i.alias2),s+=")"),s+="</td></tr>";return s+"</table>"}})),e.checkNew(new e.Command({name:"helper",help:"get/set helper connection",get:function(){return e.helper.connectinfo()},set:function(t){e.helper.connect(t[0].trim())}})),e.checkNew(new e.Command({name:"image",help:"get name of currently loaded image or display specified image",get:function(){var e=this.image;if(e)return e.file},set:function(t){var i,s;for(i=0;i<e.images.length;i++)if(0<=(s=e.images[i]).file.search(t[0])&&s.display===this.display){s.displayImage("display");break}}})),e.checkNew(new e.Command({name:"images",help:"get list of currently loaded images",get:function(){var t,i,s="";for(t=0;t<e.images.length;t++)(i=e.images[t]).display===this.display&&(s&&(s+=", "),s+=i.file);return s}})),e.checkNew(new e.Command({name:"load",help:"load image(s)",set:function(t){var i,s,a,n=t.length;for(i=0;i<n;i++){if(a=null,(s=i+1)<n&&0===t[s].indexOf("{"))try{a=JSON.parse(t[s])}catch(r){a=null}a?(e.Load(t[i],a,{display:this.display.id}),i++):e.Load(t[i],{display:this.display.id})}}})),e.checkNew(new e.Command({name:"pan",help:"set/get pan location for current image",get:function(){var e;if(e=this.image)return sprintf("%s %s",(e=e.getPan()).x,e.y)},set:function(e){var t=this.image;t&&t.setPan.apply(t,e)}})),e.checkNew(new e.Command({name:"pix2wcs",help:"get image pixel value for specified wcs position",set:function(t){var i=this.image;if(i)return(t=e.Pix2WCS(parseFloat(t[0]),parseFloat(t[1]),{display:i})).str}})),e.checkNew(new e.Command({name:"print",help:"print image window",get:function(){var e=this.image;e&&e.print()}})),e.checkNew(new e.Command({name:"refresh",help:"refresh current image using specified file (def: use last file)",set:function(t){var i,s,a,n=t.length;if(i=this.image,0===n)e.Load(i.file,a={refresh:i},{display:this.display.id});else for(i=0;i<n;i++){if(a=null,(s=i+1)<n&&0===t[s].indexOf("{"))try{a=JSON.parse(t[s])}catch(r){a=null}a?(a.refresh=!0,e.Load(t[i],a,{display:this.display.id}),i++):e.Load(t[i],a={refresh:!0},{display:this.display.id})}}})),e.checkNew(new e.Command({name:"regcnts",help:"counts in regions for current image",get:function(){var e=this.image;e&&e.countsInRegions("$sregions","$bregions",{lightwin:!0})},set:function(e){var t=this.image;if(t)return t.countsInRegions.apply(t,e)}})),e.checkNew(new e.Command({name:"regions",alias:"reg",alias2:"region",help:"add region to current image or list all regions",get:function(){var e=this.image;if(e)return e.listRegions("all",{mode:0})||""},set:function(e){var t=this.image;t&&("delete"===e[0]||"remove"===e[0]?(e=e.slice(1).join(" "),t.removeShapes("regions",e)):(e=e.join(" "),t.addShapes("regions",e)))}})),e.checkNew(new e.Command({name:"resize",help:"get/set display size for current image",get:function(){var e;if(e=this.image)return sprintf("%s %s",(e=e.display).width,e.height)},set:function(e){var t,i;(t=this.image)&&e.length&&(t=t.display,i=parseInt(e[0],10),e=1<e.length?parseInt(e[1],10):i,t.resize(i,e))}})),e.checkNew(new e.Command({name:"scale",help:"set/get scaling for current image",get:function(){var e;if(e=this.image)return sprintf("%s %s %s",(e=e.getScale()).scale,e.scalemin,e.scalemax)},set:function(e){var t=this.image;t&&t.setScale.apply(t,e)}})),e.checkNew(new e.Command({name:"scales",help:"get list of available scales",get:function(){return e.scales.join(", ")}})),e.checkNew(new e.Command({name:"section",help:"display section of current image",set:function(t){var i,s=this.image;if(1===t.length&&"full"===t[0])s.displaySection("full");else{t=t.join(" ");try{i=JSON.parse(t)}catch(a){e.error("invalid JSON section")}s.displaySection(i)}}})),e.checkNew(new e.Command({name:"status",help:"get status for specified (or current) image",get:function(t){var i,s,a,n="";for(i=0;i<e.images.length;i++)if(0<=(s=e.images[i]).file.search(t[0])){a=s;break}if(a?i=1:(i=0,a=this.image),a){if(i>t.length)return a.status.load;for(;i<t.length;i++)switch(s=t[i].toLowerCase().trim(),s){case"load":n&&(n+="\n"),n+=a.status.load}}return n}})),e.checkNew(new e.Command({name:"url",help:"display a url",set:function(t){e.DisplayHelp(t[0])}})),e.checkNew(new e.Command({name:"wcssys",help:"set/get wcs system for current image",get:function(){var e=this.image;if(e)return e.getWCSSys()},set:function(e){var t=this.image;t&&t.setWCSSys(e[0])}})),e.checkNew(new e.Command({name:"wcsu",help:"set/get wcs units used for current image",get:function(){var e=this.image;if(e)return e.getWCSUnits()},set:function(e){var t=this.image;t&&t.setWCSUnits(e[0])}})),e.checkNew(new e.Command({name:"wcssystems",help:"get list of available wcs systems",get:function(){return e.wcssyss.join(", ")}})),e.checkNew(new e.Command({name:"wcsunits",help:"get list of available wcs units",get:function(){return e.wcsunitss.join(", ")}})),e.checkNew(new e.Command({name:"wcs2pix",help:"get wcs position for specified image pixel",set:function(t){var i=this.image;if(i)return(t=e.WCS2Pix(parseFloat(t[0]),parseFloat(t[1]),{display:i})).str}})),e.checkNew(new e.Command({name:"zoom",help:"set/get zoom for current image",get:function(){var e=this.image;if(e)return e.getZoom()},set:function(e){var t=this.image;t&&t.setZoom(e[0])}})))},e.initAnalysis=function(){$(document).on("keyup keypress",".js9AnalysisForm",function(e){var t=$(this);if(13===(e.which||e.keyCode))return e.preventDefault(),(e=$(this).data("enterfunc"))&&t.find("[name='"+e+"']").click(),!1})},e.init=function(){var t;if(window.HTMLCanvasElement&&JSON||e.error("your browser does not support JS9 (no HTML5 canvas and/or JSON). Please try a modern version of Firefox, Chrome, Safari, Opera, or Edge."),window.hasOwnProperty("JS9Prefs")&&"object"==typeof JS9Prefs&&JS9Prefs.globalOpts&&JS9Prefs.globalOpts.installDir&&(e.INSTALLDIR=JS9Prefs.globalOpts.installDir),!e.INSTALLDIR){try{$('link[href$="js9.css"]').each(function(){var t=$(this).attr("href");t&&"js9.css"===t.split("/").reverse()[0]&&(e.INSTALLDIR=t.replace(/js9\.css$/,""))})}catch(i){e.INSTALLDIR=""}e.INSTALLDIR&&(e.INSTALLDIR=e.cleanPath(e.INSTALLDIR))}if(e.INSTALLDIR&&"/"!==e.INSTALLDIR.slice(-1)&&(e.INSTALLDIR+="/"),e.TOROOT=e.INSTALLDIR.replace(/([^\/.])+/g,".."),window.hasOwnProperty("JS9Inline")&&"object"==typeof JS9Inline&&(e.inline=$.extend(!0,{},JS9Inline)),"dhtml"===e.LIGHTWIN&&($("<div>").attr("id","dhtmlwindowholder").appendTo($(document.body)).append("<span style='display:none'>.</span>"),dhtmlwindow.imagefiles=e.inline?[e.inline["images/min.gif"],e.inline["images/close.gif"],e.inline["images/restore.gif"],e.inline["images/resize.gif"]]:e.allinone?[e.allinone.min,e.allinone.close,e.allinone.restore,e.allinone.resize]:[e.InstallDir("images/min.gif"),e.InstallDir("images/close.gif"),e.InstallDir("images/restore.gif"),e.InstallDir("images/resize.gif")],window.hasOwnProperty("Jupyter")&&$("#dhtmlwindowholder").arrive("input",function(){e.jupyterFocus($(this).parent())})),e.globalOpts.plotLibrary=e.globalOpts.plotLibrary||"flot","plotly"!==e.globalOpts.plotLibrary||window.hasOwnProperty("Plotly")||(e.globalOpts.plotLibrary="flot"),window.hasOwnProperty("JS9Prefs")&&"object"==typeof JS9Prefs?e.mergePrefs(JS9Prefs):e.PREFSFILE&&(e.loadPrefs(e.InstallDir(e.PREFSFILE),1),e.loadPrefs(e.PREFSFILE,0)),e.hasOwnProperty("Regions")&&$.extend(!0,e.Regions.opts,e.regionOpts),delete e.regionOpts,e.hasOwnProperty("Catalogs")&&$.extend(!0,e.Catalogs.opts,e.catalogOpts),delete e.catalogOpts,e.hasOwnProperty("Crosshair")&&$.extend(!0,e.Crosshair.opts,e.crosshairOpts),delete e.crosshairOpts,e.hasOwnProperty("Grid")&&$.extend(!0,e.Grid.opts,e.gridOpts),delete e.gridOpts,e.hasOwnProperty("Module")&&$.extend(!0,Module,e.emscriptenOpts),delete e.emscriptenOpts,e.globalOpts.resize||(e.globalOpts.resizeHandle=!1),void 0!==e.analOpts.prependJS9Dir&&(e.globalOpts.prependJS9Dir=e.analOpts.prependJS9Dir,delete e.analOpts.prependJS9Dir),void 0!==e.analOpts.dataDir&&(e.globalOpts.dataDir=e.analOpts.dataDir,delete e.analOpts.dataDir),e.BROWSER[3]&&(e.globalOpts.resizeHandle=!1),window.hasOwnProperty("localStorage")){try{t=localStorage.getItem("globals")}catch(i){t=null}if(t){try{e.userOpts.displays=JSON.parse(t)}catch(i){}e.userOpts.displays&&$.extend(!0,e.globalOpts,e.userOpts.displays)}try{t=localStorage.getItem("images")}catch(i){t=null}if(t){try{e.userOpts.images=JSON.parse(t)}catch(i){}e.userOpts.images&&$.extend(!0,e.imageOpts,e.userOpts.images)}try{t=localStorage.getItem("fits")}catch(i){t=null}if(t)try{e.userOpts.fits=JSON.parse(t)}catch(i){}try{t=localStorage.getItem("regions")}catch(i){t=null}if(t){try{e.userOpts.regions=JSON.parse(t)}catch(i){}e.userOpts.regions&&$.extend(!0,e.Regions.opts,e.userOpts.regions)}try{t=localStorage.getItem("grid")}catch(i){t=null}if(t){try{e.userOpts.images=JSON.parse(t)}catch(i){}e.userOpts.images&&$.extend(!0,e.Grid.opts,e.userOpts.images)}try{t=localStorage.getItem("catalog")}catch(i){t=null}if(t){try{e.userOpts.images=JSON.parse(t)}catch(i){}e.userOpts.images&&$.extend(!0,e.Catalogs.Opts,e.userOpts.images)}}if(e.DEBUG=e.DEBUG||e.globalOpts.debug||0,$("div.JS9").each(function(){e.checkNew(new e.Display($(this)))}),window.Worker&&!e.allinone)try{e.worker=new e.WebWorker(e.InstallDir(e.WORKERFILE))}catch(i){}e.allinone?e.initFITS():e.initEmscripten(),e.helper=new e.Helper,window.addEventListener("message",function(t){var i,s=t.data;if("null"===(t=t.origin||t.originalEvent.origin)&&(t="unknown"),e.globalOpts.postMessage){if("string"==typeof s)try{i=JSON.parse(s)}catch(a){e.error("can't parse msg: "+s,a)}else"object"==typeof s?i=s:e.error("invalid msg from postMessage");e.msgHandler(i,function(e,t,s,a){a=a||{},parent.postMessage({cmd:i.cmd,res:{name:a.name,rtype:a.rtype,rdata:e,stdout:e,stderr:t,errcode:s}},"*")})}else e.DEBUG&&(t=sprintf("JS9 ignoring postMessage, origin: %s",t),t="string"==typeof s?t+sprintf(" data: %s",s):"object"==typeof s?t+sprintf(" obj: %s",JSON.stringify(Object.keys(s))):t+sprintf(" typeof: %s",typeof s),e.log(t))},!1),window.hasOwnProperty("ImageFilters")&&(e.ImageFilters=ImageFilters),e.initColormaps(),e.initCommands(),e.initAnalysis(),e.RegisterPlugin(e.MouseTouch.CLASS,e.MouseTouch.NAME,e.MouseTouch.init,{menuItem:"Mouse/Touch",onplugindisplay:e.MouseTouch.init,help:"help/mousetouch.html",winTitle:"Mouse/Touch Actions",winResize:!0,winDims:[e.MouseTouch.WIDTH,e.MouseTouch.HEIGHT]}),e.RegisterPlugin(e.Regions.CLASS,e.Regions.NAME,e.Regions.init,{divArgs:["regions"],winDims:[0,0]}),e.RegisterPlugin(e.Crosshair.CLASS,e.Crosshair.NAME,e.Crosshair.init,{onmousemove:e.Crosshair.display,onkeyboardaction:e.Crosshair.keyaction,onkeyup:e.Crosshair.keyup,onimageload:e.Crosshair.create,winDims:[0,0]}),e.RegisterPlugin(e.Grid.CLASS,e.Grid.NAME,e.Grid.init,{onsetpan:e.Grid.regrid,onsetzoom:e.Grid.regrid,onsetwcssys:e.Grid.regrid,onsetwcsunits:e.Grid.regrid,onimageload:e.Grid.regrid,onupdateprefs:e.Grid.regrid,winDims:[0,0]}),e.RegisterPlugin(e.Dysel.CLASS,e.Dysel.NAME,e.Dysel.init,{onimageload:e.Dysel.imageload,onimageclose:e.Dysel.imageclose,winDims:[0,0]}),e.instantiatePlugins(),e.plugins.sort(function(e,t){var i=e.opts.menuItem,s=t.opts.menuItem;return i?!s||i<s?-1:i>s?1:0:1}),$(document).scrollTop(0),e.inited=!0,$(document).trigger("JS9:init")},e.parsePublicArgs=function(e){var t=null,i=(e=Array.prototype.slice.call(e))[e.length-1];return i&&"object"==typeof i&&i.hasOwnProperty("display")&&1===Object.keys(i).length&&(t=i.display,e.pop()),{argv:e,display:t}},e.mkPublic=function(t,i){"string"==typeof i?e.Image.prototype[i]?(e[t]=function(){var t;t=e.parsePublicArgs(arguments);var s=e.getImage(t.display);if(s)return(t=s[i].apply(s,t.argv))===s||t===s.display?e.globalOpts.quietReturn?"":"OK":t},e.publics[t]=e[t]):e.error("unknown image function for mkPublic: "+i):"function"==typeof i?(e[t]=i,e.publics[t]=e[t]):e.error("unsupported type for mkPublic: "+typeof i)},e.mkPublic("CloseImage","closeImage"),e.mkPublic("DisplayImage","displayImage"),e.mkPublic("DisplayExtension","displayExtension"),e.mkPublic("DisplaySlice","displaySlice"),e.mkPublic("DisplaySection","displaySection"),e.mkPublic("BlendImage","blendImage"),e.mkPublic("GetColormap","getColormap"),e.mkPublic("SetColormap","setColormap"),e.mkPublic("GetZoom","getZoom"),e.mkPublic("SetZoom","setZoom"),e.mkPublic("GetPan","getPan"),e.mkPublic("SetPan","setPan"),e.mkPublic("AlignPanZoom","alignPanZoom"),e.mkPublic("GetScale","getScale"),e.mkPublic("SetScale","setScale"),e.mkPublic("GetParam","getParam"),e.mkPublic("SetParam","setParam"),e.mkPublic("GetValPos","updateValpos"),e.mkPublic("ImageToDisplayPos","imageToDisplayPos"),e.mkPublic("DisplayToImagePos","displayToImagePos"),e.mkPublic("ImageToLogicalPos","imageToLogicalPos"),e.mkPublic("LogicalToImagePos","logicalToImagePos"),e.mkPublic("GetWCSUnits","getWCSUnits"),e.mkPublic("SetWCSUnits","setWCSUnits"),e.mkPublic("GetWCS","getWCS"),e.mkPublic("SetWCS","setWCS"),e.mkPublic("GetWCSSys","getWCSSys"),e.mkPublic("SetWCSSys","setWCSSys"),e.mkPublic("ShowShapeLayer","showShapeLayer"),e.mkPublic("ActiveShapeLayer","activeShapeLayer"),e.mkPublic("ToggleShapeLayers","toggleShapeLayers"),e.mkPublic("AddShapes","addShapes"),e.mkPublic("RemoveShapes","removeShapes"),e.mkPublic("GetShapes","getShapes"),e.mkPublic("ChangeShapes","changeShapes"),e.mkPublic("DisplayCoordGrid","displayCoordGrid"),e.mkPublic("Print","print"),e.mkPublic("SavePNG","savePNG"),e.mkPublic("SaveJPEG","saveJPEG"),e.mkPublic("SaveFITS","saveFITS"),e.mkPublic("UploadFITSFile","uploadFITSFile"),e.mkPublic("CountsInRegions","countsInRegions"),e.mkPublic("RadialProfile","radialProfile"),e.mkPublic("Plot3D","plot3d"),e.mkPublic("RunAnalysis","runAnalysis"),e.mkPublic("RawDataLayer","rawDataLayer"),e.mkPublic("GaussBlurData","gaussBlurData"),e.mkPublic("ImarithData","imarithData"),e.mkPublic("RotateData","rotateData"),e.mkPublic("ReprojectData","reprojectData"),e.mkPublic("ShiftData","shiftData"),e.mkPublic("FilterRGBImage","filterRGBImage"),e.mkPublic("MoveToDisplay","moveToDisplay"),e.mkPublic("LookupImage",function(t){var i=e.parsePublicArgs(arguments);return e.lookupImage(i.argv[0],i.display)}),e.mkPublic("LookupDisplay",function(t,i){var s=e.parsePublicArgs(arguments);return e.lookupDisplay(s.argv[0]||s.display,s.argv[1])}),e.mkPublic("RenameDisplay",function(t,i){var s;switch((s=e.parsePublicArgs(arguments)).argv.length){case 0:return;case 1:i=s.display,t=s.argv[0];break;default:i=s.argv[0],t=s.argv[1]}(s=e.lookupDisplay(i))&&s.id&&(i=s.id,s.oid||(s.oid=i),s.id=t,e.helper.send("renameDisplay",{odisplay:i,ndisplay:s.id}))}),e.mkPublic("CloseDisplay",function(t){var i,s;for(i=e.parsePublicArgs(arguments),t=e.lookupDisplay(i.argv[0]||i.display),i=e.images.length-1;0<=i;i--)(s=e.images[i]).display===t&&s.closeImage()}),e.mkPublic("AddColormap",function(t,i,s,a,n){var r,o;r=e.parsePublicArgs(arguments);var l=function(t,i){var s,a;for("object"!=typeof t&&e.error("invalid colormap object for JS9.AddColormap()"),$.isArray(t)||(t=[t]),s=0;s<t.length;s++)(a=t[s]).name||e.error("missing name for colormap in JS9.AddColormap()"),a.vertices?e.AddColormap(a.name,a.vertices[0],a.vertices[1],a.vertices[2],i):a.colors?e.AddColormap(a.name,a.colors,i):e.error("unknown colormap type for JS9.AddColormap()")};if(i=r.argv[1],s=r.argv[2],a=r.argv[3],n=r.argv[4],(t=r.argv[0])instanceof Blob)(r=new FileReader).onload=function(t){try{o=JSON.parse(t.target.result)}catch(s){e.error("can't parse json colormap",s)}l(o,i)},r.readAsText(t);else if("object"==typeof t)l(t,i);else switch(r.argv.length){case 1:try{o=JSON.parse(t)}catch(c){e.error("can't parse JSON colormap",c)}l(o);break;case 2:case 3:if("string"==typeof i)try{i=JSON.parse(i)}catch(c){e.error("can't parse JSON colormap",c)}e.checkNew(new e.Colormap(t,i)),2===r.argv.length?e.globalOpts.topColormaps.push(t):"object"==typeof s&&!1===s.toplevel||e.globalOpts.topColormaps.push(t);break;case 4:case 5:if("string"==typeof i)try{i=JSON.parse(i)}catch(c){e.error("can't parse JSON colormap",c)}if("string"==typeof s)try{s=JSON.parse(s)}catch(c){e.error("can't parse JSON colormap",c)}if("string"==typeof a)try{a=JSON.parse(a)}catch(c){e.error("can't parse JSON colormap",c)}e.checkNew(new e.Colormap(t,i,s,a)),4===r.argv.length?e.globalOpts.topColormaps.push(t):n&&"object"==typeof n&&!1===n.toplevel||e.globalOpts.topColormaps.push(t);break;default:e.error("AddColormap() requires a colormap name and 1 or 3 args")}}),e.mkPublic("LoadColormap",function(t,i){(t=e.parsePublicArgs(arguments).argv[0])||e.error("JS9.LoadColormap: no file specified for colormap load"),"object"==typeof t?e.AddColormap(t,i):"string"==typeof t?(t=e.fixPath(t),e.fetchURL(null,t,null,function(t){e.AddColormap(t,i)})):e.error("unknown file type for LoadColormap: "+typeof t)}),e.mkPublic("SetRGBMode",function(t,i){var s,a,n=["red","green","blue"],r=["rid","gid","bid"],o=e.parsePublicArgs(arguments);if(void 0===(t=o.argv[0])&&(t=!e.globalOpts.rgb.active),i=o.argv[1])for(s=0;3>s;s++)"string"==typeof(a=i[r[s]])&&(a=e.LookupImage(a)),a&&a.setColormap(n[s]);return"true"===t?t=!0:"false"===t&&(t=!1),e.globalOpts.rgb.active=!!t,e.DisplayImage({display:o.display}),e.globalOpts.rgb.active}),e.mkPublic("GetRGBMode",function(){return{active:e.globalOpts.rgb.active,rid:e.globalOpts.rgb.rim?e.globalOpts.rgb.rim.id:null,gid:e.globalOpts.rgb.gim?e.globalOpts.rgb.gim.id:null,bid:e.globalOpts.rgb.bim?e.globalOpts.rgb.bim.id:null}}),e.mkPublic("SetValPos",function(t){var i=null,s=e.parsePublicArgs(arguments),a=e.getImage(s.display);return a&&(i=a.params.valpos,a.params.valpos=t=s.argv[0]),i}),e.mkPublic("SetImageInherit",function(t){var i=null,s=e.parsePublicArgs(arguments),a=e.getImage(s.display);return a&&(i=a.params.inherit,a.params.inherit=t=s.argv[0]),i}),e.mkPublic("GetImageInherit",function(){var t=null,i=e.parsePublicArgs(arguments);return(i=e.getImage(i.display))&&(t=i.params.inherit),t}),e.mkPublic("Load",function(t,i){var s,a,n,r,o;if(a="fits",i=(n=e.parsePublicArgs(arguments)).argv[1],t=n.argv[0]){if(n=n.display?n.display:0<e.displays.length?e.displays[0].id:e.DEFID,"object"==typeof i)i=$.extend(!0,{},i);else if("string"==typeof i)try{i=JSON.parse(i)}catch(l){i={}}else i={};if(i.display=i.display||n,i.onload?r=i.onload:e.imageOpts.onload&&(i.onload=r=e.imageOpts.onload),t instanceof Blob){if(t.path||t.name)if(i.filename=t.path||t.name,n="object"==typeof i.refresh?i.refresh:e.lookupImage(i.filename,i.display)){if(e.isNull(i.refresh)&&(i.refresh=e.globalOpts.reloadRefresh),!i.refresh)return n.displayImage("display",i),n.refreshLayers(),n.display.clearMessage(),void e.waiting(!1);i.refresh=n}else delete i.refresh;else delete i.refresh;if(i.filename||(i.filename=e.ANON+e.uniqueID()),t.type&&-1!==t.type.indexOf("image/"))switch(t.type){case"image/fits":break;default:a="img"}else i.filename.split(".").pop().match(/(png|jpg|jpeg)/i)&&(a="img");switch(a){case"fits":o=$.extend(!0,{},e.fits.options,i);try{e.handleFITSFile(t,o,e.NewFitsImage)}catch(l){e.error("can't process FITS file",l)}break;case"img":try{e.handleImageFile(t,i,e.Load)}catch(l){e.error("can't process IMG file",l)}}}else if("object"==typeof t)e.checkNew(new e.Image(t,i,r));else if("string"!=typeof t&&e.error("unknown file type for Load: "+typeof t),"U0lNUExFICA9"===t.slice(0,12)&&(t=window.atob(t)),"SIMPLE  ="===t.slice(0,9)){for(r=[],s=0;s<t.length;s++)r[s]=t.charCodeAt(s);s=new Blob([new Uint8Array(r)]),i.filename||(i.filename=e.ANON+e.uniqueID()),s.name=i.filename,o=$.extend(!0,{},e.fits.options,i);try{e.handleFITSFile(s,o,e.NewFitsImage)}catch(l){e.error("can't process FITS file",l)}}else e.isNull(i.refresh)&&(i.refresh=e.globalOpts.reloadRefresh),i.refresh?"object"==typeof i.refresh?n=i.refresh:(a=t.split("/").reverse()[0],(n=e.lookupImage(a,i.display))&&(i.refresh=n)):(a=t.split("/").reverse()[0],n=e.lookupImage(a,i.display)),n&&!i.refresh?(n.displayImage("all",i),n.display.clearMessage(),e.waiting(!1)):"png"===(a=(t=e.cleanPath(t)).split(".").pop().toLowerCase())?e.globalOpts.pngisfits?e.checkNew(new e.Image(t,i,r)):(t=e.fixPath(t,i),e.fetchURL(null,t,i,e.NewFitsImage)):e.fits2RepFile(i.display,t,i,"fits")||e.fits2RepFile(i.display,t,i,"png",r)||(i.display&&(s=e.lookupDisplay(i.display)),e.waiting(!0,s),n&&i.refresh&&e.cleanupFITSFile(n.raw,!0),s=(t=e.fixPath(t,i)).replace(/\[.*\]/,""),e.localMount&&0<=e.vsize(e.localMount+"/"+t)&&0<=$.inArray("."+a,e.globalOpts.localTemplates.split(","))?((o=$.extend(!0,{},e.fits.options,i)).file=t,o.vfile=e.localMount+"/"+t,window.setTimeout(function(){try{e.handleFITSFile(t,o,e.NewFitsImage)}catch(l){e.error("can't process FITS file",l)}},0)):e.fetchURL(t,s,i))}else e.error("JS9.Load: no file specified for image load")}),e.mkPublic("LoadWindow",function(t,i,s,a,n){var r,o,l,c,h,u,d,p,f,g,m,v,b,y,x,w=e.lightOpts[e.LIGHTWIN];h=e.parsePublicArgs(arguments);var S=function(t){0<=(t=$.inArray(t,e.displays))&&e.displays.splice(t,1)};if(u=function(t,i,s){var a,n;return(i=i||{}).clone&&(n=e.lookupDisplay(i.clone,!1)),s&&(b=s.match(/(.*width=)([0-9]+)(px,height=)([0-9]+)(px.*)/,"$1@@H@@$3"),y=parseInt(b[2],10),x=parseInt(b[4],10)),a=sprintf("<hr class='hline0'>"),!n||0<$("#"+i.clone+"Menubar").length&&!n.pluginInstances.JS9Menubar.isDynamic?a+=sprintf("<div class='JS9Menubar' id='%sMenubar'></div>",t):s&&(x-=40),a+=sprintf("<div class='JS9' id='%s'></div>",t),!n||0<$("#"+i.clone+"Colorbar").length&&!n.pluginInstances.JS9Colorbar.isDynamic?(r=n&&n.pluginInstances.JS9Colorbar?sprintf("data-showTicks='%s'",n.pluginInstances.JS9Colorbar.showTicks):"",a+=sprintf("<div style='margin-top: 2px;'><div class='JS9Colorbar' id='%sColorbar' %s></div></div>",t,r),n&&n.pluginInstances.JS9Colorbar&&!n.pluginInstances.JS9Colorbar.showTicks&&(x-=15)):s&&(x-=44),s?(e.Dysel.retrievePlugins().length&&(y+=2,x+=2),{html:a,winopts:b[1]+String(y)+b[3]+String(x)+b[5]}):a},t=h.argv[0],s=h.argv[2],a=h.argv[3],n=h.argv[4],"object"==typeof(i=h.argv[1]))i=$.extend(!0,{},i);else if("string"==typeof i)try{i=JSON.parse(i)}catch(C){i={}}else i={};switch(h=((s=s||"light")||"")+"win",s){case"light":return i.id?(o=i.id,delete i.id):o=h+e.uniqueID(),c="d"+o,a?n=n||w.imageWin:(a=(d=u(o,i,w.imageWin)).html,n=n||d.winopts),d=sprintf("JS9 Display"+e.IDFMT,o),(p=e.lightWin(c,"inline",a,d,n)).onclose=function(){var t,i,s=[];for(t=0;t<e.images.length;t++)(i=e.images[t]).display.id===o&&s.push(i);if(!s.length)return S(l),!0;if("move"===e.globalOpts.lightWinClose){if(e.isNull(e.globalOpts.lightWinMoveTo)||e.globalOpts.lightWinMoveTo===o)f=0;else for(f=t=0;t<e.displays.length;t++)if(e.displays[t].id===e.globalOpts.lightWinMoveTo){f++;break}f||(e.globalOpts.lightWinClose="ask",delete e.globalOpts.lightWinMoveTo)}switch(e.globalOpts.lightWinClose){case"close":for(S(l),t=0;t<s.length;t++)try{s[t].closeImage()}catch(a){}return!0;case"move":for(S(l),t=0;t<s.length;t++)try{s[t].moveToDisplay(e.globalOpts.lightWinMoveTo)}catch(a){}return!0;default:return g="lightCloseID"+e.uniqueID(),e.allinone?(m="inline",v=e.allinone.lightCloseHTML):(m="ajax",v=e.InstallDir(e.lightOpts.lcloseURL)),$("#dhtmlwindowholder").arrive("#lightWinCloseForm",{onceOnly:!0},function(){var t,i;for(i=$("#lightWinCloseForm").find("#lightWinCloseSel"),t=0;t<e.displays.length;t++)e.displays[t].id!==o&&i.append($("<option>",{value:e.displays[t].id,text:e.displays[t].id}))}),c=e.lightWin(g,m,v,"Closing a light window",w.lcloseWin),$(c).data("dispid",o),$(c).data("winid",p),!1}},(l=new e.Display(o)).winid=p,e.helper.send("addDisplay",{display:o}),e.instantiatePlugins(),i.display=o,t&&e.Load(t,i),o;case"new":if(i.id?(o=i.id,delete i.id):o=h+e.uniqueID(),n=n||sprintf("width=%s, height=%s",e.globalOpts.newWindowWidth,e.globalOpts.newWindowHeight),(h=(h=document.getElementsByTagName("head")[0].innerHTML).replace(/src=['"].*astroemw?\.js['"]/,"")).match(/src=["'].*js9\.js/)||h.match(/src=["'].*js9\.min\.js/)||(h+=sprintf('<%s type="text/javascript" src="js9.min.js"></%s>',"script","script")),u=a||u(o,i),a=sprintf("<html><head>%s</head><body",h),t&&(a+=sprintf(" onload='JS9.Preload(\"%s\",%s);'",t,JSON.stringify(i))),a+=sprintf(">%s</body></html>\n",u),window.isElectron&&(d="data:text/html,<html><body><script>window.addEventListener('message', function(ev){document.documentElement.innerHTML=ev.data<\/script><p></body></html>"),d=window.open(d,o,n))return d.document?(d.document.open(),d.document.write(a),d.document.close()):e.error(d.postMessage?"LoadWindow('new') is disabled on the Desktop for security reasons":"no method available for drawing image into window"),o;e.error("could not create window (check your pop-up blockers)")}}),e.mkPublic("LoadProxy",function(t,i){var s,a,n=e.parsePublicArgs(arguments);if(t=n.argv[0],i=n.argv[1],e.globalOpts.loadProxy||e.error("proxy load not available for this server"),e.globalOpts.workDir||e.error("proxy load requires a temp workDir this server"),t||e.error("no url specified for proxy load"),(t=t.trim()).match(/dropbox\.com/)?t=(t=t.replace("www.dropbox.com","dl.dropboxusercontent.com")).replace("?dl=0","")+"?raw=1":t.match(/drive\.google\.com/)&&(t=t.replace(/\/file\/d\/(\w+)\/\w+\?usp=sharing/,"/uc?export=download&id=$1")),n.display&&(a=e.lookupDisplay(n.display)),"object"==typeof i)i=$.extend(!0,{},i);else if("string"==typeof i)try{i=JSON.parse(i)}catch(r){i={}}else i={};e.waiting(!0,a),e.Send("loadproxy",{cmd:"js9Xeq loadproxy "+t},function(a){(a="object"==typeof a?a:0<=a.search(e.analOpts.epattern)?{stderr:a}:{stdout:a}).errcode=a.errcode||0,a.stderr?e.error(a.stderr):a.stdout?(void 0===i.fits2png&&(i.fits2png=!1),s=e.cleanPath(a.stdout),i.proxyFile=s,"/"!==s.charAt(0)&&(s=e.InstallDir(s)),i.fixpath=!1,i.proxyURL=t,e.Load(s,i,{display:n.display})):e.error("internal error: no return from load proxy command")})}),e.mkPublic("Preload",function(t){var i,s,a,n,r="",o=null,l=null,c=e.globalOpts.alerts,h=arguments.length;i=e.parsePublicArgs(arguments);var u=e.URLEXP,d=/\.ses$/,p=/\.cmap$/;switch(t=i.argv[0],e.globalOpts.loadProxy&&e.helper.baseurl&&(a=new RegExp("^"+e.helper.baseurl)),i.display&&(l={display:i.display},--h),h){case 0:i=(null===e.helper.connected||e.helper.connected)&&e.fits.name&&0<e.preloads.length?2:3;break;case 1:i="boolean"==typeof t?t&&0<e.preloads.length?2:3:(null===e.helper.connected||e.helper.connected)&&e.fits.name?1:0;break;default:i=(null===e.helper.connected||e.helper.connected)&&e.fits.name?1:0}switch(i){case 0:for(i=0;i<h;i++)if((s=i+1)<h&&"object"==typeof arguments[s])o=$.extend(!0,{},arguments[s]),e.preloads.push([arguments[i],o,l]),i++;else if(s<h&&0===arguments[s].indexOf("{")){try{o=JSON.parse(arguments[s])}catch(f){o=null}e.preloads.push([arguments[i],o,l]),i++}else e.preloads.push([arguments[i],null,l]);break;case 1:for(e.globalOpts.alerts=!1,i=0;i<h;i++)if(n=a&&arguments[i].match(u)&&!arguments[i].match(a)?e.LoadProxy:arguments[i].match(d)?e.LoadSession:arguments[i].match(p)?e.LoadColormap:e.Load,(s=i+1)<h&&"object"==typeof arguments[s]){n!==e.Load&&n!==e.LoadProxy||(e.preloadwaiting[e.cleanPath(arguments[i])]=!0);try{l?n(arguments[i],arguments[s],l):n(arguments[i],arguments[s])}catch(f){r=r+" "+arguments[i]}i++}else if(s<h&&0===arguments[s].indexOf("{")){try{o=JSON.parse(arguments[s])}catch(f){o=null}n!==e.Load&&n!==e.LoadProxy||(e.preloadwaiting[e.cleanPath(arguments[i])]=!0);try{l?n(arguments[i],o,l):n(arguments[i],o)}catch(f){r=r+" "+arguments[i]}i++}else{n!==e.Load&&n!==e.LoadProxy||(e.preloadwaiting[e.cleanPath(arguments[i])]=!0);try{l?n(arguments[i],null,l):n(arguments[i],null)}catch(f){r=r+" "+arguments[i]}}e.globalOpts.alerts=c,r&&e.error("could not preload image(s): "+r);break;case 2:for(e.globalOpts.alerts=!1,i=0;i<e.preloads.length;i++){(n=a&&e.preloads[i][0].match(u)&&!e.preloads[i][0].match(a)?e.LoadProxy:e.preloads[i][0].match(d)?e.LoadSession:e.preloads[i][0].match(p)?e.LoadColormap:e.Load)!==e.Load&&n!==e.LoadProxy||(e.preloadwaiting[e.cleanPath(e.preloads[i][0])]=!0);try{e.preloads[i][2]?n(e.preloads[i][0],e.preloads[i][1],e.preloads[i][2]):n(e.preloads[i][0],e.preloads[i][1])}catch(f){r=r+" "+e.preloads[i][0]}}e.globalOpts.alerts=c,r&&e.error("could not preload image(s): "+r),e.preloads=[]}}),e.mkPublic("RefreshImage",function(t,i){var s=e.parsePublicArgs(arguments),a=e.getImage(s.display);if(t=s.argv[0],i=s.argv[1]||{},a)if(i.id=a.id,t instanceof Blob){i.rawid&&i.rawid!==a.raw.id||e.cleanupFITSFile(a.raw,!0);try{e.handleFITSFile(t,e.fits.options,function(e){a.refreshImage(e,i)})}catch(n){e.error("can't refresh FITS file",n)}}else a.refreshImage(t,i);else t instanceof Blob&&e.Load.apply(null,arguments)}),e.mkPublic("GetLoadStatus",function(t){var i,s,a=e.parsePublicArgs(arguments),n=e.getImage(a.display);return n?((t=a.argv[0])&&"object"==typeof t&&t.hasOwnProperty("id")&&(t=t.id),"string"==typeof t&&(s=t.split("/").reverse()[0]),n.file0&&(i=n.file0.split("/").reverse()[0],s&&!s.match(/\[.*\]/)&&(i=i.replace(/\[.*\]/,""))),!t||n.id0===t||n.file0===t||i&&s&&i===s?n.status.load:"other"):"none"}),e.mkPublic("CopyToClipboard",function(t,i){var s,a;e.clipboard=t,(a=document.createElement("textarea")).style.position="fixed",a.style.top=0,a.style.left=0,a.style.width="2em",a.style.height="2em",a.style.padding=0,a.style.border="none",a.style.outline="none",a.style.boxShadow="none",a.style.background="transparent",a.value=t,document.body.appendChild(a),a.select();try{document.execCommand("copy")?s="OK":(s="MANUAL",e.BROWSER[2].match(/Mac/)?window.prompt("copy to clipboard: Cmd+C",t):window.prompt("copy to clipboard: Ctrl+C",t))}catch(n){s="ERROR"}return document.body.removeChild(a),i&&i.display&&(i.display.divjq.trigger("mouseout"),i.display.divjq.trigger("mouseenter")),s}),e.mkPublic("CopyFromClipboard",function(){return e.clipboard||""}),e.mkPublic("OpenFileMenu",function(){var t=e.parsePublicArgs(arguments);(t=e.lookupDisplay(t.display))&&$("#openLocalLoad-"+t.id).click()}),e.mkPublic("OpenRegionsMenu",function(){var t=e.parsePublicArgs(arguments);(t=e.lookupDisplay(t.display))&&$("#openLocalLoadRegions-"+t.id).click()}),e.mkPublic("OpenSessionMenu",function(){var t=e.parsePublicArgs(arguments);(t=e.lookupDisplay(t.display))&&$("#openLocalLoadSession-"+t.id).click()}),e.mkPublic("OpenCatalogsMenu",function(){var t=e.parsePublicArgs(arguments);(t=e.lookupDisplay(t.display))&&$("#openLocalLoadCatalog-"+t.id).click()}),e.mkPublic("OpenColormapMenu",function(){var t=e.parsePublicArgs(arguments);(t=e.lookupDisplay(t.display))&&$("#openLocalLoadColormap-"+t.id).click()}),e.mkPublic("SaveColormap",function(){var t,i,s,a=(i=e.parsePublicArgs(arguments)).argv[0],n=i.argv[1],r=function(e){var t=e;if("string"==typeof e)try{t=JSON.parse(e)}catch(i){}return t},o=function(t){var i,s,a=[];for(i=0;i<t.length;i++)(s=e.lookupColormap(t[i]))&&(delete(s=$.extend(!0,{},s)).type,a.push(s));return 1===a.length?a[0]:a};return window.hasOwnProperty("saveAs")?(i=e.getImage(i.display))&&(a=r(a),n=r(n),a?"string"==typeof a?(t=a,"string"==typeof n?s=o([n]):$.isArray(n)?s=o(n):delete(s=$.extend(!0,{},i.cmapObj)).type):$.isArray(a)&&(t="js9.cmap",s=o(a)):(t="js9.cmap",delete(s=$.extend(!0,{},i.cmapObj)).type),s=JSON.stringify(s),s=new Blob([s],{type:"text/plain"}),saveAs(s,t)):e.error("no saveAs function available to save colormap"),t}),e.mkPublic("NewFitsImage",function(t,i){var s,a,n;t=(a=e.parsePublicArgs(arguments)).argv[0],i=a.argv[1]||{},a=e.lookupDisplay(a.display||i.display||e.DEFID),i.refresh?("object"==typeof i.refresh?n=i.refresh:a&&a.image&&(n=a.image),n?(i.onload&&(i.onrefresh=i.onload,delete i.onload),n.refreshImage(t,i)):(i.onload&&(s=i.onload),e.checkNew(new e.Image(t,i,s)))):(i.onload&&(s=i.onload),e.checkNew(new e.Image(t,i,s)))}),e.mkPublic("GetImage",function(t){return t&&"string"!=typeof t&&(t=e.parsePublicArgs(arguments).display),e.getImage(t)}),e.mkPublic("GetImageData",function(t){var i=e.parsePublicArgs(arguments),s=e.getImage(i.display);return s?s.getImageData(t=i.argv[0]):null}),e.mkPublic("GetDisplayData",function(t){var i,s,a,n=[];for(s=(i=e.parsePublicArgs(arguments)).display||e.displays[0].id,t=i.argv[0],i=0;i<e.images.length;i++)(a=e.images[i]).display.id===s&&n.push(a.getImageData(t));return n}),e.mkPublic("GetFITSHeader",function(t){var i="",s=e.parsePublicArgs(arguments),a=e.getImage(s.display);return a&&a.raw&&(i=e.raw2FITS(a.raw,{addcr:t=s.argv[0]})),i}),e.mkPublic("BlendDisplay",function(t){var i,s,a=[],n=(i=e.parsePublicArgs(arguments)).display||e.DEFID;if(s=e.lookupDisplay(n),t=i.argv[0],s||e.error("no JS9 display found: "+n),void 0===t||"mode"===t)return s.blendMode;if("list"===t){for(i=0;i<e.images.length;i++)(s=e.images[i]).display.id===n&&s.blend.active&&a.push(s.id);return a}return"true"===t?t=!0:"false"===t&&(t=!1),s.blendMode=!!t,s.image&&(s.image.xeqPlugins("image","ondisplayblend"),s.image.displayImage()),s.blendMode}),e.mkPublic("LoadAuxFile",function(t,i){var s=e.parsePublicArgs(arguments),a=e.getImage(s.display);a?a.loadAuxFile(t=s.argv[0],i=s.argv[1]):e.error("could not find image for aux file: "+t)}),e.mkPublic("SubmitAnalysis",function(t,i,s){var a,n,r;a=e.lightOpts[e.LIGHTWIN];var o=e.parsePublicArgs(arguments);if(t=o.argv[0],s=o.argv[2],(i=o.argv[1])?a=e.lookupDisplay(o.display).id:(i=(a=$(t).closest(a.top)).data("aname"),a=a.data("dispid")),i?a&&(n=e.getImage(a)):r="internal error: could not find analysis task name",n){a=$(t).closest("form");try{o=(o=a.serializeArray()).concat($("#"+a.attr("id")+" input[type=checkbox]:not(:checked)").map(function(){return{name:this.name,value:"false"}}).get())}catch(l){o=null}n.runAnalysis(i,o,s)}else r="internal error: could not find image";return r&&e.error(r),!1}),e.mkPublic("Send",function(t,i,s){e.helper.connected?e.helper.send(t,i,s):e.error("no JS9 helper available")}),e.mkPublic("EventToDisplayPos",function(t){return e.eventToDisplayPos(t)}),e.mkPublic("PixToWCS",function(t,i){var s,a,n=1;a=e.parsePublicArgs(arguments);var r=e.getImage(a.display);if(r&&("object"==typeof(s=a.argv[0])&&e.notNull(s.x)&&e.notNull(s.y)?(t=s.x,i=s.y):(t=a.argv[0],i=a.argv[1]),e.isNumber(t)&&e.isNumber(i)||e.error("invalid input for PixToWCS"),0<r.raw.wcs))return a=(s=e.pix2wcs(r.raw.wcs,t,i).trim()).split(/ +/),"sexagesimal"===r.params.wcsunits&&"galactic"!==r.params.wcssys&&"ecliptic"!==r.params.wcssys&&(n=15),{ra:e.saostrtod(a[0])*n,dec:e.saostrtod(a[1]),sys:a[2],str:s}}),e.Pix2WCS=e.PixToWCS,e.mkPublic("WCSToPix",function(t,i){var s,a,n;return s=e.parsePublicArgs(arguments),(n=e.getImage(s.display))&&("object"==typeof(a=s.argv[0])&&e.notNull(a.ra)&&e.notNull(a.dec)?(t=a.ra,i=a.dec):(t=s.argv[0],i=s.argv[1]),e.isNumber(t)&&e.isNumber(i)||e.error("invalid input for WCSToPix"),0<n.raw.wcs)?(s=e.wcs2pix(n.raw.wcs,t,i).trim().split(/ +/),{x:a=parseFloat(s[0]),y:n=parseFloat(s[1]),str:s=sprintf("%f %f",a,n)}):null}),e.WCS2Pix=e.WCSToPix,e.mkPublic("NewShapeLayer",function(t,i){var s=e.parsePublicArgs(arguments),a=e.getImage(s.display);return a?a.display.newShapeLayer(t=s.argv[0],i=s.argv[1]):null}),e.mkPublic("AddRegions",function(t,i){var s=e.parsePublicArgs(arguments),a=e.getImage(s.display);return a?(i=s.argv[1],(t=s.argv[0])||e.error("no region specified for AddRegions"),a.addShapes("regions",t,i)):null}),e.mkPublic("RemoveRegions",function(t){var i=e.parsePublicArgs(arguments),s=e.getImage(i.display);return s?(s.removeShapes("regions",t=i.argv[0]),s.display.clearMessage("regions"),e.globalOpts.quietReturn?"":"OK"):null}),e.mkPublic("CopyRegions",function(t,i){var s=e.parsePublicArgs(arguments),a=e.getImage(s.display);return a?(a.copyRegions(t=s.argv[0],i=s.argv[1]),e.globalOpts.quietReturn?"":"OK"):null}),e.mkPublic("GetRegions",function(t){var i=e.parsePublicArgs(arguments),s=e.getImage(i.display);return s?(i.argv.unshift("regions"),s.getShapes.apply(s,i.argv)):null}),e.mkPublic("ChangeRegions",function(t,i){var s=e.parsePublicArgs(arguments),a=e.getImage(s.display);return a&&((t=s.argv[0])||e.error("no region specified for GetRegions"),a.changeShapes("regions",t,i=s.argv[1])),null}),e.mkPublic("SaveRegions",function(t,i,s){var a,n,r,o;return a=(o=e.parsePublicArgs(arguments)).argv[0],n=o.argv[1],r=o.argv[2],(o=e.getImage(o.display))?o.saveRegions(a,n,r):null}),e.mkPublic("EditRegionTags",function(t,i,s){var a=e.parsePublicArgs(arguments),n=e.getImage(a.display);return n?n.editRegionTags(t=a.argv[0],i=a.argv[1],s=a.argv[2]):null}),e.mkPublic("ToggleRegionTags",function(t,i,s){var a=e.parsePublicArgs(arguments),n=e.getImage(a.display);return n?n.toggleRegionTags(t=a.argv[0],i=a.argv[1],s=a.argv[2]):null}),e.mkPublic("UnremoveRegions",function(){var t;return t=e.parsePublicArgs(arguments),(t=e.getImage(t.display))?t.unremoveRegions():null}),e.mkPublic("LoadRegions",function(t,i){var s;s=e.parsePublicArgs(arguments);var a=e.getImage(s.display),n=function(t,s){if(s&&void 0!==s.display&&delete s.display,e.globalOpts.reloadRefreshReg&&s.file)try{a.removeShapes("regions",s.file)}catch(n){}a.addShapes("regions",t,s),i&&i.onload&&i.onload(a)};if(i=s.argv[1],(t=s.argv[0])||e.error("JS9.LoadRegions: no file specified for regions load"),a){if("object"==typeof i)i=$.extend(!0,{},i);else if("string"==typeof i)try{i=JSON.parse(i)}catch(r){i={}}else i={};"object"==typeof t?((s=t.path||t.name)&&(i.file=s.split("/").reverse()[0]),(s=new FileReader).onload=function(e){n(e.target.result,i)},s.readAsText(t)):"string"==typeof t?(i.responseType="text",t=e.fixPath(t),i.file=t.split("/").reverse()[0],e.fetchURL(null,t,i,n)):e.error("unknown file type for LoadRegions: "+typeof t)}}),e.mkPublic("InstallDir",function(t){return t?e.cleanPath(e.INSTALLDIR+t):""}),e.mkPublic("AddDivs",function(){var t,i,s,a,n=e.parsePublicArgs(arguments);for(t=0;t<n.argv.length;t++)if(a=n.argv[t])if(0===$("#"+a).length)e.DEBUG&&e.log("warning: can't find div, skipping AddDivs(): %s",a);else{for(i=0;i<e.displays.length;i++)if(e.displays[i].id===a){s=!0;break}s?e.DEBUG&&e.log("warning: div already added, skipping AddDivs(): %s",a):(e.checkNew(new e.Display(a)),e.helper.send("addDisplay",{display:a}))}e.instantiatePlugins()}),e.mkPublic("InstantiatePlugins",function(){e.instantiatePlugins()}),e.mkPublic("ResizeDisplay",function(){var t,i;return"string"!=typeof(t=e.parsePublicArgs(arguments)).argv[0]||e.isNumber(t.argv[0])||"full"===t.argv[0]||"reset"===t.argv[0]||"image"===t.argv[0]?i=e.lookupDisplay(t.display):(i=e.lookupDisplay(t.argv[0]||t.display),t.argv.splice(0,1)),i||e.error("invalid display for resize"),(t=e.Display.prototype.resize.apply(i,t.argv))===i?e.globalOpts.quietReturn?"":"OK":t}),e.mkPublic("SelectDisplay",function(){var t=e.parsePublicArgs(arguments);(t=e.lookupDisplay(t.argv[0]||t.display))||e.error("invalid display for select"),e.hasOwnProperty("Menubar")||e.error("Menubar is required for display selection"),e.Menubar.onclick(t)}),e.mkPublic("GatherDisplay",function(t,i){var s;switch((s=e.parsePublicArgs(arguments)).argv.length){case 0:t=s.display,i=null;break;case 1:"object"==typeof s.argv[0]||"string"==typeof s.argv[0]&&"{"===s.argv[0].charAt(0)?(t=s.display,i=s.argv[0]):t=s.argv[0]||s.display;break;default:t=s.argv[0]||s.display,i=s.argv[1]}(s=e.lookupDisplay(t))||e.error("invalid display for gather"),e.Display.prototype.gather.call(s,i)}),e.mkPublic("SeparateDisplay",function(t,i){var s;switch((s=e.parsePublicArgs(arguments)).argv.length){case 0:t=s.display,i=null;break;case 1:"object"==typeof s.argv[0]||"string"==typeof s.argv[0]&&"{"===s.argv[0].charAt(0)?(t=s.display,i=s.argv[0]):t=s.argv[0]||s.display;break;default:t=s.argv[0]||s.display,i=s.argv[1]}(s=e.lookupDisplay(t))||e.error("invalid display for separate"),e.Display.prototype.separate.call(s,i)}),e.mkPublic("CenterDisplay",function(){var t=e.parsePublicArgs(arguments);(t=e.lookupDisplay(t.argv[0]||t.display))||e.error("invalid display for center"),e.Display.prototype.center.call(t)}),e.mkPublic("SaveSession",function(t,i){var s,a,n={};if(i=(a=e.parsePublicArgs(arguments)).argv[1],"object"==typeof(t=a.argv[0]))n=$.extend(!0,{},t);else if("string"==typeof t)try{n=JSON.parse(t)}catch(r){if(s=t,i)if("object"==typeof i)n=$.extend(!0,{},i);else try{n=JSON.parse(i)}catch(o){n={}}}return n.mode||(n.mode="display"),(a=e.lookupDisplay(a.display?a.display:n.display?n.display:0<e.displays.length?e.displays[0].id:e.DEFID)).image?(s||(s="display"===n.mode?"js9-"+(new Date).toISOString().slice(0,10)+".ses":a.image.id+".ses"),a.image.saveSession(s,n)):null}),e.mkPublic("LoadSession",function(t,i){var s,a;if(s=e.parsePublicArgs(arguments),i=s.argv[1],(t=s.argv[0])||e.error("JS9.LoadSession: no file specified for load"),"object"==typeof i)i=$.extend(!0,{},i);else if("string"==typeof i)try{i=JSON.parse(i)}catch(n){i={}}else i={};a=e.lookupDisplay(s.display?s.display:i.display?i.display:0<e.displays.length?e.displays[0].id:e.DEFID),i.display=a.id,"object"==typeof t?((s=new FileReader).onload=function(s){s=JSON.parse(s.target.result),i.sessionPath=e.dirname(t.path||t.name||""),a.loadSession(s,i)},s.readAsText(t)):"string"==typeof t?(i.responseType="text",i.display=a.id,t=e.fixPath(t),e.fetchURL(null,t,i,function(i,s){var n=JSON.parse(i);s.sessionPath=e.dirname(t),a.loadSession(n,s)})):e.error("unknown file type for LoadSession: "+typeof t)}),e.mkPublic("SaveCatalog",function(t,i){var s=e.parsePublicArgs(arguments),a=e.getImage(s.display);if(a)return a.saveCatalog(t=s.argv[0],i=s.argv[1])}),e.mkPublic("LoadCatalog",function(t,i,s){var a,n;if(a=e.parsePublicArgs(arguments),i=a.argv[1],s=a.argv[2],(t=a.argv[0])&&!i&&(i=t,t=null),i||e.error("JS9.LoadCatalog: no file specified for catalog load"),n=e.getImage(a.display)){if("object"==typeof s)s=$.extend(!0,{},s);else if("string"==typeof s)try{s=JSON.parse(s)}catch(r){s={}}else s={};"object"==typeof i?((a=new FileReader).onload=function(e){!t&&i.name&&(t=i.name.replace(/\.[^.]*$/,"")),n.loadCatalog(t,e.target.result,s),s&&s.onload&&s.onload(n)},a.readAsText(i)):"string"==typeof i?i.match(/\t/)?(n.loadCatalog(t,i,s),s&&s.onload&&s.onload(n)):(s.responseType="text",i=e.fixPath(i),e.fetchURL(null,i,s,function(e){n.loadCatalog(t,e,s),s&&s.onload&&s.onload(n)})):e.error("unknown file type for LoadCatalog: "+typeof i)}}),e.mkPublic("CreateMosaic",function(){var t=e.parsePublicArgs(arguments),i=e.lookupDisplay(t.display),s=t.argv[0];if(t=t.argv[1],i)return i.createMosaic(s,t)}),e.mkPublic("DisplayPlugin",function(t){var i,s,a,n;i=e.parsePublicArgs(arguments);var r=e.lookupDisplay(i.display);if(r&&i.argv[0]){for(n=(t=i.argv[0]).toLowerCase(),i=0;i<e.plugins.length;i++)if((a=(s=e.plugins[i]).name)===t||a.toLowerCase().substr(-n.length)===n)return void r.displayPlugin(s);e.error("can't find plugin: "+t)}}),e.mkPublic("DisplayHelp",function(t){var i,s,a,n=e.lightOpts.dhtml.textWin;t&&(s=t.split("/").reverse()[0],i="help_"+e.uniqueID(),(a=e.helpOpts[t])?(t=e.InstallDir(a.type+"/"+a.url),e.lightWin(i,"iframe",t,a.title||s,n)):e.lightWin(i,"iframe",t,s,n))}),e.mkPublic("LightWindow",function(t,i,s,a,n){var r=e.parsePublicArgs(arguments);return t=r.argv[0]||"lightWindow"+e.uniqueID(),i=r.argv[1]||"inline",(s=r.argv[2])||e.error("no content specified for LightWindow"),e.lightWin(t,i,s,a=r.argv[3]||"JS9 light window",n=r.argv[4]||e.lightOpts.dhtml.textWin)}),e.mkPublic("WindowPrint",function(t){var i={cmd:"print"},s=e.parsePublicArgs(arguments);s.argv[0]&&(i.opts=s.argv[0]),window.isElectron&&window.electronIPC?window.setTimeout(function(){try{window.electronIPC.send("msg",i)}catch(t){e.error("could not print window",t)}},e.TIMEOUT):e.error("WindowPrint is only available for the JS9 desktop app")}),e.mkPublic("WindowToPDF",function(t){var i=e.parsePublicArgs(arguments),s={cmd:"pdf"};s.filename=i.argv[0]||"js9.pdf",i.argv[1]&&(s.opts=i.argv[1]),window.isElectron&&window.electronIPC?window.setTimeout(function(){try{window.electronIPC.send("msg",s)}catch(t){e.error("could not create window pdf",t)}},e.TIMEOUT):e.error("WindowToPDF is only available for the JS9 desktop app")}),e.mkPublic("SaveDir",function(t){var i={cmd:"savedir"},s=e.parsePublicArgs(arguments);s.argv[0]?i.opts=s.argv[0]:e.error("SaveDir requires a directory name"),window.isElectron&&window.electronIPC?window.setTimeout(function(){try{window.electronIPC.send("msg",i)}catch(t){e.error("could not set save directory",t)}},e.TIMEOUT):e.error("SaveDir is only available for the JS9 desktop app")}),e}(),$(document).ready(function(){$(document).on("JS9:ready",function(){JS9.readied||(JS9.readied=!0,JS9.Preload(!0))}),$(document).on("JS9:init",function(){JS9.helper.ready&&JS9.fits.ready&&$(document).trigger("JS9:ready",{status:"OK"})}),$(document).on("astroem:ready",function(){if(JS9.initFITS(),window.isElectron&&JS9.hasNode)try{JS9.vmount("/",JS9.localMount)||delete JS9.localMount}catch(e){delete JS9.localMount}JS9.helper.ready&&JS9.inited&&$(document).trigger("JS9:ready",{status:"OK"})}),$(document).on("JS9:helperReady",function(){JS9.fits.ready&&JS9.inited&&!JS9.readied&&$(document).trigger("JS9:ready",{status:"OK"})}),0===$('div[data-js9init="false"]').length&&JS9.init()}),function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[r]={exports:{}};t[r][0].call(h.exports,function(e){return a(t[r][1][e]||e)},h,h.exports,e,t,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t,i){"use strict";var s,a;s=e("./xhr"),a=e("./remote-service"),e("./image-services"),e("./catalog-services"),JS9.RegisterPlugin("DataSources","ArchivesCatalogs",function(){var e=this.div;e.innerHTML='<form class="JS9Archive-form">\t    <select class="service-menu"></select>\t    <select class="server-menu"></select>\t    <select class="source-menu"></select>\t    <span style="float: right;"><input type=button value="Set RA/Dec" class="get-ra-dec">&nbsp;&nbsp;<input type=button value="Retrieve Data" class="service-go"></span>\t\t    <p>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    <table width="98%">\t\t\t\t\t\t\t\t\t\t    <tr><td> Object: </td> <td> <input type=text name=object size=12> </td>\t\t\t\t<td></td>\t\t\t\t\t\t\t\t\t\t\t<td></td>\t\t\t\t\t\t\t\t\t\t\t<td>&nbsp;&nbsp;</td>\t\t\t\t\t\t\t\t\t\t<td> <input type=checkbox name=gzip> Use Compression</td>\t\t\t\t    </tr>\t\t\t\t\t\t\t\t\t\t\t    <tr><td> RA:  \t</td><td>\t<input type=text name=ra\tsize=12> </td>\t\t\t<td> Dec: \t</td><td>\t<input type=text name=dec\tsize=12> </td>\t\t\t<td></td>\t\t\t\t\t\t\t\t\t\t\t<td> <input type=checkbox name=CORS checked> Use CORS Proxy</td>\t\t\t    <tr><td> Width: </td><td>\t<input type=text name=width\tsize=12 value=15> </td>\t\t\t<td> Height: </td><td>\t<input type=text name=height\tsize=12 value=15> </td>\t\t    </tr>\t\t\t\t\t\t\t\t\t\t\t    </table>\t\t\t\t\t\t\t\t\t\t\t    <div class=controls></div>\t\t\t\t\t\t\t\t\t    <p><span class=status></span>\t\t\t\t\t\t\t\t    </form>';var t=$(e).find(".service-menu"),i=$(e).find(".server-menu"),n=$(e).find(".source-menu");$(t).data("submenu",i),$(i).data("submenu",n);var r=this.display;$(e).find(".service-go").on("mouseup",function(){!function(e,t){var i=$(e).find(".JS9Archive-form")[0];if(""!==i.ra.value&&""!==i.dec.value){var s=parseFloat(i.width.value),n=parseFloat(i.height.value);"-"!==i.dec.value[0]&&"+"!==i.dec.value[0]&&(i.dec.value="+"+i.dec.value),s>60&&(i.width.value="60",s=60),n>60&&(i.height.value="60",n=60);var r=$(i).find(".server-menu")[0],o=$(i).find(".source-menu")[0],l=o.options[o.selectedIndex].value,c=o.options[o.selectedIndex].innerHTML;a.Services[r.options[r.selectedIndex].value].retrieve({name:i.object.value,e:"J2000",h:n.toString(),w:s.toString(),r:i.ra.value,d:i.dec.value,c:i.gzip.checked,s:l,source:c,CORS:i.CORS.checked,display:t},function(t){$(e).find(".status").html(t)})}}(e,r)}),$(e).find(".get-ra-dec").on("mouseup",function(){!function(e,t){function i(t){$(e).find(".status").html(t)}var a=$(e).find(".JS9Archive-form")[0];if(""!==a.object.value){var n=encodeURI((JS9.globalOpts.simbadProxy||"https://js9.si.edu/cgi-bin/simbad-proxy.cgi")+"?"+a.object.value);s({url:n,title:"Name",status:i},function(e,t){var s=t.responseText.trim().split(" ");":"!==s[0][1]?(a.ra.value=s[0],a.dec.value=s[1]):i("<span style='color: red;'>Object not found?</span>")})}else{var r=JS9.GetImage({display:t}),o=JS9.pix2wcs(r.raw.wcs,r.raw.header.NAXIS1/2,r.raw.header.NAXIS2/2).split(/ +/),l=JS9.PixToWCS(r.raw.header.NAXIS1/2+1,r.raw.header.NAXIS2/2+1,{display:r});a.ra.value=o[0]||"",a.dec.value=o[1]||"";var c=JS9.PixToWCS(1,r.raw.header.NAXIS2/2+1,{display:r}),h=JS9.PixToWCS(r.raw.header.NAXIS1+1,r.raw.header.NAXIS2/2+1,{display:r});a.width.value=Math.floor(Math.abs(60*(c.ra-h.ra))*Math.cos(l.dec/57.2958)*10)/10,c=JS9.PixToWCS(r.raw.header.NAXIS1/2+1,1,{display:r}),h=JS9.PixToWCS(r.raw.header.NAXIS1/2+1,r.raw.header.NAXIS2+1,{display:r}),a.height.value=Math.floor(10*Math.abs(60*(c.dec-h.dec)))/10}}(e,r)});var o=[];$.each(a.Services,function(e,t){"image-service"===t.type&&o.push({text:t.params.text,value:t.params.value,subdata:t.params.surveys})});var l=[];$.each(a.Services,function(e,t){"catalog-service"===t.type&&l.push({text:t.params.text,value:t.params.value,subdata:t.params.surveys})}),$(t).data("menu",[{text:"Image Servers",value:"imgserv",subdata:o},{text:"Catalog Servers",value:"catserv",subdata:l}]),function e(t){var i=t[0],s=$(t).data("menu"),a=$(t).data("submenu");i.options.length=0,$.each(s,function(e,t){i.options[i.options.length]=new Option(t.text,t.value)}),void 0!==a&&($(a).data("menu",s[i.selectedIndex].subdata),e(a),t.change(function(){$(a).data("menu",s[i.selectedIndex].subdata),e(a)}))}(t)},{menu:"view",menuItem:"Archives & Catalogs",winTitle:"Archives & Catalogs",winDims:[625,175],help:"archive/archive.html"})},{"./catalog-services":3,"./image-services":5,"./remote-service":6,"./xhr":10}],2:[function(e,t,i){"use strict";var s=e("./remote-service"),a=(e("./starbase"),e("./strtod"),e("./template")),n=e("./xhr");t.exports=function(e){s.Register(e.value,this),this.type="catalog-service",this.params=e,this.table2cat=function(e,t){var i,s,a,n=this.params.shape,r=t[this.params.xcol],o=t[this.params.ycol],l=function(e,t,i){var s=JS9.WCSToPix(t,i,{display:e});return s?{x:s.x,y:s.y}:null};switch(n){case"box":a=function(e){return{width:7,height:7}};break;case"circle":a=function(e){return{radius:3.5}};break;case"ellipse":a=function(e){return{width:7,height:7}}}var c,h,u,d=[];for(i=0,s=0;i<t.data.length;i++)(c=l(e,15*t.data[i][r],t.data[i][o]))&&(h=a(e,t.data[i][1],t.data[i][1]),u={id:i.toString(),shape:n,x:c.x,y:c.y,width:h.width,height:h.height,radius:h.radius,angle:0,data:{ra:15*t.data[i][r],dec:t.data[i][o]}},d[s++]=u);return d},this.retrieve=function(e,t){this.params.calc(e),e.units=this.params.units;var i=a(this.params.url,e),s=n({url:i,title:"Catalog",status:t,CORS:e.CORS},function(t){var i,a,n;a=JS9.GetImage({display:e.display}),i=s.responseText,(n={}).units=e.units,JS9.LoadCatalog(e.name,i,n,{display:a})})}}},{"./remote-service":6,"./starbase":7,"./strtod":8,"./template":9,"./xhr":10}],3:[function(e,t,i){"use strict";e("./strtod");var s=e("./catalog-service");new s({text:"SAO",value:"saoCat",surveys:[{value:"tmc",text:"Two Mass Catalog"},{value:"gsc2",text:"Guide Star Catalog 2"}],url:"http://www.cfa.harvard.edu/catalog/scat?catalog={s}&ra={r}&dec={d}&width={w}&height={h}&system={e}&compress={c}",calc:function(e){e.c&&(e.c="gzip"),e.w=60*e.w,e.h=60*e.h,e.name=e.source+"@"+this.text},shape:"circle",xcol:"ra",ycol:"dec"}),new s({text:"VizieR",value:"vizCat",surveys:[{value:"II/246",text:"2MASS"},{value:"2MASX",text:"2MASS Extended Source"},{value:"B/DENIS",text:"DENIS 3rd Release 2005"},{value:"GLIMPSE",text:"Spitzer's GLIMPSE"},{value:"GSC2.3",text:"GSC-II Catalog, Version 2.3.2"},{value:"HIP2",text:"Hipparcos (2007)"},{value:"IRAS",text:"IRAS "},{value:"NVSS",text:"NRAO VLA Sky Survey"},{value:"SDSS-DR9",text:"SDSS Photometric Catalog"},{value:"Tycho-2",text:"Tycho-2"},{value:"UCAC4",text:"UCAC 4th Release"},{value:"USNO-A2",text:"USNO-A2"},{value:"USNO-B1",text:"USNO-B1"},{value:"WISE",text:"WISE"}],url:"http://vizier.u-strasbg.fr/viz-bin/asu-tsv?-source={s}&-out.add=_RAJ,_DEJ&-c={r}{d}&-c.bm={w}x{h}&-oc.form=s&-out.meta=h",calc:function(e){e.c&&(e.c="gzip"),e.name=e.source+"@"+this.text},shape:"box",xcol:"_RAJ2000",ycol:"_DEJ2000"})},{"./catalog-service":2,"./strtod":8}],4:[function(e,t,i){"use strict";var s=e("./remote-service"),a=e("./template"),n=e("./xhr");t.exports=function(e){s.Register(e.value,this),this.type="image-service",this.params=e,this.retrieve=function(t,i){var s=t.display;e.calc(t);var r=a(e.url,t);n({url:r,title:"Image",status:i,type:"blob",CORS:t.CORS},function(i,a){if(void 0===e.handler){var n=new Blob([a.response]);n.name=t.name,JS9.fits.handleFITSFile(n,{display:s})}else e.handler(i,a,e,t)})}}},{"./remote-service":6,"./template":9,"./xhr":10}],5:[function(e,t,i){"use strict";var s=e("./image-service"),a=function(e){return(""!==e.name?e.source+"_"+e.name:e.source+"_"+e.r+e.d).replace(/\s+/g,"_")+".fits"};new s({text:"DSS1@SAO",value:"saoDSS",surveys:[{value:"DSS1",text:"DSS1"}],url:"http://www.cfa.harvard.edu/archive/dss?r={r}&d={d}&w={w}&h={h}&e={e}&c={c}",calc:function(e){e.c&&(e.c="gzip"),e.name=a(e)}}),new s({text:"DSS@STScI",value:"stsDSS",surveys:[{value:"poss2ukstu_ir",text:"STScI DSS2 IR"},{value:"poss2ukstu_red",text:"STScI DSS2 Red"},{value:"poss2ukstu_blue",text:"STScI DSS2 Blue"},{value:"poss1_red",text:"STScI DSS1 Red"},{value:"poss1_blue",text:"STScI DSS1 Blue"}],url:"http://stdatu.stsci.edu/cgi-bin/dss_search?r={r}&d={d}&w={w}&h={h}&e={e}&c={c}&v={s}&f=fits",calc:function(e){e.c=e.c?"gz":"none",e.name=a(e)}}),new s({text:"DSS@ESO",value:"esoDSS",surveys:[{value:"DSS2-infrared",text:"ESO DSS2 IR"},{value:"DSS2-red",text:"ESO DSS2 Red"},{value:"DSS2-blue",text:"ESO DSS2 Blue"},{value:"DSS1",text:"ESO DSS1"}],url:"http://archive.eso.org/dss/dss?ra={r}&dec={d}&equinox=J2000&x={w}&y={h}&mime-type={c}&Sky-Survey={s}",calc:function(e){e.c=e.c?"display/gz-fits":"application/x-fits",e.name=a(e)}}),new s({text:"2Mass@IPAC",value:"ipac2m",surveys:[{value:"j",text:"IPAC 2Mass J"},{value:"h",text:"IPAC 2Mass H"},{value:"k",text:"IPAC 2Mass K"}],url:"http://irsa.ipac.caltech.edu/cgi-bin/Oasis/2MASSImg/nph-2massimg?objstr={r},{d}&size={radius}&band={s}",calc:function(e){e.radius=Math.floor(60*Math.sqrt(e.w*e.w+e.h*e.h)),e.name=a(e)}})},{"./image-service":4}],6:[function(e,t,i){"use strict";i.Services={},i.Register=function(e,t){i.Services[e]=t}},{}],7:[function(e,t,i){"use strict";function s(e){return e}function a(e){var t;for(t=0;t<e.length;t++)if(null===e[t].match(/^-+$/))return 0;return t}t.exports=function(e,t){var i,n,r;t=t||{},this.head={},this.type=[],this.data=[],e=e.replace(/\s+$/,"").split("\n");var o=0;if(t.skip)for(r=t.skip.split("");o<e.length&&(r[0]===e[o][0]||"\n"===r[1]&&""===e[o]);o++);if(void 0!==e[o]&&void 0!==e[o+1]){this.headline=e[o++].trim().split(/ *\t */),t.units&&(this.unitline=e[o++].trim().split(/ *\t */)),this.dashline=e[o++].trim().split(/ *\t */);for(var l=a(this.dashline);0===l||l!==this.headline.length;)t.units?(this.headline=this.unitline,this.unitline=this.dashline):this.headline=this.dashline,this.dashline=e[o++].trim().split(/ *\t */),l=a(this.dashline);for(i=0;i<this.headline.length;i++)this.type[i]=t.type&&t.type[this.headline[i]]?t.type[this.headline[i]]:t.type&&t.type.default?t.type.default:s;for(n=0;o<e.length&&r[0]!==e[o][0]&&("\n"!==r[1]||""!==e[o]);o++,n++)for(this.data[n]=e[o].split("\t"),i=0;i<this.data[n].length;i++)this.data[n][i]=this.type[i](this.data[n][i]);for(i=0;i<this.headline.length;i++)this[this.headline[i]]=i}}},{}],8:[function(e,t,i){"use strict";t.exports=function(e){var t,i=e.trim().split(/[: ]/);if(3===i.length){var s=1;"-"===i[0].substr(0,1)&&(s=-1);var a=parseFloat(i[0]),n=parseFloat(i[1]),r=parseFloat(i[2]);t=s*(Math.abs(a)+n/60+r/3600)}else t=parseFloat(e);return isNaN(t)?e:t}},{}],9:[function(e,t,i){"use strict";function s(e,t){var i,s="";for(i=0;i<t;i++)s+=e;return s}t.exports=function(e,t){return e.replace(/\{([a-zA-Z0-9_.%]*)\}/g,function(e,i){var a,n,r,o,l,c=t;for(o=(i=i.split("%")).length<=1?"%s":i[1],i=(i=i[0]).split("."),l=0;l<i.length;l++){if(!c.hasOwnProperty(i[l]))return"";c=c[i[l]]}switch(a=o.substring(o.length-1),r=0|(n=(n=o.substring(0,o.length-1)).split("."))[0],n=0|n[1],a){case"s":c=c.toString();break;case"f":c=c.toFixed(n);break;case"d":c=c.toFixed(0)}return 0!==r&&r>c.length&&(r>0?c=s(" ",r-c.length)+c:c+=s(" ",r-c.length)),c})}},{}],10:[function(e,t,i){"use strict";t.exports=function(e,t){var i=e.status,s="",a=JS9.globalOpts.corsProxy||"https://js9.si.edu/cgi-bin/CORS-proxy.cgi";e.CORS&&(e.url=e.url.replace(/\?/g,"@"),e.url=e.url.replace(/&/g,"!"),e.url=encodeURI(e.url),e.url=a+"?Q="+e.url),JS9.DEBUG>1&&console.log("archive/catalog url: %s",e.url);var n=new XMLHttpRequest;return n.open("GET",e.url,!0),e.title&&(s=e.title),e.type&&(n.responseType=e.type),void 0!==i&&(n.addEventListener("progress",function(e){i(s+" progress "+e.loaded.toString())}),n.addEventListener("error",function(e){i(s+" service error")}),n.addEventListener("abort",function(e){i(s+" service aborted")})),n.onload=function(e){4===this.readyState&&(200!==this.status&&0!==this.status||(void 0!==i&&i(""),t(e,this)))},n.send(),n}},{}]},{},[1]),function(){function e(e,t){var i,s,a,n=JS9.GetImage({display:t}),r=$(e).find(".binning-form")[0];if(n&&n.raw)switch(i=n.raw.hdu,JS9.fitsLibrary()){case"fitsy":"image"===i.imtab?JS9.error("image binning not implemented"):(s=$.extend(!0,{},JS9.fits.opts,{table:{xcen:r.xcen.value,ycen:r.ycen.value,xdim:r.xdim.value,ydim:r.ydim.value,bin:r.bin.value,filter:r.filter.value}}),Fitsy.readTableHDUData(i.fits,i,s,function(e){!function(e,t,i){var s,a=/(\[.*[a-zA-Z0-9_].*\])\[.*\]/,n={display:i};r.separate.checked?(r.filter.value&&(s="["+r.filter.value.replace(/\s+/g,"")+"]",n.id=e.id.replace(a,"$1")+s,n.file=e.fitsFile?e.fitsFile.replace(a,"$1")+s:n.id),JS9.checkNew(new JS9.Image(t,n))):JS9.RefreshImage(t,n)}(n,e,t)}));break;case"cfitsio":s={xcen:0,ycen:0,xdim:0,ydim:0,bin:1,filter:""},JS9.isNumber(r.xcen.value)&&(s.xcen=parseFloat(r.xcen.value)),JS9.isNumber(r.ycen.value)&&(s.ycen=parseFloat(r.ycen.value)),(a=n.maybePhysicalToImage({x:s.xcen,y:s.ycen}))&&(s.xcen=a.x,s.ycen=a.y),JS9.isNumber(r.xdim.value)&&(s.xdim=Math.floor(parseFloat(r.xdim.value))),JS9.isNumber(r.ydim.value)&&(s.ydim=Math.floor(parseFloat(r.ydim.value))),s.bin=!r.bin.value.match(/^[+-]/)&&JS9.isNumber(r.bin.value)?Math.floor(parseFloat(r.bin.value)):r.bin.value,s.filter=r.filter.value,s.separate=$(r.separate).prop("checked"),n.displaySection(s)}}function t(){var t=this,i=this.div,s=this.display,a=this.winHandle,n="",r=JS9.GetImage({display:this.display});!r||r&&!r.raw.hdu?i.innerHTML='<p style="padding: 5px"><center>FITS image sections, with binning and filtering</center>':(a||(n='disabled="disabled"'),$(i).html('<form class="binning-form js9Form" style="margin: 0px; padding: 8px; width: 100%; height: 100%">\t\t    <table style="margin:0px; cellspacing:0; border-collapse:separate; border-spacing:4px 10px;">       \t           <tr>\t<td><input type=button class=full-image value="Load full image" style="text-align:right;"></td>\t\t\t\t<td>&nbsp;</td>    \t\t\t\t\t\t\t\t\t\t\t<td>&nbsp;</td>\t\t\t\t\t\t\t\t    \t\t\t\t<td>&nbsp;</td> \t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t        \t           <tr>\t<td><b>center:</b></td>\t\t\t\t\t\t\t\t\t\t\t<td><input type=text name=xcen size=10 style="text-align:right;"></td>\t\t\t\t\t<td><input type=text name=ycen size=10 style="text-align:right;"></td>    \t\t\t\t<td>&nbsp(center position of section)</td>\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t           <tr>\t<td><b>size:</b></td>\t\t\t\t\t\t\t\t\t\t\t<td><input type=text name=xdim size=10 style="text-align:right;"></td>\t\t\t\t\t<td><input type=text name=ydim size=10 style="text-align:right;"></td>\t\t\t\t\t<td>&nbsp(width, height of section)</td>\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t                   <tr>\t<td><b>bin:</b></td>\t\t\t\t\t\t\t\t\t\t<td><input type=text name=bin value=1 size=10 style="text-align:right;"></td>\t\t\t\t<td></td>\t\t\t\t\t\t\t\t\t\t\t\t<td>&nbsp(apply bin factor to section)</td>\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t           <tr>\t<td><b>filter:</b></td>\t\t\t\t\t\t\t\t\t\t\t<td colspan="2"><textarea name=filter rows="1" cols="22" style="text-align:left;" autocapitalize="off" autocorrect="off"></textarea></td>\t\t\t\t<td>&nbsp(event/row filter for tables)</td>\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t           <tr>\t<td><b>separate:</b></td>\t\t\t                        <td><input type=checkbox name=separate class="sep-image" style="text-align:left;"></td>\t\t\t\t<td></td>\t\t\t\t\t\t\t\t\t\t\t\t<td>&nbsp(display as separate image?)</td>\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t   <tr>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td><input type=button name=rebin value="Run" class="rebin-image"></td>         \t\t\t<td>&nbsp;</td>\t\t\t\t\t\t\t\t\t\t\t\t<td>&nbsp;</td>\t\t\t\t\t\t\t\t\t                        <td>&nbsp;<input type=button name=close value="Close" class="close-image" '+n+"></td> \t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t    </table>\t\t\t\t\t\t\t\t\t\t\t\t    </form>"),$(i).find(".full-image").on("mouseup",function(){!function(t,i,s,a){var n=JS9.GetImage({display:a}),r=$(s).find(".binning-form")[0],o=n.fileDimensions();r.xcen.value=0,r.ycen.value=0,r.xdim.value=o.xdim,r.ydim.value=o.ydim,e(s,a)}(0,0,i,s)}),$(i).find(".rebin-image").on("mouseup",function(){e(i,s)}),$(i).find(".close-image").on("mouseup",function(){a&&a.close()}),$(i).find(".sep-image").change(function(){t.sep=$(this).prop("checked")}),$(i).find(".sep-image").prop("checked",!!t.sep),r&&function(e,t){var i,s,a,n,r,o,l;void 0===t&&(e=this.div,t=this.display),(i=JS9.GetImage({display:t}))&&(a=$(e).find(".binning-form")[0],void 0!==i.raw.hdu?((n=i.raw.hdu).bin=n.bin||1,a.rebin.disabled=!1,void 0!==n.table?(a.bin.value=String(Math.floor(n.table.bin)),a.xcen.value=String(Math.floor(n.table.xcen)),a.ycen.value=String(Math.floor(n.table.ycen)),a.xdim.value=String(Math.floor(n.table.xdim)),a.ydim.value=String(Math.floor(n.table.ydim)),a.filter.value=n.table.filter||"",a.bin.disabled=!1,a.xcen.disabled=!1,a.ycen.disabled=!1,a.xdim.disabled=!1,a.ydim.disabled=!1,a.filter.disabled=!1):(i.parentFile&&i.raw.header&&void 0!==i.raw.header.LTM1_1?(o=1,l=i.raw.header.LTM1_1):(o=n.bin||1,l=1),r=Math.floor(o/l+.5),s=i.imageToLogicalPos({x:i.raw.width/2,y:i.raw.height/2}),a.xcen.value=String(Math.floor(s.x+.5*(r-1))),a.ycen.value=String(Math.floor(s.y+.5*(r-1))),a.bin.value=String(r),a.xdim.value=String(Math.floor(n.naxis1*r)),a.ydim.value=String(Math.floor(n.naxis2*r)),a.filter.value=i.raw.filter||"",a.bin.disabled=!1,a.xcen.disabled=!1,a.ycen.disabled=!1,a.xdim.disabled=!1,a.ydim.disabled=!1,a.filter.disabled=!1)):a.rebin.disabled=!0)}(i,s))}JS9.RegisterPlugin("FITS","Binning",t,{menu:"view",winTitle:"Image Sections, with Binning and Filtering",winResize:!0,menuItem:"Bin/Filter/Section",onplugindisplay:t,onimageload:t,onimagedisplay:t,help:"fitsy/binning.html",winDims:[520,250]})}(),JS9.Blend={},JS9.Blend.CLASS="JS9",JS9.Blend.NAME="Blend",JS9.Blend.WIDTH=550,JS9.Blend.HEIGHT=270,JS9.Blend.BASE=JS9.Blend.CLASS+JS9.Blend.NAME,JS9.Blend.blendModeHTML='When <b>Image Blending</b> is turned on, the images you select below will be combined using your chosen blend mode and optional opacity. See <a href="https://www.w3.org/TR/compositing-1/" target="blank">W3C Compositing and Blending</a> for info about compositing and blending.<p> <input type="checkbox" class="blendModeCheck" id="active" name="imageBlending" value="active" onclick="javascript:JS9.Blend.xblendmode(\'%s\', this)"><b>Image Blending</b>',JS9.Blend.imageHTML="<span style='float: left'>$active &nbsp;&nbsp; $blend &nbsp;&nbsp; $opacity</span>&nbsp;&nbsp; <span id='blendFile'>$imfile</span>",JS9.Blend.activeHTML='<input class="blendActiveCheck" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Blend.xactive(\'%s\', \'%s\', this)">blend using:',JS9.Blend.blendHTML='<select class="blendModeSelect" onchange="JS9.Blend.xblend(\'%s\', \'%s\', this)"><option selected disabled>blend mode</option><option value="normal">normal</option><option value="screen">screen</option><option value="multiply">multiply</option><option value="overlay">overlay</option><option value="darken">darken</option><option value="lighten">lighten</option><option value="color-dodge">color-dodge</option><option value="color-burn">color-burn</option><option value="hard-light">hard-light</option><option value="soft-light">soft-light</option><option value="difference">difference</option><option value="exclusion">exclusion</option><option value="hue">hue</option><option value="saturation">saturation</option><option value="color">color</option> <option value="luminosity">luminosity</option></select>',JS9.Blend.opacityHTML='<select class="blendOpacitySelect" onchange="JS9.Blend.xopacity(\'%s\', \'%s\', this)"><option selected disabled>opacity</option><option value="1.00">opaque</option><option value="0.95">0.95</option><option value="0.90">0.90</option><option value="0.85">0.85</option><option value="0.80">0.80</option><option value="0.75">0.75</option><option value="0.70">0.70</option><option value="0.65">0.65</option><option value="0.60">0.60</option><option value="0.55">0.55</option><option value="0.50">0.50</option><option value="0.45">0.45</option><option value="0.40">0.40</option><option value="0.35">0.35</option><option value="0.30">0.30</option><option value="0.25">0.25</option><option value="0.20">0.20</option><option value="0.10">0.10</option><option value="0.00">transparent</option></select>',JS9.Blend.imfileHTML="<b>%s</b>",JS9.Blend.nofileHTML='<p><span id="blendNoFile">[Images will appear here as they are loaded]</span>',JS9.Blend.xactive=function(e,t,i){var s=JS9.lookupImage(t,e),a=i.checked;s&&s.blendImage().active!==a&&s.blendImage(a)},JS9.Blend.xblend=function(e,t,i){var s,a=JS9.lookupImage(t,e);i.selectedIndex>=0&&(s=i.options[i.selectedIndex].value),a&&JS9.notNull(s)&&a.blendImage().mode!==s&&a.blendImage(s)},JS9.Blend.xopacity=function(e,t,i){var s,a,n=JS9.lookupImage(t,e);i.selectedIndex>=0&&(a=i.options[i.selectedIndex].value),n&&JS9.notNull(a)&&(s=n.blendImage(),a=parseFloat(a),s.opacity!==a&&n.blendImage(null,a))},JS9.Blend.xblendmode=function(e,t){var i=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));i&&JS9.BlendDisplay(t.checked,{display:i})},JS9.Blend.imid=function(e){return(e.display.id+"_"+e.id).replace(/[^A-Za-z0-9_]/g,"_")+"BlendImage"},JS9.Blend.dispclass=function(e){return(JS9.Blend.BASE+"_"+e.display.id).replace(/[^A-Za-z0-9_]/g,"_")},JS9.Blend.displayBlend=function(e){var t;e&&(t=e.display,this.divjq.find(".blendModeCheck").prop("checked",t.blendMode))},JS9.Blend.imageBlend=function(e,t){var i,s,a,n,r;s=e.blendImage(),a=JS9.Blend.imid(e),s&&((n=this.divjq.find("#"+a)).find(".blendActiveCheck").prop("checked",s.active),void 0!==s.mode&&(r=n.find(".blendModeSelect").val(s.mode),t&&r.change()),void 0!==s.opacity&&(i="number"==typeof s.opacity?s.opacity.toFixed(2):s.opacity,r=n.find(".blendOpacitySelect").val(i),t&&r.change()))},JS9.Blend.activeImage=function(e){var t,i;e&&(t=JS9.Blend.imid(e),i=JS9.Blend.dispclass(e)+"_Image",$("."+i).removeClass(JS9.Blend.BASE+"ImageActive").addClass(JS9.Blend.BASE+"ImageInactive"),$("#"+t).removeClass(JS9.Blend.BASE+"ImageInactive").addClass(JS9.Blend.BASE+"ImageActive"))},JS9.Blend.addImage=function(e){var t,i,s,a,n,r=[],o=JS9.Blend.BASE+"Image";e&&(n=e.id,a=e.display.id,i=JS9.Blend.imid(e),s=JS9.Blend.dispclass(e)+"_Image",r.push({name:"imid",value:n}),r.push({name:"active",value:sprintf(JS9.Blend.activeHTML,a,n)}),r.push({name:"opacity",value:sprintf(JS9.Blend.opacityHTML,a,n)}),r.push({name:"blend",value:sprintf(JS9.Blend.blendHTML,a,n)}),r.push({name:"imfile",value:sprintf(JS9.Blend.imfileHTML,n)}),this.blendDivs||this.blendImageContainer.html(""),t=JS9.Image.prototype.expandMacro.call(e,JS9.Blend.imageHTML,r),$("<div>").addClass(o).addClass(s).attr("id",i).prop("imid",n).html(t).appendTo(this.blendImageContainer).on("mousedown touchstart",function(){e.displayImage(),JS9.Blend.activeImage.call(this,e)}),JS9.Blend.imageBlend.call(this,e,!1),JS9.Blend.displayBlend.call(this,e),this.blendDivs++,JS9.Blend.activeImage(e))},JS9.Blend.removeImage=function(e){var t;return!!e&&(t=JS9.Blend.imid(e),$("#"+t).remove(),this.blendDivs--,0===this.blendDivs&&this.blendImageContainer.html(JS9.Blend.nofileHTML),!0)},JS9.Blend.init=function(e,t){var i,s,a,n,r=this;for("div"===this.winType&&(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Blend.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Blend.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10)),this.divjq.html(""),this.blendDivs=0,this.divjq.addClass("JS9PluginScrolling"),this.blendContainer=$("<div>").addClass(JS9.Blend.BASE+"Container").attr("id",this.id+"BlendContainer").appendTo(this.divjq),this.blendHeader=$("<div>").addClass(JS9.Blend.BASE+"Header").attr("id",this.display.id+"Header").html(sprintf(JS9.Blend.blendModeHTML,this.display.id)).appendTo(this.blendContainer),this.blendImageContainer=$("<div>").addClass(JS9.Blend.BASE+"ImageContainer").attr("id",this.id+"BlendImageContainer").html(JS9.Blend.nofileHTML).appendTo(this.blendContainer),a=(n=JS9.getDynamicDisplayOr(this.display)).blendMode,n.blendMode=!1,i=0;i<JS9.images.length;i++)(s=JS9.images[i]).display===n&&JS9.Blend.addImage.call(this,s);n.blendMode=a,n.image&&n.image.displayImage(),this.divjq.find(".blendModeCheck").prop("checked",!!n.blendMode),this.blendImageContainer.sortable({start:function(e,t){this.oidx=t.item.index()},stop:function(e,t){var i=t.item.index();JS9.images.splice(i,0,JS9.images.splice(this.oidx,1)[0]),r.display.image&&r.display.image.displayImage()}})},JS9.Blend.dysel=function(){var e,t=JS9.getDynamicDisplayOr("previous");t&&(e=t.blendMode,t.blendMode=!1,t.image&&t.image.displayImage()),JS9.Blend.init.call(this),t&&(t.blendMode=e)},JS9.Blend.displayblend=function(e){e&&JS9.Blend.displayBlend.call(this,e)},JS9.Blend.imageblend=function(e){e&&JS9.Blend.imageBlend.call(this,e,!1)},JS9.Blend.imageload=function(e){var t=JS9.getDynamicDisplayOr(this.display);e&&e.display===t&&JS9.Blend.addImage.call(this,e)},JS9.Blend.imagedisplay=function(e){JS9.Blend.activeImage.call(this,e)},JS9.Blend.imageclose=function(e){JS9.Blend.removeImage.call(this,e)},JS9.Blend.sessionload=function(e){e&&JS9.Blend.init.call(this)},JS9.RegisterPlugin(JS9.Blend.CLASS,JS9.Blend.NAME,JS9.Blend.init,{menuItem:"Blending",dynamicSelect:!0,onplugindisplay:JS9.Blend.init,ondynamicselect:JS9.Blend.dysel,ondisplayblend:JS9.Blend.displayblend,onimageblend:JS9.Blend.imageblend,onimageload:JS9.Blend.imageload,onimagedisplay:JS9.Blend.imagedisplay,onimageclose:JS9.Blend.imageclose,onsessionload:JS9.Blend.sessionload,help:"help/blend.html",winTitle:"Image Blending",winResize:!0,winDims:[JS9.Blend.WIDTH,JS9.Blend.HEIGHT]}),JS9.Blink={},JS9.Blink.CLASS="JS9",JS9.Blink.NAME="Blink",JS9.Blink.WIDTH=512,JS9.Blink.HEIGHT=270,JS9.Blink.BASE=JS9.Blink.CLASS+JS9.Blink.NAME,JS9.Blink.rate=1e3,JS9.Blink.blinkModeHTML="When <b>Blink Images</b> is turned on, selected images will be displayed at the specified blink rate. You also can blink the selected images manually. The blink sequence can be changed by moving images around in the stack. <p>$mode&nbsp;&nbsp;&nbsp;&nbsp;$rate&nbsp;&nbsp;&nbsp;&nbsp;$manual",JS9.Blink.modeHTML='<input type="checkbox" id="active" name="blinkImages" value="active" onclick="javascript:JS9.Blink.xblinkmode(\'%s\', this)"><b>Blink Images</b>',JS9.Blink.rateHTML='<select id="blinkRateSelect" onfocus="this.selectedIndex=0;" onchange="JS9.Blink.xrate(\'%s\',this)"><option selected disabled>blink rate</option><option value="0.1">0.1</option><option value="0.25">0.25</option><option value="0.5">0.5</option><option value="1.0">1.0</option><option value="2.0">2.0</option><option value="3.0">3.0</option><option value="4.0">4.0</option><option value="5.0">5.0</option><option value="6.0">6.0</option><option value="7.0">7.0</option><option value="8.0">8.0</option><option value="9.0">9.0</option><option value="10.0">10.0</option><option value="15.0">15.0</option><option value="20.0">20.0</option><option value="30.0">30.0</option></select>',JS9.Blink.manualHTML='<input type="button" id="manual" name="manualBlink" value="blink manually" onclick="javascript:JS9.Blink.xblink1(\'%s\', this)">',JS9.Blink.imageHTML="<span style='float: left'>$active&nbsp;&nbsp;</span><span id='blinkFile'>$imfile</span>",JS9.Blink.activeHTML='<input class="blinkActiveCheck" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Blink.xactive(\'%s\', \'%s\', this)">blink',JS9.Blink.imfileHTML="<b>%s</b>",JS9.Blink.nofileHTML='<p><span id="blinkNoFile">[Images will appear here as they are loaded]</span>',JS9.Blink.start=function(e){var t,i=!1,s=e.pluginInstances.JS9Blink,a=s.idx;if(s){for(;!i;)(t=JS9.images[s.idx]).display===e&&t.tmp.blinkMode&&(t.displayImage("display"),i=!0),++s.idx>=JS9.images.length&&(s.idx=0),s.idx===a&&(i=!0);e.blinkMode&&(e.pluginInstances.JS9Blink.tid=window.setTimeout(function(){JS9.Blink.start(e)},s.rate))}},JS9.Blink.stop=function(e){var t=e.pluginInstances.JS9Blink;t&&(t.tid&&(window.clearTimeout(t.tid),delete t.tid),e.blinkMode=!1,t.idx=0)},JS9.Blink.xactive=function(e,t,i){var s=JS9.lookupImage(t,e);s&&(s.tmp.blinkMode=i.checked)},JS9.Blink.xblinkmode=function(e,t){var i=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e)),s=t.checked;i&&($(".blinkActive").prop("disabled",!s),s?(i.blinkMode=!0,JS9.Blink.start(i)):JS9.Blink.stop(i))},JS9.Blink.xblink1=function(e,t){var i=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e)),s=i?i.pluginInstances.JS9Blink:null;s&&i&&(JS9.images[s.idx]===i.image&&++s.idx>=JS9.images.length&&(s.idx=0),JS9.Blink.start(i))},JS9.Blink.xrate=function(e,t){var i=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e)),s=i?i.pluginInstances.JS9Blink:null,a=Math.floor(1e3*t.options[t.selectedIndex].value);s&&i&&(isNaN(a)||(s.rate=a))},JS9.Blink.imid=function(e){return(e.display.id+"_"+e.id).replace(/[^A-Za-z0-9_]/g,"_")+"BlinkImage"},JS9.Blink.dispclass=function(e){return(JS9.Blink.BASE+"_"+e.display.id).replace(/[^A-Za-z0-9_]/g,"_")},JS9.Blink.activeImage=function(e){var t,i;e&&(t=JS9.Blink.imid(e),i=JS9.Blink.dispclass(e)+"_Image",$("."+i).removeClass(JS9.Blink.BASE+"ImageActive").addClass(JS9.Blink.BASE+"ImageInactive"),$("#"+t).removeClass(JS9.Blink.BASE+"ImageInactive").addClass(JS9.Blink.BASE+"ImageActive"))},JS9.Blink.addImage=function(e){var t,i,s,a,n,r=[],o=JS9.Blink.BASE+"Image";e&&(n=e.id,a=e.display.id,i=JS9.Blink.imid(e),s=JS9.Blink.dispclass(e)+"_Image",r.push({name:"imid",value:e.id}),r.push({name:"active",value:sprintf(JS9.Blink.activeHTML,a,n)}),r.push({name:"imfile",value:sprintf(JS9.Blink.imfileHTML,n)}),this.blinkDivs||this.blinkImageContainer.html(""),t=JS9.Image.prototype.expandMacro.call(e,JS9.Blink.imageHTML,r),$("<div>").addClass(o).addClass(s).attr("id",i).prop("imid",n).html(t).appendTo(this.blinkImageContainer).on("mousedown touchstart",function(){e.displayImage(),JS9.Blink.activeImage.call(this,e)}),this.blinkDivs++,e.tmp.blinkMode=!1,JS9.Blink.activeImage(e))},JS9.Blink.removeImage=function(e){var t;return!!e&&(t=JS9.Blink.imid(e),$("#"+t).remove(),this.blinkDivs--,0===this.blinkDivs&&this.blinkImageContainer.html(JS9.Blink.nofileHTML),delete e.tmp.blinkMode,!0)},JS9.Blink.init=function(){var e,t,i,s,a,n=[],r=this;for(void 0===this.idx&&(this.idx=0),void 0===this.rate&&(this.rate=JS9.Blink.rate),this.divjq.html(""),this.blinkDivs=0,this.divjq.addClass("JS9PluginScrolling"),this.blinkContainer=$("<div>").addClass(JS9.Blink.BASE+"Container").attr("id",this.id+"BlinkContainer").css("overflow","auto").appendTo(this.divjq),n.push({name:"mode",value:sprintf(JS9.Blink.modeHTML,a=this.display.id)}),n.push({name:"manual",value:sprintf(JS9.Blink.manualHTML,a)}),n.push({name:"rate",value:sprintf(JS9.Blink.rateHTML,a)}),t=JS9.Image.prototype.expandMacro.call(null,JS9.Blink.blinkModeHTML,n),this.blinkHeader=$("<div>").addClass(JS9.Blink.BASE+"Header").attr("id",a+"Header").html(t).appendTo(this.blinkContainer),this.blinkImageContainer=$("<div>").addClass(JS9.Blink.BASE+"ImageContainer").attr("id",this.id+"BlinkImageContainer").html(JS9.Blink.nofileHTML).appendTo(this.blinkContainer),(s=JS9.getDynamicDisplayOr(this.display)).blinkMode=!1,e=0;e<JS9.images.length;e++)(i=JS9.images[e]).display===s&&JS9.Blink.addImage.call(this,i);this.blinkImageContainer.sortable({start:function(e,t){this.oidx=t.item.index()},stop:function(e,t){var i=t.item.index();JS9.images.splice(i,0,JS9.images.splice(this.oidx,1)[0]),r.display.image&&r.display.image.displayImage()}})},JS9.Blink.dysel=function(){var e=JS9.getDynamicDisplayOr("previous");e&&JS9.Blink.stop(e),JS9.Blink.init.call(this)},JS9.Blink.imageload=function(e){var t=JS9.getDynamicDisplayOr(this.display);e&&e.display===t&&JS9.Blink.addImage.call(this,e)},JS9.Blink.imagedisplay=function(e){JS9.Blink.activeImage.call(this,e)},JS9.Blink.imageclose=function(e){JS9.Blink.removeImage.call(this,e)},JS9.RegisterPlugin(JS9.Blink.CLASS,JS9.Blink.NAME,JS9.Blink.init,{menuItem:"Blinking",dynamicSelect:!0,onplugindisplay:JS9.Blink.init,ondynamicselect:JS9.Blink.dysel,onimageload:JS9.Blink.imageload,onimagedisplay:JS9.Blink.imagedisplay,onimageclose:JS9.Blink.imageclose,help:"help/blink.html",winTitle:"Image Blinking",winResize:!0,winDims:[JS9.Blink.WIDTH,JS9.Blink.HEIGHT]}),JS9.Cmaps={},JS9.Cmaps.CLASS="JS9",JS9.Cmaps.NAME="Cmaps",JS9.Cmaps.WIDTH=600,JS9.Cmaps.HEIGHT=270,JS9.Cmaps.BASE=JS9.Cmaps.CLASS+JS9.Cmaps.NAME,JS9.Cmaps.DEFMODE="equidistant",JS9.Cmaps.DEFNMAP=3,JS9.Cmaps.DEFASSIGN=!0,JS9.Cmaps.DEFNAME="cmap",JS9.Cmaps.DEFTOL=Math.pow(8,2),JS9.Cmaps.DEFTIMEOUT=0,JS9.Cmaps.COLORCLASS="cmapsColorPicker",JS9.Cmaps.CMAPCLASS="cmapsSelect",JS9.Cmaps.CHECKCLASS="cmapsActiveCheck",JS9.Cmaps.headerHTML='Select a color&nbsp;&nbsp;<input type="color" value="#FF0000" class="'+JS9.Cmaps.COLORCLASS+'">&nbsp;&nbsp;or a &nbsp;&nbsp;<select class="'+JS9.Cmaps.CMAPCLASS+'" onchange="JS9.Cmaps.xCmap(\'%s\',this)"></select>&nbsp;&nbsp;colormap to create&nbsp;&nbsp;<input type="number" onchange="JS9.Cmaps.xNslice(\'%s\',this)" value="'+JS9.Cmaps.DEFNMAP+'" min="1" max="36" size="3" style="width:40px;box-sizing: border-box;">&nbsp;&nbsp;<select class="cmapsMode" onchange="JS9.Cmaps.xMode(\'%s\',this)">&nbsp;&nbsp;<option value="equidistant">equidistant</option><option value="analogous">analogous</option></select><p>slices of the <a href="https://en.wikipedia.org/wiki/Color_wheel" target="_blank">colorwheel</a>,&nbsp;&nbsp;the first&nbsp;&nbsp;<input type="number" onchange="JS9.Cmaps.xNmap(\'%s\',this)" value="'+JS9.Cmaps.DEFNMAP+'" min="1" max="36" size="3" style="width:40px;box-sizing: border-box;">&nbsp;of which will be used to create colormaps.<p><input type="checkbox" onchange="JS9.Cmaps.xAssignCmaps(\'%s\',this)" checked> assign the new colormaps to these images:',JS9.Cmaps.imageHTML="<span style='float: left'>$active</span>&nbsp;&nbsp; <span style='float: right'>$imfile</span>",JS9.Cmaps.activeHTML='<input class="'+JS9.Cmaps.CHECKCLASS+'" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Cmaps.xActive(\'%s\', \'%s\', this)">&nbsp;',JS9.Cmaps.imfileHTML="<b>%s</b>",JS9.Cmaps.nofileHTML='<div class="JS9cmapsNoFile">[Colormap generation options will appear here after an image is loaded]</div>',JS9.Cmaps.equidistant=function(e,t,i){var s,a=tinycolor(e).toHsl(),n=a.h,r=360/i,o=[];for(s=0;s<t;s++)a.h=(n+s*r)%360,o.push(tinycolor(a));return o},JS9.Cmaps.mkColors=function(e,t,i,s){if(t&&i&&s)switch(e=e||"equidistant"){case"analogous":return tinycolor(t).analogous(i,s);case"equidistant":return JS9.Cmaps.equidistant(tinycolor(t),i,s);default:return[tinycolor(t)]}},JS9.Cmaps.assignCmaps=function(e){var t,i,s=0,a="."+JS9.Cmaps.CHECKCLASS;e.cmaps.names&&e.cmaps.names.length&&(i=e.cmaps.that.cmapsImageContainer).length&&(t=e.cmaps.names.length,i.find("."+JS9.Cmaps.BASE+"Image").each(function(i,n){var r=$(n),o=r.prop("imid"),l=JS9.lookupImage(o),c=r.find(a);l&&s<t&&c.prop("checked")&&(l.setColormap(e.cmaps.names[s++]),l.displayImage())}))},JS9.Cmaps.mkCmapsFromCmap=function(e,t,i,s,a){var n,r,o,l,c,h,u,d,p,f=[],g=[],m=[],v="rgb (%s,%s,%s)",b=function(e){return[e.r/255,e.g/255,e.b/255]},y=function(e,t){return JS9.Colormap.prototype.mkColorCell.call(e,t)};if(t&&i&&s)switch(d=(a=a||{}).mode||JS9.Cmaps.DEFMODE,p=t.name,e.cmaps.names=[],t.type){case"lut":for(n=0;n<i;n++)e.cmaps.names[n]=p+"_"+String(n+1),f[n]=[];for(n=0;n<t.colors.length;n++)for(c=sprintf(v,Math.floor(255*t.colors[n][0]+.5),Math.floor(255*t.colors[n][1]+.5),Math.floor(255*t.colors[n][2]+.5)),l=JS9.Cmaps.mkColors(d,c,i,s),r=0;r<i;r++)f[r].push(b(l[r].toRgb()));for(n=0;n<i;n++)(t=JS9.lookupColormap(e.cmaps.names[n],!1))?t.colors=f[n]:JS9.AddColormap(e.cmaps.names[n],f[n],{toplevel:!1});a.assign&&JS9.Cmaps.assignCmaps(e);break;case"sao":for(n=0;n<i;n++)e.cmaps.names[n]=t.name+"_"+String(n+1),g[n]=[[],[],[]];for(n=0;n<3;n++)for(r=0;r<t.vertices[n].length;r++)u=y(t,(h=t.vertices[n][r][0])*JS9.COLORSIZE),m.push({index:h,rgb:u});for(m.sort(function(e,t){return e.index>t.index?1:e.index<t.index?-1:0}),n=m.length-2;n>=0;n--)m[n].index===m[n+1].index&&m.splice(n+1,1);for(n=0;n<m.length;n++)for(c=sprintf(v,m[n].rgb[0],m[n].rgb[1],m[n].rgb[2]),l=JS9.Cmaps.mkColors(d,c,i,s),r=0;r<i;r++)o=b(l[r].toRgb()),g[r][0].push([m[n].index,o[0]]),g[r][1].push([m[n].index,o[1]]),g[r][2].push([m[n].index,o[2]]);for(n=0;n<i;n++)(t=JS9.lookupColormap(e.cmaps.names[n],!1))?t.vertices=g[n]:JS9.AddColormap(e.cmaps.names[n],g[n][0],g[n][1],g[n][2],{toplevel:!1});a.assign&&JS9.Cmaps.assignCmaps(e)}},JS9.Cmaps.mkCmapsFromColor=function(e,t,i,s,a){var n,r,o,l,c;if(t&&i&&s)return l=(a=a||{}).mode||"equidistant",c=e.id||JS9.Cmaps.DEFNAME,o=void 0!==a.rgbtol?a.rgbtol:e.cmaps.tol,n=tinycolor(t),r=n.toRgb(),Math.pow(Math.abs(r.r-e.cmaps.orgb.r),2)+Math.pow(Math.abs(r.g-e.cmaps.orgb.g),2)+Math.pow(Math.abs(r.b-e.cmaps.orgb.b),2)<o?0:e.cmaps.timeOutID?0:void(e.cmaps.timeOutID=window.setTimeout(function(){var t,o,h;for(e.cmaps.names=[],o=JS9.Cmaps.mkColors(l,n,i,s),e.cmaps.orgb.r=r.r,e.cmaps.orgb.g=r.g,e.cmaps.orgb.b=r.b,t=0;t<i;t++)if(r=o[t].toRgb(),e.cmaps.names[t]=c+"_"+String(t+1),h=JS9.lookupColormap(e.cmaps.names[t],!1))switch(h.type){case"lut":h.type="sao",h.vertices=[[[0,0],[1,r.r/255]],[[0,0],[1,r.g/255]],[[0,0],[1,r.b/255]]];break;case"sao":h.vertices=[[[0,0],[1,r.r/255]],[[0,0],[1,r.g/255]],[[0,0],[1,r.b/255]]]}else JS9.AddColormap(e.cmaps.names[t],[[0,0],[1,r.r/255]],[[0,0],[1,r.g/255]],[[0,0],[1,r.b/255]],{toplevel:!1});a.assign&&JS9.Cmaps.assignCmaps(e),e.cmaps.timeOutID=null},JS9.Cmaps.DEFTIMEOUT))},JS9.Cmaps.mkCmaps=function(e,t,i,s,a){var n;if(!t||!i||!s)return 0;(n=JS9.lookupColormap(t,!1))?JS9.Cmaps.mkCmapsFromCmap(e,n,i,s,a):JS9.Cmaps.mkCmapsFromColor(e,t,i,s,a)},JS9.Cmaps.xActive=function(e){var t=JS9.lookupDisplay(e);t&&t.cmaps.assign&&JS9.Cmaps.assignCmaps(t)},JS9.Cmaps.xMode=function(e,t){var i=JS9.lookupDisplay(e);i&&(i.cmaps.mode=t.options[t.selectedIndex].value,JS9.Cmaps.mkCmaps(i,i.cmaps.lastCname,i.cmaps.nmap,i.cmaps.nslice,{mode:i.cmaps.mode,assign:i.cmaps.assign,rgbtol:0}))},JS9.Cmaps.xNmap=function(e,t){var i=JS9.lookupDisplay(e);i&&(i.cmaps.nmap=parseInt(t.value,10)||1,JS9.Cmaps.mkCmaps(i,i.cmaps.lastCname,i.cmaps.nmap,i.cmaps.nslice,{mode:i.cmaps.mode,assign:i.cmaps.assign,rgbtol:0}))},JS9.Cmaps.xNslice=function(e,t){var i=JS9.lookupDisplay(e);i&&(i.cmaps.nslice=parseInt(t.value,10)||1,JS9.Cmaps.mkCmaps(i,i.cmaps.lastCname,i.cmaps.nmap,i.cmaps.nslice,{mode:i.cmaps.mode,assign:i.cmaps.assign,rgbtol:0}))},JS9.Cmaps.xCmap=function(e,t){var i=JS9.lookupDisplay(e),s=t.options[t.selectedIndex].value;i&&(JS9.Cmaps.mkCmaps(i,s,i.cmaps.nmap,i.cmaps.nslice,{mode:i.cmaps.mode,assign:i.cmaps.assign,rgbtol:0}),i.cmaps.lastCname=s)},JS9.Cmaps.xAssignCmaps=function(e,t){var i=JS9.lookupDisplay(e);i&&(i.cmaps.assign=$(t).prop("checked"),i.cmaps.assign&&JS9.Cmaps.assignCmaps(i))},JS9.Cmaps.imid=function(e){return(e.display.id+"_"+e.id).replace(/[^A-Za-z0-9_]/g,"_")+"CmapsImage"},JS9.Cmaps.dispclass=function(){return(JS9.Cmaps.BASE+"_"+this.display.id).replace(/[^A-Za-z0-9_]/g,"_")},JS9.Cmaps.activeImage=function(e){var t,i;e&&(t=JS9.Cmaps.imid.call(this,e),i=JS9.Cmaps.dispclass.call(this)+"_Image",$("."+i).removeClass(JS9.Cmaps.BASE+"ImageActive").addClass(JS9.Cmaps.BASE+"ImageInactive"),$("#"+t).removeClass(JS9.Cmaps.BASE+"ImageInactive").addClass(JS9.Cmaps.BASE+"ImageActive"))},JS9.Cmaps.addImage=function(e){var t,i,s,a,n,r=this,o=[],l=JS9.Cmaps.BASE+"Image";e&&(n=e.id,a=this.display.id,i=JS9.Cmaps.imid.call(this,e),s=JS9.Cmaps.dispclass.call(this)+"_Image",o.push({name:"imid",value:n}),o.push({name:"active",value:sprintf(JS9.Cmaps.activeHTML,a,n)}),o.push({name:"imfile",value:sprintf(JS9.Cmaps.imfileHTML,n)}),t=JS9.Image.prototype.expandMacro.call(e,JS9.Cmaps.imageHTML,o),$("<div>").addClass(l).addClass(s).addClass(JS9.Cmaps.BASE+"ImageInactive").prop("id",i).prop("imid",n).html(t).appendTo(this.cmapsImageContainer).on("mousedown touchstart",function(){a===e.display.id&&(e.displayImage(),JS9.Cmaps.activeImage.call(r,e))}),this.display.id===e.display.id&&JS9.Cmaps.activeImage.call(this,e))},JS9.Cmaps.removeImage=function(e){var t;return!!e&&(t=JS9.Cmaps.imid.call(this,e),$("#"+t).remove(),!0)},JS9.Cmaps.init=function(e,t){var i,s,a,n,r=this,o="."+JS9.Cmaps.COLORCLASS,l="."+JS9.Cmaps.CMAPCLASS,c=this.display;if(this.divjq.addClass("JS9PluginScrolling"),"div"===this.winType&&(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Cmaps.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Cmaps.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10)),JS9.colormaps&&JS9.colormaps.length){for(c.cmaps||(c.cmaps={},c.cmaps.mode=JS9.Cmaps.DEFMODE,c.cmaps.nmap=JS9.Cmaps.DEFNMAP,c.cmaps.nslice=JS9.Cmaps.DEFNMAP,c.cmaps.assign=JS9.Cmaps.DEFASSIGN,c.cmaps.tol=JS9.Cmaps.DEFTOL,c.cmaps.lastCname=null,c.cmaps.names=[],c.cmaps.ims=[],c.cmaps.orgb={r:0,g:0,b:0},c.cmaps.that=r),this.divjq.html(""),this.cmapsContainer=$("<div>").addClass(JS9.Cmaps.BASE+"Container").attr("id",this.id+"CMapsContainer").appendTo(this.divjq),a=sprintf(JS9.Cmaps.headerHTML,s=this.display.id,s,s,s,s),this.cmapsHeader=$("<div>").addClass(JS9.Cmaps.BASE+"Header").attr("display",this.display.id).attr("id",this.display.id+"CMapsHeader").html(a).appendTo(this.cmapsContainer),this.cmapsImageContainer=$("<div>").addClass(JS9.Cmaps.BASE+"ImageContainer").attr("id",this.id+"CmapsImageContainer").appendTo(this.cmapsContainer),i=0;i<JS9.images.length;i++)JS9.Cmaps.addImage.call(this,JS9.images[i]);this.cmapsImageContainer.sortable({start:function(e,t){this.oidx=t.item.index()},stop:function(e,t){var i=t.item.index();JS9.images.splice(i,0,JS9.images.splice(this.oidx,1)[0]),r.display.image&&r.display.image.displayImage()}}),n=this.cmapsContainer.find(o),this.cmapsContainer.find(l).each(function(){var e,t;for(e=0;e<JS9.colormaps.length;e++)t=JS9.colormaps[e].name,$(l).append($("<option>",{value:t,text:t}))}),c.cmaps.inited||(JS9.globalOpts.internalColorPicker&&$.fn.spectrum.inputTypeColorSupport()||(n.spectrum({showButtons:!1,showInput:!0,preferredFormat:"hex6"}),n.on("move.spectrum",function(e,t){var i=t.toHex();JS9.Cmaps.mkCmaps(c,i,c.cmaps.nmap,c.cmaps.nslice,{mode:c.cmaps.mode,assign:c.cmaps.assign}),c.cmaps.lastCname=i}),n.on("change",function(){var e=tinycolor($(this).val()).toHex();JS9.Cmaps.mkCmaps(c,e,c.cmaps.nmap,c.cmaps.nslice,{mode:c.cmaps.mode,assign:c.cmaps.assign}),c.cmaps.lastCname=e})),n.on("input",function(e){var t=e.target.value;$(e.target).parent().attr("display")===c.id&&(JS9.Cmaps.mkCmaps(c,t,c.cmaps.nmap,c.cmaps.nslice,{mode:c.cmaps.mode,assign:c.cmaps.assign}),c.cmaps.lastCname=t)}),c.cmaps.inited=!0)}else this.divjq.html(JS9.Cmaps.nofileHTML)},JS9.Cmaps.imageload=function(e){var t,i,s;for(this.display.cmaps?JS9.Cmaps.addImage.call(this,e):JS9.Cmaps.init.call(this),t=0;t<JS9.displays.length;t++)(i=JS9.displays[t]).image&&i.id!==e.display.id&&(s=i.pluginInstances.JS9Cmaps)&&s.isActive("onimageload")&&JS9.Cmaps.addImage.call(s,e)},JS9.Cmaps.imagedisplay=function(e){JS9.Cmaps.activeImage.call(this,e)},JS9.Cmaps.imageclose=function(e){var t,i,s;for(JS9.Cmaps.removeImage.call(this,e),t=0;t<JS9.displays.length;t++)(i=JS9.displays[t]).image&&i.id!==e.display.id&&(s=i.pluginInstances.JS9Cmaps)&&s.isActive("onimageclose")&&JS9.Cmaps.removeImage.call(s,e)},JS9.RegisterPlugin(JS9.Cmaps.CLASS,JS9.Cmaps.NAME,JS9.Cmaps.init,{menuItem:"Colormaps",help:"help/cmaps.html",onimageload:JS9.Cmaps.imageload,onimagedisplay:JS9.Cmaps.imagedisplay,onimageclose:JS9.Cmaps.imageclose,winTitle:"Create Colormaps",winResize:!0,winDims:[JS9.Cmaps.WIDTH,JS9.Cmaps.HEIGHT]}),JS9.Colorbar={},JS9.Colorbar.CLASS="JS9",JS9.Colorbar.NAME="Colorbar",JS9.Colorbar.WIDTH=512,JS9.Colorbar.HEIGHT=40,JS9.Colorbar.BASE=JS9.Colorbar.CLASS+JS9.Colorbar.NAME,JS9.Colorbar.SCALED=!1,JS9.Colorbar.TICKS=10,JS9.Colorbar.COLORBARHEIGHT=16,JS9.Colorbar.MAXLABELSIZE=10,JS9.Colorbar.display=function(e){var t,i,s,a,n,r,o,l,c,h=[],u=this.colorbarWidth,d=this.colorbarHeight,p=this.ctx.getImageData(0,0,u,d),f=p.data,g=4*u,m=new Uint8Array(f.buffer,0,g);if(r=this.scaled?e.psColors:e.colorCells){for(n=r.length/u,t=0,i=0;t<u;t++,i+=4)a=Math.floor(t*n),f[i]=r[a][0],f[i+1]=r[a][1],f[i+2]=r[a][2],f[i+3]=255;for(t=1;t<d;t++)f.set(m,t*g);if(this.ctx.putImageData(p,0,0),this.showTicks){for(n=e.psInverse.length/this.ticks,this.textctx.clear(),s=JS9.floatPrecision(Math.min(e.params.scalemin,e.psInverse[0]),Math.max(e.params.scalemax,e.psInverse[e.psInverse.length-1])),i=0;i<3;i++){for(c=!0,t=0;t<this.ticks;t++)o=e.psInverse[Math.floor(t*n)],h[t]=JS9.floatFormattedString(o,s,i);for(t=1;t<this.ticks;t++)h[t-1]===h[t]&&(c=!1);if(c)break}for(t=1;t<this.ticks;t++)t>1&&h[t]===h[t-1]||(l=t/this.ticks*this.width,this.textctx.textAlign="center",this.textctx.beginPath(),this.textctx.moveTo(l,0),this.textctx.lineWidth=1,this.textctx.lineTo(l,5),this.textctx.stroke(),h[t].length>=JS9.Colorbar.MAXLABELSIZE&&t%2==0||this.textctx.fillText(h[t],l,15))}}else JS9.Colorbar.imageclear(e)},JS9.Colorbar.init=function(e,t){var i=JS9.PIXEL_RATIO||1;this.showTicks=this.divjq.attr("data-showTicks"),this.showTicks=void 0===this.showTicks||"true"===this.showTicks,this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Colorbar.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=this.showTicks?t||JS9.Colorbar.HEIGHT:t||JS9.Colorbar.COLORBARHEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.colorbarWidth=this.width,this.colorbarHeight=parseInt(this.divjq.attr("data-colorbarHeight"),10),this.colorbarHeight||(this.colorbarHeight=JS9.Colorbar.COLORBARHEIGHT),this.colorbarHeight=Math.min(this.height,this.colorbarHeight),this.scaled=this.divjq.attr("data-scaled"),this.scaled=void 0===this.scaled?JS9.Colorbar.SCALED:"true"===this.scaled,this.ticks=this.divjq.attr("data-ticks"),this.ticks||(this.ticks=JS9.Colorbar.TICKS),this.divjq.html(""),this.colorbarContainer=$("<div>").addClass(JS9.Colorbar.BASE+"Container").attr("id",this.id+"Container").attr("width",this.width).attr("height",this.height).appendTo(this.divjq),this.colorbarjq=$("<canvas>").addClass(JS9.Colorbar.BASE+"Canvas").attr("id",this.id+"Canvas").attr("width",this.width-1).attr("height",this.colorbarHeight).appendTo(this.colorbarContainer),this.ctx=this.colorbarjq[0].getContext("2d"),this.showTicks&&(this.textjq=$("<canvas>").addClass(JS9.Colorbar.BASE+"TextCanvas").attr("id",this.id+"TextCanvas").attr("width",this.width*i).attr("height",(this.height-this.colorbarHeight)*i).css("width",this.width+"px").css("height",this.height-this.colorbarHeight+"px").appendTo(this.colorbarContainer),this.textctx=this.textjq[0].getContext("2d"),this.colorbarFont=this.divjq.attr("data-colorbarFont"),this.colorbarFont?this.textctx.font=this.colorbarFont:JS9.Colorbar.COLORBARFONT&&(this.textctx.font=JS9.Colorbar.COLORBARFONT),this.textctx.setTransform(i,0,0,i,0,0)),this.display.image&&JS9.Colorbar.display.call(this,this.display.image)},JS9.Colorbar.imagedisplay=function(e){e&&JS9.Colorbar.display.call(this,e)},JS9.Colorbar.imageclear=function(e){e&&e===e.display.image&&(this.ctx&&this.ctx.clear(),this.textctx&&this.textctx.clear())},JS9.Colorbar.dynamic=function(e){var t;e&&(t=e.display.pluginInstances.JS9Colorbar)&&t.isDynamic&&JS9.Colorbar.imagedisplay.call(this,e)},JS9.RegisterPlugin(JS9.Colorbar.CLASS,JS9.Colorbar.NAME,JS9.Colorbar.init,{menuItem:"Colorbar",dynamicSelect:!0,ondynamicselect:JS9.Colorbar.dynamic,onimagedisplay:JS9.Colorbar.imagedisplay,onimageclear:JS9.Colorbar.imageclear,onimageclose:JS9.Colorbar.imageclear,help:"help/colorbar.html",winTitle:"Colorbar",winDims:[JS9.Colorbar.WIDTH,JS9.Colorbar.HEIGHT]}),JS9.Console={},JS9.Console.CLASS="JS9",JS9.Console.NAME="Console",JS9.Console.WIDTH=512,JS9.Console.HEIGHT=180,JS9.Console.HTML="<form name='form' onsubmit='return false;' class='JS9CmdForm' action=''><table class='JS9CmdTable'><tr class='JS9Tr'><td><div id='JS9CmdPrompt' class='JS9CmdPrompt'>@@PR@@</div></td><td class='JS9CmdTd'><input type='text' class='JS9CmdIn' autocapitalize='off' autocorrect='off' autocomplete='off' value='' /></td></tr></table></form>",JS9.Console.init=function(e,t){this.display.conMode=2,this.hist=[],this.histpos=0,this.histtemp=0,this.histused=!1,this.consoleConjq=$("<div>").addClass("JS9ConsoleContainer").appendTo(this.divjq),"light"!==this.winType&&(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.CONWIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.CONHEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.consoleConjq.css("width",this.width).css("height",this.height)),this.consoleConjq.attr("tabindex","0"),this.consoleConjq.on("keydown",this,function(e){return JS9.Console.keyDownCB(e)}),JS9.Console.out.call(this,"Type 'help' for a list of commands","info"),JS9.Console.inp.call(this)},JS9.Console.inp=function(){var e;return this.consoleConjq.find(".JS9CmdIn:last").attr("readonly","readonly"),this.consoleConjq.append(JS9.Console.HTML.replace(/@@PR@@/g,"js9>")),(e=this.consoleConjq.find(".JS9CmdIn:last")).focus().attr("autocapitalize","off").attr("autocorrect","off").attr("autocomplete","off"),JS9.jupyterFocus(e.parent()),this},JS9.Console.out=function(e,t){switch(t.toLowerCase()){case"error":e="ERROR: "+e,t="Error";break;case"info":t="Info";break;case"out":default:t="Out"}return $("<div>").addClass("JS9Cmd"+t).html(e).appendTo(this.consoleConjq),this},JS9.Console.xeq=function(){var e,t,i,s,a=this.consoleConjq.find(".JS9CmdIn:last").val(),n=a.replace(/ {2,}/g," ").split(" "),r=[];if(!n[0])return this;for(t=n[0],e=1;e<n.length;e++)r.push(n[e]);this.histused||(this.hist[this.hist.length]=a),this.histpos=this.hist.length,this.histused=!1;try{if(i=JS9.lookupCommand(t))switch(i.getDisplayInfo(this.display),i.getWhich(r)){case"get":s=i.get(r)||"",JS9.Console.out.call(this,s,"ok");break;case"set":(s=i.set(r))&&JS9.Console.out.call(this,s,"ok");break;default:s=sprintf("unknown cmd type for '%s'",t),JS9.error(s)}else s=sprintf("unknown command '%s'",t),r.length>0&&(s=s+" "+r),JS9.error(s)}catch(o){JS9.Console.out.call(this,o.message,"error")}return this},JS9.Console.keyDownCB=function(e){var t,i=e.data,s=e.which||e.keyCode;if(!JS9.specialKey(e)){if((t=i.consoleConjq.find(".JS9CmdIn:last")).focus(),i.hist.length&&(38===s||40===s)){switch(i.hist[i.histpos]?i.hist[i.histpos]=t.val():i.histtemp=t.val(),s){case 38:i.histpos--,i.histpos<0&&(i.histpos=0);break;case 40:i.histpos++,i.histpos>i.hist.length&&(i.histpos=i.hist.length);break;default:JS9.error("internal keycode switch mixup")}i.hist[i.histpos]?(t.val(i.hist[i.histpos]),i.histused=i.histpos!==i.hist.length):(t.val(i.histtemp),i.histused=!1)}13===s&&(JS9.globalOpts.alerts=!1,JS9.Console.xeq.call(i),JS9.globalOpts.alerts=!0,JS9.Console.inp.call(i))}},JS9.RegisterPlugin("JS9","Console",JS9.Console.init,{menuItem:"Console",winTitle:"Console",winResize:!0,winDims:[JS9.Console.WIDTH,JS9.Console.HEIGHT]}),JS9.Cube={},JS9.Cube.CLASS="JS9",JS9.Cube.NAME="Cube",JS9.Cube.WIDTH=512,JS9.Cube.HEIGHT=240,JS9.Cube.BASE=JS9.Cube.CLASS+JS9.Cube.NAME,JS9.Cube.cubeHTML="<div class='JS9CubeLinegroup'>$header</div><p><div class='JS9CubeLinegroup'><span class='JS9CubeSpan' style='float: left'>$range&nbsp;&nbsp;&nbsp;&nbsp;$value&nbsp;&nbsp;&nbsp;&nbsp;$extname</span><span class='JS9CubeSpan' style='float: right'>$order</span></div><div class='JS9CubeLinegroup'><span class='JS9CubeSpan' style='float: left'>$first&nbsp;$next&nbsp;$prev&nbsp;$last</span><span class='JS9CubeSpan' style='float: right'>$blink&nbsp;$stop&nbsp;$rate</span></div><p><div class='JS9CubeLinegroup'>$header2</div><p><div class='JS9CubeLinegroup'><span class='JS9CubeSpan' style='float: left'>$load</span></div>",JS9.Cube.headerHTML="Use the slider, text box, navigation or blink buttons to display a slice of a <b>FITS data cube</b>. Use the menu at the right to specify the slice axis.",JS9.Cube.rangeHTML='<span class="JS9CubeRangeLine">1<input type="range" min="1" max="%s" value="%s" class="JS9CubeRange" onchange="JS9.Cube.xrange(\'%s\', \'%s\', this)">%s</span>',JS9.Cube.valueHTML='<input type="text" class="JS9CubeValue" min="1" max="%s" value="%s" onchange="JS9.Cube.xvalue(\'%s\', \'%s\', this)" size="4">',JS9.Cube.firstHTML='<input type="button" class=JS9CubeBtn" value="First" onclick="JS9.Cube.xfirst(\'%s\', \'%s\', this)">',JS9.Cube.nextHTML='<input type="button" class=JS9CubeBtn" value="Next" onclick="JS9.Cube.xnext(\'%s\', \'%s\', this)">',JS9.Cube.prevHTML='<input type="button" class=JS9CubeBtn" value="Prev" onclick="JS9.Cube.xprev(\'%s\',\'%s\', this)">',JS9.Cube.lastHTML='<input type="button" class=JS9CubeBtn" value="Last" onclick="JS9.Cube.xlast(\'%s\', \'%s\', this)">',JS9.Cube.blinkHTML='<input type="button" class=JS9CubeBtn" value="Blink" onclick="JS9.Cube.xstart(\'%s\', \'%s\', this)">',JS9.Cube.stopHTML='<input type="button" class=JS9CubeBtn" value="Stop" onclick="JS9.Cube.xstop(\'%s\', \'%s\', this)">',JS9.Cube.extnameHTML='<span class="JS9CubeRangeLine">%s</span>',JS9.Cube.orderHTML='<select class="JS9CubeOrder" onchange="JS9.Cube.xorder(\'%s\', \'%s\', this)"><option value="$slice:*:*">$slice : * : *</option><option value="*:$slice:*">* : $slice : *</option><option value="*:*:$slice">* : * : $slice</option></select>',JS9.Cube.rateHTML='<select class="JS9CubeRate" onchange="JS9.Cube.xrate(\'%s\', \'%s\', this)"><option selected disabled>Rate</option><option value=".1">0.1 sec</option><option value=".25">0.25 sec</option><option value=".5">0.5 sec</option><option value="1" default>1 sec</option><option value="2">2 sec</option><option value="5">5 sec</option></select>',JS9.Cube.header2HTML="Or load each slice separately into JS9:",JS9.Cube.loadHTML='<input type="button" class=JS9CubeBtn" value="Load All" onclick="JS9.Cube.loadall(\'%s\',\'%s\', this)">',JS9.Cube.doSlice=function(e,t,i){var s,a,n=e.display.pluginInstances[JS9.Cube.BASE];if(!e.parentFile||!n.inProcess){for(s=0;s<i.length;s++)n.divjq.find(i[s]).val(t);a=e.expandMacro(n.slice,[{name:"slice",value:t}]),n.sval=t,n.inProcess=!0,e.displaySlice(a,{},function(){n.inProcess=!1})}},JS9.Cube.xrange=function(e,t,i){var s,a=JS9.lookupImage(t,e);a&&(s=parseInt(i.value,10),JS9.Cube.doSlice(a,s,[".JS9CubeValue"]))},JS9.Cube.xvalue=function(e,t,i){var s,a=JS9.lookupImage(t,e);a&&(s=parseInt(i.value,10),JS9.Cube.doSlice(a,s,[".JS9CubeRange"]))},JS9.Cube.xfirst=function(e,t,i){var s=JS9.lookupImage(t,e);s&&JS9.Cube.doSlice(s,1,[".JS9CubeValue",".JS9CubeRange"])},JS9.Cube.xnext=function(e,t,i){var s,a,n=JS9.lookupImage(t,e);n&&((s=(a=n.display.pluginInstances[JS9.Cube.BASE]).sval+1)>(n.parent&&n.parent.raw&&n.parent.raw.header?n.parent.raw.header:n.raw.header)["NAXIS"+a.sidx]&&(s=1),JS9.Cube.doSlice(n,s,[".JS9CubeValue",".JS9CubeRange"]))},JS9.Cube.xprev=function(e,t,i){var s,a,n=JS9.lookupImage(t,e);n&&((s=(a=n.display.pluginInstances[JS9.Cube.BASE]).sval-1)<1&&(s=(n.parent&&n.parent.raw&&n.parent.raw.header?n.parent.raw.header:n.raw.header)["NAXIS"+a.sidx]),JS9.Cube.doSlice(n,s,[".JS9CubeValue",".JS9CubeRange"]))},JS9.Cube.xlast=function(e,t,i){var s=JS9.lookupImage(t,e);s&&JS9.Cube.doSlice(s,(s.parent&&s.parent.raw&&s.parent.raw.header?s.parent.raw.header:s.raw.header)["NAXIS"+s.display.pluginInstances[JS9.Cube.BASE].sidx],[".JS9CubeValue",".JS9CubeRange"])},JS9.Cube.xorder=function(e,t,i){var s,a,n,r,o=JS9.lookupImage(t,e);if(o){for(r=o.parent&&o.parent.raw&&o.parent.raw.header?o.parent.raw.header:o.raw.header,(n=o.display.pluginInstances[JS9.Cube.BASE]).slice=i.value,a=n.slice.split(/[ ,:]/),s=0;s<a.length;s++)"*"!==a[s]&&(n.sidx=s+1,n.sval=1,n.smax=r["NAXIS"+n.sidx]);$(".JS9CubeRange").prop("max",n.smax),JS9.Cube.doSlice(o,n.sval,[".JS9CubeValue",".JS9CubeRange"])}},JS9.Cube.blink=function(e,t,i){var s,a=JS9.lookupImage(t,e);if(a){if(!1===(s=a.display.pluginInstances[JS9.Cube.BASE]).blinkMode)return void delete s.blinkMode;JS9.Cube.xnext(e,t,i),void 0===s.blinkMode&&(s.blinkMode=!0),JS9.Cube.tid=window.setTimeout(function(){JS9.Cube.blink(e,t,i)},s.rate)}},JS9.Cube.xstart=function(e,t,i){var s=JS9.lookupImage(t,e);s&&(s.display.pluginInstances[JS9.Cube.BASE].blinkMode||JS9.Cube.blink(e,t,i))},JS9.Cube.xstop=function(e,t,i){var s,a=JS9.lookupImage(t,e);a&&((s=a.display.pluginInstances[JS9.Cube.BASE]).inProcess=!1,s.blinkMode&&(s.tid&&(window.clearTimeout(s.tid),delete s.tid),s.blinkMode=!1))},JS9.Cube.xrate=function(e,t,i){var s=JS9.lookupImage(t,e);s&&(s.display.pluginInstances[JS9.Cube.BASE].rate=Math.floor(1e3*parseFloat(i.value)))},JS9.Cube.loadall=function(e,t,i){var s=JS9.lookupImage(t,e);s&&s.displaySlice("all")},JS9.Cube.display=function(){this.lastimage!==this.display.image&&JS9.Cube.init.call(this)},JS9.Cube.close=function(){JS9.Cube.init.call(this,{mode:"clear"})},JS9.Cube.init=function(e){var t,i,s,a,n,r,o,l;if(e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Cube.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Cube.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.cubeWidth=this.width,this.cubeHeight=parseInt(this.divjq.attr("data-cubeHeight"),10),this.cubeHeight||(this.cubeHeight=JS9.Cube.CUBEHEIGHT),(s=this.display.image)&&"clear"!==e.mode){if(l=s.parent&&s.parent.raw&&s.parent.raw.header?s.parent.raw.header:s.raw.header,r=s.id,o=s.display.id,s.slice)for(this.slice=s.slice.replace(/[0-9][0-9]*/,"$slice"),a=s.slice.split(/[ ,:]/),t=0;t<a.length;t++)"*"!==a[t]&&(this.sidx=t+1,this.smax=l["NAXIS"+this.sidx],this.sval=parseInt(a[t],10));else this.slice="*:*:$slice",this.smax=l.NAXIS3,this.sidx=3,this.sval=1;this.rate||(this.rate=1e3),void 0!==this.tid&&(window.clearTimeout(this.tid),delete this.tid),void 0!==this.blinkMode&&delete this.blinkMode,l.NAXIS>2?((n=[]).push({name:"header",value:JS9.Cube.headerHTML}),n.push({name:"range",value:sprintf(JS9.Cube.rangeHTML,this.smax,this.sval,o,r,this.smax)}),n.push({name:"value",value:sprintf(JS9.Cube.valueHTML,this.smax,this.sval,o,r)}),n.push({name:"first",value:sprintf(JS9.Cube.firstHTML,o,r)}),n.push({name:"next",value:sprintf(JS9.Cube.nextHTML,o,r)}),n.push({name:"prev",value:sprintf(JS9.Cube.prevHTML,o,r)}),n.push({name:"last",value:sprintf(JS9.Cube.lastHTML,o,r)}),n.push({name:"blink",value:sprintf(JS9.Cube.blinkHTML,o,r)}),n.push({name:"stop",value:sprintf(JS9.Cube.stopHTML,o,r)}),n.push({name:"order",value:sprintf(JS9.Cube.orderHTML,o,r)}),n.push({name:"rate",value:sprintf(JS9.Cube.rateHTML,o,r)}),n.push({name:"extname",value:sprintf(JS9.Cube.extnameHTML,l.EXTNAME||"")}),n.push({name:"header2",value:JS9.Cube.header2HTML}),n.push({name:"load",value:sprintf(JS9.Cube.loadHTML,o,r)}),i=s.expandMacro(JS9.Cube.cubeHTML,n)):i="<p><center>This image is not a FITS data cube.</center>",this.lastimage=s}else i="<p><center>FITS cube processing will appear here.</center>";this.divjq.html(""),this.cubeContainer=$("<div>").addClass(JS9.Cube.BASE+"Container").attr("id",this.id+"Container").attr("width",this.width).attr("height",this.height).appendTo(this.divjq),this.cubeContainer.html(i),this.divjq.find(".JS9CubeRange").prop("max",this.smax),this.divjq.find(".JS9CubeValue").prop("max",this.smax),this.divjq.find(".JS9CubeOrder").val(this.slice)},JS9.RegisterPlugin(JS9.Cube.CLASS,JS9.Cube.NAME,JS9.Cube.init,{menuItem:"Data Cube",onplugindisplay:JS9.Cube.init,onimageload:JS9.Cube.init,onimagedisplay:JS9.Cube.display,onimageclose:JS9.Cube.close,help:"help/cube.html",winTitle:"FITS Data Cubes",winDims:[JS9.Cube.WIDTH,JS9.Cube.HEIGHT]}),JS9.Divs={},JS9.Divs.CLASS="JS9",JS9.Divs.NAME="Divs",JS9.Divs.WIDTH=400,JS9.Divs.HEIGHT=146,JS9.Divs.BASE=JS9.Divs.CLASS+JS9.Divs.NAME,JS9.Divs.headerHTML="JS9 plugin divs can be hidden or made visible below.",JS9.Divs.divHTML="<span style='float: left'>$visible&nbsp;&nbsp;</span>&nbsp;&nbsp; <span class='JS9DivsSpan'>$div&nbsp;&nbsp</span>",JS9.Divs.nodivsHTML='<p><span class="JS9NoDivs">[No JS9 divs have been created for this display]</span>',JS9.Divs.visibleHTML='<input class="JS9DivsVisibleCheck" type="checkbox" id="visible" name="visible" value="visible" onclick="javascript:JS9.Divs.xvisible(\'%s\', \'%s\', this)">visible',JS9.Divs.divNameHTML="<b>%s</b>",JS9.Divs.xvisible=function(e,t,i){var s,a,n=JS9.lookupDisplay(e);n&&((a=n.pluginInstances[t])&&(s=i.checked?"visible":"hidden"),a.divjq.closest(".JS9PluginContainer").css("visibility",s))},JS9.Divs.addDiv=function(e){var t,i=JS9.Divs.BASE+"Div",s=[];e&&this.display.pluginInstances[e]&&(this.ndiv||this.divsDivContainer.html(""),s.push({name:"visible",value:sprintf(JS9.Divs.visibleHTML,this.display.id,e)}),s.push({name:"div",value:sprintf(JS9.Divs.divNameHTML,e)}),t=JS9.Image.prototype.expandMacro.call(null,JS9.Divs.divHTML,s),$("<div>").addClass(i).html(t).appendTo(this.divsDivContainer).find(".JS9DivsVisibleCheck").prop("checked","visible"===this.display.pluginInstances[e].divjq.css("visibility")),this.ndiv++)},JS9.Divs.init=function(e){var t,i;if(e=e||{},this.divjq.html(""),this.ndiv=0,this.divjq.addClass("JS9PluginScrolling"),this.divsContainer=$("<div>").addClass(JS9.Divs.BASE+"Container").attr("id",this.id+"DivsContainer").css("overflow","auto").appendTo(this.divjq),this.divsHeader=$("<div>").addClass(JS9.Divs.BASE+"Header").attr("id",this.display.id+"Header").html(JS9.Divs.headerHTML).appendTo(this.divsContainer),this.divsDivContainer=$("<div>").addClass(JS9.Divs.BASE+"DivContainer").attr("id",this.id+"DivsDivContainer").html(JS9.Divs.nodivsHTML).appendTo(this.divsContainer),"clear"!==e.mode)for(t in i=this.display.pluginInstances)i.hasOwnProperty(t)&&"div"===i[t].winType&&JS9.Divs.addDiv.call(this,t)},JS9.RegisterPlugin(JS9.Divs.CLASS,JS9.Divs.NAME,JS9.Divs.init,{menuItem:"Show/Hide Plugins",onplugindisplay:JS9.Divs.init,help:"help/divs.html",winTitle:"Show/Hide Plugins",winResize:!0,winDims:[JS9.Divs.WIDTH,JS9.Divs.HEIGHT]}),JS9.Imarith={},JS9.Imarith.CLASS="JS9",JS9.Imarith.NAME="Imarith",JS9.Imarith.WIDTH=512,JS9.Imarith.HEIGHT=170,JS9.Imarith.BASE=JS9.Imarith.CLASS+JS9.Imarith.NAME,JS9.Imarith.imageHTML="<div class='JS9ImarithLinegroup'>Choose an op (add, subtract, multiply, divide, min, max) and an operand (number or image) and click Run. Reset will revert to the original data.</div><div class='JS9ImarithLinegroup'><span class='JS9ImarithSpan' style='float: left'><b>$imid</b> &nbsp;&nbsp; $op &nbsp;&nbsp; $arg1 &nbsp;&nbsp; $num</span></div><p><div class='JS9ImarithLinegroup'><span class='JS9ImarithSpan' style='float: left'>$run</span><span style='float: right'>$reset</span></div>",JS9.Imarith.opHTML='<select class=JS9ImarithOp" onchange="JS9.Imarith.xop(\'%s\', \'%s\', this)"><option value="" selected disabled>op</option><option value="add">add</option><option value="sub">sub</option><option value="mul">mul</option><option value="div">div</option><option value="min">min</option><option value="max">max</option></select>',JS9.Imarith.arg1HTML='<select class=JS9ImarithArg1" onchange="JS9.Imarith.xarg1(\'%s\', \'%s\', this)"><option val="" selected disabled>operand</option><option value="num">number &#8594;</option>%s</select>',JS9.Imarith.numHTML='<input type="text" class="JS9ImarithNum" value="" onchange="JS9.Imarith.xnum(\'%s\', \'%s\', this)" size="10" placeholder="number">',JS9.Imarith.runHTML='<input type="button" class=JS9ImarithBtn" value="Run" onclick="JS9.Imarith.xrun(\'%s\', \'%s\', this)">',JS9.Imarith.resetHTML='<input type="button" class=JS9ImarithBtn" value="Reset" onclick="JS9.Imarith.xreset(\'%s\', \'%s\', this)">',JS9.Imarith.xop=function(e,t,i){var s=i.options[i.selectedIndex].value,a=JS9.lookupImage(t,e);a&&s&&(a.display.pluginInstances.JS9Imarith.op=s)},JS9.Imarith.xarg1=function(e,t,i){var s=JS9.lookupImage(t,e),a=i.options[i.selectedIndex].value;s&&a&&(s.display.pluginInstances.JS9Imarith.arg1=a,"num"===a?$(".JS9ImarithNum").css("visibility","visible"):$(".JS9ImarithNum").css("visibility","hidden"))},JS9.Imarith.xnum=function(e,t,i){var s=JS9.lookupImage(t,e),a=i.value;JS9.isNumber(a)?s.display.pluginInstances.JS9Imarith.num=parseFloat(a):a&&JS9.error("please enter a real number: "+a)},JS9.Imarith.xrun=function(e,t,i){var s,a,n=JS9.lookupImage(t,e);n&&((a=n.display.pluginInstances.JS9Imarith).op&&a.arg1||JS9.error("please select an operation and an operand"),"num"===a.arg1?(void 0===a.num&&JS9.error("please enter a real number for the operand"),s=a.num):s=a.arg1,n.imarithData(a.op,s))},JS9.Imarith.xreset=function(e,t,i){var s=JS9.lookupImage(t,e);s&&s.imarithData("reset")},JS9.Imarith.display=function(){this.lastimage!==this.display.image&&JS9.Imarith.init.call(this)},JS9.Imarith.close=function(){JS9.Imarith.init.call(this,{mode:"clear"})},JS9.Imarith.init=function(e){var t,i,s,a,n,r,o,l="";if(e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Imarith.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Imarith.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.imarithWidth=this.width,this.imarithHeight=parseInt(this.divjq.attr("data-imarithHeight"),10),this.imarithHeight||(this.imarithHeight=JS9.Imarith.IMARITHHEIGHT),delete this.arg1,delete this.op,delete this.num,(s=this.display.image)&&"clear"!==e.mode){for(r=s.id,o=s.display.id,this.lastim=s.id,t=0;t<JS9.images.length;t++)(a=JS9.images[t])!==s&&(l+=sprintf('<option value="%s">%s</option>',a.id,a.id));(n=[]).push({name:"images",value:l}),n.push({name:"imid",value:r}),n.push({name:"op",value:sprintf(JS9.Imarith.opHTML,o,r)}),n.push({name:"arg1",value:sprintf(JS9.Imarith.arg1HTML,o,r,l)}),n.push({name:"num",value:sprintf(JS9.Imarith.numHTML,o,r)}),n.push({name:"run",value:sprintf(JS9.Imarith.runHTML,o,r)}),n.push({name:"reset",value:sprintf(JS9.Imarith.resetHTML,o,r)}),i=JS9.Image.prototype.expandMacro.call(s,JS9.Imarith.imageHTML,n),this.lastimage=s}else i="<p><center>Image arithmetic will appear here.</center>";this.divjq.html(""),this.imarithContainer=$("<div>").addClass(JS9.Imarith.BASE+"Container").attr("id",this.id+"Container").attr("width",this.width).attr("height",this.height).appendTo(this.divjq),this.imarithContainer.html(i),this.imarithContainer.find(".JS9ImarithNum").css("visibility","hidden")},JS9.RegisterPlugin(JS9.Imarith.CLASS,JS9.Imarith.NAME,JS9.Imarith.init,{menuItem:"Imarith",onplugindisplay:JS9.Imarith.init,onimageload:JS9.Imarith.init,onimagedisplay:JS9.Imarith.display,onimageclose:JS9.Imarith.close,help:"help/imarith.html",winTitle:"Image Arithmetic",winDims:[JS9.Imarith.WIDTH,JS9.Imarith.HEIGHT]}),JS9.Info={},JS9.Info.CLASS="JS9",JS9.Info.NAME="Info",JS9.Info.WIDTH=325,JS9.Info.HEIGHT=250,JS9.Info.REGHEIGHT=75,JS9.Info.opts={infoURL:"./params/info.html",infoObj:{file:'<tr><td><input type="text" class="column0" value="file" readonly="readonly"></td><td colspan="2"><input type="text" name="id" class="input2" value="" readonly="readonly" onclick="this.scrollLeft=this.scrollWidth;"></td></tr>',object:'<tr><td><input type="text" class="column0" value="object" readonly="readonly"></td><td colspan="2"><input type="text" name="object" class="input2" value="" readonly="readonly"></td></tr>',wcscen:'<tr><td><input type="text" class="column0" value="center" readonly="readonly"></td><td colspan="2"><input type="text" name="wcscen" class="input2" value="" readonly="readonly"></td></tr>',wcsfov:'<tr><td><input type="text" class="column0" value="fov" readonly="readonly"></td><td colspan="2"><input type="text" name="wcsfovpix" class="input2" value="" readonly="readonly"></td></tr>',value:'<tr><td><input type="text" class="column0" value="value" readonly="readonly"></td><td colspan="2"><input type="text" name="val3" class="input2" value="" readonly="readonly"></td></tr>',impos:'<tr><td><input type="text" class="column0" value="image" readonly="readonly"></td><td colspan="2"><input type="text" name="ipos" class="input2" value="" readonly="readonly"></td></tr>',physpos:'<tr><td><input type="text" class="column0" value="physical" readonly="readonly"></td><td colspan="2"><input type="text" name="ppos" class="input2" value="" readonly="readonly"></td></tr>',wcspos:'<tr><td><input type="text" class="column0" value="wcs" name="wcssys" readonly="readonly"></td><td colspan="2"><input type="text" name="wcspos" class="input2" value="" readonly="readonly"></td></tr>',regions:'<tr><td><input type="text" class="column0" value="regions" readonly="readonly"></td><td colspan="2"><textarea class="text2" name="regions" rows="4" value="" readonly="readonly"></textarea></td></tr>',progress:'<tr><td colspan="2"><div class="JS9Progress"><progress name="progress" class="JS9ProgressBar" value="0" max="100"></progress></div></td></tr>'}},JS9.Info.init=function(){var e,t,i,s,a;if(this.display.image&&this.display.image===this.lastimage){switch(this.display.image.callingPlugin){case"onplugindisplay":case"onimagerefresh":case"onupdateprefs":break;default:return}this.lastimage=this.display.image}for(i=JS9.globalOpts.infoBox,s=JS9.Info.opts.infoObj,a='<table name="info" class="js9InfoTable">',e=0;e<i.length;e++)(t=i[e]).match(/^wcs/)&&JS9.globalOpts.infoBoxResize&&this.display.image&&!(this.display.image.raw.wcs>0)||t.match(/^regions/)&&"lightwin"===JS9.globalOpts.regionDisplay||t in s&&(a+=s[t]);a+="</table>",this.infoConjq&&this.infoConjq.html(""),this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.Info.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.Info.HEIGHT,"lightwin"!==JS9.globalOpts.regionDisplay&&(this.height+=JS9.Info.REGHEIGHT)),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.infoConjq=$("<div>").addClass("JS9Container").append(a).appendTo(this.divjq),this.jq=this.infoConjq.find("[name='info']")},JS9.Info.display=function(e,t,i,s){var a,n,r,o,l,c,h,u,d,p,f,g,m,v=this,b=this;if(this.display&&(b=this.display),m=b.image,b.pluginInstances&&(u=b.pluginInstances.JS9Info),!u||"active"!==u.status||i&&s?i?(i===b?(r=b,i=null):r=i instanceof jQuery?i:"object"==typeof i?$(i):$("#"+i),r.length||(r=b,i=null),this.lasttarget=i):(r=b,this.lasttarget=b):r=u,"progress"!==e){if(r===u&&("regions"!==e||"lightwin"!==JS9.globalOpts.regionDisplay)){switch(typeof t){case"string":(f=u.jq.find("[name='"+e+"']")).length>0&&f.val(t);break;case"object":for(d in t)t.hasOwnProperty(d)&&(f=u.jq.find("[name='"+d+"']")).length>0&&f.val(t[d])}return b}switch(e){case"regions":if("lightwin"===JS9.globalOpts.regionDisplay){if(g=b.id+"_regions",!(p=$("#"+g)).length||p[0].isClosed)return t?($("#dhtmlwindowholder").arrive("#"+g,{fireOnAttributesModification:!0},function(){JS9.Info.display.call(v,e,t,i,s)}),n="Regions",m&&(n+=": "+m.id),n+=" ",n+=sprintf(JS9.IDFMT,this.id),void JS9.lightWin(g,"inline","<div class='JS9Message'></div>",n,JS9.lightOpts[JS9.LIGHTWIN].regWin0)):void 0;l=p.find(".JS9Message")}else i?l=r:(l=r.regionsArea,r.infoheight=r.infoArea.height()+4,r.regheight=Math.max(2*r.infoheight+10,r.infoheight+r.regionsArea.height()+10),h=!b.image||b.image.iy>r.regheight?JS9.textColorOpts.inimage:JS9.textColorOpts.regions);o=";";break;case"info":default:i?l=r:(l=r.infoArea,r.infoheight=r.infoArea.height()+4,h=!b.image||b.image.iy>r.infoheight?JS9.textColorOpts.inimage:JS9.textColorOpts.info,o="")}switch(typeof t){case"string":a=t;break;case"object":a=t[d="vstr"+JS9.globalOpts.valposWidth]||t.vstrmedium||t.vstr||""}return""!==o&&a.split(o).length>2&&(c=new RegExp(o,"g"),a=a.replace(c,"<br>")),h&&l.css("color",h),l.html(a),b}if((p=r===u?u.jq:r.divjq).length>0)switch(p=p.find("[name='progress']"),typeof t){case"string":case"boolean":t?("indeterminate"===t&&p.removeAttr("value"),p.parent().css("display","inline-block")):(p.parent().css("display","none"),p.attr("value",0));break;case"object":t[1]&&p.attr("max",t[1]),p.attr("value",t[0])}},JS9.Display.prototype.displayMessage=JS9.Info.display,JS9.Image.prototype.displayMessage=JS9.Info.display,JS9.Info.clear=function(e){var t=this;return this.display&&(t=this.display),e?t.displayMessage(e,""):(t.displayMessage("info",""),t.displayMessage("regions",""),t.displayMessage("progress",!1)),t},JS9.Display.prototype.clearMessage=JS9.Info.clear,JS9.Image.prototype.clearMessage=JS9.Info.clear,JS9.Info.pluginDisplay=function(e){var t;e&&e.display&&(e.tmp&&(e.tmp.info_ovalpos=e.params.valpos),e.params.valpos=!0,this.display.lasttarget&&((t=this.display).displayMessage("info","",t.lasttarget,!0),t.displayMessage("regions","",t.lasttarget,!0),t.displayMessage("progress",!1,t.lasttarget,!0),delete t.lasttarget))},JS9.Info.pluginClose=function(e){e&&e.display&&e.tmp&&void 0!==e.tmp.info_ovalpos&&(e.params.valpos=e.tmp.info_ovalpos)},JS9.mkPublic("DisplayMessage",function(e,t,i){var s,a=JS9.parsePublicArgs(arguments),n=JS9.lookupDisplay(a.display);return n||JS9.error("invalid display for display message"),(s=n.displayMessage(e=a.argv[0],t=a.argv[1],i=a.argv[2]))===n&&(s="OK"),s}),JS9.RegisterPlugin("JS9","Info",JS9.Info.init,{menuItem:"InfoBox",dynamicSelect:!0,onplugindisplay:JS9.Info.pluginDisplay,onpluginclose:JS9.Info.pluginClose,onimagedisplay:JS9.Info.init,onimagerefresh:JS9.Info.init,onupdateprefs:JS9.Info.init,winTitle:"Info",winResize:!0,winDims:[JS9.Info.WIDTH,JS9.Info.HEIGHT]}),JS9.Keyboard={},JS9.Keyboard.CLASS="JS9",JS9.Keyboard.NAME="Keyboard",JS9.Keyboard.WIDTH=450,JS9.Keyboard.HEIGHT=420,JS9.Keyboard.BASE=JS9.Keyboard.CLASS+JS9.Keyboard.NAME,JS9.Keyboard.actionHTML="<div class='JS9KeyboardText'><button class='JS9Button JS9KeyboardButton' type='button' value='%s'>%s</button></div><div class='JS9KeyboardAction'>%s</div>",JS9.Keyboard.actionid=function(e,t){return(e+"_"+t).replace(/[^A-Za-z0-9_]/g,"_")},JS9.Keyboard.addAction=function(e,t,i){var s,a,n,r=this;return a=JS9.Keyboard.actionid(t,i),s=sprintf(JS9.Keyboard.actionHTML,i,t,i),(n=$("<div class='JS9KeyboardItem'>").attr("id",a).html(s).appendTo(e)).find(".JS9KeyboardButton").on("click",function(e){var t=this.value,i=r.display.image;i&&t&&JS9.Keyboard.Actions[t]&&JS9.Keyboard.Actions[t](i,i.ipos,e)}),n},JS9.Keyboard.arrowKey=function(e,t,i,s){e.pos.x+=i.x,e.pos.y+=i.y,e.ipos=e.displayToImagePos(e.pos),JS9.hasOwnProperty("MouseTouch")&&(e.valpos=null,JS9.MouseTouch.Actions["display value/position"](e,e.ipos,t)),JS9.hasOwnProperty("Magnifier")&&JS9.Magnifier.display(e,e.ipos),JS9.hasOwnProperty("Crosshair")&&!s&&(e.clickInRegion||(e.tmp.arrowCrosshair=!0,e.tmp.arrowCrosshairVisible=!0,JS9.Crosshair.display(e,e.ipos,t),delete e.tmp.arrowCrosshair))},JS9.Keyboard.Actions={},JS9.Keyboard.Actions["open local file"]=function(e,t,i){JS9.OpenFileMenu({display:i.data})},JS9.Keyboard.Actions["close image"]=function(e,t,i){e&&e.closeImage()},JS9.Keyboard.Actions["new JS9 light window"]=function(e,t,i){JS9.LoadWindow(null,{clone:i.data.id},"light")},JS9.Keyboard.Actions["copy wcs position to clipboard"]=function(e,t,i){var s,a;if(e&&e.raw.wcs&&t)return s=JS9.pix2wcs(e.raw.wcs,t.x,t.y).trim(),JS9.globalOpts.copyWcsPosFormat&&(a=s.split(/\s+/),s=e.expandMacro(JS9.globalOpts.copyWcsPosFormat,[{name:"ra",value:a[0]},{name:"dec",value:a[1]},{name:"sys",value:a[2]}])),JS9.CopyToClipboard(s,e),s},JS9.Keyboard.Actions["copy physical position to clipboard"]=function(e,t,i){var s,a;if(e&&t)return a=sprintf("%f %f",(s=e.imageToLogicalPos(t)).x,s.y),JS9.CopyToClipboard(a,e),a},JS9.Keyboard.Actions["copy pixel value to clipboard"]=function(e,t,i){var s,a,n;if(e&&t)return a=e.raw.data[Math.floor(t.y-.5)*e.raw.width+Math.floor(t.x-.5)],n=JS9.floatPrecision(e.params.scalemin,e.params.scalemax),s=JS9.floatFormattedString(a,n,3),JS9.CopyToClipboard(s,e),s},JS9.Keyboard.Actions["copy value and position to clipboard"]=function(e,t,i){var s,a,n;if(e&&t)return n=e.setParam("valpos",!0),s=e.updateValpos(t,!1),e.setParam("valpos",n),a="vstr"+JS9.globalOpts.valposWidth,s=s&&s[a]?s[a].replace(/&nbsp;/g," "):" ",JS9.CopyToClipboard(s,e),s},JS9.Keyboard.Actions["edit selected region"]=function(e,t,i){var s,a;e&&(s=e.layers.regions)&&(a=s.canvas.getActiveObject(),JS9.Regions.displayConfigForm.call(e,a))},JS9.Keyboard.Actions["toggle selected region: source/background"]=function(e,t,i){if(e)return e.toggleRegionTags("selected","source","background")},JS9.Keyboard.Actions["toggle selected region: include/exclude"]=function(e,t,i){if(e)return e.toggleRegionTags("selected","include","exclude")},JS9.Keyboard.Actions["tag selected region as 'source'"]=function(e,t,i){if(e)return JS9.Keyboard.editregion(e,"source","background")},JS9.Keyboard.Actions["tag selected region as 'background'"]=function(e,t,i){if(e)return JS9.Keyboard.editregion(e,"background","source")},JS9.Keyboard.Actions["tag selected region as 'include'"]=function(e,t,i){if(e)return JS9.Keyboard.editregion(e,"include","exclude")},JS9.Keyboard.Actions["tag selected region as 'exclude'"]=function(e,t,i){if(e)return JS9.Keyboard.editregion(e,"exclude","include")},JS9.Keyboard.Actions["toggle full screen mode"]=function(e,t,i){var s=i.data;s.width===s.width0&&s.height===s.height0?s.resize("full",{center:!0}):s.resize("reset")},JS9.Keyboard.Actions["reset zoom"]=function(e,t,i){e&&e.setZoom("1")},JS9.Keyboard.Actions["zoom in"]=function(e,t,i){e&&e.setZoom("*2")},JS9.Keyboard.Actions["zoom out"]=function(e,t,i){e&&e.setZoom("/2")},JS9.Keyboard.Actions["display next image"]=function(e,t,i){e&&e.display.nextImage(1)},JS9.Keyboard.Actions["display previous image"]=function(e,t,i){e&&e.display.nextImage(-1)},JS9.Keyboard.Actions["open a local FITS file"]=function(e,t,i){JS9.OpenFileMenu({display:i.data})},JS9.Keyboard.Actions["save image as a FITS file"]=function(e,t,i){e&&e.saveFITS()},JS9.Keyboard.Actions["save image as a PNG file"]=function(e,t,i){e&&e.savePNG()},JS9.Keyboard.Actions["save regions as a text file"]=function(e,t,i){e&&e.saveRegions()},JS9.Keyboard.Actions["move region/position up"]=function(e,t,i){var s,a,n,r=1;i&&i.preventDefault(),e&&(JS9.specialKey(i)&&(r*=5),s=e.display.layers[a=e.layer||"regions"].canvas,(n=1===fabric.major_version?s.getActiveObject()||s.getActiveGroup():s.getActiveObject())&&e.changeShapes(a,"selected",{dy:r}),JS9.Keyboard.arrowKey(e,i,{x:0,y:-1*r},n),s.fire("mouse:up"))},JS9.Keyboard.Actions["move region/position down"]=function(e,t,i){var s,a,n,r=-1;i&&i.preventDefault(),e&&(JS9.specialKey(i)&&(r*=5),s=e.display.layers[a=e.layer||"regions"].canvas,(n=1===fabric.major_version?s.getActiveObject()||s.getActiveGroup():s.getActiveObject())&&e.changeShapes(a,"selected",{dy:r}),JS9.Keyboard.arrowKey(e,i,{x:0,y:-1*r},n),s.fire("mouse:up"))},JS9.Keyboard.Actions["move region/position left"]=function(e,t,i){var s,a,n,r=-1;i&&i.preventDefault(),e&&(JS9.specialKey(i)&&(r*=5),s=e.display.layers[a=e.layer||"regions"].canvas,(n=1===fabric.major_version?s.getActiveObject()||s.getActiveGroup():s.getActiveObject())&&e.changeShapes(a,"selected",{dx:r}),JS9.Keyboard.arrowKey(e,i,{x:r,y:0},n),s.fire("mouse:up"))},JS9.Keyboard.Actions["move region/position right"]=function(e,t,i){var s,a,n,r=1;i&&i.preventDefault(),e&&(JS9.specialKey(i)&&(r*=5),s=e.display.layers[a=e.layer||"regions"].canvas,(n=1===fabric.major_version?s.getActiveObject()||s.getActiveGroup():s.getActiveObject())&&e.changeShapes(a,"selected",{dx:r}),JS9.Keyboard.arrowKey(e,i,{x:r,y:0},n),s.fire("mouse:up"))},JS9.Keyboard.Actions["remove selected region"]=function(e,t,i){var s,a;i&&i.preventDefault(),e&&(s=e.display.layers[a=e.layer||"regions"].canvas,e.removeShapes(a,"selected"),e.display.clearMessage(a),s.fire("mouse:up"))},JS9.Keyboard.Actions["raise region layer to top"]=function(e,t,i){i&&i.preventDefault(),e&&e.activeShapeLayer("regions")},JS9.Keyboard.Actions["toggle active shape layers"]=function(e,t,i){i&&i.preventDefault(),e&&e.toggleShapeLayers()},JS9.Keyboard.Actions["send selected region to back"]=function(e,t,i){i&&i.preventDefault(),e&&e.changeShapes("regions","selected",{send:"back"})},JS9.Keyboard.Actions["copy selected region to clipboard"]=function(e,t,i){var s;if(e)return s=e.listRegions("selected",{mode:1}),JS9.CopyToClipboard(s,e),s},JS9.Keyboard.Actions["copy all regions to clipboard"]=function(e,t,i){var s;if(e)return s=e.listRegions("all",{mode:1}),JS9.CopyToClipboard(s,e),s},JS9.Keyboard.Actions["paste regions from local clipboard"]=function(e,t,i){return JS9.Regions.pasteFromClipboard.call(e,!1)},JS9.Keyboard.Actions["paste regions to current position"]=function(e,t,i){return JS9.Regions.pasteFromClipboard.call(e,!0)},JS9.Keyboard.Actions["undo remove of region(s)"]=function(e,t,i){e&&e.unremoveRegions()},JS9.Keyboard.Actions["select region"]=function(e,t,i){var s,a,n,r;if(e)for(r=(a=e.layers[e.layer||"regions"].canvas).getObjects(),s=0;s<r.length;s++)if(a.containsPoint(null,n=r[s],e.pos)){a.setActiveObject(n);break}},JS9.Keyboard.Actions["select all regions"]=function(e,t,i){var s,a;e&&1!==fabric.major_version&&(a=new fabric.ActiveSelection((s=e.layers[e.layer||"regions"].canvas).getObjects(),{canvas:s}),s.setActiveObject(a),s.renderAll())},JS9.Keyboard.Actions["refresh image"]=function(e,t,i){e&&(i&&i.preventDefault(),e.refreshImage())},JS9.Keyboard.Actions["display full image"]=function(e,t,i){e&&(i&&i.preventDefault(),e.displaySection("full"))},JS9.Keyboard.Actions["display selected cutouts"]=function(e,t,i){e&&(i&&i.preventDefault(),e.displaySection("selected"))},JS9.Keyboard.Actions["toggle coordinate grid"]=function(e,t,i){JS9.Grid.toggle(e)},JS9.Keyboard.Actions["toggle crosshair"]=function(e,t,i){e&&(i&&i.preventDefault(),e.params.crosshair=!e.params.crosshair,e.params.crosshair||JS9.Crosshair.hide(e))},JS9.Keyboard.Actions["toggle mouse/touch plugin"]=function(e,t,i){e&&e.display.displayPlugin("JS9MouseTouch")},JS9.Keyboard.Actions["toggle keyboard actions plugin"]=function(e,t,i){e&&e.display.displayPlugin("JS9Keyboard")},JS9.Keyboard.Actions["toggle preferences plugin"]=function(e,t,i){e&&e.display.displayPlugin("JS9Preferences")},JS9.Keyboard.Actions["toggle shape layers plugin"]=function(e,t,i){e&&e.display.displayPlugin("JS9Layers")},JS9.Keyboard.getAction=function(e,t){var i,s=JS9.eventToCharStr(t);return s&&(i=JS9.globalOpts.keyboardActions[s]),i},JS9.Keyboard.action=function(e,t,i,s){(s=s||JS9.Keyboard.getAction(e,i))&&JS9.Keyboard.Actions[s]&&(JS9.Keyboard.Actions[s](e,t,i),e&&JS9.globalOpts.extendedPlugins&&e.xeqPlugins("keypress","onkeyboardaction",i))},JS9.Keyboard.editregion=function(e,t,i){var s,a,n,r;if((n=e.getShapes("regions","selected")).length){for(s=0;s<n.length;s++){for(r=n[s].tags,a=0;a<r.length;a++){if(r[a]===t){t="";break}if(r[a]===i){r[a]=t,t="";break}}t&&r.push(t)}e.changeShapes("regions","selected",{tags:r})}},JS9.Keyboard.init=function(){var e,t;for(t in this.divjq.html(""),this.divjq.addClass("JS9PluginScrolling"),this.keyboardContainer=$("<div>").addClass(JS9.Keyboard.BASE+"Container").attr("id",this.id+"KeyboardContainer").appendTo(this.divjq),e=sprintf("<div class='%s'><b>Keys and their actions (or click the buttons):</b></div><p>",JS9.Keyboard.BASE+"Header"),this.keyboardHeadContainer=$("<div>").addClass(JS9.Keyboard.BASE+"Container").attr("id",this.id+"KeyboardHeadContainer").html(e).appendTo(this.keyboardContainer),this.keyboardActionContainer=$("<div>").addClass(JS9.Keyboard.BASE+"ActionContainer").attr("id",this.id+"ActionContainer").html("").appendTo(this.keyboardContainer),JS9.globalOpts.keyboardActions)JS9.globalOpts.keyboardActions.hasOwnProperty(t)&&JS9.Keyboard.addAction.call(this,this.keyboardActionContainer,t,e=JS9.globalOpts.keyboardActions[t])},JS9.RegisterPlugin(JS9.Keyboard.CLASS,JS9.Keyboard.NAME,JS9.Keyboard.init,{menuItem:"Keyboard Actions",onplugindisplay:JS9.Keyboard.init,help:"help/keyboard.html",winTitle:"Keyboard Actions",winResize:!0,winDims:[JS9.Keyboard.WIDTH,JS9.Keyboard.HEIGHT]}),JS9.Layers={},JS9.Layers.CLASS="JS9",JS9.Layers.NAME="Layers",JS9.Layers.WIDTH=460,JS9.Layers.HEIGHT=250,JS9.Layers.BASE=JS9.Layers.CLASS+JS9.Layers.NAME,JS9.Layers.headerHTML="Shape layers can be hidden or made visible below. The topmost visible layer in the stack is <b>active</b>: it responds to mouse and touch events. Move a layer to the top of the stack to make it active.",JS9.Layers.layerHTML="<span style='float: left'>$visible&nbsp;&nbsp;$save&nbsp;&nbsp;</span>&nbsp;&nbsp; <span class='JS9LayersSpan'>$layer&nbsp;&nbsp</span>",JS9.Layers.nolayersHTML='<p><span class="JS9NoLayers">[Layers will appear here as they are created]</span>',JS9.Layers.visibleHTML='<input class="JS9LayersVisibleCheck" type="checkbox" id="visible" name="visible" value="visible" onclick="javascript:JS9.Layers.xvisible(\'%s\', \'%s\', \'%s\', this)">visible',JS9.Layers.saveBothHTML='<select class="JS9LayersSaveBothSelect" onfocus="this.selectedIndex=0;" onchange="JS9.Layers.xsave(\'%s\', \'%s\', \'%s\', this)"><option selected disabled>save as ...</option><option value="catalog">catalog</option><option value="regions">regions</option><option value="svg">svg</option></select>',JS9.Layers.saveRegionsHTML='<select class="JS9LayersSaveSelect" onfocus="this.selectedIndex=0;" onchange="JS9.Layers.xsave(\'%s\', \'%s\', \'%s\', this)"><option selected disabled>save as ...</option><option value="regions">regions</option><option value="svg">svg</option></select>',JS9.Layers.layerNameHTML="<b>%s</b>",JS9.Layers.imid=function(e,t){return(e.display.id+"_"+e.id+"_"+t+"_").replace(/[^A-Za-z0-9_]/g,"_")+"Layer"},JS9.Layers.dispclass=function(e){return(JS9.Layers.BASE+"_"+e.display.id).replace(/[^A-Za-z0-9_]/g,"_")},JS9.Layers.activeLayer=function(e,t){var i,s,a,n,r;if(e){if(1===(r=t.layersLayerContainer.sortable("toArray")).length&&!r[0])return;for(i=0;i<r.length;i++)r[i]=$("#"+r[i]).attr("layer");s=e.activeShapeLayer(r),a=JS9.Layers.imid(e,s),n=JS9.Layers.dispclass(e)+"_Layer",$("."+n).removeClass(JS9.Layers.BASE+"LayerActive").addClass(JS9.Layers.BASE+"LayerInactive"),$("#"+a).removeClass(JS9.Layers.BASE+"LayerInactive").addClass(JS9.Layers.BASE+"LayerActive")}},JS9.Layers.xvisible=function(e,t,i,s){var a=JS9.lookupImage(t,e);a&&(a.showShapeLayer(i,!!s.checked),JS9.Layers.activeLayer(a,a.display.pluginInstances[JS9.Layers.BASE],!0))},JS9.Layers.xsave=function(e,t,i,s){var a=JS9.lookupImage(t,e),n=s.options[s.selectedIndex].value;a&&("catalog"===n?a.saveCatalog(null,i):"regions"===n?a.saveRegions(null,null,i):"svg"===n&&a.saveRegions(null,null,{layer:i,type:"svg"}))},JS9.Layers.addLayer=function(e,t){var i,s,a,n,r,o,l,c,h,u=JS9.Layers.BASE+"Layer",d=[];e&&t&&e.layers[t]&&"main"===e.layers[t].dlayer.dtype&&(this.nlayer||this.layersLayerContainer.html(""),c=e.id,h=e.display.id,r=parseInt(e.display.layers[t].divjq.css("z-index"),10),a=JS9.Layers.imid(e,t),l=JS9.Layers.dispclass(e)+"_Layer",d.push({name:"imid",value:c}),d.push({name:"visible",value:sprintf(JS9.Layers.visibleHTML,h,c,t)}),d.push(e.layers[t].catalog?{name:"save",value:sprintf(JS9.Layers.saveBothHTML,h,c,t)}:{name:"save",value:sprintf(JS9.Layers.saveRegionsHTML,h,c,t)}),i=JS9.DEBUG>1?sprintf("%s layer [zindex: %s]",t,r):sprintf("%s layer",t),d.push({name:"layer",value:sprintf(JS9.Layers.layerNameHTML,i)}),s=JS9.Image.prototype.expandMacro.call(e,JS9.Layers.layerHTML,d),n=$("<div>").addClass(u).addClass(l).attr("id",a).attr("layer",t).prop("imid",c).html(s),this.nlayer?(this.layersLayerContainer.find("."+u).each(function(t,i){var s,a,l=$(i);o||(s=l.attr("layer"))&&(a=parseInt(e.display.layers[s].divjq.css("z-index"),10),Math.abs(r)>Math.abs(a)&&(n.insertBefore(l),o=!0))}),o||n.appendTo(this.layersLayerContainer)):n.appendTo(this.layersLayerContainer),n.find(".JS9LayersVisibleCheck").prop("checked",!!e.layers[t].show),this.nlayer++)},JS9.Layers.display=function(){this.lastimage!==this.display.image&&JS9.Layers.init.call(this)},JS9.Layers.close=function(){JS9.Layers.init.call(this,{mode:"clear"})},JS9.Layers.init=function(e){var t,i,s=this;if(e=e||{},this.divjq.html(""),this.nlayer=0,this.divjq.addClass("JS9PluginScrolling"),this.layersContainer=$("<div>").addClass(JS9.Layers.BASE+"Container").attr("id",this.id+"LayersContainer").css("overflow","auto").appendTo(this.divjq),this.layersHeader=$("<div>").addClass(JS9.Layers.BASE+"Header").attr("id",this.display.id+"Header").html(JS9.Layers.headerHTML).appendTo(this.layersContainer),this.layersLayerContainer=$("<div>").addClass(JS9.Layers.BASE+"LayerContainer").attr("id",this.id+"LayersLayerContainer").html(JS9.Layers.nolayersHTML).appendTo(this.layersContainer),"clear"!==e.mode){if(this.display.image){for(t in(i=this.display.image).layers)"crosshair"!==t&&i.layers.hasOwnProperty(t)&&JS9.Layers.addLayer.call(this,i,t);this.lastimage=i}this.layersLayerContainer.sortable({start:function(e,t){},stop:function(e,t){JS9.Layers.activeLayer(i,s)}}),JS9.Layers.activeLayer(i,this)}},JS9.RegisterPlugin(JS9.Layers.CLASS,JS9.Layers.NAME,JS9.Layers.init,{menuItem:"Shape Layers",onplugindisplay:JS9.Layers.init,onshapelayercreate:JS9.Layers.init,onshapelayershow:JS9.Layers.init,onshapelayeractive:JS9.Layers.init,onshapelayerhide:JS9.Layers.init,onimageload:JS9.Layers.init,onimagedisplay:JS9.Layers.display,onimageclose:JS9.Layers.close,help:"help/layers.html",winTitle:"Shape Layers",winResize:!0,winDims:[JS9.Layers.WIDTH,JS9.Layers.HEIGHT]}),JS9.Magnifier={},JS9.Magnifier.CLASS="JS9",JS9.Magnifier.NAME="Magnifier",JS9.Magnifier.WIDTH=JS9.WIDTH/2,JS9.Magnifier.HEIGHT=JS9.HEIGHT/2,JS9.Magnifier.SWIDTH=250,JS9.Magnifier.SHEIGHT=250,JS9.Magnifier.opts={originX:"left",originY:"top",hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,selectable:!1,zoom:4,canvas:{selection:!1},tagcolors:{defcolor:"#00FF00"}},JS9.Magnifier.bcall=function(e,t,i){var s,a;switch((s=$(e).closest("div[class^=JS9PluginToolbar]").data("displayid"))?a=JS9.getImage(s):JS9.error("can't find display for cmd: "+t),a||JS9.error("can't find image for cmd: "+t),t){case"zoomMagnifier":arguments.length<3&&JS9.error("missing argument(s) for cmd: "+t);try{JS9.Magnifier.zoom(a,i)}catch(n){JS9.error("error calling zoomMagnifier()",n)}}},JS9.Magnifier.HTML="<span><button type='button' class='JS9Button' onClick='JS9.Magnifier.bcall(this, \"zoomMagnifier\", \"x2\"); return false'>x2</button><button type='button' class='JS9Button' onClick='JS9.Magnifier.bcall(this, \"zoomMagnifier\", \"/2\"); return false'>/2</button><button type='button' class='JS9Button' onClick='JS9.Magnifier.bcall(this, \"zoomMagnifier\", \""+JS9.Magnifier.opts.zoom+"\"); return false'>"+JS9.Magnifier.opts.zoom+"</button></span>",JS9.Magnifier.init=function(e,t){this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Magnifier.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Magnifier.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.canvas=document.createElement("canvas"),this.canvasjq=$(this.canvas),this.canvasjq.addClass("JS9Magnifier"),this.canvasjq.css("z-index",JS9.ZINDEX),this.canvasjq.attr("width",this.width),this.canvasjq.attr("height",this.height),this.context=this.canvas.getContext("2d"),JS9.ANTIALIAS||(this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.msImageSmoothingEnabled=!1),this.containerjq=$("<div>").addClass("JS9Container").append(this.canvasjq).appendTo(this.divjq),this.display.newShapeLayer("magnifier",JS9.Magnifier.opts,this.divjq)},JS9.Magnifier.display=function(e,t){var i,s,a,n,r,o,l,c,h,u,d,p,f;e&&e.display.pluginInstances.JS9Magnifier&&"active"===e.display.pluginInstances.JS9Magnifier.status&&(e.clickState>0||e.clickState<-1||(e.magnifier||(e.magnifier={zoom:JS9.Magnifier.opts.zoom,posx:0,posy:0}),a=e.display.pluginInstances.JS9Magnifier,r=e.display.canvas,n=e.magnifier.zoom,c=Math.floor(a.width/n),h=Math.floor(a.height/n),t?(l=(i=e.imageToDisplayPos(t)).y-h/2,e.magnifier.posx=o=i.x-c/2,e.magnifier.posy=l):(o=e.magnifier.posx,l=e.magnifier.posy),u=0,d=0,p=a.canvas.width,f=a.canvas.height,o<0&&(c+=o,u-=o*n,p+=o*n,o=0),(s=o+c-r.width)>0&&(p=(c-=s)*n),l<0&&(h+=l,d-=l*n,f+=l*n,l=0),(s=l+h-r.height)>0&&(f=(h-=s)*n),a.context.clear(),a.context.drawImage(r,o,l,c,h,u,d,p,f),JS9.globalOpts.magnifierRegions&&e.display.layers&&e.display.layers.regions&&(r=e.display.layers.regions.canvas.getElement(),a.context.drawImage(r,o*=fabric.devicePixelRatio,l*=fabric.devicePixelRatio,c*=fabric.devicePixelRatio,h*=fabric.devicePixelRatio,u,d,p,f)),e.magnifier.boxid||(e.magnifier.boxid=e.addShapes("magnifier","box"),$(a.canvas).css("background-color","black")),e.magnifier.ozoom!==n&&(e.changeShapes("magnifier",e.magnifier.boxid,{left:a.width/2,top:a.height/2,width:n,height:n}),e.magnifier.ozoom=e.magnifier.zoom)))},JS9.Magnifier.zoom=function(e,t){var i,s,a;if(e&&e.magnifier){switch(s=(i=e.magnifier).zoom,t.charAt(0)){case"x":case"*":a=s*parseFloat(t.slice(1));break;case"/":a=s/parseFloat(t.slice(1));break;default:a=parseFloat(t)}(!a||a<1)&&(a=1),i.ozoom=i.zoom,i.zoom=a,JS9.Magnifier.display(e)}},JS9.Magnifier.clear=function(e){var t=e.display.pluginInstances.JS9Magnifier;return t&&e===e.display.image&&(t.context.clear(),e.removeShapes("magnifier","all"),e.magnifier.boxid=null,e.magnifier.ozoom=0,$(t.canvas).css("background-color","#E9E9E9")),e},JS9.RegisterPlugin(JS9.Magnifier.CLASS,JS9.Magnifier.NAME,JS9.Magnifier.init,{menuItem:"Magnifier",dynamicSelect:!0,toolbarSeparate:!1,toolbarHTML:JS9.Magnifier.HTML,onplugindisplay:JS9.Magnifier.display,onmousemove:JS9.Magnifier.display,onimagedisplay:JS9.Magnifier.display,onimageclose:JS9.Magnifier.clear,onimageclear:JS9.Magnifier.clear,winTitle:"Magnifier",winDims:[JS9.Magnifier.WIDTH,JS9.Magnifier.HEIGHT],divArgs:[JS9.Magnifier.SWIDTH,JS9.Magnifier.SHEIGHT]}),JS9.Mef={},JS9.Mef.CLASS="JS9",JS9.Mef.NAME="Mef",JS9.Mef.WIDTH=800,JS9.Mef.HEIGHT=240,JS9.Mef.BASE=JS9.Mef.CLASS+JS9.Mef.NAME,JS9.Mef.xseparate=function(e,t){var i=JS9.lookupDisplay(e);i&&(i.pluginInstances[JS9.Mef.BASE].separate=t.checked)},JS9.Mef.imid=function(e,t,i){var s=e.display.id+"_"+e.id;return i&&(s=s.replace(/\[[a-zA-Z0-9][a-zA-Z0-9_]*\]/g,"")),s.replace(/[^A-Za-z0-9_]/g,"_")+"_MefExtension_"+t},JS9.Mef.activeExtension=function(e,t){var i;e&&($("."+e.display.id+"_"+JS9.Mef.BASE+"Extension").removeClass(JS9.Mef.BASE+"ExtensionActive").addClass(JS9.Mef.BASE+"ExtensionInactive"),i=JS9.Mef.imid(e,t,!0),$("."+i).removeClass(JS9.Mef.BASE+"ExtensionInactive").addClass(JS9.Mef.BASE+"ExtensionActive"))},JS9.Mef.display=function(){this.lastimage!==this.display.image&&JS9.Mef.init.call(this)},JS9.Mef.close=function(){JS9.Mef.init.call(this,{mode:"clear"})},JS9.Mef.init=function(e){var t,i,s,a,n,r,o,l,c,h,u=this,d=function(e,t,n){var r,o,d="",p=!0;switch(e.type){case"image":e.naxes.length<2&&(p=!1);break;case"table":case"ascii":for(o=0;o<e.cols.length;o++)"X"!==(r=e.cols[o]).name&&"x"!==r.name||(d+="x"),"Y"!==r.name&&"y"!==r.name||(d+="y");"xy"!==d&&"yx"!==d&&(p=!1)}c=p?"<pre>&nbsp;&nbsp;"+t+"</pre>":"<pre>&nbsp;&nbsp;<span class='JS9MefStrike'><span>"+t+"</span></span></pre>",s=JS9.Mef.imid(i,n),a=JS9.Mef.imid(i,n,!0),h=i.display.id+"_"+JS9.Mef.BASE,l=$("<div>").addClass(a).addClass(h+"Extension").addClass(JS9.Mef.BASE+"Extension").addClass(JS9.Mef.BASE+"ExtensionInactive").attr("id",s).html(c).appendTo(u.mefContainer),p&&l.on("mousedown touchstart",function(){i.displayExtension(e.hdu,{separate:u.separate}),JS9.Mef.activeExtension(i,e.hdu)})};if(e=e||{},this.divjq.addClass("JS9PluginScrolling"),this.divjq.html(""),this.mefContainer=$("<div>").addClass(JS9.Mef.BASE+"Container").attr("id",this.id+"MefContainer").appendTo(this.divjq),void 0===this.separate&&(this.separate=!1),(i=this.display.image)&&"clear"!==e.mode)if(i.hdus){for(this.lastimage=i,r=sprintf("<div class='%s'><span><b>Click on a FITS HDU extension to display it:</b></span>",JS9.Mef.BASE+"Header"),r+=sprintf('<span style="float: right"><input type="checkbox" id="%s" name="separate" value="separate" onclick="javascript:JS9.Mef.xseparate(\'%s\', this)"><b>Display each extension as a separate image</b></span></div>',o=JS9.Mef.imid(i,"Separate"),this.display.id),this.mefContainer.html(r),t=0;t<i.hdus.length;t++)d(n=i.hdus[t],r=JS9.hdus2Str([n]).trim(),t);$("#"+o).prop("checked",this.separate),void 0!==i.raw.hdu.fits.extnum&&JS9.Mef.activeExtension(i,i.raw.hdu.fits.extnum)}else this.mefContainer.html("<p><center>No FITS HDU extensions are present in this image.</center>");else this.mefContainer.html("<p><center>FITS HDU extensions will be displayed here.</center>")},JS9.RegisterPlugin(JS9.Mef.CLASS,JS9.Mef.NAME,JS9.Mef.init,{menuItem:"Extensions",help:"help/mef.html",onplugindisplay:JS9.Mef.init,onimageload:JS9.Mef.init,onimagedisplay:JS9.Mef.display,onimageclose:JS9.Mef.close,winTitle:"Multi-Extension FITS",winResize:!0,winDims:[JS9.Mef.WIDTH,JS9.Mef.HEIGHT]}),JS9.Menubar={},JS9.Menubar.CLASS="JS9",JS9.Menubar.NAME="Menubar",JS9.Menubar.WIDTH=JS9.WIDTH||512,JS9.Menubar.HEIGHT="auto",JS9.Menubar.buttonOptsArr=[{name:"file",label:"File"},{name:"edit",label:"Edit"},{name:"view",label:"View"},{name:"zoom",label:"Zoom"},{name:"scale",label:"Scale"},{name:"color",label:"Color"},{name:"region",label:"Regions"},{name:"wcs",label:"WCS"},{name:"analysis",label:"Analysis"},{name:"help",label:"Help"}],JS9.Menubar.keyMap={"local file ...":"open local file","toggle: src/bkgd":"toggle selected region: source/background","crosshair for this image":"toggle crosshair","toggle: incl/excl":"toggle selected region: include/exclude","full image":"display full image","selected cutouts":"display selected cutouts","refreshed image":"refresh image","light window":"new JS9 light window","active shape layers":"toggle active shape layers","Keyboard Actions":"toggle keyboard actions plugin","Mouse/Touch":"toggle mouse/touch plugin",Preferences:"toggle preferences plugin","Shape Layers":"toggle shape layers plugin","edit selected":"edit selected region","copy selected":"copy selected region to clipboard",edit:"edit selected region","to back":"send selected region to back",copy:"copy selected region to clipboard","copy all":"copy all regions to clipboard","paste to region pos":"paste regions from local clipboard","paste to current pos":"paste regions to current position","undo remove":"undo remove of region(s)","copy wcs pos":"copy wcs position to clipboard","copy value/pos":"copy value and position to clipboard","zoom 1":"reset zoom","zoom in":"zoom in","zoom out":"zoom out"},JS9.menuButtonOptsArr&&(JS9.Menubar.buttonOptsArr=JS9.menuButtonOptsArr),JS9.Menubar.getDisplays=function(e,t){var i,s,a,n=[];if(e=e||"any",t=t||"",this.id.search(JS9.SUPERMENU)>=0&&!t.match(/^super_/)){if("all"!==e&&this.selectedDisplay){if($.inArray(this.selectedDisplay,JS9.displays)>=0)return[this.selectedDisplay];this.selectedDislay=null}if("*"===(s=(this.divjq.data("displays")||"*").split(","))[0])for(i=0;i<JS9.displays.length;i++)n.push(JS9.displays[i]);else for(i=0;i<s.length;i++)(a=JS9.lookupDisplay(s[i]))&&n.push(a)}else"*"===this.divjq.data("js9id")&&n.push(JS9.getDynamicDisplayOr(JS9.displays[0]));return n.length||n.push(this.display),n},JS9.Menubar.onclick=function(e){var t,i,s;for("string"==typeof e&&"all"!==e&&(e=JS9.lookupDisplay(e)),t=0;t<JS9.supermenus.length;t++)i=JS9.Menubar.getDisplays.call(s=JS9.supermenus[t],"all"),($.inArray(e,i)>=0||"all"===e)&&(JS9.bugs.webkit_resize?$(".JS9").find(".JS9Image").removeClass("JS9Highlight"):$(".JS9").removeClass("JS9Highlight"),e===s.selectedDisplay||"all"===e?s.selectedDisplay=null:(s.selectedDisplay=e,JS9.bugs.webkit_resize?$(e.divjq).find(".JS9Image").addClass("JS9Highlight"):$(e.divjq).addClass("JS9Highlight")))},JS9.Menubar.reset=function(e){JS9.Menubar.rkeyMap=null},JS9.Menubar.createMenus=function(){var e=this,t=function(e,t,i){var s;window.hasOwnProperty("Jupyter")?(s=this.offset(),e.$menu.css({left:s.left+20,top:s.top+10})):e.$menu.position({my:"left top",at:"right-5 bottom-5",of:e.$trigger,collision:"fit"})},i=function(){var t=e.display;JS9.bugs.hide_menu&&t.image&&t.image.displayImage("rgb")},s=function(e,t){var i,s={name:e},a=JS9.globalOpts.keyboardActions,n=JS9.Menubar.keyMap[e];if(!JS9.Menubar.rkeyMap){for(i in JS9.Menubar.rkeyMap={},a)a.hasOwnProperty(i)&&(JS9.Menubar.rkeyMap[a[i]]=i);JS9.Menubar.keyActions=$.extend(!0,{},a)}if(JS9.notNull(n)&&JS9.Menubar.rkeyMap)(i=JS9.Menubar.rkeyMap[n])&&(s={name:"<span>"+e+" <span style='float:right;font:bold 10pt Courier;'>&nbsp;&nbsp;&nbsp;"+i+"</span></span>",isHtmlName:!0});else if(t&&JS9.Menubar.rkeyMap)for(n in JS9.Menubar.rkeyMap)JS9.Menubar.rkeyMap.hasOwnProperty(n)&&n===t&&(i=JS9.Menubar.rkeyMap[n])&&(s={name:"<span>"+e+" <span style='float:right;font:bold 10pt Courier;'>&nbsp;&nbsp;&nbsp;"+i+"</span></span>",isHtmlName:!0});return s},a=function(t){var i=t.data;t.preventDefault(),$("#"+i.name+"UserMenu"+e.id).contextMenu()},n=function(a){a&&a.name&&a.title&&a.options&&$.contextMenu({selector:"#"+a.name+"UserMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,n,r={};for(t=0;t<a.options.length;t++)n=s((i=a.options[t]).name,i.shortcut),r[i.name]=i.image?{name:"<div class='JS9MenubarUserImage'><img src='"+i.image+"' alt='"+i.name+"' class='JS9MenubarUserImage' >&nbsp;&nbsp;"+n.name+"</div>",isHtmlName:!0}:n;return{callback:function(t,s){JS9.Menubar.getDisplays.call(e).forEach(function(e){var n,r,o,l=e;for(n=0;n<a.options.length;n++)t===(i=a.options[n]).name&&("function"==typeof JS9.publics[i.cmd]?((r=JSON.parse(JSON.stringify(i.args||[]))).push({display:l}),JS9.publics[i.cmd].apply(null,r),!1!==i.updateTitle&&(i.image&&a.updateTitle&&!1!==i.updateTitle&&a.updateTitle.match(/(both|image)/)?("both"===a.updateTitle?o="<div style='white-space:nowrap;'><img src='"+i.image+"' alt='"+i.name+"' class='JS9MenubarUserImage' >&nbsp;&nbsp;"+i.name+"</div>":"image"===a.updateTitle&&(o="<div style='white-space:nowrap;'><img src='"+i.image+"' alt='"+i.name+"' class='JS9MenubarUserImage' ></div>"),$(s.selector).html(o)):a.updateTitle&&i.name&&$(s.selector).text(i.name))):JS9.error("unknown function for user menubar: "+a.cmd))})},items:r}}})};$("#fileMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#fileMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#fileMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,a,n,r,o,l,c,h=0,u={},d=JS9.Menubar.getDisplays.call(e)[0],p=d.image,f=JS9.images.length;for(t=0,l=0;t<f;t++)(a=JS9.images[t]).display===d&&l++;for((!l||l>=JS9.globalOpts.imagesFileSubmenu)&&(u.filetitle={name:"Files and Displays:",disabled:!0}),l&&l<JS9.globalOpts.imagesFileSubmenu?(u.imagestitle={name:"Images:",disabled:!0},c=u):l&&(u.images={name:"images ...",items:{imagestitle:{name:"display this image:",disabled:!0}}},c=u.images.items),t=0;t<f;t++)(a=JS9.images[t]).display===d&&(n=a.id,JS9.globalOpts.rgb.active&&(a===JS9.globalOpts.rgb.rim&&(n+=" (red)"),a===JS9.globalOpts.rgb.gim&&(n+=" (green)"),a===JS9.globalOpts.rgb.bim&&(n+=" (blue)")),c[n]=s(n),d.image&&d.image.id===a.id&&(c[n].icon="sun"));if(l&&l<JS9.globalOpts.imagesFileSubmenu&&(u["sep"+h++]="------",u.filetitle={name:"Files and Displays:",disabled:!0}),u.opens={name:"open ...",items:{openstitle:{name:"open:",disabled:!0}}},u.opens.items.open=s("local file ..."),u.opens.items.loadproxy=s("url via proxy ..."),u.opens.items.loadproxy.disabled=!(!JS9.allinone&&"none"!==JS9.globalOpts.helperType&&JS9.globalOpts.workDir&&JS9.globalOpts.loadProxy),u.opens.items.loadcors=s("url via CORS ..."),u.opens.items.loadcors.disabled=!!window.hasOwnProperty("Jupyter"),u.disps={name:"display ...",items:{dispstitle:{name:"display:",disabled:!0}}},u.disps.items.header=s("FITS header"),u.disps.items.hdus=s("FITS HDUs"),p||(u.disps.items.header.disabled=!0),p&&p.hdus||(u.disps.items.hdus.disabled=!0),u.disps.items.refresh=s("refreshed image"),u.disps.items.full=s("full image"),u.disps.items.cutout=s("selected cutouts"),u.disps.items.pageid=s("page id"),p&&p.raw&&p.raw.hdu&&p.raw.hdu.fits||(u.disps.items.refresh.disabled=!0,u.disps.items.full.disabled=!0,u.disps.items.cutout.disabled=!0),u.moveto={name:"move ...",items:{movetotitle:{name:"move to this display:",disabled:!0}}},p){for(u.moveto.disabled=!1,t=0;t<JS9.displays.length;t++)$("#"+JS9.displays[t].id).length>0&&d!==JS9.displays[t]&&(u.moveto.items["moveto_"+JS9.displays[t].id]=s(JS9.displays[t].id));u.moveto.items.moveto_newdisp=s("a new display")}else u.moveto.disabled=!0;if(u.saveas={name:"save ...",items:{saveastitle:{name:"choose output format:",disabled:!0},savefits:s("FITS"),savejpeg:s("JPEG"),savepng:s("PNG")}},p||(u.saveas.disabled=!0),u.separates={name:"separate ...",items:{}},u.separates.items.separate=s("separate these images"),u.separates.items.gather=s("gather all images here"),p||(u.separates.disabled=!0),u.syncs={name:"sync ...",items:{syncstitle:{name:"sync/unsync images:",disabled:!0}}},u.syncs.items.sync={name:"sync images ...",items:{}},u.syncs.items.unsync={name:"unsync images ...",items:{}},p){for(u.syncs.items.sync.disabled=!1,u.syncs.items.sync.items.sync_opstitle={name:"op(s) that trigger syncing:",disabled:!0},u.syncs.items.sync.items.syncops={value:JS9.globalOpts.syncOps,type:"textarea"},u.syncs.items.sync.items.syncreciprocate={name:"reciprocal syncing",selected:JS9.globalOpts.syncReciprocate,type:"checkbox"},u.syncs.items.sync.items["sep"+h++]="------",u.syncs.items.sync.items.title={name:"image(s) to keep in sync:",disabled:!0},t=0;t<JS9.images.length;t++)p!==JS9.images[t]&&(u.syncs.items.sync.items["sync_"+JS9.images[t].id]=s(JS9.images[t].id));for(u.syncs.items.sync.items.sync_allimages=s("all images"),u.syncs.items.unsync.disabled=!1,u.syncs.items.unsync.items.unsync_opstitle={name:"op(s) to unsync:",disabled:!0},u.syncs.items.unsync.items.unsyncops={value:JS9.globalOpts.syncOps,type:"textarea"},u.syncs.items.unsync.items.unsyncreciprocate={name:"unsync reciprocals",selected:JS9.globalOpts.syncReciprocate,type:"checkbox"},u.syncs.items.unsync.items["sep"+h++]="------",u.syncs.items.unsync.items.title={name:"image(s) to unsync:",disabled:!0},t=0;t<JS9.images.length;t++)p!==JS9.images[t]&&(u.syncs.items.unsync.items["unsync_"+JS9.images[t].id]=s(JS9.images[t].id));u.syncs.items.unsync.items.unsync_allimages=s("all images")}else u.syncs.disabled=!0,u.syncs.items.sync.disabled=!0,u.syncs.items.unsync.disabled=!0;if(u.closes={name:"close ...",items:{closestitle:{name:"close:",disabled:!0}}},p||(u.closes.disabled=!0),u.closes.items.close=s("this image"),u.closes.items.closeall=s("all images"),u.closes.items.free=s("this image's memory"),u.closes.items.removeproxy=s("proxy file"),p&&p.raw&&p.raw.hdu&&p.raw.hdu.fits||(u.closes.items.free.disabled=!0),p&&p.proxyFile||(u.closes.items.removeproxy.disabled=!0),u.catalogs={name:"catalog ...",items:{}},p||(u.catalogs.disabled=!0),u.catalogs.items.loadcatalog=s("load ..."),u.catalogs.items.savecatalog=s("save active"),u.createmosaic={name:"mosaic ...",items:{createmosaictitle:{name:"create a mosaic using:",disabled:!0},mosaiccurrent:s("images in the current file"),mosaicdisplay:s("images in this display")}},p||(u.createmosaic.disabled=!0),u.sessions={name:"session ...",items:{}},u.sessions.items.loadsession=s("load ..."),u.sessions.items.savesession={name:"save ...",items:{savesessiontitle:{name:"include these images:",disabled:!0},savecurrent:s("the current image"),savedisplay:s("all images in this display")}},u.windows={name:"window ...",items:{windowstitle:{name:"create a new:",disabled:!0}}},u.windows.items.lite=s("light window"),u.windows.items.xnew=s("separate window"),window.isElectron&&(u.windows.items.xnew.disabled=!0),window.isElectron&&window.electronIPC&&(u.electronHelper=s("connect to JS9 helper"),JS9.helper.connected&&(u.electronHelper.disabled=!0)),e.issuper){for(r=JS9.Menubar.getDisplays.call(e,"all"),u.supermenu={name:"supermenu ...",items:{supertitle:{name:"target this display:",disabled:!0}}},t=0,i=0;t<r.length;t++)u.supermenu.items["super_"+(n=(o=r[t]).id)]=s(n),e.selectedDisplay===o&&(u.supermenu.items["super_"+n].icon="sun",i++);u.supermenu.items.super_all=s(n="all displays"),i||(u.supermenu.items.super_all.icon="sun")}return u["sep"+h++]="------",u.print=s("print ..."),p||(u.print.disabled=!0),window.isElectron&&window.electronIPC&&(u.windowPrint=s("print window ..."),u.windowPDF=s("save window to pdf")),{callback:function(t,i){JS9.Menubar.getDisplays.call(e,"any",t).forEach(function(s){var a,n,r,o,l,c,h,u,d,p,f=s,g=f.image;if(!($.inArray(f,JS9.displays)<0))switch(t){case"refresh":g&&g.raw.hdu&&g.raw.hdu.fits&&g.refreshImage();break;case"full":g&&g.raw.hdu&&g.raw.hdu.fits&&g.displaySection("full");break;case"cutout":g&&g.raw.hdu&&g.raw.hdu.fits&&g.displaySection("selected");break;case"free":g&&g.raw.hdu&&g.raw.hdu.fits&&JS9.cleanupFITSFile(g.raw.hdu.fits,!0);break;case"close":g&&g.closeImage();break;case"closeall":f&&JS9.CloseDisplay(f.id);break;case"removeproxy":g&&g.removeProxyFile();break;case"savecurrent":f&&g&&JS9.SaveSession({mode:"image"},{display:f});break;case"savedisplay":f&&JS9.SaveSession({mode:"display"},{display:f});break;case"loadsession":f&&JS9.OpenSessionMenu({display:f});break;case"loadcatalog":f&&JS9.OpenCatalogsMenu({display:f});break;case"savecatalog":g&&g.saveCatalog();break;case"mosaiccurrent":f&&g&&JS9.CreateMosaic("current",{display:f});break;case"mosaicdisplay":f&&JS9.CreateMosaic("all",{display:f});break;case"header":g&&(g.raw.header?g.displayAnalysis("text",JS9.raw2FITS(g.raw,{addcr:!0}),{title:"FITS Header: "+g.id}):JS9.error("no FITS header for "+g.id));break;case"hdus":g&&(g.hdus?g.displayAnalysis("text",JS9.hdus2Str(g.hdus),{title:"FITS HDUs: "+g.id,winformat:"width=800px,height=200px,center=1,resize=1,scrolling=1"}):JS9.error("no FITS header for "+g.id));break;case"lite":JS9.LoadWindow(null,{clone:f.id},"light");break;case"xnew":JS9.LoadWindow(null,null,"new");break;case"electronHelper":if(window.isElectron&&window.electronIPC)try{window.electronIPC.send("msg","startHelper")}catch(m){}break;case"pageid":n=sprintf("<center><p>pageid: %s</center>",JS9.helper.pageid||"none"),r="JS9 page id",r+=sprintf(JS9.IDFMT,f.id),JS9.lightWin("fileid"+JS9.uniqueID(),"inline",n,r,JS9.lightOpts[JS9.LIGHTWIN].lineWin);break;case"open":JS9.OpenFileMenu({display:f});break;case"loadcors":o=JS9.Image.prototype.displayAnalysis.call(null,"textline",JS9.allinone?JS9.allinone.loadCorsHTML:JS9.InstallDir(JS9.globalOpts.corsURL),{title:"Open a shared CORS link"}),$(o).data("dispid",f.id);break;case"loadproxy":o=JS9.Image.prototype.displayAnalysis.call(null,"textline",JS9.InstallDir(JS9.globalOpts.proxyURL),{title:"Open a link via server proxy"}),$(o).data("dispid",f.id).data("aname","loadproxy");break;case"savefits":g&&(n=g.id.replace(/\.png/i,".fits").replace(/\.gz$/i,"").replace(/\[.*\]/,""),g.saveFITS(n));break;case"savepng":g&&(n=g.id.replace(/\.fit[s]?/i,".png").replace(/\.gz$/i,"").replace(/\[.*\]/,""),g.savePNG(n));break;case"savejpeg":g&&(n=g.id.replace(/\.fit[s]?/i,".jpeg").replace(/\.png$/i,".jpeg").replace(/\.gz$/i,"").replace(/\[.*\]/,""),g.saveJPEG(n));break;case"print":g&&g.print();break;case"windowPrint":window.isElectron&&window.electronIPC&&JS9.WindowPrint();break;case"windowPDF":window.isElectron&&window.electronIPC&&JS9.WindowToPDF();break;case"separate":f&&f.separate();break;case"gather":f&&(e.id.search(JS9.SUPERMENU)>=0&&!e.selectedDisplay&&JS9.error("gather requires a selected display"),f.gather());break;default:if(t.match(/^super_/))return c=t.replace(/^super_/,""),void JS9.Menubar.onclick.call(e,c);if(t.match(/^moveto_/))return void("newdisp"===(c=t.replace(/^moveto_/,""))?(h="JS9_light"+JS9.uniqueID(),$("#dhtmlwindowholder").arrive("#"+h,{onceOnly:!0},function(){g.moveToDisplay(h)}),JS9.LoadWindow(null,{id:h,clone:f.id},"light")):g.moveToDisplay(c));if(g&&t.match(/^sync_/))return d=(u=$.contextMenu.getInputValues(i)).syncops?u.syncops.trim().split(","):null,p={reciprocate:u.syncreciprocate},c=t.replace(/^sync_/,""),void g.syncImages(d,"allimages"===c?null:[c],p);if(g&&t.match(/^unsync_/))return d=(u=$.contextMenu.getInputValues(i)).unsyncops?u.unsyncops.trim().split(","):null,p={reciprocate:u.syncreciprocate},c=t.replace(/^unsync_/,""),void g.unsyncImages(d,"allimages"===c?null:[c],p);for(a=0;a<JS9.images.length;a++)if(g=JS9.images[a],l=t.replace(/ *\((red|green|blue)\)/,""),f.id===g.display.id&&g.id===l){g.displayImage("all"),g.refreshLayers(),f.clearMessage();break}}})},items:u}}}),$("#editMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#editMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#editMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t=0,i={edittitle1:{name:"Regions:",disabled:!0}};return i.configSelReg=s("edit selected"),i.copySelReg=s("copy selected"),i.copyAllReg=s("copy all"),i.pasteReg=s("paste to region pos"),i.pastePos=s("paste to current pos"),i.undoRemove=s("undo remove"),i["sep"+t++]="------",i.edittitle2={name:"Position/Value:",disabled:!0},i.copyWCSPos=s("copy wcs pos"),i.copyValPos=s("copy value/pos"),{callback:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i,s,a,n=e.image;if(!($.inArray(e,JS9.displays)<0))switch(t){case"copyAllReg":n&&(i=n.listRegions("all",{mode:1}),JS9.CopyToClipboard(i));break;case"copySelReg":n&&(i=n.listRegions("selected",{mode:1}),JS9.CopyToClipboard(i));break;case"configSelReg":n&&(s=n.layers.regions)&&(a=s.canvas.getActiveObject(),JS9.Regions.displayConfigForm.call(n,a));break;case"pasteReg":n&&JS9.Regions.pasteFromClipboard.call(n);break;case"pastePos":n&&JS9.Regions.pasteFromClipboard.call(n,!0);break;case"undoRemove":n&&n.unremoveRegions();break;case"copyWCSPos":JS9.hasOwnProperty("Keyboard")&&JS9.Keyboard.Actions["copy wcs position to clipboard"](n,n.ipos);break;case"copyValPos":JS9.hasOwnProperty("Keyboard")&&JS9.Keyboard.Actions["copy value and position to clipboard"](n,n.ipos)}})},items:i}}}),$("#viewMacMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#viewMacMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#viewMacMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,s={edittitle1:{name:"View:",disabled:!0}};for(t=0;t<e.macmenus.length;t++)s[(i=e.macmenus[t]).name]={name:i.title+" ..."};return{callback:function(t){$("#"+t+"Menu"+e.id).contextMenu()},items:s}}}),$("#viewMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#viewMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#viewMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,a,n,r,o="",l=0,c={},h=JS9.Menubar.getDisplays.call(e)[0],u=h.image,d=function(e,t){var i,s,a;if(delete h.tmp.editingMenu,t.resize)switch((a=t.resize.split(/[\s,\/]+/)).length){case 0:break;case 1:u?(i=u.wcs2imlen(a[0]),e.resize(i,i)):JS9.isNumber(a[0])&&(i=parseInt(a[0],10),e.resize(i,i));break;default:u&&u.wcs?(i=u.wcs2imlen(a[0]),s=u.wcs2imlen(a[1]),e.resize(i,s)):JS9.isNumber(a[0])&&JS9.isNumber(a[1])&&(i=parseInt(a[0],10),s=parseInt(a[1],10),e.resize(i,s))}};for(c["sep"+l++]={name:"Plugins:"},c["sep"+(l-1)].disabled=!0,t=0;t<JS9.plugins.length;t++)a=(i=JS9.plugins[t]).name,i.opts.menuItem&&"view"===i.opts.menu&&((n=h.pluginInstances[a])&&!n.winHandle||(i.xclass!==o&&(l+=1),o=i.xclass,c[a]=s(i.opts.menuItem),n&&"active"===n.status&&(c[a].icon="sun")));if(c["sep"+l++]="------",c.vdispstitle={name:"Display Options:",disabled:!0},c.vdisps={name:"show ...",items:{vdispstitle:{name:"show options:",disabled:!0}}},c.vdisps.items.valpos=s("value/position"),JS9.hasOwnProperty("Info")?h.image&&h.image.params.valpos&&(c.vdisps.items.valpos.icon="sun"):c.vdisps.items.valpos.disabled=!0,c.vdisps.items.toggleLayers=s("active shape layers"),u&&!u.toggleLayers&&(c.vdisps.items.toggleLayers.icon="sun"),c.vdisps.items.xhair=s("crosshair for this image"),JS9.hasOwnProperty("Crosshair")&&u?u&&u.params.crosshair&&(c.vdisps.items.xhair.icon="sun"):c.vdisps.items.xhair.disabled=!0,c.vdisps.items.xhairwcs=s("match wcs crosshairs"),JS9.hasOwnProperty("Crosshair")?JS9.globalOpts.wcsCrosshair&&(c.vdisps.items.xhairwcs.icon="sun"):c.vdisps.items.xhairwcs.disabled=!0,c.vdisps.items.toolbar=s("toolbar tooltips"),JS9.hasOwnProperty("Toolbar")?JS9.GetToolbar("showTooltips")&&(c.vdisps.items.toolbar.icon="sun"):c.vdisps.items.toolbar.disabled=!0,JS9.allinone||(c.vdisps.items.logo=s("js9 logo"),JS9.globalOpts.logoDisplay&&(c.vdisps.items.logo.icon="sun")),c.vdisps.items.inherit=s("new images inherit current params"),h.image&&h.image.params.inherit&&(c.vdisps.items.inherit.icon="sun"),c.vdisps.items.rawlayer={name:"raw data sources ...",items:{}},u&&u.raws.length>1){for(c.vdisps.items.rawlayer.items.whichrawtitle={name:"current raw data:"},t=0;t<u.raws.length;t++)c.vdisps.items.rawlayer.items[r="rawlayer_"+u.raws[t].id]={name:u.raws[t].id},u.raw===u.raws[t]&&(c.vdisps.items.rawlayer.items[r].icon="sun");c.vdisps.items.rawlayer.items["sep"+l++]="------",c.vdisps.items.rawlayer.items.rawlayer_remove=s("remove")}else c.vdisps.items.rawlayer.disabled=!0;return c.resizes={name:"resize ...",items:{resizestitle:{name:"resize the display:",disabled:!0}}},c.resizes.items.resize={events:{keyup:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i=$.contextMenu.getInputValues(t.data),s=t.which||t.keyCode,a=e;if(!($.inArray(a,JS9.displays)<0))switch(s){case 9:case 13:d(a,i);break;default:a.tmp.editingMenu=!0}})}},name:"change width/height:",type:"text"},c.resizes.items.imagesize=s("set to image size"),c.resizes.items.fullsize=s("set size to full window"),c.resizes.items.resetsize=s("reset to original size"),JS9.globalOpts.resize?u||(c.resizes.items.imagesize.disabled=!0):(c.resizes.items.resize.disabled=!0,c.resizes.items.fullsize.disabled=!0,c.resizes.items.imagesize.disabled=!0,c.resizes.items.resetsize.disabled=!0),{callback:function(i){JS9.Menubar.getDisplays.call(e).forEach(function(e){var s,a,n,r=e,o=r.image;if(!($.inArray(r,JS9.displays)<0))switch(i){case"valpos":o&&o.toggleValpos();break;case"xhair":o&&o.toggleCrosshair();break;case"xhairwcs":o&&o.toggleWCSCrosshair();break;case"toolbar":n=!JS9.GetToolbar("showTooltips"),JS9.SetToolbar("showTooltips",n);break;case"logo":for(JS9.globalOpts.logoDisplay=!JS9.globalOpts.logoDisplay,n=JS9.globalOpts.logoDisplay?"block":"none",s=0;s<JS9.displays.length;s++)JS9.displays[s].iconjq.css("display",n);break;case"toggleLayers":o&&o.toggleShapeLayers();break;case"inherit":o&&(o.params.inherit=!o.params.inherit);break;case"fullsize":r.resize("full",{center:!0});break;case"imagesize":r.resize("image");break;case"resetsize":r.resize("reset");break;default:for(s=0;s<JS9.plugins.length;s++)if((a=JS9.plugins[s]).name===i)return void r.displayPlugin(a);if(u&&i.match(/^rawlayer_/))if("remove"===(n=i.replace(/^rawlayer_/,""))){if(u.raw.id!==JS9.RAWID0)for(t=0;t<u.raws.length;t++)u.raw===u.raws[t]&&u.rawDataLayer(u.raw.id,"remove")}else u.rawDataLayer(n)}})},events:{show:function(t){var i=e.display,s={};i&&(s.resize=sprintf("%d %d",i.width,i.height),$.contextMenu.setInputValues(t,s),JS9.jupyterFocus(".context-menu-item"))},hide:function(t){var i,s=e.display;s&&s.tmp.editingMenu&&(i=$.contextMenu.getInputValues(t),d(s,i))}},items:c}}}),$("#zoomMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#zoomMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#zoomMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,a,n,r,o,l=0,c=JS9.Menubar.getDisplays.call(e)[0],h=c.image,u=function(e,t){delete c.tmp.editingMenu,isNaN(t.zoom)||e.setZoom(t.zoom)},d={zoomtitle:{name:"Zoom Factors:",disabled:!0}};for(t=JS9.imageOpts.zooms;t>=1;t--)i=Math.pow(2,-t),a=Math.pow(2,t),n=sprintf("zoom%s",i),r=sprintf("zoom 1/%s",a),d[n]=s(r),h&&h.rgb.sect.zoom===i&&(d[n].icon="sun");for(t=0;t<=JS9.imageOpts.zooms;t++)n=sprintf("zoom%s",i=Math.pow(2,t)),r=sprintf("zoom %s",i),d[n]=s(r),h&&h.rgb.sect.zoom===i&&(d[n].icon="sun");for(d.zoom={events:{keyup:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i=$.contextMenu.getInputValues(t.data),s=t.which||t.keyCode,a=e,n=a.image;if(!($.inArray(a,JS9.displays)<0))switch(s){case 9:case 13:n&&u(n,i);break;default:a.tmp.editingMenu=!0}})}},name:"other zoom:",type:"text"},d["sep"+l++]="------",d.zoomiotitle={name:"Zoom In/Out:",disabled:!0},d.zoomIn=s("zoom in"),d.zoomOut=s("zoom out"),d.zoomToFit=s("zoom to fit"),d["sep"+l++]="------",d.panzoomtitle={name:"Pand and Zoom:",disabled:!0},d.center=s("pan to center"),d.alignpanzoom={name:"align pan/zoom ...",items:{alignpanzoomtitle:{name:"to this image:",disabled:!0}}},t=0,o=0;t<JS9.images.length;t++)if(JS9.images[t].raw.wcs){if(h===JS9.images[t]&&e.id.search(JS9.SUPERMENU)<0)continue;d.alignpanzoom.items["alignpanzoom_"+JS9.images[t].id]={name:JS9.images[t].id},o++}return 0===o?d.alignpanzoom.items.notasks={name:"[none]",disabled:!0,events:{keyup:function(){}}}:d.alignpanzoom.disabled=!1,d.reset=s("reset pan/zoom"),{callback:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i=e.image;if(!($.inArray(e,JS9.displays)<0)&&i)switch(t){case"zoomIn":i.setZoom("x2");break;case"zoomOut":i.setZoom("/2");break;case"zoomToFit":i.setZoom("tofit");break;case"center":i.setPan();break;case"reset":i.setZoom("1"),i.setPan();break;default:t.match(/^zoom/)?i.setZoom(t.slice(4)):t.match(/^alignpanzoom_/)&&i.alignPanZoom(t.slice(13))}})},events:{show:function(t){var i=e.display.image,s={};i&&(s.zoom=String(i.rgb.sect.zoom)),$.contextMenu.setInputValues(t,s),JS9.jupyterFocus(".context-menu-item")},hide:function(t){var i,s=e.display,a=s.image;a&&s.tmp.editingMenu&&(i=$.contextMenu.getInputValues(t),u(a,i))}},items:d}}}),$("#scaleMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#scaleMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#scaleMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,a,n,r,o="",l=0,c={},h=JS9.Menubar.getDisplays.call(e)[0],u=function(e,t){var i=e.params.scalemin,s=e.params.scalemax;delete h.tmp.editingMenu,JS9.isNumber(t.scalemin)&&(i=parseFloat(t.scalemin)),JS9.isNumber(t.scalemax)&&(s=parseFloat(t.scalemax)),e.setScale(i,s),e.displayImage("colors")},d=function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i=$.contextMenu.getInputValues(t.data),s=t.which||t.keyCode,a=e,n=a.image;if(!($.inArray(a,JS9.displays)<0))switch(s){case 9:case 13:n&&u(n,i);break;default:a.tmp.editingMenu=!0}})};for(c.scaletitle={name:"Scaling Algorithms:",disabled:!0},t=0;t<JS9.scales.length;t++)c[i=JS9.scales[t]]=s(i),h.image&&h.image.params.scale===i&&(c[i].icon="sun");for(c["sep"+l++]="------",c.scalelims={name:"Data Limits:",disabled:!0},c.scalemin={events:{keyup:d},name:"low:",type:"text"},c.scalemax={events:{keyup:d},name:"high:",type:"text"},c["sep"+l++]="------",t=0;t<JS9.plugins.length;t++)n=(a=JS9.plugins[t]).name,a.opts.menuItem&&"scale"===a.opts.menu&&((r=h.pluginInstances[n])&&!r.winHandle||(a.xclass!==o&&(l+=1),o=a.xclass,c[n]=s(a.opts.menuItem),r&&"active"===r.status&&(c[n].icon="sun")));return{callback:function(t){var i,s;JS9.Menubar.getDisplays.call(e).forEach(function(e){var a=e,n=a.image;if(!($.inArray(a,JS9.displays)<0)&&n){for(i=0;i<JS9.plugins.length;i++)if((s=JS9.plugins[i]).name===t)return void a.displayPlugin(s);n.setScale(t)}})},events:{show:function(t){var i=e.display.image,s={};i&&(s.scalemin=JS9.floatToString(i.params.scalemin),s.scalemax=JS9.floatToString(i.params.scalemax)),$.contextMenu.setInputValues(t,s),JS9.jupyterFocus(".context-menu-item")},hide:function(t){var i,s=e.display,a=s.image;a&&s.tmp.editingMenu&&(i=$.contextMenu.getInputValues(t),u(a,i))}},items:c}}}),$("#colorMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#colorMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#colorMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,a,n=0,r={},o=JS9.Menubar.getDisplays.call(e)[0],l=function(e,t){delete o.tmp.editingMenu,t.contrast&&!isNaN(t.contrast)&&(e.params.contrast=parseFloat(t.contrast)),t.bias&&!isNaN(t.bias)&&(e.params.bias=parseFloat(t.bias)),isNaN(t.opacity)||(e.params.opacity=""!==t.opacity?parseFloat(t.opacity):1),e.displayImage("colors")},c=function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i=$.contextMenu.getInputValues(t.data),s=t.which||t.keyCode,a=e,n=a.image;if(!($.inArray(a,JS9.displays)<0))switch(s){case 9:case 13:l(n,i);break;default:a.tmp.editingMenu=!0}})};for(r.cmaptitle={name:"Colormaps:",disabled:!0},t=0;t<JS9.globalOpts.topColormaps.length;t++)r[i=JS9.globalOpts.topColormaps[t]]=s(i),o.image&&o.image.cmapObj.name===i&&(r[i].icon="sun");for(r.morecmaps={name:"more colormaps ...",items:{morecmapstitle:{name:"Colormaps:",disabled:!0}}},t=0;t<JS9.colormaps.length;t++)-1===JS9.globalOpts.topColormaps.indexOf(i=JS9.colormaps[t].name)&&(r.morecmaps.items[i]=s(i),o.image&&o.image.cmapObj.name===i&&(r.morecmaps.items[i].icon="sun"));for(r["sep"+n++]="------",r.imfilter={name:"image filters",items:{imfiltertitle:{name:"adjust colors using:",disabled:!0}}},a=JS9.Image.prototype.filterRGBImage.call(null).sort(),t=0;t<a.length;t++)"convolve"!==a[t]&&(r.imfilter.items[i="imfilter_"+a[t]]={name:a[t]});return r["sep"+n++]="------",r.contrast={events:{keyup:c},name:"contrast:",type:"text"},r.bias={events:{keyup:c},name:"bias:",type:"text"},r.opacity={events:{keyup:c},name:"opacity:",type:"text"},r.reset=s("reset contrast/bias"),r["sep"+n++]="------",r.loadcmap=s("load ..."),r.savecmap=s("save"),r["sep"+n++]="------",r.invert=s("invert"),o.image&&o.image.params.invert&&(r.invert.icon="sun"),r.rgb=s("rgb mode"),JS9.globalOpts.rgb.active&&(r.rgb.icon="sun"),{callback:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var s=e,a=s.image;if(!($.inArray(s,JS9.displays)<0))switch(t){case"loadcmap":JS9.OpenColormapMenu({display:s});break;case"savecmap":JS9.SaveColormap({display:s});break;default:if(a){if(t.match(/^imfilter_/))return i=t.replace(/^imfilter_/,""),void a.filterRGBImage(i);a.setColormap(t)}}})},events:{show:function(t){var i=e.display.image,s={};i&&(s.contrast=String(i.params.contrast),s.bias=String(i.params.bias),s.opacity=String(i.params.opacity),s.sigma=String(i.params.sigma)),$.contextMenu.setInputValues(t,s),JS9.jupyterFocus(".context-menu-item")},hide:function(t){var i,s=e.display,a=s.image;a&&s.tmp.editingMenu&&(i=$.contextMenu.getInputValues(t),l(a,i))}},items:r}}}),$("#regionMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#regionMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#regionMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i=JS9.Menubar.getDisplays.call(e)[0].image,a={},n=function(e,t){switch(e){case"color":if("#"!==t.charAt(0)&&JS9.colorToHex(t)===t)return null;break;case"strokeWidth":if(!JS9.isNumber(t))return null;t=parseFloat(t);break;case"strokeDashArray":if(!(t=t.split(/[\s,]+/))||!t.length)return null;if(t.length<2&&(t[1]="0"),!JS9.isNumber(t[0])||!JS9.isNumber(t[1]))return null;t[0]=parseFloat(t[0]),t[1]=parseFloat(t[1])}return t},r=function(e,t,i){var s,a,r={};if(i)s=i.substring(3),a=t[i],s&&a&&e.tmp["editingReg"+i]&&(delete e.tmp["editingReg"+i],(a=n(s,a))&&(r[s]=a,e.changeShapes("regions","selected",r)));else{for(i in t)t.hasOwnProperty(i)&&(s=i.substring(3),a=t[i],s&&a&&e.tmp["editingReg"+i]&&(delete e.tmp["editingReg"+i],(a=n(s,a))&&(r[s]=a)));Object.keys(r).length&&e.changeShapes("regions","selected",r)}},o=function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i,s=$.contextMenu.getInputValues(t.data),a=t.which||t.keyCode,n=e.image;if(!($.inArray(e,JS9.displays)<0))switch(t&&t.target&&t.target.name&&(i=t.target.name.split("-").reverse()[0]),a){case 9:case 13:n&&i&&r(n,s,i);break;default:n&&i&&(n.tmp["editingReg"+i]=!0)}})};if(a.regiontitle={name:"Regions:",disabled:!0},a.annulus=s("annulus"),a.box=s("box"),a.circle=s("circle"),a.ellipse=s("ellipse"),a.line=s("line"),a.point=s("point"),a.polygon=s("polygon"),a.text=s("text"),a.sep1="------",a.loadRegions=s("load"),a.listRegions=s("list"),fabric.major_version>1&&(a.selectRegions=s("select")),a.saveas={name:"save ...",items:{saveastitle:{name:"choose output format:",disabled:!0},saveas_reg:s("regions"),saveas_svg:s("SVG")}},a.copyto={name:"copy to ...",items:{copytotitle:{name:"choose image:",disabled:!0}}},a.removeRegions=s("remove"),a.sep2="------",a.selectops={name:"selected regions ...",items:{selopstitle:{name:"actions on selected:",disabled:!0},configSelReg:s("edit"),listSelReg:s("list"),backSelReg:s("to back"),saveSelReg:s("save"),copySelReg:{name:"copy to ...",items:{copyseltotitle:{name:"choose image:",disabled:!0}}},removeSelReg:s("remove"),regcolor:{events:{keyup:o},name:"color:",type:"text"},regstrokeWidth:{events:{keyup:o},name:"width:",type:"text"},regstrokeDashArray:{events:{keyup:o},name:"dash:",type:"text"},regtags:{events:{keyup:o},name:"tag:",type:"text"},sbSelReg:s("toggle: src/bkgd"),ieSelReg:s("toggle: incl/excl")}},a.sep3="------",a.onchange={name:"onchange ...",items:{listonchange:s("list on change"),xeqonchange:s("xeq on change")}},i&&i.params.listonchange&&(a.onchange.items.listonchange.icon="sun"),i&&i.params.xeqonchange&&(a.onchange.items.xeqonchange.icon="sun"),i&&JS9.images.length>1){for(t=0;t<JS9.images.length;t++)i!==JS9.images[t]&&(a.copyto.items["copyto_"+JS9.images[t].id]=s(JS9.images[t].id),a.selectops.items.copySelReg.items["copyselto_"+JS9.images[t].id]=s(JS9.images[t].id));a.copyto.items.copyto_all=s("all images"),a.copyto.disabled=!1,a.selectops.items.copySelReg.disabled=!1}else a.copyto.disabled=!0,a.selectops.items.copySelReg.disabled=!0;return JS9.hasOwnProperty("Info")||(a.listRegions.disabled=!0),{callback:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i,s,a,n=e,r=n.image;if(!($.inArray(n,JS9.displays)<0)&&r)switch(t){case"loadRegions":JS9.OpenRegionsMenu({display:n});break;case"listRegions":r.listRegions("all",{mode:2});break;case"selectRegions":JS9.hasOwnProperty("Keyboard")&&JS9.Keyboard.Actions["select all regions"](r,r.ipos);break;case"removeRegions":r.removeShapes("regions","all"),n.clearMessage("regions");break;case"srcSelReg":r.editRegionTags("selected","source","background");break;case"bkgSelReg":r.editRegionTags("selected","background","source");break;case"incSelReg":r.editRegionTags("selected","include","exclude");break;case"exclSelReg":r.editRegionTags("selected","exclude","include");break;case"sbSelReg":r.toggleRegionTags("selected","source","background");break;case"ieSelReg":r.toggleRegionTags("selected","exclude","include");break;case"configSelReg":(s=r.layers.regions)&&(a=s.canvas.getActiveObject(),JS9.Regions.displayConfigForm.call(r,a));break;case"saveSelReg":r.saveRegions("js9.reg","selected");break;case"listSelReg":r.listRegions("selected",{mode:2});break;case"backSelReg":JS9.hasOwnProperty("Keyboard")&&JS9.Keyboard.Actions["send selected region to back"](r,r.ipos);break;case"removeSelReg":r.removeShapes("regions","selected"),n.clearMessage("regions");break;case"xeqonchange":r.params.xeqonchange=!r.params.xeqonchange;break;case"listonchange":r.params.listonchange=!r.params.listonchange;break;default:if(t.match(/^saveas_/))return i=t.replace(/^saveas_/,""),void r.saveRegions("js9."+i,"all",{type:i});if(t.match(/^copyto_/))return i=t.replace(/^copyto_/,""),void r.copyRegions(i);if(t.match(/^copyselto_/))return i=t.replace(/^copyselto_/,""),void r.copyRegions(i,"selected");r.addShapes("regions",t,{ireg:!0})}})},events:{show:function(e){$.contextMenu.setInputValues(e,{color:""}),JS9.jupyterFocus(".context-menu-item")},hide:function(t){var i,s=e.display.image;s&&(i=$.contextMenu.getInputValues(t),r(s,i))}},items:a}}}),$("#wcsMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#wcsMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#wcsMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,a,n,r=0,o=0,l=0,c={},h=JS9.Menubar.getDisplays.call(e)[0],u=h.image,d=function(e,t){delete h.tmp.editingMenu,JS9.isNumber(t.rot)&&e.rotateData(parseFloat(t.rot))};for(c.wcssystitle={name:"WCS Systems:",disabled:!0},t=0;t<JS9.wcssyss.length;t++)c[i=JS9.wcssyss[t]]=s(i),u&&u.params.wcssys===i&&(c[i].icon="sun",l++);for(l||(c[i="native"].icon="sun"),c["sep"+r++]="------",c.wcsutitle={name:"WCS Units:",disabled:!0},t=0;t<JS9.wcsunitss.length;t++)c[i=JS9.wcsunitss[t]]=s(i),u&&u.params.wcsunits===i&&(c[i].icon="sun");if(c["sep"+r++]="------",c.altwcs={name:"alternate wcs",items:{altwcstitle:{name:"choose a wcs:",disabled:!0}}},u&&u.raw&&u.raw.altwcs){for(a in n=u.raw.altwcs)n.hasOwnProperty(a)&&(c.altwcs.items[i="altwcs_"+a]=s(n[a].header.WCSNAME?n[a].header.WCSNAME+"    ("+a+")":a),u.raw.wcs===n[a].wcs&&(c.altwcs.items[i].icon="sun"),o++);o<2&&(c.altwcs.disabled=!0,c.altwcs.items.notasks={name:"[none]",disabled:!0,events:{keyup:function(){}}})}else c.altwcs.disabled=!0;for(c["sep"+r++]="------",c.reproject={name:"wcs reproject ...",items:{reprojtitle:{name:"using the wcs from:",disabled:!0}}},t=0,o=0;t<JS9.images.length;t++)if(JS9.images[t].raw.wcs){if(u===JS9.images[t]&&e.id.search(JS9.SUPERMENU)<0)continue;c.reproject.items[i="reproject_"+JS9.images[t].id]={name:JS9.images[t].id},o++}return 0===o?c.reproject.items.notasks={name:"[none]",disabled:!0,events:{keyup:function(){}}}:(c.reproject.disabled=!1,c.reproject.items["sep"+r++]="------",c.reproject.items.reproject_wcsalign={name:"display wcs-aligned"},u&&u.params.wcsalign&&(c.reproject.items.reproject_wcsalign.icon="sun")),c.reproject.items["sep"+r++]="------",c.reproject.items.rotatetitle={name:"by rotating the image:",disabled:!0},c.reproject.items.reproject_northup={name:"so that north is up"},c.reproject.items.rot={events:{keyup:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i=$.contextMenu.getInputValues(t.data),s=t.which||t.keyCode,a=e,n=a.image;if(!($.inArray(a,JS9.displays)<0))switch(s){case 9:case 13:n&&d(n,i);break;default:a.tmp.editingMenu=!0}})}},name:"by this angle in deg:",type:"text"},u&&u.raw&&u.raw.header&&u.raw.wcsinfo||(c.reproject.disabled=!0),c.reproject.items["sep"+r++]="------",c.reproject.items.reproject_revert={name:"revert"},{callback:function(i){JS9.Menubar.getDisplays.call(e).forEach(function(e){var s,a,n=new RegExp(i),r=e.image;if(!($.inArray(e,JS9.displays)<0)&&r){if(i.match(/^altwcs_/))return a=i.replace(/^altwcs_/,""),void r.setWCS(a);if(i.match(/^reproject_/)){if("reproject_wcsalign"===i)r.params.wcsalign=!r.params.wcsalign,r.displayImage("display");else if("reproject_northup"===i)r.rotateData("northisup");else if("reproject_revert"===i){if(r.raw.id!==JS9.RAWID0)for(t=0;t<r.raws.length;t++)r.raw===r.raws[t]&&r.rawDataLayer(r.raw.id,"remove")}else s=i.replace(/^reproject_/,""),r.reprojectData(s);return}JS9.wcssyss.join("@").search(n)>=0?(r.setWCSSys(i),r.updateShapes("regions","all","wcs")):JS9.wcsunitss.join("@").search(n)>=0?(r.setWCSUnits(i),r.updateShapes("regions","all","wcs")):JS9.error("unknown wcs sys/units: "+i)}})},events:{show:function(t){var i={};e.display.image&&(i.rot="",$.contextMenu.setInputValues(t,i),JS9.jupyterFocus(".context-menu-item"))},hide:function(t){var i,s=e.display,a=s.image;a&&(i=$.contextMenu.getInputValues(t),s.tmp.editingMenu&&d(a,i))}},items:c}}}),$("#analysisMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#analysisMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#analysisMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var t,i,a,n,r,o,l,c,h,u=/fitsHeader\(([A-Za-z0-9_]+),(.*)\)/,d=/winVar\((.*),(.*)\)/,p=/js9Var\((.*),(.*)\)/,f=/imVar\((.*),(.*)\)/,g=0,m=0,v={},b=JS9.Menubar.getDisplays.call(e)[0],y=b.image,x="",w=function(e,t){return!(!e||!t)&&String(e).toUpperCase()===String(t).toUpperCase()},S=function(e,t){delete b.tmp.editingMenu,t.sigma=t.sigma||"0","none"===t.sigma&&(t.sigma="0");try{e.params.sigma=parseFloat(t.sigma)}catch(i){e.params.sigma=0}e.gaussBlurData(e.params.sigma)};for(t=0;t<JS9.plugins.length;t++)c=(o=JS9.plugins[t]).name,o.opts.menuItem&&"analysis"===o.opts.menu&&((l=b.pluginInstances[c])&&!l.winHandle||(o.xclass!==x&&(m>0&&(v["sep"+m++]="------"),v["sep"+m++]={name:o.xclass+" Plugins:"},v["sep"+(m-1)].disabled=!0),x=o.xclass,v[c]={name:o.opts.menuItem},l&&"active"===l.status&&(v[c].icon="sun"),m++));if(!JS9.allinone){if(m>0&&(v["sep"+m++]="------"),v.localtitle={name:"Client-side Analysis:",disabled:!0},v.grid=s("Coordinate Grid"),!y||!y.raw.wcs||y.raw.wcs<=0?v.grid.disabled=!0:y.displayCoordGrid()&&(v.grid.icon="sun"),v.regcnts=s("Counts in Regions"),v.radprof=s("Radial Profile"),v.cnts3d=s("3D Counts in Regions"),v.plot3d=s("3D Plot using Regions"),y&&y.raw&&y.raw.hdu&&y.raw.hdu.vfile?3!==y.raw.header.NAXIS&&(v.cnts3d.disabled=!0,v.plot3d.disabled=!0):(v.regcnts.disabled=!0,v.radprof.disabled=!0,v.cnts3d.disabled=!0,v.plot3d.disabled=!0),v.sigma={events:{keyup:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i=$.contextMenu.getInputValues(t.data),s=t.which||t.keyCode,a=e,n=a.image;if(!($.inArray(a,JS9.displays)<0))switch(s){case 9:case 13:S(n,i);break;default:a.tmp.editingMenu=!0}})}},name:"Blur, equivalent sigma:",type:"text"},v["sep"+m++]="------",v.remotetitle={name:"Server-side Analysis:",disabled:!0},y&&y.analysisPackages)for(n=y.analysisPackages,i=0;i<n.length;i++)for(r=n[i],t=0;t<r.length;t++)if(r[t].title&&r[t].name&&!r[t].hidden){if(r[t].files){if(r[t].files.match(/^fits$/)&&!y.fitsFile)continue;if(r[t].files.match(/^png$/)&&"fits2png"!==y.source)continue;if(r[t].files.match(/^table$/)&&"table"!==y.imtab)continue;if(r[t].files.match(/^image$/)&&"image"!==y.imtab)continue;if((h=r[t].files.match(u))&&!w(a=y.raw.header[h[1].toUpperCase()],h[2]))continue;if((h=r[t].files.match(d))&&!w(a=JS9.varByName(h[1],window),h[2]))continue;if((h=r[t].files.match(p))&&!w(a=JS9.varByName(h[1],JS9),h[2]))continue;if((h=r[t].files.match(f))&&!w(a=JS9.varByName(h[1],y),h[2]))continue}r[t].rtype&&r[t].rtype.match(/^---/)?(v["sep"+m++]="------",v[r[t].name]={name:r[t].title+":",disabled:!0}):(a=r[t].title,r[t].purl&&(a+=" ..."),v[r[t].name]={name:a},g++)}g||(v.notasks={name:"[none]",disabled:!0,events:{keyup:function(){}}},JS9.globalOpts.loadProxy&&y&&y.raw&&y.raw.hdu&&y.raw.hdu.vfile&&(v.upload={name:"upload FITS to make tasks available"},(!JS9.helper.connected||"nodejs"!==JS9.helper.type&&"socket.io"!==JS9.helper.type)&&(v.upload.disabled=!0))),v["sep"+m++]="------",v.sconfig={name:"server-side params ...",items:{}},v.sconfig.items.dpath=s("set data analysis path ..."),!1===JS9.globalOpts.dataPathModify&&(v.sconfig.items.dpath.disabled=!0),v.sconfig.items.fpath=s("set this image file's path ..."),(!y||document.domain&&"localhost"!==document.domain)&&(v.sconfig.items.fpath.disabled=!0)}return{callback:function(t){JS9.Menubar.getDisplays.call(e).forEach(function(e){var i,s,a,n,r=e,o=r.image;if(!($.inArray(r,JS9.displays)<0)){for(a=0;a<JS9.plugins.length;a++)if((n=JS9.plugins[a]).name===t)return void r.displayPlugin(n);if(o)switch(t){case"regcnts":JS9.CountsInRegions("$sregions","$bregions",{lightwin:!0},{display:r.id});break;case"radprof":JS9.RadialProfile("$sregions","$bregions",{display:r.id});break;case"cnts3d":JS9.CountsInRegions("$sregions","$bregions",{lightwin:!0,cmdswitches:"-c "+JS9.globalOpts.plot3d.cube},{display:r.id});break;case"plot3d":JS9.Plot3D("$sregions","$bregions",null,{display:r.id});break;case"dpath":$("#dhtmlwindowholder").arrive("#dataPathForm",{onceOnly:!0},function(){$("#dataPath").val(JS9.globalOpts.dataPath)}),s=o.displayAnalysis("textline",JS9.InstallDir(JS9.analOpts.dpathURL),{title:"Data path for analysis"}),$(s).data("dispid",r.id),$(s).data("imid",o.id);break;case"fpath":$("#dhtmlwindowholder").arrive("#filePathForm",{onceOnly:!0},function(){$("#filePath").val(o.file)}),s=o.displayAnalysis("textline",JS9.InstallDir(JS9.analOpts.fpathURL),{title:"File path for this image"}),$(s).data("dispid",r.id),$(s).data("imid",o.id);break;case"grid":o.displayCoordGrid(!o.displayCoordGrid());break;case"upload":o.uploadFITSFile();break;default:return void((i=o.lookupAnalysis(t))&&(i.purl?(s=o.displayAnalysis("params",JS9.InstallDir(i.purl),{title:i.title+": "+o.fitsFile,winformat:i.pwin}),$(s).data("dispid",r.id).data("aname",i.name)):o.runAnalysis(i.name)))}}})},events:{show:function(t){var i=e.display.image,s={};i&&(s.sigma=String(i.params.sigma)),$.contextMenu.setInputValues(t,s),JS9.jupyterFocus(".context-menu-item")},hide:function(t){var i,s=e.display,a=s.image;a&&s.tmp.editingMenu&&(i=$.contextMenu.getInputValues(t),S(a,i))}},items:v}}}),$("#helpMenu"+e.id).on("mousedown",function(t){t.preventDefault(),$("#helpMenu"+e.id).contextMenu()}),$.contextMenu({selector:"#helpMenu"+e.id,zIndex:JS9.MENUZINDEX,events:{hide:i},position:t,build:function(){var e,t,i,a=1,n="",r={js9help:{name:"General help ...",items:{helptitle:{name:"General help:",disabled:!0}}}};for(t in JS9.helpOpts)JS9.helpOpts.hasOwnProperty(t)&&"JS9Help"===(i=JS9.helpOpts[t]).heading&&(n=i.type,r.js9help.items[t]={name:i.title});for(t in r["sep"+a++]="------",r.pluginhelp={name:"JS9 plugins ...",items:{helptitle:{name:"JS9 plugins:",disabled:!0}}},JS9.helpOpts)JS9.helpOpts.hasOwnProperty(t)&&"JS9"===(i=JS9.helpOpts[t]).heading&&(n=i.type,r.pluginhelp.items[t]={name:i.title.replace(/ \.\.\./,"")});for(t in JS9.helpOpts)if(JS9.helpOpts.hasOwnProperty(t)){if("JS9Help"===(i=JS9.helpOpts[t]).heading||"JS9"===i.heading)continue;""!==n&&i.type!==n&&(r["sep"+a++]="------",i.heading&&(r["sep"+a++]={name:(e=i.heading+" plugins")+" ...",items:{title:{name:e+":",disabled:!0}}})),n=i.type,r["sep"+(a-1)].items[t]={name:i.title}}return r["sep"+a++]="------",r.about=s("about JS9"),{callback:function(e){switch(e){case"about":alert(sprintf("JS9: astronomical image display everywhere\nversion: %s\nEric Mandel, Alexey Vikhlinin\ncontact: eric@cfa.harvard.edu\n%s",JS9.VERSION,JS9.COPYRIGHT));break;default:JS9.DisplayHelp(e)}},items:r}}}),function(){var t,i;if(JS9.globalOpts.userMenuBar)for(t=0;t<JS9.globalOpts.userMenuBar.length;t++)(i=JS9.globalOpts.userMenuBar[t])&&i.name&&i.title&&($("#"+i.name+"UserMenu"+e.id).on("mousedown",i,a),n(i))}()},JS9.Menubar.init=function(e,t){var i,s,a,n,r,o;for(this.issuper=this.id.search(JS9.SUPERMENU)>=0,this.issuper&&JS9.supermenus.push(this),this.style=this.divjq.attr("data-style")||JS9.globalOpts.menubarStyle||"classic",this.style=this.style.toLowerCase(),this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Menubar.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.buttonClass=this.divjq.attr("data-buttonClass")||"JS9Button",this.containerClass="JS9MenubarContainer",this.buttonClass.match(/-flat/)?this.containerClass+="-flat":this.buttonClass.match(/-border/)&&(this.containerClass+="-border"),this.backgroundColor=this.divjq.attr("data-backgroundColor"),this.height||(this.height=t||JS9.MENUHEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.usermenus="true"===this.divjq.attr("data-usermenus")||JS9.globalOpts.userMenus,o="<span id='JS9Menus_@@ID@@'>",s=0;s<JS9.globalOpts.menuBar.length;s++)for(r=JS9.globalOpts.menuBar[s],i=0;i<JS9.Menubar.buttonOptsArr.length;i++)if(r===(a=JS9.Menubar.buttonOptsArr[i].name)){if(n=JS9.Menubar.buttonOptsArr[i].label,JS9.allinone&&"help"===a)break;if("#"===a[0])"classic"===this.syle&&"#"!==(a=a.slice(1))[1]&&(o+="<button type='button' id='"+a+"Menu@@ID@@' class='"+this.buttonClass+"' disabled='disabled'>"+n+" </button>");else if("classic"===this.style)o+="<button type='button' id='"+a+"Menu@@ID@@' class='"+this.buttonClass+"'>"+n+"</button>";else switch(a){case"file":case"edit":o+="<button type='button' id='"+a+"Menu@@ID@@' class='"+this.buttonClass+"'>"+n+"</button>";break;case"help":o+="<span style='float:right'><button type='button' id='"+a+"Menu@@ID@@' class='"+this.buttonClass+"'>"+n+"</button></span>";break;default:this.macmenus||(o+="<span style='position:relative;'><button type='button' id='viewMacMenu@@ID@@' class='"+this.buttonClass+"'>View</button>",this.macmenus=[]),"View"===n&&(n="Plugins"),o+="<button type='button' id='"+a+"Menu@@ID@@' class='"+this.buttonClass+"' style='position:absolute;top:0px;left:0px;visibility:hidden;zindex:-1'></button>",this.macmenus.push({name:a,title:n})}break}if(this.macmenus&&(o+="</span>"),this.usermenus&&JS9.globalOpts.userMenuBar)for(o+=JS9.globalOpts.userMenuDivider||"",s=0;s<JS9.globalOpts.userMenuBar.length;s++)(r=JS9.globalOpts.userMenuBar[s])&&r.name&&r.title&&r.options&&(o+="<button type='button' id='"+r.name+"UserMenu@@ID@@' class='"+this.buttonClass+"'>"+(r.imageTitle?"<div class='JS9MenubarUserImage'><img src='"+r.imageTitle+"' alt='"+r.title+"' class='JS9MenubarUserImage' ></div>":r.title)+"</button>");o+="<button type='button' id='hiddenRegionMenu@@ID@@'class='JS9Button' style='display:none'>R</button>",o+="<button type='button' id='hiddenAnchorMenu@@ID@@'class='JS9Button' style='display:none'>R</button>",o+="</span>",this.display.menubar=this,this.html=o.replace(/@@ID@@/g,this.id),this.menuConjq=$("<div>").addClass(this.containerClass).attr("width",this.width).attr("height",this.height).html(this.html).appendTo(this.divjq),this.backgroundColor&&this.menuConjq.css("background",this.backgroundColor),JS9.Menubar.createMenus.call(this)},JS9.RegisterPlugin("JS9","Menubar",JS9.Menubar.init,{onupdateprefs:JS9.Menubar.reset,dynamicSelect:!0,winDims:[JS9.Menubar.WIDTH,JS9.Menubar.HEIGHT]}),JS9.Panner={},JS9.Panner.CLASS="JS9",JS9.Panner.NAME="Panner",JS9.Panner.WIDTH=320,JS9.Panner.HEIGHT=320,JS9.Panner.SWIDTH=250,JS9.Panner.SHEIGHT=250,JS9.Panner.VSIZE=30,JS9.Panner.NORTH={color:"#00FF00",text:"N",fontSize:12,strokeWidth:1,strokeDashArray:[2,1]},JS9.Panner.EAST={color:"#FFFF00",text:"E",fontSize:12,strokeWidth:1,strokeDashArray:[2,1]},JS9.Panner.opts={hasControls:!1,hasRotatingPoint:!1,hasBorders:!1,zoom:4,canvas:{selection:!0},tagcolors:{defcolor:"#00FF00"}},JS9.Panner.bcall=function(e,t,i){var s,a,n;switch((s=$(e).closest("div[class^=JS9PluginToolbar]").data("displayid"))?a=(n=JS9.getImage(JS9.getDynamicDisplayOr(s))).display.pluginInstances.JS9Panner:JS9.error("can't find display for cmd: "+t),n||JS9.error("can't find image for cmd: "+t),t){case"zoomPanner":arguments.length<3&&JS9.error("missing argument(s) for cmd: "+t);try{JS9.Panner.zoom.call(a,n,i)}catch(r){JS9.error("error calling zoomPanner()",r)}break;case"panImage":try{n.setPan()}catch(r){JS9.error("error calling setPan()",r)}}},JS9.Panner.HTML="<span><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"zoomPanner\", \"x2\"); return false'>x2</button><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"zoomPanner\", \"/2\"); return false'>/2</button><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"zoomPanner\", \"1\"); return false'>z1</button><button type='button' class='JS9Button' onClick='JS9.Panner.bcall(this, \"panImage\"); return false'>center</button></span>",JS9.Panner.init=function(e,t){this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Panner.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Panner.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.canvas=document.createElement("canvas"),this.canvasjq=$(this.canvas),this.canvasjq.addClass("JS9Panner"),this.canvasjq.css("z-index",JS9.ZINDEX),this.canvasjq.attr("width",this.width),this.canvasjq.attr("height",this.height),this.context=this.canvas.getContext("2d"),JS9.ANTIALIAS||(this.context.imageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.msImageSmoothingEnabled=!1),this.containerjq=$("<div>").addClass("JS9Container").append(this.canvasjq).appendTo(this.divjq),this.display.image&&JS9.Panner.disp.call(this,this.display.image)},JS9.Panner.create=function(e){var t,i,s,a,n,r,o,l,c,h,u,d,p,f,g,m,v,b,y,x,w,S=this;if(e&&e.raw&&e.display.pluginInstances.JS9Panner){if(e.panner||(e.panner={}),e.panner.zoom||(e.panner.zoom=1),t=e.display.pluginInstances.JS9Panner,i=e.panner,s=e.rgb.sect,m=Math.min(e.raw.width,t.width),v=Math.min(e.raw.height,t.height),i.xblock=e.raw.width/m,i.yblock=e.raw.height/v,i.xblock>i.yblock?(v=Math.floor(v/i.xblock*i.yblock+.5),i.yblock=i.xblock):i.yblock>i.xblock&&(m=Math.floor(m/i.yblock*i.xblock+.5),i.xblock=i.yblock),a=e.display.context.createImageData(m,v),1===i.zoom?(o=i.xblock,l=i.yblock,n=0,r=0):(o=i.xblock/i.zoom,l=i.yblock/i.zoom,n=Math.max(0,(s.x0+s.x1-m*o)/2),r=Math.max(0,(s.y0+s.y1-v*l)/2)),i.x0=n,i.y0=r,i.img=a,i.ix=0,i.iy=0,e.rgbFile){for(h=0;h<v;h++)for(d=Math.floor(r+h*l)*e.offscreen.img.width,p=h*m,c=0;c<m;c++)u=Math.floor(n+c*o),a.data[g=4*(p+c)]=e.offscreen.img.data[f=4*(u+d)],a.data[g+1]=e.offscreen.img.data[f+1],a.data[g+2]=e.offscreen.img.data[f+2],a.data[g+3]=255;return e}for(h=0;h<v;h++)for(d=Math.floor(r+(v-h-1)*l)*e.raw.width,p=h*m,c=0;c<m;c++)u=Math.floor(n+c*o),g=4*(p+c),e.psColors[f=e.colorData[u+d]]&&(a.data[g]=e.psColors[f][0],a.data[g+1]=e.psColors[f][1],a.data[g+2]=e.psColors[f][2],a.data[g+3]=255);return this.display.layers.panner?(this.display.image&&this.isDynamic&&(this.display.layers.panner&&!e.display.layers.panner&&(e.display.layers.panner=this.display.layers.panner),this.display.image.layers.panner&&!e.layers.panner&&(e.layers.panner=this.display.image.layers.panner)),e):((w=this.display.newShapeLayer("panner",JS9.Panner.opts,this.divjq)).canvas.on("object:modified",function(e){var t,i;if(t=(i=JS9.getDynamicDisplayOr(S.display))&&i.image?i.image:S.display.image){b=e.target.getCenterPoint(),y=(b.x-t.panner.ix)*t.panner.xblock/t.panner.zoom+t.panner.x0,x=(w.canvas.height-(b.y+t.panner.iy))*t.panner.yblock/t.panner.zoom+t.panner.y0;try{t.display.pluginInstances.JS9Panner.status="inactive",t.setPan(y,x)}catch(s){JS9.log("couldn't pan image",s)}finally{t.display.pluginInstances.JS9Panner.status="active"}}}),e)}},JS9.Panner.disp=function(e){var t,i,s,a,n,r,o,l,c,h,u,d,p,f,g,m;if(e&&e.display.pluginInstances.JS9Panner&&"active"===e.display.pluginInstances.JS9Panner.status&&(JS9.Panner.create.call(this,e),s=e.rgb.sect,u=(t=e.display.pluginInstances.JS9Panner).width/2,d=t.height/2,(i=e.panner).img))return i.img.width<t.canvas.width&&(i.ix=Math.floor((t.canvas.width-i.img.width)/2)),i.img.height<t.canvas.height&&(i.iy=Math.floor((t.canvas.height-i.img.height)/2)),JS9.Panner.clear.call(this,e),t.context.putImageData(i.img,i.ix,i.iy),o=(s.x0-i.x0)*(a=i.zoom/i.xblock)+i.ix,l=t.height-1-((s.y1-i.y0)*(n=i.zoom/i.yblock)+i.iy),o+=1,l+=1,o+=(c=s.width*a/s.zoom)/2,l+=(h=s.height*n/s.zoom)/2,r={left:o=Math.floor(o),top:l=Math.floor(l),width:c=Math.floor(c),height:h=Math.floor(h)},e.panner.boxid?e.changeShapes("panner",e.panner.boxid,r):e.panner.boxid=e.addShapes("panner","box",r),e.panner.northid&&(e.removeShapes("panner",e.panner.northid),e.removeShapes("panner",e.panner.northidt)),e.panner.eastid&&(e.removeShapes("panner",e.panner.eastid),e.removeShapes("panner",e.panner.eastidt)),!JS9.globalOpts.pannerDirections||!e.raw.wcs||e.raw.wcs<=0?e:(p={x:u,y:d},f=e.raw.wcsinfo&&e.raw.wcsinfo.cdelt2&&e.raw.wcsinfo.cdelt2>=0?{x:u,y:d-JS9.Panner.VSIZE}:{x:u,y:d+JS9.Panner.VSIZE},e.raw.wcsinfo&&e.raw.wcsinfo.crot&&(f=JS9.rotatePoint(f,-e.raw.wcsinfo.crot,p)),e.panner.northid=e.addShapes("panner","line",{color:JS9.Panner.NORTH.color,strokeWidth:JS9.Panner.NORTH.strokeWidth,strokeDashArray:JS9.Panner.NORTH.strokeDashArray,points:[p,f],changeable:!1,originX:"left",originY:"top",noLeftTop:!0}),e.panner.northidt=e.addShapes("panner","text",{color:JS9.Panner.NORTH.color,text:JS9.Panner.NORTH.text,fontSize:JS9.Panner.NORTH.fontSize,changeable:!1,left:f.x,top:f.y}),g={x:u,y:d},m=e.raw.wcsinfo&&e.raw.wcsinfo.cdelt1&&e.raw.wcsinfo.cdelt1<0?{x:u-JS9.Panner.VSIZE,y:d}:{x:u+JS9.Panner.VSIZE,y:d},e.raw.wcsinfo&&e.raw.wcsinfo.crot&&(m=JS9.rotatePoint(m,-e.raw.wcsinfo.crot,g)),e.panner.eastid=e.addShapes("panner","line",{color:JS9.Panner.EAST.color,strokeWidth:JS9.Panner.EAST.strokeWidth,strokeDashArray:JS9.Panner.EAST.strokeDashArray,changeable:!1,points:[g,m],originX:"left",originY:"top",noLeftTop:!0}),e.panner.eastidt=e.addShapes("panner","text",{color:JS9.Panner.EAST.color,text:JS9.Panner.EAST.text,fontSize:JS9.Panner.EAST.fontSize,changeable:!1,left:m.x,top:m.y}),e)},JS9.Panner.zoom=function(e,t){var i,s,a;if(e&&e.panner&&e.display.pluginInstances.JS9Panner){switch(s=(i=e.panner).zoom,t.charAt(0)){case"*":case"x":case"X":a=Math.min(Math.min(this.width,this.height),s*parseFloat(t.slice(1)));break;case"/":a=Math.max(1,s/parseFloat(t.slice(1)));break;default:a=parseFloat(t)}return(!a||a<1)&&(a=1),i.zoom=a,JS9.Panner.disp.call(this,e),e}},JS9.Panner.dysel=function(e){var t;e&&(t=e.display.pluginInstances.JS9Panner)&&t.isDynamic&&JS9.Panner.disp.call(this,e)},JS9.Panner.clear=function(e){var t,i;if(e)return i=JS9.getDynamicDisplayOr(this.display),(t=e.display.pluginInstances.JS9Panner)&&e.display===i&&(t.context.clear(),e.removeShapes("panner","all"),e.panner.boxid=null),e},JS9.RegisterPlugin(JS9.Panner.CLASS,JS9.Panner.NAME,JS9.Panner.init,{menuItem:"Panner",dynamicSelect:!0,toolbarSeparate:!1,toolbarHTML:JS9.Panner.HTML,ondynamicselect:JS9.Panner.dysel,onplugindisplay:JS9.Panner.disp,onimagedisplay:JS9.Panner.disp,onimageclose:JS9.Panner.clear,onimageclear:JS9.Panner.clear,onupdateprefs:JS9.Panner.disp,winTitle:"Panner",winDims:[JS9.Panner.WIDTH,JS9.Panner.HEIGHT],divArgs:[JS9.Panner.SWIDTH,JS9.Panner.SHEIGHT]}),JS9.Prefs={},JS9.Prefs.CLASS="JS9",JS9.Prefs.NAME="Preferences",JS9.Prefs.WIDTH=750,JS9.Prefs.HEIGHT=400,JS9.Prefs.imagesSchema={title:"Image Preferences",description:"Preferences for each displayed image",properties:{colormap:{type:"string",helper:"default color map"},contrast:{type:"number",helper:"default color contrast"},bias:{type:"number",helper:"default color bias"},scale:{type:"string",helper:"default scale algorithm"},scaleclipping:{type:"string",helper:"'dataminmax' or 'zscale'"},zscalecontrast:{type:"number",helper:"default from ds9"},zscalesamples:{type:"number",helper:"default from ds9"},zscaleline:{type:"number",helper:"default from ds9"},exp:{type:"number",helper:"default exp value for scaling"},wcssys:{type:"string",helper:"current WCS system"},wcsunits:{type:"string",helper:"current WCS units"},lcs:{type:"string",helper:"default logical coordinate system"},opacity:{type:"number",helper:"opacity for images (0.0 to 1.0)"},zoom:{type:"number",helper:"default zoom factor"},zooms:{type:"number",helper:"how many zooms in each direction?"},nancolor:{type:"string",helper:"6-digit #hex color for NaN values"},listonchange:{type:"boolean",helper:"list after a region change?"},whichonchange:{type:"string",helper:"list 'all' or 'selected'?"},valpos:{type:"boolean",helper:"display value/position?"},inherit:{type:"boolean",helper:"new images inherit current params?"},invert:{type:"boolean",helper:"by default, invert colormap?"},disable:{type:"mobject",helper:"array of core functions to disable"}}},JS9.Prefs.regionsSchema={title:"Region Preferences",description:"Preferences for each displayed region",type:"object",properties:{iradius:{type:"number",helper:"annulus: initial inner radius"},oradius:{type:"number",helper:"annulus: initial outer radius"},nannuli:{type:"number",helper:"annulus: initial number of annuli"},width:{type:"number",helper:"box: initial width"},height:{type:"number",helper:"box: initial height"},radius:{type:"number",helper:"circle: initial radius"},r1:{type:"number",helper:"ellipse: initial radius1"},r2:{type:"number",helper:"ellipse: initial radius2"},ptshape:{type:"string",helper:"point shape: box, circle, ellipse"},ptsize:{type:"number",helper:"point size"},points:{type:"string",helper:"array of x,y relative positions"},angle:{type:"number",helper:"box, ellipse: initial angle in degrees"},tags:{type:"string",helper:"initial tags for a region"},strokeWidth:{type:"number",helper:"region stroke width"},fontFamily:{type:"string",helper:"region font"},fontSize:{type:"string",helper:"region font size"},fontStyle:{type:"string",helper:"region font style"},fontWeight:{type:"string",helper:"region font weight"},textAlign:{type:"string",helper:"text alignment"}}},JS9.Prefs.gridSchema={title:"Grid Preferences",description:"Preferences for wcs coordinate grids",type:"object",properties:{strokeWidth:{type:"number",helper:"grid stroke width"},lineColor:{type:"string",helper:"color of grid lines"},raLines:{type:"number",helper:"approx. number of RA grid lines"},raAngle:{type:"number",helper:"rotation for RA label"},raSkip:{type:"number",helper:"number of RA lines to skip"},decLines:{type:"number",helper:"approx. number of Dec grid lines"},decAngle:{type:"number",helper:"rotation for Dec label"},decSkip:{type:"number",helper:"number of Dec lines to skip"},labelColor:{type:"string",helper:"color of text labels"},labelFontFamily:{type:"string",helper:"label font"},labelFontSize:{type:"string",helper:"label font size"},labelFontStyle:{type:"string",helper:"label font style"},labelFontWeight:{type:"string",helper:"label font weight"},labelRAOffx:{type:"number",helper:"x offset of RA labels"},labelRAOffy:{type:"number",helper:"y offset of RA labels"},labelDecOffx:{type:"number",helper:"x offset of Dec labels"},labelDecOffy:{type:"number",helper:"y offset of Dec labels"},degPrec:{type:"number",helper:"precision for degree labels"},sexaPrec:{type:"number",helper:"precision for sexagesimal labels"},reduceDims:{type:"boolean",helper:"reduce lines of smaller image dim?"},stride:{type:"number",helper:"fineness of grid lines"},margin:{type:"number",helper:"edge margin for displaying a grid line"},labelMargin:{type:"number",helper:"edge margin for displaying a label"},cover:{type:"string",helper:"grid lines cover: display or image"}}},JS9.Prefs.fitsSchema={title:"FITS Preferences",description:"Preferences for processing FITS files",properties:{extlist:{type:"string",helper:"default binary table extensions"},xdim:{type:"string",helper:"x dim of image section from table"},ydim:{type:"string",helper:"y dim of image section from table"},bin:{type:"string",helper:"bin factor for tables"},ixdim:{type:"string",helper:"x dim of image section from image"},iydim:{type:"string",helper:"y dim of image section from table"},ibin:{type:"string",helper:"bin factor for images"},binMode:{type:"string",helper:"'s' for summing, 'a' for averaging"},clear:{type:"string",helper:"clear image's virtual file memory"}}},JS9.Prefs.catalogsSchema={title:"Catalogs Preferences",description:"Preferences for loading tab-delimited catalogs",properties:{ras:{type:"mobject",helper:"RA patterns to look for in table"},decs:{type:"mobject",helper:"Dec patterns to look for in table"},wcssys:{type:"string",helper:"wcs system of catalog"},shape:{type:"string",helper:"shape of objects"},color:{type:"string",helper:"color of objects"},width:{type:"number",helper:"width of box objects"},height:{type:"number",helper:"height of box objects"},radius:{type:"number",helper:"radius of circle objects"},r1:{type:"number",helper:"r1 of ellipse objects"},r2:{type:"number",helper:"r2 of ellipse objects"},tooltip:{type:"string",helper:"tooltip format for objects"},skip:{type:"string",helper:"comment character in table"}}},JS9.Prefs.globalsSchema={title:"Global Preferences",description:"Global preferences for all JS9 displays",properties:{topColormaps:{type:"mobject",helper:"array of top-level colormaps"},infoBox:{type:"mobject",helper:"array of infoBox items to display"},toolBar:{type:"mobject",helper:"array of toolbar tools to display"},separate:{type:"mobject",helper:"options when separating images"},mouseActions:{type:"mobject",helper:"array of mouse actions"},touchActions:{type:"mobject",helper:"array of touch actions"},keyboardActions:{type:"mobject",helper:"object containing keyboard actions"},centerDivs:{type:"mobject",helper:"divs used when centering"},resizeDivs:{type:"mobject",helper:"divs used when resizing"},plot3d:{type:"mobject",helper:"options for 3D data cube plot"},syncOps:{type:"mobject",helper:"ops to sync between images"},wcsUnits:{type:"mobject",helper:"default units for WCS systems"},copyWcsPosFormat:{type:"string",helper:"format string using: $ra $dec $sys"},regionDisplay:{type:"string",helper:"show regions in 'lightwin' or 'display'"},regionConfigSize:{type:"string",helper:"size of region dialog: small, medium"},lightWinClose:{type:"string",helper:"ask, close, move images when closing lightwin"},fits2fits:{type:"string",helper:"make rep file?: true,false,size>N"},dynamicSelect:{type:"string",helper:"select display: click, move, false"},fits2png:{type:"boolean",helper:"convert FITS to PNG rep files?"},mousetouchZoom:{type:"boolean",helper:"scroll/pinch to zoom?"},toolbarTooltips:{type:"boolean",helper:"show tooltips in Toolbar plugin?"},logoDisplay:{type:"boolean",helper:"show JS9 logo?"},reloadRefresh:{type:"boolean",helper:"does a reload refresh the data?"},reloadRefreshReg:{type:"boolean",helper:"reloading regions file removes prev?"},regionsToClipboard:{type:"boolean",helper:"copy region mods to pseudo-clipboard?"},syncReciprocate:{type:"boolean",helper:"reciprocal image sync'ing?"},panWithinDisplay:{type:"boolean",helper:"keep panned image within the display?"},pannerDirections:{type:"boolean",helper:"show direction vectors in panner?"},magnifierRegions:{type:"boolean",helper:"show regions in magnifier?"},svgBorder:{type:"boolean",helper:"add border when exporting SVG?"}}},JS9.Prefs.sources=[{name:"globals",schema:JS9.Prefs.globalsSchema},{name:"images",schema:JS9.Prefs.imagesSchema},{name:"fits",schema:JS9.Prefs.fitsSchema},{name:"regions",schema:JS9.Prefs.regionsSchema},{name:"grid",schema:JS9.Prefs.gridSchema},{name:"catalogs",schema:JS9.Prefs.catalogsSchema}],JS9.Prefs.init=function(){var e,t,i,s,a,n,r,o,l,c,h;for(n=JS9.Prefs.sources,c="<div style='padding: 8px'>",c+=sprintf("<div id='%s' class='indentmenu'>\n",l=this.id+"prefsTabs"),c+="<ul>",e=0;e<n.length;e++)c+=sprintf("  <li><a href='#' rel='%s'>%s</a></li>\n",(o=this.id+JS9.Prefs.CLASS+JS9.Prefs.NAME+(r=n[e]).name)+"Div",r.name);for(c+="</ul>",c+="<br style='clear:left'></div></div><p>\n",e=0;e<n.length;e++){switch(o=this.id+JS9.Prefs.CLASS+JS9.Prefs.NAME+(r=n[e]).name,r.name){case"images":r.data=JS9.imageOpts;break;case"regions":r.data=JS9.Regions.opts;break;case"grid":r.data=JS9.Grid.opts;break;case"fits":r.data={extlist:JS9.fits.options.extlist,xdim:JS9.fits.options.table.xdim,ydim:JS9.fits.options.table.ydim,bin:JS9.fits.options.table.bin,ixdim:JS9.fits.options.image.xdim,iydim:JS9.fits.options.image.ydim,ibin:JS9.fits.options.image.bin,binMode:JS9.globalOpts.binMode,clear:JS9.globalOpts.clearImageMemory};break;case"catalogs":r.data={ras:JS9.globalOpts.catalogs.ras,decs:JS9.globalOpts.catalogs.decs,wcssys:JS9.globalOpts.catalogs.wcssys,shape:JS9.globalOpts.catalogs.shape,color:JS9.globalOpts.catalogs.color,width:JS9.globalOpts.catalogs.width,height:JS9.globalOpts.catalogs.height,radius:JS9.globalOpts.catalogs.radius,r1:JS9.globalOpts.catalogs.r1,r2:JS9.globalOpts.catalogs.r2,tooltip:JS9.globalOpts.catalogs.tooltip,skip:JS9.globalOpts.catalogs.skip};break;case"globals":r.data={fits2png:JS9.globalOpts.fits2png,fits2fits:JS9.globalOpts.fits2fits,dynamicSelect:JS9.globalOpts.dynamicSelect,toolbarTooltips:JS9.globalOpts.toolbarTooltips,logoDisplay:JS9.globalOpts.logoDisplay,syncReciprocate:JS9.globalOpts.syncReciprocate,reloadRefresh:JS9.globalOpts.reloadRefresh,reloadRefreshReg:JS9.globalOpts.reloadRefreshReg,regionsToClipboard:JS9.globalOpts.regionsToClipboard,panWithinDisplay:JS9.globalOpts.panWithinDisplay,pannerDirections:JS9.globalOpts.pannerDirections,magnifierRegions:JS9.globalOpts.magnifierRegions,svgBorder:JS9.globalOpts.svgBorder,topColormaps:JS9.globalOpts.topColormaps,mouseActions:JS9.globalOpts.mouseActions,touchActions:JS9.globalOpts.touchActions,keyboardActions:JS9.globalOpts.keyboardActions,centerDivs:JS9.globalOpts.centerDivs,resizeDivs:JS9.globalOpts.resizeDivs,plot3d:JS9.globalOpts.plot3d,syncOps:JS9.globalOpts.syncOps,wcsUnits:JS9.globalOpts.wcsUnits,mousetouchZoom:JS9.globalOpts.mousetouchZoom,copyWcsPosFormat:JS9.globalOpts.copyWcsPosFormat,regionDisplay:JS9.globalOpts.regionDisplay,regionConfigSize:JS9.globalOpts.regionConfigSize,lightWinClose:JS9.globalOpts.lightWinClose,infoBox:JS9.globalOpts.infoBox,toolBar:JS9.globalOpts.toolBar,separate:JS9.globalOpts.separate}}for(s in c+=sprintf("<div id='%s' class='tabcontent'>",o+"Div"),c+=sprintf("<form id='%s' class='js9AnalysisForm' style='max-height: %spx; overflow: hidden'>",o+"Form",this.height-90),c+=sprintf("<center><b>%s</b></center><p>",r.schema.description),a=r.schema.properties)if(a.hasOwnProperty(s))switch(h=(i=a[s]).prompt||s+":",i.type){case"boolean":c+=sprintf("<div class='linegroup'><span class='column_R1'><b>%s</b></span><span class='column_R2'><input type='checkbox' name='%s' value='true' %s></span><span class='column_R4l'>%s</span></div>",h,s,t=r.data[s]?"checked":"",i.helper);break;default:t="object"==typeof r.data[s]?"mobject"===i.type?JSON.stringify(r.data[s],null,2):JSON.stringify(r.data[s]):r.data[s],c+=sprintf("mobject"===i.type?"<div class='linegroup' style='height:64px'><span class='column_R1'><b>%s</b></span><span class='column_R2l'><textarea name='%s' class='text_R' rows='5' style='overflow-x: hidden; resize: none'>%s</textarea></span><span class='column_R4l'>%s</span></div>":"<div class='linegroup'><span class='column_R1'><b>%s</b></span><span class='column_R2l'><input type='text' name='%s' class='text_R' value='%s'></span><span class='column_R4l'>%s</span></div>",h,s,t,i.helper)}c+="<input id='"+this.id+"_applyPrefs' name='Apply' type='button' class='button' value='Apply' onclick='JS9.Prefs.applyForm.call(this);' style='margin: 8px'>",window.hasOwnProperty("localStorage")&&(c+="<input id='"+this.id+"_savePrefs' name='Save' type='button' class='button' value='Save' onclick='JS9.Prefs.saveForm.call(this)' style='margin: 8px'>",c+="<input id='"+this.id+"_showPrefs' name='Show' type='button' class='button' value='Show Saved' onclick='JS9.Prefs.showForm.call(this)' style='margin: 8px'>",c+="<input id='delete' name='Delete' type='button' class='button' value='Delete Saved' onclick='JS9.Prefs.deleteForm.call(this)' style='margin: 8px'>"),"light"===this.winType&&(c+="<input id='"+this.id+"_closePrefs' name='Close' type='button' class='button' value='Close' onclick='var form = $(this).closest(\"form\"); var winid = form.data(\"winid\"); winid.close(); return false;' style='float: right; margin: 8px'>"),c+="</form>",c+="</div>"}for(this.divjq.addClass("JS9PluginScrolling"),this.divjq.html(c),e=0;e<n.length;e++)o=this.id+JS9.Prefs.CLASS+JS9.Prefs.NAME+(r=n[e]).name,$("#"+o+"Form").data("display",this.display),$("#"+o+"Form").data("source",r),"light"===this.winType&&$("#"+o+"Form").data("winid",this.winHandle);this.tabs=new ddtabcontent(l),this.tabs.setpersist(!1),this.tabs.setselectedClassTarget("link"),this.tabs.init()},JS9.Prefs.applyForm=function(){var e=$(this).closest("form"),t=e.serializeArray(),i=e.data("display"),s=e.data("source"),a=e.data("winid");return t=t.concat($("#"+e.attr("id")+" input[type=checkbox]:not(:checked)").map(function(){return{name:this.name,value:"false"}}).get()),JS9.Prefs.processForm(s,t,i,a),!1},JS9.Prefs.saveForm=function(){var e=$(this).closest("form").data("source");JS9.Prefs.applyForm.call(this);try{localStorage.setItem(e.name,JSON.stringify(e.data,null,2)),JS9.userOpts[e.name]=localStorage.getItem(e.name)}catch(t){JS9.error("could not save prefs: "+e.name)}return!1},JS9.Prefs.showForm=function(){var e,t,i=$(this).closest("form").data("source");try{e=localStorage.getItem(i.name)}catch(s){}return t=e&&"null"!==e?"<pre>"+e+"</pre>":sprintf("<p><center>No saved prefs: %s</center>",i.name),JS9.lightWin("savedPrefs"+JS9.uniqueID(),"inline",t,"Saved prefs: "+i.name,JS9.lightOpts[JS9.LIGHTWIN].textWin),!1},JS9.Prefs.deleteForm=function(){var e=$(this).closest("form").data("source");try{localStorage.removeItem(e.name),delete JS9.userOpts[e.name]}catch(t){}return!1},JS9.Prefs.processForm=function(e,t,i,s){var a,n,r,o,l,c,h,u=t.length;switch(e.name){case"images":c=JS9.imageOpts;break;case"regions":c=JS9.Regions.opts;break;case"grid":c=JS9.Grid.opts;break;case"fits":c=JS9.fits.options;break;case"catalogs":c=JS9.globalOpts.catalogs;break;case"globals":c=JS9.globalOpts}for(a=0;a<u;a++){switch("true"===(l=t[a].value)&&(l=!0),"false"===l&&(l=!1),typeof c[o=t[a].name]){case"boolean":break;case"number":l=parseFloat(l);break;case"object":try{l=JSON.parse(l)}catch(d){JS9.error("invalid JSON (see jsonlint.com): "+l,d)}}if(c[o]!==l)switch(e.name){case"images":c[o]=l,i&&i.image&&("disable"===o?i.image.params.disable=l:i.image.setParam(o,l));break;case"regions":for(c[o]=l,n=0;n<JS9.displays.length;n++)(h=JS9.displays[n].layers.regions)&&(h.opts[o]=l);break;case"fits":switch(o){case"xdim":c.table.xdim=Math.floor(parseFloat(l));break;case"ydim":c.table.ydim=Math.floor(parseFloat(l));break;case"bin":c.table.bin=Math.floor(parseFloat(l));break;case"ixdim":c.image.xdim=Math.floor(parseFloat(l));break;case"iydim":c.image.ydim=Math.floor(parseFloat(l));break;case"ibin":c.image.bin=Math.floor(parseFloat(l));break;case"binMode":JS9.globalOpts.binMode=l;break;case"clear":JS9.globalOpts.clearImageMemory=l;break;default:c[o]=l}e.data[o]=l;break;case"catalogs":switch(o){case"skip":c[o]=l+"\n";break;default:c[o]=l}break;case"globals":switch(o){case"toolBar":c[o]=l,JS9.SetToolbar("init"),e.data[o]=l;break;case"toolbarTooltips":c[o]=l,e.data[o]=l;break;case"logoDisplay":for(c[o]=l,JS9.SetToolbar("init"),e.data[o]=l,r=l?"block":"none",n=0;n<JS9.displays.length;n++)JS9.displays[n].iconjq.css("display",r);break;case"separate":default:c[o]=l,e.data[o]=l}break;default:c[o]=l}}if(JS9.globalOpts.extendedPlugins)for(n=0;n<JS9.displays.length;n++)JS9.displays[n].image&&JS9.displays[n].image.xeqPlugins("image","onupdateprefs")},JS9.RegisterPlugin(JS9.Prefs.CLASS,JS9.Prefs.NAME,JS9.Prefs.init,{menuItem:"Preferences",help:"help/prefs.html",winTitle:"User Preferences",winResize:!0,winDims:[JS9.Prefs.WIDTH,JS9.Prefs.HEIGHT]}),JS9.ScaleLimits={},JS9.ScaleLimits.CLASS="JS9",JS9.ScaleLimits.NAME="Scale",JS9.ScaleLimits.WIDTH=512,JS9.ScaleLimits.HEIGHT=400,JS9.ScaleLimits.WIDTHOFFSET=40,JS9.ScaleLimits.HEIGHTOFFSET=210,JS9.ScaleLimits.BASE=JS9.ScaleLimits.CLASS+JS9.ScaleLimits.NAME,JS9.ScaleLimits.XSCALE="linear",JS9.ScaleLimits.YSCALE="log",JS9.ScaleLimits.NDIST=512,JS9.ScaleLimits.TIMEOUT=250,JS9.ScaleLimits.CARET=4,JS9.ScaleLimits.XTEXTHEIGHT=14,JS9.ScaleLimits.XTEXTFONT="Ariel",JS9.ScaleLimits.XTEXTCOLOR="black",JS9.ScaleLimits.XTEXTFRAC=.75,JS9.ScaleLimits.YTEXTFRAC=.15,JS9.ScaleLimits.PLOTCOLOR="#030AE4",JS9.ScaleLimits.XLOCOLOR="#FF0000",JS9.ScaleLimits.XHICOLOR="#00FF00",JS9.ScaleLimits.AXISFONT={size:12,family:"Ariel",color:"black"},JS9.ScaleLimits.AXISFANCY=!0,JS9.ScaleLimits.dataOpts={bars:{show:!0,align:"center",barWidth:.1},clickable:!0,hoverable:!0,data:[]},JS9.ScaleLimits.plotOpts={selection:{mode:"x"},grid:{hoverable:!0}},JS9.ScaleLimits.scalelimsHTML="<div class='JS9ScaleLinegroup'>$header</div><div class='JS9ScaleLinegroup'>$scales&nbsp;&nbsp;$limits&nbsp;&nbsp;$axes</div><p><div class='JS9ScaleLinegroup'>$plot</div><p><div class='JS9ScaleLinegroup'><span class='JS9ScaleSpan' style='float: left'>&nbsp;&nbsp;$lo&nbsp;&nbsp;&nbsp;&nbsp;$hi</span></div>",JS9.ScaleLimits.headerHTML="Set clipping limits via the Data Limits menu, or by selecting part of the Pixel Distribution plot, or by changing the Low and/or High limit.",JS9.ScaleLimits.scalesHTML="<select class=\"JS9ScaleSelect\" onchange=\"JS9.ScaleLimits.xsetscale('%s', '%s', this)\">%s</select>",JS9.ScaleLimits.limitsHTML='<select class="JS9ScaleSelect" onchange="JS9.ScaleLimits.xsetlims(\'%s\', \'%s\', this)"><option selected disabled>Data Limits</option><option value="dataminmax">data min/max</option><option value="zscale_z1_z2">zscale z1/z2</option><option value="zscale_z1_datamax">zscale z1/max</option></select>',JS9.ScaleLimits.axesHTML='<select class="JS9ScaleSelect" onchange="JS9.ScaleLimits.xaxes(\'%s\', \'%s\', this)"><option selected disabled>Plot Axes</option><option disabled>x axis:</option><option value="xlinear">linear</option><option value="xlog">log</option><option disabled>y axis:</option><option value="ylinear">linear</option><option value="ylog">log</option></select>',JS9.ScaleLimits.plotHTML='<div><center>Pixel Distribution: %s</center></div><div class="JS9ScalePlot" style="width:%spx;height:%spx"></div>',JS9.ScaleLimits.loHTML='Low:&nbsp;&nbsp;<input type="text" class="JS9ScaleValue" value=\'%s\' onchange="JS9.ScaleLimits.xsetlo(\'%s\', \'%s\', this)" size="16">',JS9.ScaleLimits.hiHTML='High:&nbsp;&nbsp;<input type="text" class="JS9ScaleValue" value=\'%s\' onchange="JS9.ScaleLimits.xsethi(\'%s\', \'%s\', this)" size="16">',JS9.ScaleLimits.xsetscale=function(e,t,i){var s=JS9.lookupImage(t,e);s&&s.setScale(i.value)},JS9.ScaleLimits.xsetlo=function(e,t,i){var s,a=JS9.lookupImage(t,e);a&&(s=parseFloat(i.value),a.setScale(s,a.params.scalemax))},JS9.ScaleLimits.xsethi=function(e,t,i){var s,a=JS9.lookupImage(t,e);a&&(s=parseFloat(i.value),a.setScale(a.params.scalemin,s))},JS9.ScaleLimits.xsetlims=function(e,t,i){var s=JS9.lookupImage(t,e);if(s)switch(i.value){case"dataminmax":s.setScale("dataminmax",s.raw.dmin,s.raw.dmax);break;case"zscale_z1_z2":s.setScale("zscale",s.params.z1,s.params.z2);break;case"zscale_z1_datamax":s.setScale("zmax",s.params.z1,s.raw.dmax)}},JS9.ScaleLimits.log10=function(e){return e<=0?null:Math.log(e)/Math.LN10},JS9.ScaleLimits.xaxes=function(e,t,i){var s,a=JS9.lookupImage(t,e);if(a){if(!(s=a.display.pluginInstances[JS9.ScaleLimits.BASE])||!s.plot)return;switch(i.value){case"xlinear":s.xscale="linear",JS9.ScaleLimits.doplot.call(s,a);break;case"xlog":s.xscale="log",JS9.ScaleLimits.doplot.call(s,a);break;case"ylinear":s.yscale="linear",JS9.ScaleLimits.doplot.call(s,a);break;case"ylog":s.yscale="log",JS9.ScaleLimits.doplot.call(s,a)}}$(i).val("Plot Axes").prop("selected",!0)},JS9.ScaleLimits.getPixelDist=function(e,t){var i,s,a=[],n=e.raw.dmin,r=e.raw.dmax-e.raw.dmin,o=e.raw.width*e.raw.height;for(i=0;i<t;i++)a[i]=0;for(i=0;i<o;i++)(s=Math.floor((e.raw.data[i]-n)/r*t+.5))>=0&&s<t&&(a[s]+=1);return a},JS9.ScaleLimits.to10E=function(e){return JS9.ScaleLimits.AXISFANCY&&e>=0&&e<=9?"10"+["\u2070","\xb9","\xb2","\xb3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"][e]:"10E"+String(e)},JS9.ScaleLimits.doplot=function(e){var t,i,s,a,n,r,o,l,c,h,u,d,p=this,f=e.raw.dmin,g=e.raw.dmax-e.raw.dmin,m=$.extend(!0,{},JS9.ScaleLimits.dataOpts),v=$.extend(!0,{},JS9.ScaleLimits.plotOpts),b=function(e,t,i){var s=e.getCanvas().getContext("2d"),a=JS9.ScaleLimits.CARET,n=e.pointOffset({x:t,y:0});s.beginPath(),s.moveTo(n.left,n.top),s.lineTo(n.left-a,n.top-2*a),s.lineTo(n.left+a,n.top-2*a),s.lineTo(n.left,n.top),s.fillStyle=i,s.fill()};for(this.plotComplete=!1,this.plotColor&&(m.color=this.plotColor),o=JS9.ScaleLimits.getPixelDist(e,this.ndist),t=0;t<this.ndist;t++)m.data[t]=[t,o[t]];if(v.xaxis=v.xaxis||{},v.xaxis.font=JS9.ScaleLimits.AXISFONT,"linear"===this.xscale)for(v.xaxis.transform=null,v.xaxis.ticks=[],u=(d=g)<10?1:d<50?5:d<250?10:d<500?50:d<2500?100:d<5e3?500:d<25e3?1e3:d<5e4?5e3:d<25e4?1e4:d<5e5?5e4:d<25e5?1e5:d<5e6?5e5:d<25e6?1e6:1e7,h=Math.floor(g/u+.5)+1,t=0;t<h;t++)i=t*u,s=String(i),v.xaxis.ticks[t]=[(i-f)*this.ndist/g,s];else if("log"===this.xscale)for(v.xaxis.transform=JS9.ScaleLimits.log10,v.xaxis.min=1,v.xaxis.ticks=[],h=JS9.ScaleLimits.log10(this.ndist)+1,t=0;t<h;t++)i=Math.floor((Math.pow(10,t)-f)*this.ndist/g),v.xaxis.ticks[t]=[i,JS9.ScaleLimits.to10E(t)];if(n=(e.params.scalemin-f)/g*this.ndist,r=(e.params.scalemax-f)/g*this.ndist,v.yaxis=v.yaxis||{},v.yaxis.font=JS9.ScaleLimits.AXISFONT,"linear"===this.yscale)v.yaxis.transform=null,v.yaxis.ticks=null;else if("log"===this.yscale){for(v.yaxis.transform=JS9.ScaleLimits.log10,v.yaxis.min=1,v.yaxis.ticks=[],t=0;t<this.ndist;t++)(void 0===l||o[t]<l)&&(l=o[t]),(void 0===c||o[t]>c)&&(c=o[t]);for(h=JS9.ScaleLimits.log10(c-l+1),t=0;t<h;t++)v.yaxis.ticks[t]=[Math.pow(10,t),JS9.ScaleLimits.to10E(t)]}a=this.divjq.find(".JS9ScalePlot"),this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null),a.off("plotselected"),a.on("plotselected",function(t,i){var s=i.xaxis.from,a=i.xaxis.to;"log"===p.xscale&&(s=Math.pow(10,s),a=Math.pow(10,a)),e.setScale("user",s=s*g/p.ndist+f,a=a*g/p.ndist+f)}),a.off("plothover"),a.on("plothover",function(e,t){var i,s,a,n,r,o,l,c=t.x;p.plot&&p.plotComplete&&("log"===p.xscale&&(c=Math.pow(10,c)),l=c*g/p.ndist+f,isFinite(l)&&(a=JS9.floatToString(l),(i=p.plot.getCanvas().getContext("2d")).save(),i.textBaseline="top",i.font=JS9.ScaleLimits.XTEXTHEIGHT+"px "+JS9.ScaleLimits.XTEXTFONT,i.fillStyle=JS9.ScaleLimits.XTEXTCOLOR||"black",s=i.measureText(a),o=Math.max(p.lastTextWidth,s.width+2),i.clearRect(n=p.plotWidth*JS9.ScaleLimits.XTEXTFRAC,r=p.plotHeight*JS9.ScaleLimits.YTEXTFRAC,o,JS9.ScaleLimits.XTEXTHEIGHT+2),i.fillText(a,n,r),i.restore(),p.lastTextWidth=o))}),this.timeout=window.setTimeout(function(){p.plot=$.plot(a,[m],v),p.timeout=null,b(p.plot,n,p.xlocolor),b(p.plot,r,p.xhicolor),p.plotComplete=!0},JS9.ScaleLimits.TIMEOUT)},JS9.ScaleLimits.display=function(){this.lastimage!==this.display.image&&JS9.ScaleLimits.init.call(this)},JS9.ScaleLimits.close=function(){JS9.ScaleLimits.init.call(this,{mode:"clear"})},JS9.ScaleLimits.init=function(e){var t,i,s,a,n;e=e||{},this.width=this.divjq.attr("data-width"),this.width||(this.width=JS9.ScaleLimits.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=JS9.ScaleLimits.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.plotWidth=this.plotWidth||this.divjq.attr("data-plotWidth"),this.plotWidth||(this.plotWidth=this.width-JS9.ScaleLimits.WIDTHOFFSET),this.plotHeight=this.plotHeight||this.divjq.attr("data-plotHeight"),this.plotHeight||(this.plotHeight=this.height-JS9.ScaleLimits.HEIGHTOFFSET),this.xscale=this.xscale||this.divjq.attr("data-xscale"),this.xscale||(this.xscale=JS9.ScaleLimits.XSCALE),this.yscale=this.yscale||this.divjq.attr("data-yscale"),this.yscale||(this.yscale=JS9.ScaleLimits.YSCALE),this.plotColor=this.plotColor||this.divjq.attr("data-plotColor"),this.plotColor||(this.plotColor=JS9.ScaleLimits.PLOTCOLOR),this.xlocolor=this.xlocolor||this.divjq.attr("data-xlocolor"),this.xlocolor||(this.xlocolor=JS9.ScaleLimits.XLOCOLOR),this.xhicolor=this.xhicolor||this.divjq.attr("data-xhicolor"),this.xhicolor||(this.xhicolor=JS9.ScaleLimits.XHICOLOR),this.ndist=this.divjq.attr("data-ndist"),this.ndist||(this.ndist=JS9.ScaleLimits.NDIST),this.divjq.html(""),this.lastTextWidth=0,this.scalelimsContainer=$("<div>").addClass(JS9.ScaleLimits.BASE+"Container").attr("id",this.id+"Container").attr("width",this.width).attr("height",this.height).appendTo(this.divjq),(i=this.display.image)&&"clear"!==e.mode?(a=i.id,n=i.display.id,(s=[]).push({name:"header",value:JS9.ScaleLimits.headerHTML}),s.push({name:"scales",value:sprintf(JS9.ScaleLimits.scalesHTML,n,a,function(){var e,t="<option selected disabled>Scales</option>";for(e=0;e<JS9.scales.length;e++)t+="<option>"+JS9.scales[e]+"</option>";return t}())}),s.push({name:"limits",value:sprintf(JS9.ScaleLimits.limitsHTML,n,a)}),s.push({name:"axes",value:sprintf(JS9.ScaleLimits.axesHTML,n,a)}),s.push({name:"plot",value:sprintf(JS9.ScaleLimits.plotHTML,a,this.plotWidth,this.plotHeight)}),s.push({name:"lo",value:sprintf(JS9.ScaleLimits.loHTML,JS9.floatToString(i.params.scalemin),n,a)}),s.push({name:"hi",value:sprintf(JS9.ScaleLimits.hiHTML,JS9.floatToString(i.params.scalemax),n,a)}),t=i.expandMacro(JS9.ScaleLimits.scalelimsHTML,s),this.lastimage=i):t="<p><center>Scale parameters will appear here.</center>",this.scalelimsContainer.html(t),i&&JS9.ScaleLimits.doplot.call(this,i)},JS9.RegisterPlugin(JS9.ScaleLimits.CLASS,JS9.ScaleLimits.NAME,JS9.ScaleLimits.init,{menu:"scale",menuItem:"Scale Controls ...",onplugindisplay:JS9.ScaleLimits.init,onsetscale:JS9.ScaleLimits.init,onimagedisplay:JS9.ScaleLimits.display,onimageclose:JS9.ScaleLimits.close,help:"help/scalelimits.html",winTitle:"Scale Controls",winDims:[JS9.ScaleLimits.WIDTH,JS9.ScaleLimits.HEIGHT]}),JS9.Separate={},JS9.Separate.CLASS="JS9",JS9.Separate.NAME="Separate",JS9.Separate.WIDTH=512,JS9.Separate.HEIGHT=336,JS9.Separate.BASE=JS9.Separate.CLASS+JS9.Separate.NAME,JS9.Separate.topHTML="$separate<p>$gather",JS9.Separate.separateHTML='<b>separate selected</b> images or <b>separate all</b> images into different displays. The topmost (selected) image remains in place, and the presence or absence of its menubar, toolbar, and colorbar will be replicated in the new displays:<p><div><input type="button" class="separateButton1" name="separate" value="separate selected" onclick="javascript:JS9.Separate.separate.call(this, \'%s\', \'selected\');">;<input type="button" class="separateButton2" name="separate" value="separate all" onclick="javascript:JS9.Separate.separate.call(this, \'%s\', \'all\');"><span style=\'float: right\'><select class="separateLayoutSelect" onchange="JS9.Separate.xlayout.call(this, \'%s\')"><option selected disabled>layout</option><option value="auto">auto</option><option value="horizontal">horizontal</option><option value="vertical">vertical</option></select></span></div><p>',JS9.Separate.gatherHTML='<b>gather selected</b> images or  <b>gather all</b> images into this display:<p><div><input type="button" class="separateButton1" name="gather" value="gather selected" onclick="javascript:JS9.Separate.gather.call(this, \'%s\', \'selected\');"><input type="button" class="separateButton2" name="gather" value="gather all" onclick="javascript:JS9.Separate.gather.call(this, \'%s\', \'all\');"></div><p>',JS9.Separate.imageHTML="<span style='float: left'>$active&nbsp;&nbsp;</span><span id='separateFile'>$imfile</span>",JS9.Separate.activeHTML='<input class="separateActiveCheck" type="checkbox" id="active" name="active" value="active" onclick="javascript:JS9.Separate.xactive.call(this, \'%s\')">select',JS9.Separate.imfileHTML="<b>%s</b>",JS9.Separate.nofileHTML='<p><span id="NoFile">[Images will appear here as they are loaded]</span>',JS9.Separate.xactive=function(e){var t=JS9.lookupImage(e);t&&(t.tmp.separateMode=this.checked)},JS9.Separate.xlayout=function(e){var t,i=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));i&&(t=i.pluginInstances.JS9Separate)&&this.selectedIndex>=0&&(t.separateLayout=this.options[this.selectedIndex].value)},JS9.Separate.separate=function(e,t){var i,s,a,n,r={},o=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));if(o){switch((a=o.pluginInstances.JS9Separate)&&a.separateLayout&&(r.layout=a.separateLayout),t){case"selected":for(n=[],i=0;i<JS9.images.length;i++)(s=JS9.images[i]).tmp.separateMode&&n.push(s);if(!n.length)return;r.images=n}o.separate(r)}},JS9.Separate.gather=function(e,t){var i,s,a,n={},r=JS9.getDynamicDisplayOr(JS9.lookupDisplay(e));if(r){switch(t){case"all":r.gather();break;case"selected":for(a=[],i=0;i<JS9.images.length;i++)(s=JS9.images[i]).tmp.separateMode&&a.push(s);if(!a.length)return;n.images=a}r.gather(n)}},JS9.Separate.imid=function(e){return(e.display.id+"_"+e.id).replace(/[^A-Za-z0-9_]/g,"_")+"SeparateImage"},JS9.Separate.dispclass=function(e){return(JS9.Separate.BASE+"_"+e.display.id).replace(/[^A-Za-z0-9_]/g,"_")},JS9.Separate.activeImage=function(e){var t,i;e&&(t=JS9.Separate.imid(e),i=JS9.Separate.dispclass(e)+"_Image",$("."+i).removeClass(JS9.Separate.BASE+"ImageActive").addClass(JS9.Separate.BASE+"ImageInactive"),$("#"+t).removeClass(JS9.Separate.BASE+"ImageInactive").addClass(JS9.Separate.BASE+"ImageActive"))},JS9.Separate.addImage=function(e){var t,i,s,a,n,r=[],o=JS9.Separate.BASE+"Image";e&&(n=e.id,i=JS9.Separate.imid(e),a=JS9.Separate.dispclass(e)+"_Image",r.push({name:"imid",value:e.id}),r.push({name:"active",value:sprintf(JS9.Separate.activeHTML,n)}),r.push({name:"imfile",value:sprintf(JS9.Separate.imfileHTML,n)}),this.separateDivs||this.separateImageContainer.html(""),t=JS9.Image.prototype.expandMacro.call(e,JS9.Separate.imageHTML,r),(s=$("<div>").addClass(o).addClass(a).attr("id",i).prop("imid",n).html(t).appendTo(this.separateImageContainer)).on("mousedown touchstart",function(){e.displayImage(),JS9.Separate.activeImage.call(this,e)}),this.separateDivs++,s.find(".separateActiveCheck").prop("checked",!0===e.tmp.separateMode),JS9.Separate.activeImage(e))},JS9.Separate.removeImage=function(e){var t;return!!e&&(t=JS9.Separate.imid(e),$("#"+t).remove(),this.separateDivs--,0===this.separateDivs&&this.separateImageContainer.html(JS9.Separate.nofileHTML),delete e.tmp.separateMode,!0)},JS9.Separate.init=function(){var e,t,i,s,a,n=this,r=[];for(this.divjq.html(""),this.separateDivs=0,this.divjq.addClass("JS9PluginScrolling"),this.separateContainer=$("<div>").addClass(JS9.Separate.BASE+"Container").attr("id",this.id+"SeparateContainer").css("overflow","auto").appendTo(this.divjq),r.push({name:"separate",value:sprintf(JS9.Separate.separateHTML,a=this.display.id,a,a)}),r.push({name:"gather",value:sprintf(JS9.Separate.gatherHTML,a,a)}),t=JS9.Image.prototype.expandMacro.call(null,JS9.Separate.topHTML,r),this.separateHeader=$("<div>").addClass(JS9.Separate.BASE+"Header").attr("id",a+"Header").html(t).appendTo(this.separateContainer),this.separateImageContainer=$("<div>").addClass(JS9.Separate.BASE+"ImageContainer").attr("id",this.id+"SeparateImageContainer").html(JS9.Separate.nofileHTML).appendTo(this.separateContainer),s=JS9.getDynamicDisplayOr(this.display),e=0;e<JS9.images.length;e++)(i=JS9.images[e]).display===s&&JS9.Separate.addImage.call(this,i);this.separateImageContainer.sortable({start:function(e,t){this.oidx=t.item.index()},stop:function(e,t){var i=t.item.index();JS9.images.splice(i,0,JS9.images.splice(this.oidx,1)[0]),n.display.image&&n.display.image.displayImage()}})},JS9.Separate.imageload=function(e){var t=JS9.getDynamicDisplayOr(this.display);e&&e.display===t&&JS9.Separate.addImage.call(this,e)},JS9.Separate.imagedisplay=function(e){JS9.Separate.activeImage.call(this,e)},JS9.Separate.imageclose=function(e){JS9.Separate.removeImage.call(this,e)},JS9.Separate.reinit=function(e){e&&JS9.Separate.init.call(this)},JS9.RegisterPlugin(JS9.Separate.CLASS,JS9.Separate.NAME,JS9.Separate.init,{menuItem:"Separate/Gather",dynamicSelect:!0,onplugindisplay:JS9.Separate.init,ondynamicselect:JS9.Separate.reinit,ongatherdisplay:JS9.Separate.reinit,onimageload:JS9.Separate.imageload,onimagedisplay:JS9.Separate.imagedisplay,onimageclose:JS9.Separate.imageclose,help:"help/separate.html",winTitle:"Separate/Gather Images",winResize:!0,winDims:[JS9.Separate.WIDTH,JS9.Separate.HEIGHT]}),JS9.Sync={},JS9.Sync.CLASS="JS9",JS9.Sync.NAME="Sync",JS9.Sync.getOps=function(e){var t,i,s,a=[];for(e=e||JS9.globalOpts.syncOps,$.isArray(e)||(e=[e]),t=0,i=0;t<e.length;t++)switch(s=e[t]){case"wcs":a[i++]="wcssys",a[i++]="wcunits";break;default:a[i++]=s}return a},JS9.Sync.getIms=function(e){var t,i,s,a=[];for(e=e||JS9.images,$.isArray(e)||(e=[e]),t=0,i=0;t<e.length;t++)!(s="string"==typeof e[t]?JS9.lookupImage(e[t]):e[t])||s.id===this.id&&s.display.id===this.display.id||(a[i++]=s);return a},JS9.Sync.sync=function(e,t,i){var s,a,n,r,o,l,c,h=[];if(this.syncs=this.syncs||{active:!0},i=i||{reciprocate:JS9.globalOpts.syncReciprocate},1!==arguments.length||"boolean"!=typeof e)if(o=JS9.Sync.getOps.call(this,e),c=(l=JS9.Sync.getIms.call(this,t)).length,i.reverse)for(delete i.reverse,s=0;s<c;s++)JS9.Sync.sync.call(l[s],o,[this]);else{for(s=0;s<o.length;s++)for(this.syncs[n=o[s]]=this.syncs[n]||[],t=this.syncs[n],a=0;a<c;a++)r=l[a],$.inArray(r,t)<0&&(t.push(r),h.push({im:this,xim:r,xop:n,xarg:null}));if(i.reciprocate){for(JS9.Sync.reciprocating=!0,i.reciprocate=!1,s=0,r=this;s<c;s++)l.push(r),r=l.shift(),JS9.Sync.sync.call(r,o,l,i);delete JS9.Sync.reciprocating}JS9.Sync.reciprocating||(JS9.Sync.xeqSync.call(this,h),JS9.Sync.ready=!0)}else this.syncs.active=e},JS9.Sync.unsync=function(e,t,i){var s,a,n,r,o,l,c;if(this.syncs)if(i=i||{reciprocate:JS9.globalOpts.syncReciprocate},r=JS9.Sync.getOps.call(this,e),l=(o=JS9.Sync.getIms.call(this,t)).length,i.reverse)for(delete i.reverse,s=0;s<l;s++)JS9.Sync.unsync.call(o[s],r,[this]);else{for(a in this.syncs)if(this.syncs.hasOwnProperty(a)){if(r&&$.inArray(a,r)<0)continue;if(o){for(s=(n=this.syncs[a]).length-1;s>=0;s--)$.inArray(n[s],o)>=0&&n.splice(s,1);n.length||delete this.syncs[a]}else delete this.syncs[a]}if(Object.keys(this.syncs).length||delete this.syncs,i.reciprocate){for(JS9.Sync.reciprocating=!0,i.reciprocate=!1,s=0,c=this;s<l;s++)o.push(c),c=o.shift(),JS9.Sync.unsync.call(c,r,o,i);delete JS9.Sync.reciprocating}}},JS9.Sync.xeqSync=function(e){var t,i,s,a,n,r,o,l,c,h,u,d,p,f,g,m=JS9.globalOpts.xeqPlugins,v=this.id+"_"+this.display.id;if(!this.syncs.running){this.syncs.running=!0;try{for(t=0;t<e.length;t++)if((o=(a=e[t]).xim).display.image===o){o.syncs&&(o.syncs.running=!0);try{switch(a.xop){case"colormap":o.setColormap(this.params.colormap);break;case"contrastbias":o.setColormap(this.params.contrast,this.params.bias);break;case"pan":this.raw.wcs>0&&(n=this.displayToImagePos({x:this.display.width/2,y:this.display.height/2}),r=JS9.pix2wcs(this.raw.wcs,n.x,n.y),o.setPan({wcs:r}));break;case"regions":if(g=[],l=null,a.xarg)g.push(a.xarg);else for(p||(p=this.getShapes("regions")),l=o.getShapes("regions"),i=0;i<p.length;i++){for(p[i].mode="add",s=0;s<l.length;s++)if(y=p[i],(b=l[s]).data&&b.data.syncid&&y.data&&y.data.syncid&&b.data.syncid===y.data.syncid){p[i].mode="update";break}g.push(p[i])}for(i=0;i<g.length;i++)switch(d=(u=$.extend(!0,{},g[i])).data&&u.data.syncid?u.data.syncid:v+"_"+u.id,u.mode){case"add":h={doexport:!1,syncid:d},JS9.globalOpts.xeqPlugins=!1,this.changeShapes("regions",u.id,{data:h}),JS9.globalOpts.xeqPlugins=m,f=this.listRegions(u.id,{mode:1}),o.addShapes("regions",f,{data:h});break;case"remove":for(l||(l=o.getShapes("regions")),s=0;s<l.length;s++)(c=l[s].data)&&c.syncid&&c.syncid===d&&o.removeShapes("regions",l[s].id);break;case"move":case"update":for(delete u.sizeScale,this.raw.wcsinfo&&o.raw.wcsinfo&&(o.raw.wcsinfo.cdelt1&&(u.sizeScale=this.raw.wcsinfo.cdelt1/o.raw.wcsinfo.cdelt1),o.raw.wcsinfo.crot&&("box"===u.shape||"ellipse"===u.shape||"text"===u.shape&&!u.parent)&&(u.angle+=o.raw.wcsinfo.crot)),l||(l=o.getShapes("regions")),s=0;s<l.length;s++)(c=l[s].data)&&c.syncid&&c.syncid===d&&o.changeShapes("regions",l[s].id,u)}break;case"scale":o.setScale(this.params.scale);break;case"wcssys":o.setWCSSys(this.params.wcssys);break;case"wcsunits":o.setWCSUnits(this.params.wcsunits);break;case"zoom":o.setZoom(this.params.zoom)}}catch(x){}finally{o.syncs&&delete o.syncs.running}}}catch(x){}finally{delete this.syncs.running}var b,y}},JS9.Sync.maybeSync=function(e,t){var i,s,a=[];if(JS9.Sync.ready&&this.syncs&&!this.syncs.running&&this.syncs&&this.syncs.active&&$.isArray(this.syncs[e])&&this.syncs[e].length){for(s=this.syncs[e],i=0;i<s.length;i++)a.push({xim:s[i],xop:e,xarg:t});JS9.Sync.xeqSync.call(this,a)}},JS9.Sync.init=function(){return this},JS9.Sync.setcolormap=function(e){e&&JS9.Sync.maybeSync.call(e,"colormap")},JS9.Sync.changecontrastbias=function(e){e&&JS9.Sync.maybeSync.call(e,"contrastbias")},JS9.Sync.setpan=function(e){e&&JS9.Sync.maybeSync.call(e,"pan")},JS9.Sync.regionschange=function(e,t){e&&JS9.Sync.maybeSync.call(e,"regions",t)},JS9.Sync.setscale=function(e){e&&JS9.Sync.maybeSync.call(e,"scale")},JS9.Sync.setwcssys=function(e){e&&JS9.Sync.maybeSync.call(e,"wcssys")},JS9.Sync.setwcsunits=function(e){e&&JS9.Sync.maybeSync.call(e,"wcsunits")},JS9.Sync.setzoom=function(e){e&&JS9.Sync.maybeSync.call(e,"zoom")},JS9.Sync.closeimage=function(e){var t;if(e)for(t=0;t<JS9.images.length;t++)JS9.Sync.unsync.call(JS9.images[t],null,[e])},JS9.Image.prototype.syncImages=JS9.Sync.sync,JS9.mkPublic("SyncImages","syncImages"),JS9.Image.prototype.unsyncImages=JS9.Sync.unsync,JS9.mkPublic("UnsyncImages","unsyncImages"),JS9.RegisterPlugin(JS9.Sync.CLASS,JS9.Sync.NAME,JS9.Sync.init,{onsetcolormap:JS9.Sync.setcolormap,onsetpan:JS9.Sync.setpan,onregionschange:JS9.Sync.regionschange,onsetscale:JS9.Sync.setscale,onsetwcssys:JS9.Sync.setwcssys,onsetwcsunits:JS9.Sync.setwcsunits,onsetzoom:JS9.Sync.setzoom,onchangecontrastbias:JS9.Sync.changecontrastbias,onimageload:JS9.Sync.loadimage,onimageclose:JS9.Sync.closeimage,winDims:[0,0]}),JS9.Toolbar={},JS9.Toolbar.CLASS="JS9",JS9.Toolbar.NAME="Toolbar",JS9.Toolbar.WIDTH=512,JS9.Toolbar.HEIGHT=36,JS9.Toolbar.BASE=JS9.Toolbar.CLASS+JS9.Toolbar.NAME,JS9.Toolbar.IMAGEWIDTH=24,JS9.Toolbar.IMAGEHEIGHT=24,JS9.Toolbar.TOOLBARHEIGHT=36,JS9.Toolbar.TOOLTIPX=30,JS9.Toolbar.TOOLTIPY=50,JS9.Toolbar.TOOLTIPLX=30,JS9.Toolbar.TOOLTIPLY=82,JS9.Toolbar.tools=[{name:"linear",tip:"linear scale",cmd:"SetScale",args:["linear"]},{name:"log",tip:"log scale",cmd:"SetScale",args:["log"]},{name:"histeq",tip:"histogram equalization",cmd:"SetScale",args:["histeq"]},{name:"power",tip:"power scale",cmd:"SetScale",args:["power"]},{name:"sqrt",tip:"square root scale",cmd:"SetScale",args:["sqrt"]},{name:"asinh",tip:"asinh scale",cmd:"SetScale",args:["asinh"]},{name:"sinh",tip:"sinh scale",cmd:"SetScale",args:["sinh"]},{name:"squared",tip:"squared scale",cmd:"SetScale",args:["squared"]},{name:"annulus",tip:"annulus region",image:"images/toolbar/svg/annulus.svg",cmd:"AddRegions",args:["annulus"]},{name:"box",tip:"box region",image:"images/toolbar/svg/box.svg",cmd:"AddRegions",args:["box"]},{name:"circle",tip:"circle region",image:"images/toolbar/svg/circle.svg",cmd:"AddRegions",args:["circle"]},{name:"ellipse",tip:"ellipse region",image:"images/toolbar/svg/ellipse.svg",cmd:"AddRegions",args:["ellipse"]},{name:"line",tip:"line region",image:"images/toolbar/svg/line.svg",cmd:"AddRegions",args:["line"]},{name:"polygon",tip:"polygon region",image:"images/toolbar/svg/polygon.svg",cmd:"AddRegions",args:["polygon"]},{name:"text",tip:"text region",image:"images/toolbar/svg/txt.svg",cmd:"AddRegions",args:["text"]},{name:"inc/excl",tip:"toggle selected region incl/excl",cmd:"ToggleRegionTags",args:["selected","include","exclude"]},{name:"src/bkg",tip:"toggle selected region src/bkg",cmd:"ToggleRegionTags",args:["selected","source","background"]},{name:"remove",tip:"remove selected region",cmd:"RemoveRegions",args:["selected"]},{name:"zoom+",tip:"zoom in",cmd:"SetZoom",args:["x2"]},{name:"zoom-",tip:"zoom out",cmd:"SetZoom",args:["/2"]},{name:"zoom1",tip:"zoom 1",cmd:"SetZoom",args:[1]},{name:"open",tip:"open local file dialog box",cmd:"OpenFileMenu",args:[]},{name:"infobox",tip:"toggle infobox display",cmd:"DisplayPlugin",args:["JS9Info"]},{name:"magnifier",tip:"toggle magnifier display",cmd:"DisplayPlugin",args:["JS9Magnifier"]},{name:"panner",tip:"toggle panner display",cmd:"DisplayPlugin",args:["JS9Panner"]},{name:"prefs",tip:"toggle preferences display",cmd:"DisplayPlugin",args:["JS9Preferences"]}],JS9.Toolbar.tooltip=function(e,t,i){var s,a,n,r;t?(r=$(i.currentTarget).position(),this.tooltip.html(t),"light"===this.winType?(s=r.left+JS9.Toolbar.TOOLTIPLX,a=r.top-JS9.Toolbar.TOOLTIPLY):(s=r.left+JS9.Toolbar.TOOLTIPX,a=r.top-JS9.Toolbar.TOOLTIPY),s+(n=this.tooltip.width())+20>this.width&&(s=r.left-n-20),this.tooltip.css({left:s,top:a,display:"inline-block"})):this.tooltip.html("").css({left:-9999,display:"none"})},JS9.Toolbar.addTool=function(e){var t,i,s,a=this;return e?"$break"!==e?(e.name&&e.cmd||JS9.error("invalid input to JS9.toolbar: "+JSON.stringify(e)),t=$("<div>").addClass(JS9.Toolbar.BASE+"ButtonDiv").appendTo(this.activeToolbar),e.image?(s=e.image,JS9.inline&&JS9.inline[s]?s=JS9.inline[s]:"/"!==s.charAt(0)&&(s=JS9.InstallDir(s)),i=$("<input>").addClass(JS9.Toolbar.BASE+"ImageButton").attr("type","image").attr("src",s).attr("width",JS9.Toolbar.IMAGEWIDTH).attr("height",JS9.Toolbar.IMAGEHEIGHT).attr("alt",e.name).appendTo(t)):i=$("<input>").addClass(JS9.Toolbar.BASE+"ButtonButton").attr("type","button").attr("value",e.name).appendTo(t),i.on("click",function(){var t,i=a.display;"function"==typeof JS9.publics[e.cmd]?((t=JSON.parse(JSON.stringify(e.args||[]))).push({display:i}),JS9.publics[e.cmd].apply(null,t)):JS9.error("unknown JS9 function for toolbar: "+e.cmd)}),JS9.globalOpts.toolbarTooltips&&(i.on("mouseover",function(t){JS9.Toolbar.tooltip.call(a,e,e.tip||e.name,t)}),i.on("mouseout",function(t){JS9.Toolbar.tooltip.call(a,e,null,t)})),e.btn=i,e):void $("<hr>").appendTo(this.activeToolbar):JS9.Toolbar.tools},JS9.Toolbar.init=function(e,t){var i,s,a,n;for(this.width=this.divjq.attr("data-width"),this.width||(this.width=e||JS9.Toolbar.WIDTH),this.divjq.css("width",this.width),this.width=parseInt(this.divjq.css("width"),10),this.height=this.divjq.attr("data-height"),this.height||(this.height=t||JS9.Toolbar.HEIGHT),this.divjq.css("height",this.height),this.height=parseInt(this.divjq.css("height"),10),this.divjq.html(""),this.toolbarContainer=$("<div>").addClass(JS9.Toolbar.BASE+"Container").attr("id",this.id+"Container").appendTo(this.divjq),this.activeToolbar=$("<div>").addClass(JS9.Toolbar.BASE+"Div").attr("id",this.id+"Toolbar").css("width",this.width).css("height",this.height).css("min-height",JS9.Toolbar.TOOLBARHEIGHT).appendTo(this.toolbarContainer),this.tooltip=$("<div>").attr("id","tooltip_"+this.id).addClass("JS9ToolbarTooltip").appendTo(this.divjq),s=0;s<JS9.globalOpts.toolBar.length;s++)for(n=JS9.globalOpts.toolBar[s],i=0;i<JS9.Toolbar.tools.length;i++)n===(a=JS9.Toolbar.tools[i]).name&&JS9.Toolbar.addTool.call(this,a);for(i=0;i<JS9.Toolbar.tools.length;i++)a=JS9.Toolbar.tools[i],$.inArray(a.name,JS9.globalOpts.toolBar)<0&&JS9.Toolbar.addTool.call(this,a);return JS9.Toolbar.tools},JS9.mkPublic("GetToolbar",function(e){return"showTooltips"===(e=JS9.parsePublicArgs(arguments).argv[0])?JS9.globalOpts.toolbarTooltips:JS9.Toolbar.tools}),JS9.mkPublic("SetToolbar",function(e,t){var i,s=JS9.parsePublicArgs(arguments),a=function(){var e,t;for(e=0;e<JS9.displays.length;e++)(t=JS9.displays[e].pluginInstances.JS9Toolbar)&&JS9.Toolbar.init.call(t)};if(e=s.argv[0]){if("init"!==e){if("showTooltips"===e)return JS9.globalOpts.toolbarTooltips=!!(t=s.argv[1]),void a();if("string"==typeof e){try{e=JSON.parse(e)}catch(n){JS9.error("can't parse json for SetToolBar: "+e,n)}JS9.Toolbar.tools.push(e),a()}else if($.isArray(e)){for(i=0;i<e.length;i++)JS9.Toolbar.tools.push(e[i]);a()}else"object"==typeof e&&(JS9.Toolbar.tools.push(e),a());return null}a()}}),JS9.RegisterPlugin(JS9.Toolbar.CLASS,JS9.Toolbar.NAME,JS9.Toolbar.init,{menuItem:"Toolbar",help:"help/toolbar.html",winTitle:"Toolbar",winDims:[JS9.Toolbar.WIDTH,JS9.Toolbar.HEIGHT]}),require=function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[r]={exports:{}};t[r][0].call(h.exports,function(e){return a(t[r][1][e]||e)},h,h.exports,e,t,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)a(s[r]);return a}({"./imexam":[function(e,t,i){"use strict";var s=e("typed-array-function");(s=(s=s.extend(s,e("typed-array-ops"))).extend(s,e("typed-numeric-uncmin"))).rotate=e("typed-array-rotate"),s.mask=e("./mask.js");var a=e("./template"),n=s;s.zeros=function(e,t){var i,a=1,n=[];for(void 0===t&&(t=Float32Array),i=0;i<e.length;++i)n.push(Math.floor(e[i])),a*=n[i];return s.ndarray(new t(a),n)},s.fill=n(function(e,t){t.apply(void 0,[])}),i.fixupDiv=function(e){if("div"===e.winType){e.outerdivjq.find(".drag-handle").html(e.plugin.opts.winTitle);var t=e.outerdivjq.find(".JS9PluginToolbar-div");t.css("cursor","default"),t.css("right",0)}};var r={};function o(e){switch(e.shape){case"annulus":e.width=2*e.radii[e.radii.length-1],e.height=2*e.radii[e.radii.length-1];break;case"circle":e.width=2*e.radius,e.height=2*e.radius;break;case"ellipse":e.width=2*e.r1,e.height=2*e.r2;break;case"polygon":case"line":var t,i=0,s=0,a=1e6,n=0,o=1e6,l=0;for(t=0;t<e.pts.length;t++)i+=e.pts[t].x,s+=e.pts[t].y,e.pts[t].x>n&&(n=e.pts[t].x),e.pts[t].x<a&&(a=e.pts[t].x),e.pts[t].y>l&&(l=e.pts[t].y),e.pts[t].y<o&&(o=e.pts[t].y);e.x=i/e.pts.length,e.y=s/e.pts.length,"line"===e.shape&&2===e.pts.length?(e.width=Math.sqrt((e.pts[0].x-e.pts[1].x)*(e.pts[0].x-e.pts[1].x)+(e.pts[0].y-e.pts[1].y)*(e.pts[0].y-e.pts[1].y)),e.height=JS9.globalOpts.imexamLineHeight||1,e.angle=Math.atan2(e.pts[1].y-e.pts[0].y,e.pts[1].x-e.pts[0].x),e.angle=180*e.angle/Math.PI):(e.width=n-a,e.height=l-o);break;case"text":e.width=10,e.height=10}return r.mksection(e.x,e.y,e.width,e.height)}s.maxvalue=s.sup,s.minvalue=s.inf,s.size=function(e){var t,i=1;for(t=0;t<e.length;t++)i*=e[t];return i},s.reshape=function(e,t){if(e.size!==s.size(t))throw new Error("sizes not equil "+e.size+" != ",+s.size(t));return s.ndarray(e.data,t)},s.section=function(e,t){var i=t[0][0],s=t[0][1],a=t[1][0],n=t[1][1];return e.lo(a,i).hi(n-a,s-i)},s.print=function(e,t,i){var s,a,n;if(void 0===t&&(t=7),void 0===i&&(i=3),1===e.shape.length){for(n="",s=0;s<e.shape[0];++s)n+=e.get(s).toFixed(i)+" ";console.log(n)}else{for(a=e.shape[0]-1;a>=0;--a){for(n="",s=0;s<e.shape[1];++s)n+=e.get(a,s).toFixed(i)+" ";console.log(n)}console.log("\n")}},s._hist=n(function(e,t,i,s){var a=Math.floor((s-i)/t),n=new Int32Array(a+1);return isNaN(e)||n[0|Math.max(0,Math.min(a,Math.round((e-i)/t)))]++,n}),s.hist=function(e,t,i,a){var n,r={};return void 0===i&&(i=s.minvalue(e)),void 0===a&&(a=s.maxvalue(e)),void 0===t&&(t=Math.max(1,(a-i)/250)),r.raw=e,r.min=i,r.max=a,r.width=t,n=s._hist(e,t,i,a),r.data=s.ndarray(n,[n.length]),r},s.proj=function(e,t){var i,a,n={};n.n=e.shape[1===t?0:1],n.x=e.shape[t],n.sum=[],n.avg=[],n.med=[];var r=s.assign(s.zeros(e.shape),e);for(a=0;a<n.n;a++)i=s.section(r,0===t?[[a,a+1],[0,n.x]]:[[0,n.x],[a,a+1]]),n.sum[a]=s.sum(i),n.avg[a]=s.sum(i)/n.n,n.med[a]=s.median(i);return n},s.qcenter=n(function(e){var t,i=[],s=[],a=Number.MIN_VALUE;i[0]++,i[1]++,s[0]--,s[1]--;var n=+e[-1][-1]+e[-1][0]+e[-1][1]+e[0][-1]+e[0][0]+e[0][1]+e[1][-1]+e[1][0]+e[1][1];return a<n&&(a=n,t=[0,0]),t}),s._imcnts=n({consider:{c:!1}},function(e,t,i){e[i]+=t}),s.imcnts=function(e,t,i){var a={};return a.cnts=s.ndarray(s._imcnts(new Float32Array(i),e,t)),a.area=s.hist(t,1,0,i-1).data,a},s._centroid=n(function(e,t,i){var s=0,a=0,n=0,r=0,o=0;e>0&&0<t*t+i*i&&(s+=e,a+=0*e,r+=0*e*0,n+=0*e,o+=0*e*0);var l={};return l.sum=s,l.cenx=a/s,l.ceny=n/s,l.rmom=(r-a*a/s+o-n*n/s)/s,l.fwhm=l.rmom<=0?-1:2.354*Math.sqrt(l.rmom)/Math.sqrt(2),l}),s.centroid=function(e){return s._centroid(e,e.shape[0],e.shape[1])},s.flatten=function(){var e,t,i,a=0;for(e=0;e<arguments.length;e++)a+=arguments[e].size;var n=s.zeros([a]),r=0;for(t=0;t<arguments.length;t++)s.assign(s.ndarray(n.data,(i=arguments[t]).shape,void 0,r),i),r+=i.size;return n},s.median=function(e){var t=s.assign(s.zeros(e.shape),e);return Array.prototype.sort.call(t.data,function(e,t){return e-t}),t.data[Math.round((t.size-1)/2)]},s.rms=n(function(e){var t=0,i=0;isNaN(e)||(t+=e,i+=e*e);var s=t/e.size;return Math.sqrt((i-2*s*t+e.size*s*s)/(e.size-1))}),s.rmsClipped=n(function(e,t,i){var s=0,a=0,n=0;!isNaN(e)&&(null===t||e>t)&&(null===i||e<i)&&(s++,a+=e,n+=e*e);var r=a/s;return Math.sqrt((n-2*r*a+s*r*r)/(s-1))}),s.meanClipped=n(function(e,t,i){var s=0,a=0;return!isNaN(e)&&(null===t||e>t)&&(null===i||e<i)&&(s++,a+=e),a/s}),r.backgr=function(e,t){var i={},a=s.flatten(s.section(e,[[0,t],[0,e.shape[1]]]),s.section(e,[[e.shape[0]-t,e.shape[0]],[0,e.shape[1]]]),s.section(e,[[t,e.shape[0]-t],[0,t]]),s.section(e,[[t,e.shape[0]-t],[e.shape[1]-t,e.shape[1]]]));return i.noise=s.rms(a),i.value=s.median(a),i},r.mksection=function(e,t,i,s){return[[Math.floor(e-i/2),Math.floor(e+i/2)],[Math.floor(t-s/2),Math.floor(t+s/2)]]},r._rproj=n(function(e,t,i,s,a){var n=new Float32Array(a),r=new Float32Array(a),o=Math.sqrt(s*s),l=0,c=Math.sqrt((0-i)*(0-i)+(0-t)*(0-t));return c<=o&&!isNaN(e)&&(n[l]=c,r[l]=e,l++),{rad:n.subarray(0,l),val:r.subarray(0,l),n:l}}),r.rproj=function(e,t){var i,a,n,o=(e.shape[0]/2+e.shape[1]/2)/2,l=r._rproj(e,t[1],t[0],o,e.size);return i=l.rad,a=l.val,(n=Array.prototype.map.call(i,function(e,t){return[e,t,a[t]]})).sort(function(e,t){return e[0]-t[0]}),n.map(function(e,t){i[t]=e[0],a[t]=e[2]}),{radi:s.ndarray(l.rad,[l.rad.length]),data:s.ndarray(l.val,[l.rad.length]),radius:o}},r._encen=n(function(e,t,i,s){var a,n=new Float32Array(s),r=0,o=0,l=0-t,c=0-i,h=l*l+c*c;for(e>0&&h<s*s&&(n[Math.round(Math.sqrt(h))]+=e,r+=e),a=0;a<s;a++)n[a]=(o+=n[a])/r;return n}),r.encen=function(e,t){var i=Math.floor((e.shape[0]/2+e.shape[1]/2)/2),a=r._encen(e,t[1],t[0],i);return s.ndarray(a,[a.length])},s.indexof=function(e,t){var i;for(i=0;i<e.shape[0]&&!(t<e.get(i));i++);return 0===i?0:i===e.shape[0]?e.shape[0]:i+(t-e.get(i))/(e.get(i)-e.get(i-1))},s.gauss1d=function(e,t){var i=s.zeros(e.shape),a=t[0],n=t[1],r=t[2];return s.fill(i,function(t){var i=e.data[t]-0;return a*Math.pow(2.71828,-i*i/(2*n*n))+r}),i},s.gsfit1d=function(e,t,i){return n.uncmin(function(i){var a=s.gauss1d(e,i);s.sub(a,a,t),s.mul(a,a,a),s.fill(a,function(t){return a.get(t)/(e.get(t)*e.get(t))});var n=s.sum(a);return Math.sqrt(n/e.shape[0])},i,1e-6).solution},i.getRegionData=function(e,t){var i,a=o(t),n=s.ndarray(e.raw.data,[e.raw.height,e.raw.width]);return t.angle&&0!==t.angle?(i=s.zeros([t.height,t.width]),s.rotate(i,n,t.angle/57.29577951,t.y,t.x)):i=s.section(n,a),i},i.convolve1d=n(function(e,t,i){var s,a,n,r=Math.round(e.shape[0]/2);for(s=0;s<t.shape[0];s++)for(a=0;a<e.shape[0];a++)(n=s+a-r)>=0&&n<t.shape[0]&&(i[s]+=e[a]*t[n])}),i.convolve2dSep=function(e,t,i){var s,a,n,r,o,l=t.shape[1],c=t.shape[0],h=e.shape[0],u=Math.floor(h/2);for(a=0;a<c;a++)for(s=0;s<l;s++)for(i[a][s]=0,n=0;n<h;n++)(r=s+n-u)>0&&r<l&&(i[a][s]+=t[a][r]*e[n]);for(s=0;s<l;s++)for(a=0;a<c;a++)for(n=0;n<h;n++)(o=a+n-u)>0&&o<c&&(i[a][s]+=t[a+n][s]*e[n])},i.reg2section=o,i.template=a,i.ndops=s,i.typed=s,i.imops=r},{"./mask.js":1,"./template":12,"typed-array-function":4,"typed-array-ops":5,"typed-array-rotate":8,"typed-numeric-uncmin":10}],1:[function(e,t,i){"use strict";!function(){var t=e("./raster");function s(e,t){var i;for(i=0;i<e.tags.length;i++)if(e.tags[i]===t)return!0;return!1}i.hasTag=s,i.listRegions=function(e){var t,i,s,a=1,n=[];for(t=0;t<e.length;t++)switch((s=e[t]).shape){case"annulus":for(i=0;i<s.radii.length;i++)0!==s.radii[i]&&(n[a-1]=$.extend($.extend({},s),{regno:a++,shape:"circle",radius:s.radii[i]}));break;default:n[a-1]=$.extend({regno:a++},s)}return n},i.drawRegions=function(e,i,a){var n,r,o,l=["include","exclude"];for(r=0;r<2;r++)for(o=e.length-1;o>=0;o--)if(s(n=e[o],l[r]))switch(n.shape){case"polygon":t.drawPolygon(i,a,n.pts,n.regno);break;case"circle":t.drawCircle(i,a,n.x,n.y,n.radius,n.regno);break;case"box":t.drawBox(i,a,n.x,n.y,n.width,n.height,n.angle,n.regno);break;case"ellipse":t.drawEllipse(i,a,n.x,n.y,n.r1,n.r2,n.angle,n.regno)}}}()},{"./raster":11}],2:[function(e,t,i){"use strict";var s=e("iota-array"),a=["concat","join","slice","toString","indexOf","lastIndexOf","forEach","every","some","filter","map","reduce","reduceRight"];function n(e,t){return e[0]-t[0]}function r(){var e,t=this.stride,i=new Array(t.length);for(e=0;e<i.length;++e)i[e]=[Math.abs(t[e]),e];i.sort(n);var s=new Array(i.length);for(e=0;e<s.length;++e)s[e]=i[e][1];return s}function o(e,t){var i=["View",t,"d",e].join("");t<0&&(i="View_Nil"+e);var n="generic"===e;if(-1===t){var o="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(o)()}if(0===t)return o="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}",new Function("TrivialArray",o)(l[e][0]);o=["'use strict'"];var c=s(t),h=c.map(function(e){return"i"+e}),u="this.offset+"+c.map(function(e){return["this._stride",e,"*i",e].join("")}).join("+");o.push("function "+i+"(a,"+c.map(function(e){return"b"+e}).join(",")+","+c.map(function(e){return"c"+e}).join(",")+",d){this.data=a");for(var d=0;d<t;++d)o.push("this._shape"+d+"=b"+d+"|0");for(d=0;d<t;++d)o.push("this._stride"+d+"=c"+d+"|0");o.push("this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+e+"'","proto.dimension="+t);var p={stride:"VStride"+t+"d"+e,shape:"VShape"+t+"d"+e};for(var f in p){var g=p[f];o.push("function "+g+"(v) {this._v=v} var aproto="+g+".prototype","aproto.length="+t);var m=[];for(d=0;d<t;++d)m.push(["this._v._",f,d].join(""));for(o.push("aproto.toJSON=function "+g+"_toJSON(){return ["+m.join(",")+"]}","aproto.valueOf=aproto.toString=function "+g+"_toString(){return ["+m.join(",")+"].join()}"),d=0;d<t;++d)o.push(["Object.defineProperty(aproto,",d,",{get:function(){return this._v._",f,d,"},set:function(v){return this._v._",f,d,"=v|0},enumerable:true})"].join(""));for(d=0;d<a.length;++d)a[d]in Array.prototype&&o.push(["aproto.",a[d],"=Array.prototype.",a[d]].join(""));for(o.push(["Object.defineProperty(proto,'",f,"',{get:function ",g,"_get(){return new ",g,"(this)},set: function ",g,"_set(v){"].join("")),d=0;d<t;++d)o.push(["this._",f,d,"=v[",d,"]|0"].join(""));o.push("return v}})")}o.push(["Object.defineProperty(proto,'size',{get:function ",i,"_size(){return ",c.map(function(e){return["this._shape",e].join("")}).join("*"),"}})"].join("")),1===t?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),t<4?(o.push(["function ",i,"_order(){"].join("")),2===t?o.push("return (Math.abs(this._stride0)>Math.abs(this._stride1))?[1,0]:[0,1]}})"):3===t&&o.push("var s0=Math.abs(this._stride0),s1=Math.abs(this._stride1),s2=Math.abs(this._stride2);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push(["proto.set=function ",i,"_set(",h.join(","),",v){"].join("")),o.push(n?["return this.data.set(",u,",v)}"].join(""):["return this.data[",u,"]=v}"].join("")),o.push(["proto.get=function ",i,"_get(",h.join(","),"){"].join("")),o.push(n?["return this.data.get(",u,")}"].join(""):["return this.data[",u,"]}"].join("")),o.push(["proto.index=function ",i,"_index(",h.join(),"){return ",u,"}"].join("")),o.push(["proto.hi=function ",i,"_hi(",h.join(","),"){return new ",i,"(this.data,",c.map(function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this._shape",e,":i",e,"|0"].join("")}).join(","),",",c.map(function(e){return"this._stride"+e}).join(","),",this.offset)}"].join(""));var v=c.map(function(e){return"a"+e+"=this._shape"+e}),b=c.map(function(e){return"c"+e+"=this._stride"+e});for(o.push(["proto.lo=function ",i,"_lo(",h.join(","),"){var b=this.offset,d=0,",v.join(","),",",b.join(",")].join("")),d=0;d<t;++d)o.push(["if(typeof i",d,"==='number'&&i",d,">=0){d=i",d,"|0;b+=c",d,"*d;a",d,"-=d}"].join(""));for(o.push(["return new ",i,"(this.data,",c.map(function(e){return"a"+e}).join(","),",",c.map(function(e){return"c"+e}).join(","),",b)}"].join("")),o.push(["proto.step=function ",i,"_step(",h.join(","),"){var ",c.map(function(e){return"a"+e+"=this._shape"+e}).join(","),",",c.map(function(e){return"b"+e+"=this._stride"+e}).join(","),",c=this.offset,d=0,ceil=Math.ceil"].join("")),d=0;d<t;++d)o.push(["if(typeof i",d,"==='number'){d=i",d,"|0;if(d<0){c+=b",d,"*(a",d,"-1);a",d,"=ceil(-a",d,"/d)}else{a",d,"=ceil(a",d,"/d)}b",d,"*=d}"].join(""));o.push(["return new ",i,"(this.data,",c.map(function(e){return"a"+e}).join(","),",",c.map(function(e){return"b"+e}).join(","),",c)}"].join(""));var y=new Array(t),x=new Array(t);for(d=0;d<t;++d)y[d]=["a[i",d,"]"].join(""),x[d]=["b[i",d,"]"].join("");for(o.push(["proto.transpose=function ",i,"_transpose(",h,"){",h.map(function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"}).join(";"),";var a=this.shape,b=this.stride;return new ",i,"(this.data,",y.join(","),",",x.join(","),",this.offset)}"].join("")),o.push(["proto.pick=function ",i,"_pick(",h,"){var a=[],b=[],c=this.offset"].join("")),d=0;d<t;++d)o.push(["if(typeof i",d,"==='number'&&i",d,">=0){c=(c+this._stride",d,"*i",d,")|0}else{a.push(this._shape",d,");b.push(this._stride",d,")}"].join(""));return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push(["return function construct_",i,"(data,shape,stride,offset){return new ",i,"(data,",c.map(function(e){return"shape["+e+"]"}).join(","),",",c.map(function(e){return"stride["+e+"]"}).join(","),",offset)}"].join("")),new Function("CTOR_LIST","ORDER",o.join("\n"))(l[e],r)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],generic:[]};t.exports=function(e,t,i,s){if(void 0===e)return(0,l.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var a=t.length;if(void 0===i){i=new Array(a);for(var n=a-1,r=1;n>=0;--n)i[n]=r,r*=t[n]}if(void 0===s)for(s=0,n=0;n<a;++n)i[n]<0&&(s-=(t[n]-1)*i[n]);for(var c=function(e){return e instanceof Float64Array?"float64":e instanceof Float32Array?"float32":e instanceof Int32Array?"int32":e instanceof Uint32Array?"uint32":e instanceof Uint8Array?"uint8":e instanceof Uint16Array?"uint16":e instanceof Int16Array?"int16":e instanceof Int8Array?"int8":e instanceof Uint8ClampedArray?"uint8_clamped":e instanceof Array?"array":"generic"}(e),h=l[c];h.length<=a+1;)h.push(o(c,h.length-1));return(0,h[a+1])(e,t,i,s)}},{"iota-array":3}],3:[function(e,t,i){"use strict";t.exports=function(e){for(var t=new Array(e),i=0;i<e;++i)t[i]=i;return t}},{}],4:[function(e,t,i){"use strict";!function(){var i=e("ndarray-nobuffer"),s={int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,float32:Float32Array,float64:Float64Array};function a(e){if(e.shape)return e.shape;for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t}function n(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0);var s,a=e[i],r=[];if(i===e.length-1){for(s=a-2;s>=0;s-=2)r[s+1]=t,r[s]=t;return-1===s&&(r[0]=t),r}for(s=a-1;s>=0;s--)r[s]=n(e,t,i+1);return r}function r(){var e,t,i,s,r,l=arguments,c={};if(void 0===this.cache){s="string"==typeof this.func?this.func:this.func.toString(),this.text=s;var h=s.match(/function [A-Za-z0-9_]*\(([^()]*)\)[^{]*\{([\S\s]*)\}[\S\s]*/);i=h[1].split(",").map(function(e){return e.trim()}),this.args=i,this.prep="",this.post="",(r=h[2].split(/\/\/ ----+/)).length>1?(this.prep=r[0],this.post=r[2],this.body=r[1]):this.body=r[0],""!==this.post&&void 0!==this.post||(this.post="\nreturn "+i[0]+";")}i=this.args,s=this.text;var u=this.opts;void 0===u&&(u={});var d,p="",f=0;for(e=0;e<i.length;e++)null!=l[e]&&"object"==typeof l[e]&&(void 0===u.consider||"object"==typeof u.consider&&!1!==u.consider[i[e]])?(c[i[e]]=l[e],l[e].shape||(l[e].shape=a(l[e])),f=Math.max(l[e].shape.length,f),p+=l[e].data?" "+l[e].dtype+" "+l[e].offset+"  "+l[e].stride:" O"):p+=" X";if(p=f+p,this.cache&&(d=this.cache[p]))return d;var g=this.prep,m=this.post,v=[],b=["iW","iV","iU","iZ","iY","iX"],y=!1;r=function t(i){return function(e,t){for(var i,s,a,n,r="",o=-1,l=0;l<e.length&&(i=e.match(/[a-zA-Z_][a-zA-Z0-9_]*/));){for(r+=e.substr(l,i.index),s=[],l=i.index+i[0].length,n=!0;n&&l<e.length;){for(;" "===e[l];)l++;switch(e[l]){case"[":for(o=1,a=l+1,l++;o;)"]"===e[l]&&(1===o&&s.push(e.substring(a,l)),o--),"["===e[l]&&o++,l++;break;case".":for(a=l,l++;" "===e[l];)l++;for(;null!==e[l].match(/[ a-zA-Z0-9_]/);)l++;s.push(e.substring(a,l));break;default:n=!1}}r+=t(i[0],s),e=e.substr(l),l=0}return r+e.substr(l)}(i,function(i,s){var a,n,r;for("index"===i&&(y=!0),a=0;a<s.length;a++)s[a]=t(s[a]);var o,l,h,d,p=c[i];if(void 0!==p&&"object"==typeof p)if(s.length>=1&&".length"===s[s.length-1].trim()&&(s[0]=".shape",s[1]=s.length-1,s.length=2),s.length>=1&&"."===s[0][0])r=s.length>=2&&".shape"===s[0].trim()?p.data?i+".shape["+s[1]+"]":i+function(e,t){if(t<1)return"";for(var i="";t>0;)1&t&&(i+=e),t>>=1,e+=e;return i}("[0]",s[1])+".length":i+s[0].trim();else{p.data?(o=p.dimension,0!==s.length&&s.length<p.dimension?(i+=".data.subarray",h="()",d=s.length):(i+=".data",h="[]",d=p.dimension),l=" + "):(o=p.shape.length,l="][",n="",h="[]");var f=b.slice(6-o);if(!(void 0!==u.loops&&!0!==u.loops||0!==s.length&&o!==s.length))for(e=0;e<o;e++)void 0===s[e]&&(s[e]=f[e]),void 0===v[e]&&(v[e]=0),v[e]=Math.max(v[e],p.shape[e]);if(p.data){for(e=0;e<d;e++)1!==p.stride[e]&&(s[e]="("+s[e]+")*"+p.stride[e]);n=0!==p.offset?p.offset+" + ":""}r=s.length?i+h[0]+n+s.join(l)+h[1]+" ":i}else{for(r=i,e=0;e<s.length;e++)r+="."===s[e][0]?s[e].trim():"["+s[e].trim()+"]";r+=" "}return r})}(r=this.body);var x=b.slice(6-v.length),w=b.slice(6-v.length).reverse();v.reverse();var S="\n",C="\n",A="",_="";if(void 0===u.loops||!0===u.loops){for(S+="\tvar index = ["+n([v.length],0).join(",")+"];\n",S+="\tvar start = ["+n([v.length],0).join(",")+"];\n",S+="\tvar   end = ["+n([v.length],0).join(",")+"];\n\n",e=0;e<v.length;e++)for(t=0;t<i.length;t++)if(c[i[t]]&&void 0!==l[t]&&"object"==typeof l[t]){S+="\tend["+e+"] = "+i[t]+".shape["+e+"];\n";break}for(S+="\n",e=0;e<v.length;e++)C+="\tvar "+x[e]+"start = start["+e+"];\n",C+="\tvar   "+x[e]+"end =   end["+e+"];\n";for(C+="\n",e=0;e<v.length;e++)y&&(A="index["+(v.length-e-1)+"] = 0;\n",_="\tindex["+(v.length-e-1)+"]++\n"),r=A+"for ( var "+w[e]+" = "+w[e]+"start; "+w[e]+" < "+w[e]+"end; "+w[e]+"++ ) {\n\t"+r+"\n"+_+"\n    }"}return d="// Array optimized funciton\n",d+="// "+p+"\n",d+="return function ("+i.join(",")+") {\n'use strict';\n\n"+S+g+C+r+m+"\n}",o.debug&&console.log(d),void 0===this.cache&&(this.cache={}),d=new Function(d)(),this.cache[p]=d,d}function o(e,t){void 0===t&&(t=e,e=void 0);var i={func:t,opts:e},s=(function(){return r.apply(this,arguments).apply(o,arguments)}).bind(i);return s.baked=r.bind(i),s}var l=o(function(e){return 1*e});t.exports=o,t.exports.ndarray=i,t.exports.section=function(e,t){var i=t[0][0],s=t[0][1],a=t[1][0],n=t[1][1];return e.lo(a,i).hi(n-a,s-i)},t.exports.extend=function(e){var t,i;for(t=1;t<arguments.length;t++)for(i in arguments[t])arguments[t].hasOwnProperty(i)&&(e[i]=arguments[t][i]);return e},t.exports.array=function(e,t,a){var r,o,c;if("number"!=typeof a&&(a=0),t&&t.dtype&&(t=t.dtype),"string"==typeof t&&(t=s[t]),"function"==typeof t)for(c=l(e),r=i(new t(c),e),o=0;o<c;o++)r.data[o]=a;else r=n(e,a);return r.shape=e,r},t.exports.clone=function(e){return o.assign(o.array(o.dim(e),e),e)},t.exports.print=function(e,t,i){var s,a,n;if(void 0===t&&(t=7),void 0===i&&(i=3),1===e.shape.length){for(n="",s=0;s<e.shape[0];++s)n+=e.get(s).toFixed(i)+" ";console.log(n)}else{for(a=e.shape[0]-1;a>=0;--a){for(n="",s=0;s<e.shape[1];++s)n+=e.get(a,s).toFixed(i)+" ";console.log(n)}console.log("\n")}},t.exports.iota=function(e,t){void 0===t&&(t=e,e=0);var i,s=[];for(i=0;i<t;i++)s[i]=e,e+=1;return s},t.exports.rep=n,t.exports.dim=a,t.exports.epsilon=2.220446049250313e-16}()},{"ndarray-nobuffer":2}],5:[function(e,t,i){"use strict";!function(){var i,s,a,n=e("typed-array-function"),r={};function o(e){var t,i;return function(s,a,r){return void 0===r&&(t=n.dim(s),i=n.dim(a),r=a,s=n.array(t.length>i.length?t:i,a=s)),e(s,a,r)}}function l(e){return function(t,i){return void 0===i&&(t=n.array(n.dim(i=t),i)),e(t,i)}}function c(e){return function(t,i,s){return void 0===s?o(e.baked(t,i,s)):e.baked(t,i,s)}}function h(e){return function(t,i){return void 0===i?l(e.baked(t,i)):e.baked(t,i)}}t.exports=r;var u={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};for(s in u)u.hasOwnProperty(s)&&(r[s+"3"]=n("function (a, b, c)    {            a = b "+(a=u[s])+" c; }"),r[s+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = b "+a+" c; } }"),r[s+"eq"]=n("function (a, b   )    {            a "+a+"= b;    }  "),r[s+"eq_mask"]=n("function (a, b   , m) { if ( m ) { a "+a+"= b;    } }"),r[s]=o(r[s+"3"]),r[s].baked=c(r[s+"3"]),r[s+"s"]=r[s],r[s+"seq"]=r[s+"eq"]);var d={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};for(s in d)d.hasOwnProperty(s)&&(r[s+"3"]=n("function (a, b, c)    {            a = b "+(a=d[s])+" c; }"),r[s+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = b "+a+" c; } }"),r[s+"eq"]=n("function (a, b   )    {            a = a "+a+" b; }  "),r[s+"eq_mask"]=n("function (a, b   , m) { if ( m ) { a = a "+a+" b; } }"),r[s]=o(r[s+"3"]),r[s].baked=c(r[s+"3"]),r[s+"s"]=r[s],r[s+"seq"]=r[s+"eq"]);var p={not:"!",bnot:"~",neg:"-",recip:"1.0/"};for(s in p)p.hasOwnProperty(s)&&(r[s+"2"]=n("function (a, b   )    {            a = "+(a=p[s])+" b; }"),r[s+"_mask"]=n("function (a, b   , m) { if ( m ) { a = "+a+" b; } }"),r[s+"eq"]=n("function (a      )    {            a = "+a+" a; }"),r[s+"eq_mask"]=n("function (a      , m) { if ( m ) { a = "+a+" a; } }"),r[s]=l(r[s+"2"]),r[s].baked=h(r[s+"2"]));var f=["Math.abs","Math.exp","Math.floor","Math.log","Math.round","Math.sqrt","Math.acos","Math.asin","Math.atan","Math.ceil","Math.cos","Math.sin","Math.tan","isFinite","isNaN"];for(i=0;i<f.length;i++)s=(a=f[i]).split("."),r[(s=2==s.length?s[1]:s[0])+"2"]=n("function (a, b   )    {            a = "+a+"(b); }"),r[s+"_mask"]=n("function (a, b   , m) { if ( m ) { a = "+a+"(b); } }"),r[s+"eq"]=n("function (a      )    {            a = "+a+"(a); }"),r[s+"eq_mask"]=n("function (a      , m) { if ( m ) { a = "+a+"(a); } }"),r[s]=l(r[s+"2"]),r[s].baked=h(r[s+"2"]);var g=["max","min"];for(i=0;i<g.length;i++)s=a=g[i],r[s+"3"]=n("function (a, b, c)    {            a = Math."+a+"(b, c); }"),r[s+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = Math."+a+"(b, c); } }"),r[s]=o(r[s+"3"]),r[s].baked=c(r[s+"3"]),r[s+"s"]=r[s],r[s+"seq"]=r[s];var m=["atan2","pow"];for(i=0;i<m.length;i++)s=a=m[i],r[s+"3"]=n("function (a, b, c)    {            a = Math."+a+"(b, c); }"),r[s+"_mask"]=n("function (a, b, c, m) { if ( m ) { a = Math."+a+"(b, c); } }"),r[s]=o(r[s+"3"]),r[s].baked=c(r[s+"3"]),r[s+"s"]=r[s],r[s+"seq"]=r[s];r.assign=n(function(e,t){}),r.equals=n(function(e,t){if(e!==t)return!1}),r.any=n(function(e){if(e)return!0}),r.all=n(function(e){if(!e)return!1}),r.random=n(function(e){Math.random()}),r.sum=n(function(e){return 0+e}),r.prod=n(function(e){return 1*e}),r.inf=n(function(e){var t=1/0;return e<t&&(t=e),t}),r.sup=n(function(e){var t=-1/0;return e>t&&(t=e),t}),r.norm2Squared=n(function(e){return 0+e*e}),r.norm2=function(e){return Math.sqrt(r.norm2Squared(e))}}()},{"typed-array-function":4}],6:[function(e,t,i){"use strict";function s(e,t){var i=Math.floor(t),s=t-i,a=0<=i+1&&i+1<e.shape[0];return(1-s)*(0<=i&&i<e.shape[0]?+e.get(i):0)+s*(a?+e.get(i+1):0)}function a(e,t,i){var s=Math.floor(t),a=t-s,n=0<=s&&s<e.shape[0],r=0<=s+1&&s+1<e.shape[0],o=Math.floor(i),l=i-o,c=0<=o&&o<e.shape[1],h=0<=o+1&&o+1<e.shape[1],u=n&&c?e.get(s,o):0,d=n&&h?e.get(s,o+1):0;return(1-l)*((1-a)*u+a*(r&&c?e.get(s+1,o):0))+l*((1-a)*d+a*(r&&h?e.get(s+1,o+1):0))}function n(e,t,i,s){var a=Math.floor(t),n=t-a,r=0<=a&&a<e.shape[0],o=0<=a+1&&a+1<e.shape[0],l=Math.floor(i),c=i-l,h=0<=l&&l<e.shape[1],u=0<=l+1&&l+1<e.shape[1],d=Math.floor(s),p=s-d,f=0<=d&&d<e.shape[2],g=0<=d+1&&d+1<e.shape[2],m=r&&h&&f?e.get(a,l,d):0,v=r&&u&&f?e.get(a,l+1,d):0,b=o&&h&&f?e.get(a+1,l,d):0,y=o&&u&&f?e.get(a+1,l+1,d):0,x=r&&h&&g?e.get(a,l,d+1):0,w=r&&u&&g?e.get(a,l+1,d+1):0;return(1-p)*((1-c)*((1-n)*m+n*b)+c*((1-n)*v+n*y))+p*((1-c)*((1-n)*x+n*(o&&h&&g?e.get(a+1,l,d+1):0))+c*((1-n)*w+n*(o&&u&&g?e.get(a+1,l+1,d+1):0)))}t.exports=function(e,t,i,r){switch(e.shape.length){case 0:return 0;case 1:return s(e,t);case 2:return a(e,t,i);case 3:return n(e,t,i,r);default:return(function(e){var t,i,s=0|e.shape.length,a=new Array(s),n=new Array(s),r=new Array(s),o=new Array(s);for(t=0;t<s;++t)i=+arguments[t+1],a[t]=Math.floor(i),n[t]=i-a[t],r[t]=0<=a[t]&&a[t]<e.shape[t],o[t]=0<=a[t]+1&&a[t]+1<e.shape[t];var l,c,h,u=0;e:for(t=0;t<1<<s;++t){for(c=1,h=e.offset,l=0;l<s;++l)if(t&1<<l){if(!o[l])continue e;c*=n[l],h+=e.stride[l]*(a[l]+1)}else{if(!r[l])continue e;c*=1-n[l],h+=e.stride[l]*a[l]}u+=c*e.data[h]}return u}).apply(void 0,arguments)}},t.exports.d1=s,t.exports.d2=a,t.exports.d3=n},{}],7:[function(e,t,i){"use strict";var s=e("ndarray-linear-interpolate"),a=e("typed-array-function"),n=a(function(e,t,i){var s=e.shape.slice(0);t(s,[0,0,0]),e=i.apply(void 0,s)}),r=a(function(e,t,i,s){var a=[0],n=s;t(a,[0]),i(n,a[0])}),o=a(function(e,t,i,s){var a=[0,0],n=s;t(a,[0,0]),i(n,a[0],a[1])}),l=a(function(e,t,i,s){var a=[0,0,0],n=s;t(a,[0,0,0]),i(n,a[0],a[1],a[2])});t.exports=function(e,t,i){switch(t.shape.length){case 1:r(e,i,s.d1,t);break;case 2:o(e,i,s.d2,t);break;case 3:l(e,i,s.d3,t);break;default:n(e,i,s.bind(void 0,t))}return e}},{"ndarray-linear-interpolate":6,"typed-array-function":4}],8:[function(e,t,i){"use strict";var s=e("typed-array-warp");t.exports=function(e,t,i,a,n,r,o){var l=Math.cos(i),c=Math.sin(-i),h=(a=a||t.shape[0]/2)-l*(r=r||e.shape[0]/2)+c*(o=o||e.shape[1]/2),u=(n=n||t.shape[1]/2)-c*r-l*o;return s(e,t,function(e,t){e[0]=l*t[0]-c*t[1]+h,e[1]=c*t[0]+l*t[1]+u}),e}},{"typed-array-warp":7}],9:[function(e,t,i){"use strict";var s=e("typed-array-function"),a=s;s.dot=function(e,t){var i=a.dim,s=i(e),n=i(t);switch(1e3*i(e).length+i(t).length){case 2002:return a.dotMM(a.array([s[0],n[1]],e.dtype),e,t);case 2001:return a.dotMV(e,t);case 1002:return a.dotVM(e,t);case 1001:return a.dotVV(e,t);case 1e3:return a.mulVS(e,t);case 1:return a.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},a.dotVV=function(e,t){var i,s,a=e.length,n=e[a-1]*t[a-1];for(i=a-2;i>=1;i-=2)n+=e[i]*t[i]+e[s=i-1]*t[s];return 0===i&&(n+=e[0]*t[0]),n},a.dotMV=function(e,t){var i,s=e.length,a=this.array([s],e.dtype),n=this.dotVV;for(i=s-1;i>=0;i--)a[i]=n(e[i],t);return a},a.dotVM=function(e,t){var i,s,n,r,o,l,c;for(n=e.length,o=a.array([r=t[0].length],e.dtype),s=r-1;s>=0;s--){for(l=e[n-1]*t[n-1][s],i=n-2;i>=1;i-=2)l+=e[i]*t[i][s]+e[c=i-1]*t[c][s];0===i&&(l+=e[0]*t[0][s]),o[s]=l}return o},a.dotMM=function(e,t,i){var s,a,n,r,o,l,c,h=e.shape[1],u=i.length;for(s=t.length-1;s>=0;s--)for(r=e[s],o=t[s],n=h-1;n>=0;n--){for(l=o[u-1]*i[u-1][n],a=u-2;a>=1;a-=2)l+=o[a]*i[a][n]+o[c=a-1]*i[c][n];0===a&&(l+=o[0]*i[0][n]),r[n]=l}},a.diag=function(e){var t,i,s,a,n=e.length,r=this.array([n,n],e.dtype);for(t=n-1;t>=0;t--){for(a=r[t],i=t+2,s=n-1;s>=i;s-=2)a[s]=0,a[s-1]=0;for(s>t&&(a[s]=0),a[t]=e[t],s=t-1;s>=1;s-=2)a[s]=0,a[s-1]=0;0===s&&(a[0]=0)}return r},a.identity=function(e,t){return this.diag(this.array([e],t,1))},a.tensorXX=function(e,t,i){var s,a,n,r,o=i.length;for(a=t.length-1;a>=0;a--){for(s=e[a],r=t[a],n=o-1;n>=3;--n)s[n]=r*i[n],s[--n]=r*i[n],s[--n]=r*i[n],s[--n]=r*i[n];for(;n>=0;)s[n]=r*i[n],--n}},a.tensorXX=s({loops:!1},a.tensorXX),a.tensor=function(e,t){if("number"==typeof e||"number"==typeof t)return a.mul(e,t);var i=a.dim(e),s=a.dim(t);if(1!==i.length||1!==s.length)throw new Error("numeric: tensor product is only defined for vectors");return a.tensorXX(a.array([i[0],s[0]],e.dtype),e,t)},a.dotVV=s({loops:!1},a.dotVV),a.dotVM=s({loops:!1},a.dotVM),a.dotMV=s({loops:!1},a.dotMV),a.dotMM=s({loops:!1},a.dotMM),a.diag=s({loops:!1},a.diag)},{"typed-array-function":4}],10:[function(e,t,i){var s=e("typed-array-function");s=(s=s.extend(s,e("typed-array-ops"))).extend(s,e("typed-matrix-ops")),i.gradient=function(e,t){var i=t.length,a=e(t);if(isNaN(a))throw new Error("gradient: f(x) is a NaN!");var n,r,o,l,c,h,u,d,p,f=s.clone(t),g=Array(i),m=Math.max,v=Math.abs,b=Math.min,y=0;for(n=0;n<i;n++)for(var x=m(1e-6*a,1e-8);;){if(++y>20)throw new Error("Numerical gradient fails");if(f[n]=t[n]+x,r=e(f),f[n]=t[n]-x,o=e(f),f[n]=t[n],isNaN(r)||isNaN(o))x/=16;else{if(g[n]=(r-o)/(2*x),l=t[n]-x,c=t[n],h=t[n]+x,u=(r-a)/x,d=(a-o)/x,p=m(v(g[n]),v(a),v(r),v(o),v(l),v(c),v(h),1e-8),!(b(m(v(u-g[n]),v(d-g[n]),v(u-d))/p,x/p)>.001))break;x/=16}}return g},i.uncmin=function(e,t,a,n,r,o,l){var c=i.gradient;void 0===l&&(l={}),void 0===a&&(a=1e-8),void 0===n&&(n=function(t){return c(e,t)}),void 0===r&&(r=1e3);var h,u,d=(t=s.clone(t)).length,p=e(t);if(isNaN(p))throw new Error("uncmin: f(x0) is a NaN!");var f=Math.max,g=s.norm2;a=f(a,s.epsilon);var m,v,b,y,x,w,S,C,A,_,k=l.Hinv||s.identity(d),T=s.dot,I=s.sub,M=s.add,O=s.tensor,P=s.div,D=s.mul,J=s.all,E=s.isFinite,L=s.neg,j=0,F="";for(v=n(t);j<r;){if("function"==typeof o&&o(j,t,p,v,k)){F="Callback returned true";break}if(!J(E(v))){F="Gradient has Infinity or NaN";break}if(!J(E(m=L(T(k,v))))){F="Search direction has Infinity or NaN";break}if((_=g(m))<a){F="Newton step smaller than tol";break}for(A=1,u=T(v,m),x=t;j<r&&!(A*_<a)&&(x=M(t,y=D(m,A)),(h=e(x))-p>=.1*A*u||isNaN(h));)A*=.5,++j;if(A*_<a){F="Line search step size smaller than tol";break}if(j===r){F="maxit reached during line search";break}C=T(w=I(b=n(x),v),y),S=T(k,w),k=I(M(k,D((C+T(w,S))/(C*C),O(y,y))),P(M(O(S,y),O(y,S)),C)),t=x,p=h,v=b,++j}return{solution:t,f:p,gradient:v,invHessian:k,iterations:j,message:F}}},{"typed-array-function":4,"typed-array-ops":5,"typed-matrix-ops":9}],11:[function(e,t,i){"use strict";!function(){function e(e,t,i,s,a,n,r){i<0&&(i=0),s>t&&(s=t);var o,l=i+a*t;switch(r){case void 0:case"set":for(o=i;o<s;o++)e[l++]=n;break;case"add":for(o=i;o<s;o++)e[l++]+=n}}function t(e,t,i,s,a,n){var r,o,l;t>s&&(o=t,t=s,s=o,r=e,e=i,i=r),t=Math.floor(t)+1,r=e;var c=(i-e)/((s=Math.floor(s))-t),h=Math.round(t-a);for(o=t;o<=s;o++)l=Math.floor(r)+1,n[h].minx>l&&(n[h].minx=l),n[h].maxx<l&&(n[h].maxx=l),r+=c,h++}function s(i,s,a,n,r){var o,l=a[0].y-1,c=a[0].y-1;for(o=1;o<a.length;o++)a[o].y-1<l&&(l=a[o].y-1),a[o].y-1>c&&(c=a[o].y-1);var h=c-l,u=[];for(o=0;o<=h+1;o++)u.push({minx:1e6,maxx:-1e6});for(o=0;o<a.length-1;o++)t(a[o].x-1,a[o].y-1,a[o+1].x-1,a[o+1].y-1,l,u);for(t(a[o].x-1,a[o].y-1,a[0].x-1,a[0].y-1,l,u),o=0;o<u.length;o++)e(i,s,Math.floor(u[o].minx),Math.floor(u[o].maxx),Math.floor(o+l),n,r)}function a(e,t,i){var s,a=[];t*=Math.PI/180;var n=Math.sin(t),r=Math.cos(t);for(s=0;s<e.length;s++)a.push({x:i.x+((e[s].x-i.x)*r-(e[s].y-i.y)*n),y:i.y+((e[s].x-i.x)*n+(e[s].y-i.y)*r)});return a}function n(e,t,i,s){var a,n,r,o=[];for(r=0;r<2*Math.PI;r+=.01)a=e+i*Math.cos(r),n=t+s*Math.sin(r),o.push({x:a,y:n});return o}i.drawPolygon=function(e,t,i,a,n){s(e,t,i,a,n)},i.drawCircle=function(e,t,i,a,r,o,l){s(e,t,n(i,a,r,r),o,l)},i.drawEllipse=function(e,t,i,r,o,l,c,h,u){s(e,t,a(n(i,r,o,l),c,{x:i,y:r}),h,u)},i.drawBox=function(e,t,i,n,r,o,l,c,h){s(e,t,a(function(e,t,i,s){return[{x:e-i/2,y:t-s/2},{x:e-i/2,y:t+s/2},{x:e+i/2,y:t+s/2},{x:e+i/2,y:t-s/2}]}(i,n,r,o),l,{x:i,y:n}),c,h)}}()},{}],12:[function(e,t,i){"use strict";function s(e,t){var i,s="";for(i=0;i<t;i++)s+=e;return s}t.exports=function(e,t){return e.replace(/\{([a-zA-Z0-9_.%]*)\}/g,function(e,i){var a,n,r,o,l,c=t;for(o=(i=i.split("%")).length<=1?"%s":i[1],i=(i=i[0]).split("."),l=0;l<i.length;l++){if(!c.hasOwnProperty(i[l]))return"";c=c[i[l]]}switch(a=o.substring(o.length-1),r=0|(n=(n=o.substring(0,o.length-1)).split("."))[0],n=0|n[1],a){case"s":c=c.toString();break;case"f":c=c.toFixed(n);break;case"d":c=c.toFixed(0)}return 0!==r&&r>c.length&&(r>0?c=s(" ",r-c.length)+c:c+=s(" ",r-c.length)),c})}},{}]},{},[]),function(){var e=require("./imexam");JS9.RegisterPlugin("ImExam","EncEnergy",function(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see encircled energy<br>")},{menu:"analysis",menuItem:"Encircled Energy",winTitle:"Encircled Energy",help:"imexam/imexam.html#enener",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function(t,i){var s=this.div,a=e.getRegionData(t,i),n=e.imops.backgr(a,4).value,r=e.ndops.assign(e.ndops.zeros(a.shape),a);e.ndops.subs(r,a,n);var o=e.ndops.qcenter(r),l=e.ndops.centroid(r,o),c=e.imops.encen(r,[l.ceny,l.cenx]),h={};h.ee80=e.ndops.indexof(c,.8),h.ee50=e.ndops.indexof(c,.5);var u,d=[];for(u=0;u<c.shape[0];u++)d[u]=[u,c.get(u)];$(s).empty(),$.plot(s,[d],{selection:{mode:"xy"}}),$(s).append(e.template(" \t\t\t\t\t\t    \t<div style='position:absolute;right: 10px;bottom:50px'>\t\t        <table>\t\t\t\t\t\t\t\t\t    <tr><td>ee50</td><td align=right>{ee50%.2f}</td><tr>\t\t    <tr><td>ee80</td><td align=right>{ee80%.2f}</td><tr>\t        </table>\t\t\t\t\t\t\t\t</div>",h))},winDims:[250,250]})}(),function(){var e=require("./imexam");function t(e,t,i){var s,a=new RegExp(i,"g"),n="";for(s=0;s<t;s++)n+=e.replace(a,s);return n}JS9.RegisterPlugin("ImExam","PxTabl",function(){var i;e.fixupDiv(this),$(this.div).html("<form class=pxtabl>"+(i="<table cellpadding=0 cellspacing=0>",i+=t("<tr>"+t("<td ><input class='col%x row%y' type=entry size=6 name=cell%y.%x value=0></td>",10,"%x")+"</tr>\n",10,"%y"),i+="</table>")+"</form>"),$(this.div).find(".row5").css("background","lightblue"),$(this.div).find(".col5").css("background","lightblue"),$(this.div).find(":input").css("font-size","11")},{menu:"view",menuItem:"Pixel Table",winTitle:"Pixel Table",winResize:!0,toolbarSeparate:!0,onmousemove:function(t,i){var s,a,n=e.ndops.ndarray(t.raw.data,[t.raw.height,t.raw.width]),r=0,o=0,l=$(this.div).find(".pxtabl")[0];for(l["cell"+o+"."+r].value="col\\row",o=0,r=1;r<10;r++)l["cell"+o+"."+r].value=(s=i.x+r-5)>0&&s<=t.raw.width?s.toFixed(0):"";for(r=0,o=1;o<10;o++)l["cell"+(10-o)+"."+r].value=(a=i.y+o-5)>0&&a<=t.raw.height?a.toFixed(0):"";for(o=1;o<10;o++)for(r=1;r<10;r++)a=i.y+o-5-.5|0,l["cell"+(10-o)+"."+r].value=(s=i.x+r-5-.5|0)>=0&&s<t.raw.width&&a>=0&&a<t.raw.height?n.get(a,s).toPrecision(4):""},winDims:[625,240]})}(),function(){var e=require("./imexam");JS9.RegisterPlugin("ImExam","RadialProj",function(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see radial projection<br>")},{menu:"analysis",menuItem:"Radial Proj",winTitle:"Radial Proj",help:"imexam/imexam.html#r_proj",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function(t,i){var s=this.div,a=e.getRegionData(t,i),n=e.ndops.maxvalue(a),r=e.imops.backgr(a,4).value,o=e.ndops.assign(e.ndops.zeros(a.shape),a);e.ndops.subs(o,a,r);var l,c=e.ndops.qcenter(o),h=e.ndops.centroid(o,c),u=e.imops.rproj(a,[h.ceny,h.cenx]),d=e.ndops.gsfit1d(u.radi,u.data,[n,h.fwhm/2.355,r]),p={a:d[0],b:0,c:d[1],d:d[2]},f=[],g=[];for(l=0;l<u.radi.shape[0];l++)f[l]=[u.radi.get(l),u.data.get(l)];for(u.samp=e.ndops.zeros([s.offsetWidth/2]),e.ndops.fill(u.samp,function(e){return u.radius*e/(s.offsetWidth/2)}),u.modl=e.ndops.gauss1d(u.samp,d),l=0;l<u.modl.shape[0];l++)g[l]=[u.samp.get(l),u.modl.get(l)];$(s).empty(),$.plot(s,[{data:f,points:{radius:1,show:!0}},{data:g}],{zoomStack:!0,selection:{mode:"xy"}}),$(s).append(e.template("<div style='position:absolute;right: 10px;top:30px'>                     <table>                                     <tr><td>peak        </td><td align=right>{a%.2f}</td><tr>                                     <tr><td>sigma       </td><td align=right>{c%.2f}</td><tr>                                     <tr><td>bias        </td><td align=right>{d%.2f}</td><tr>                     </table>                     </div>",p))},winDims:[250,250]})}(),function(){var e=require("./imexam"),t="<div class='annotation' style='position:absolute;right: 10px;top:30px'>                     <table>                                     <tr><td>rms        </td><td align=right>{rms%.2f}</td><tr>                                     <tr><td>mean       </td><td align=right>{mean%.2f}</td><tr>                     </table>                     </div>";function i(i,s,a){var n=s.getAxes(),r=n.xaxis.options.min,o=n.xaxis.options.max,l=$(i).data("hist").raw,c=e.ndops.rmsClipped(l,r,o),h=e.ndops.meanClipped(l,r,o);$(i).find(".annotation").empty(),$(i).append(e.template(t,{rms:c,mean:h}))}JS9.RegisterPlugin("ImExam","Histogram",function(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see histogram<br>")},{menu:"analysis",menuItem:"Histogram",winTitle:"Histogram",help:"imexam/imexam.html#rghist",dynamicSelect:!0,toolbarSeparate:!0,toolbarHTML:" ",onregionschange:function(t,s){var a=this.div,n=e.getRegionData(t,s),r=e.ndops.hist(n);r.sum=e.ndops.sum(r.data),$(a).data("hist",r);var o,l,c=0,h=.001*r.sum,u=0;$(a).empty();var d=[];for(o=0;o<r.data.shape[0];o++)(c+=r.data.get(o))>h&&c<r.sum-h&&(l=r.data.get(o),d[u]=[o*r.width+r.min,l],u++);i(a,$.plot(a,[d],{zoomStack:!0,zoomFunc:i,selection:{mode:"x"}}))},winDims:[250,250]})}(),function(){var e=require("./imexam");function t(t,i){var s=e.reg2section(i),a=e.getRegionData(t,i),n=e.ndops.assign(e.ndops.zeros(a.shape),a),r=e.ndops.assign(e.ndops.zeros(a.shape),a),o={};return t&&i?(o.reg=i,o.min=e.ndops.minvalue(a),o.max=e.ndops.maxvalue(a),o.bkgd=e.imops.backgr(a,4),e.ndops.subs(n,a,o.bkgd.value),o.bscnts=e.ndops.centroid(n,e.ndops.qcenter(n)),o.bscnts.cenx+=s[0][0],o.bscnts.ceny+=s[1][0],o.totcnts=e.ndops.centroid(r,e.ndops.qcenter(r)),o.totcnts.cenx+=s[0][0],o.totcnts.ceny+=s[1][0],o):null}JS9.Image.prototype.getRegionStats=function(e){return t(this,e)},JS9.mkPublic("GetRegionStats","getRegionStats"),JS9.RegisterPlugin("ImExam","RegionStats",function(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see stats<br>")},{menu:"analysis",winTitle:"Region Stats",menuItem:"Region Stats",help:"imexam/imexam.html#rgstat",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function(i,s){$(this.div).html(e.template("                                                                                        <table width=100% style='padding-right: 6px; padding-left: 0px'>                                            <tr><td align=right>position x</td> <td align=right>{reg.x%.2f}              </td>                      <td align=right>y</td>              <td align=right>{reg.y%.2f}             </td></tr>                  <tr><td align=right>box width</td>      <td align=right>{reg.width%.2f}         </td>                   <td align=right>height</td>         <td align=right>{reg.height%.2f}        </td></tr>                  <tr><td align=right>min</td>        <td align=right>{min%.2f}               </td>                       <td align=right>max</td>            <td align=right>{max%.2f}               </td></tr>                  <tr><td align=right>totcounts</td>     <td align=right colspan=3>{totcnts.sum%.2f}</tr>               <tr><td align=right>bscounts</td>     <td align=right colspan=3>{bscnts.sum%.2f}</tr>                 <tr><td align=right>bkgd</td>     <td align=right>{bkgd.value%.2f}      </td>                         <td align=right>noise</td>          <td align=right>{bkgd.noise%.2f}      </td></tr>                  <tr><td align=right>centroid x</td> <td align=right>{bscnts.cenx%.2f}     </td>                       <td align=right>y</td>              <td align=right>{bscnts.ceny%.2f}     </td></tr>                  <tr><td align=right>FWHM</td>       <td align=right>{bscnts.fwhm%.2f}     </td>                       <td align=right></td>            <td align=right>{bscnts.rms%.2f}      </td></tr>                 </table>",t(i,s)))},winDims:[250,250]})}(),function(){"use strict";var e=require("./imexam"),t="                                \t\t\t<div style='float: right;'>\t\t                 <select  class='proj_menu'>\t\t                        <option>sum</option>                                    <option>avg</option>                                    <option>med</option>            \t\t </select>\t\t\t\t\t\t</div>";function i(t,s){var a,n,r,o;void 0===t?(a=s.div,n=s.proj,r=s.menu,o=s.chek):(a=this.div,r=this.outerdivjq.find(".proj_menu")[0],o=this.outerdivjq.find(".proj_chek")[0],n=e.ndops.proj(e.getRegionData(t,s),this.plugin.opts.xyproj),$(r).change(function(e){i(void 0,{div:a,proj:n,menu:r,chek:o})}),$(o).change(function(e){i(void 0,{div:a,proj:n,menu:r,chek:o})}));var l,c,h=[],u=r.options[r.selectedIndex].value;for($(a).empty(),"sum"===u&&(l=n.sum),"avg"===u&&(l=n.avg),"med"===u&&(l=n.med),c=0;c<l.length;c++)h[c]=[c,l[c]];$.plot(a,[h],{zoomStack:!0,selection:{mode:"xy"}})}function s(){e.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see projection<br>")}JS9.RegisterPlugin("ImExam","XProj",s,{menu:"analysis",menuItem:"X Projection",winTitle:"X Projection",help:"imexam/imexam.html#xyproj",dynamicSelect:!0,toolbarSeparate:!0,toolbarHTML:t,onregionschange:i,winDims:[250,250],xyproj:0}),JS9.RegisterPlugin("ImExam","YProj",s,{menu:"analysis",menuItem:"Y Projection",winTitle:"Y Projection",help:"imexam/imexam.html#xyproj",dynamicSelect:!0,toolbarSeparate:!0,toolbarHTML:t,onregionschange:i,winDims:[250,250],xyproj:1})}(),function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[r]={exports:{}};t[r][0].call(h.exports,function(e){return a(t[r][1][e]||e)},h,h.exports,e,t,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t,i){!function(){"use strict";var t=e("./imexam");e("./JSSurfacePlot-V1.7/javascript/SurfacePlot"),e("./JSSurfacePlot-V1.7/javascript/ColourGradient"),JS9.RegisterPlugin("ImExam","3dPlot",function(){t.fixupDiv(this),$(this.div).append("<p style='padding: 20px 0px 0px 20px; margin: 0px'>create, click, move, or resize a region to see 3d plot<br>")},{menu:"analysis",menuItem:"3dPlot",winTitle:"3dPlot",help:"imexam/imexam.html#3dplot",dynamicSelect:!0,toolbarSeparate:!0,onregionschange:function(e,i){!function(e,i){var s=t.ndops.zeros(i.shape),a=t.ndops.minvalue(i),n=t.ndops.maxvalue(i)-a,r=$(e).data("surfplot");s.getNumberOfRows=function(){return this.shape[1]},s.getNumberOfColumns=function(){return this.shape[0]},s.getFormattedValue=function(e,t){return this.get(t,e).toString()},void 0===r&&(e.innerHTML="",r=new greg.ross.visualisation.SurfacePlot(e),$(e).data("surfplot",r));var o,l,c,h=[],u=s.getNumberOfRows(),d=s.getNumberOfColumns(),p=0,f=e.offsetHeight,g=e.offsetWidth;for(o=0;o<u;o++)for(l=0;l<d;l++)c=i.get(l,o),s.set(l,o,(c-a)/(2.25*n)),void 0!==c&&(h[p]="x:"+o+", y:"+l+" = "+c.toFixed(2)),p++;r.draw(s,{xPos:0,yPos:0,width:g,height:f,colourGradient:[{red:0,green:0,blue:255},{red:0,green:255,blue:255},{red:0,green:255,blue:0},{red:255,green:255,blue:0},{red:255,green:0,blue:0}],fillPolygons:!0,tooltips:h,xTitle:"X",yTitle:"Y",zTitle:"Z",restrictXRotation:!1})}(this.div,t.getRegionData(e,i))},winDims:[250,250]})}()},{"./JSSurfacePlot-V1.7/javascript/ColourGradient":2,"./JSSurfacePlot-V1.7/javascript/SurfacePlot":3,"./imexam":void 0}],2:[function(e,t,i){greg.ross.visualisation.ColourGradient=function(e,t,i){function s(e){return e.red*e.red+e.green*e.green+e.blue*e.blue}function a(e,t,i){return t==i?0:(e-t)/(i-t)}this.getColour=function(n){return isNaN(n)||n<e||n>t||1==i.length?{red:i[0].red,green:i[0].green,blue:i[0].blue}:function(e){var t,n,r,o=i.length,l=1/(o-1),c=e/l,h=(c=parseInt(c+""),i[c=c>=o-1?o-2:c]),u=i[c+1];s(h)>s(u)?(t=u,n=h):(t=h,n=u);var d=[(r=t==u?1-a(e,c*l,(c+1)*l):a(e,c*l,(c+1)*l))*(n.red-t.red),r*(n.green-t.green),r*(n.blue-t.blue)],p=t.red+d[0],f=t.green+d[1],g=t.blue+d[2];return{red:p=parseInt(p),green:f=parseInt(f),blue:g=parseInt(g)}}(a(n,e,t))}}},{}],3:[function(e,t,s){function a(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}!function(e){for(var t="greg.ross.visualisation".split("."),i=window,s=t.length,a=0;a<s;a++)void 0===i[t[a]]&&(i[t[a]]=new Object),i=i[t[a]]}(),greg.ross.visualisation.SurfacePlot=function(e){this.containerElement=e},greg.ross.visualisation.SurfacePlot.prototype.draw=function(e,t){null==this.surfacePlot&&(this.surfacePlot=new greg.ross.visualisation.JSSurfacePlot(t.xPos,t.yPos,t.width,t.height,t.colourGradient,this.containerElement,t.tooltips,t.fillPolygons,t.xTitle,t.yTitle,t.zTitle,t.restrictXRotation)),this.surfacePlot.redraw(e)},greg.ross.visualisation.JSSurfacePlot=function(e,t,s,n,r,o,l,c,h,u,d,p){var f,g=function(){var e=0;do{e++}while(document.getElementById("surfacePlot"+e));return"surfacePlot"+e}(),m=null,v=greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE,b=greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,y=greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE;this.data=null;var x,w,S,C,A,_=!1,k=!0,T=null,I=!1,M=!1,O=!1,P=null,D=null,J=new greg.ross.visualisation.Point(0,0),E=null,L=null,j=new greg.ross.visualisation.Point(0,0),F=new greg.ross.visualisation.Point(0,0),R=null,N=(new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!0),new greg.ross.visualisation.Tooltip(!1));function z(){N.hide()}function B(e){m.clearRect(0,0,f.width,f.height),m.fillStyle="#000",m.fillRect(0,0,f.width,f.height),this.data=e;var t=s-40;if(S.init(),S.rotate(y,0,b),S.scale(v),S.translate(t/2+20,t/3*2+20,0),C=new greg.ross.visualisation.Point3D(t/2+20,t/2+20,-1e3),I)for(i=0;i<T.length;i++){var n=T[i];m.fillStyle="#ff2222";var r=S.ChangeObjectPoint(n);r.dist=a(r,C);var o=r.ax,l=r.ay;m.beginPath();var p=greg.ross.visualisation.JSSurfacePlot.DATA_DOT_SIZE;m.arc(o-p/2,l-p/2,1,0,2*self.Math.PI,!0),m.fill()}var g=function(){var e=new greg.ross.visualisation.Point3D(-.5,.5,0),t=new greg.ross.visualisation.Point3D(.5,.5,0),i=new greg.ross.visualisation.Point3D(-.5,-.5,0),s=new greg.ross.visualisation.Point3D(-.5,.5,1),a=S.ChangeObjectPoint(e),n=S.ChangeObjectPoint(t),r=S.ChangeObjectPoint(i),o=S.ChangeObjectPoint(s),l=new Array,c=new greg.ross.visualisation.Polygon(C,!0);c.addPoint(a),c.addPoint(n),c.calculateCentroid(),c.calculateDistance(),l[l.length]=c;var h=new greg.ross.visualisation.Polygon(C,!0);h.addPoint(a),h.addPoint(r),h.calculateCentroid(),h.calculateDistance(),l[l.length]=h;var u=new greg.ross.visualisation.Polygon(C,!0);return u.addPoint(a),u.addPoint(o),u.calculateCentroid(),u.calculateDistance(),l[l.length]=u,l}(),_=function(e){var t,i,s=new Array,a=0;for(t=0;t<x-1;t++)for(i=0;i<w-1;i++){var n=new greg.ross.visualisation.Polygon(C,!1),r=S.ChangeObjectPoint(e[i+t*w]),o=S.ChangeObjectPoint(e[i+t*w+w]),l=S.ChangeObjectPoint(e[i+t*w+w+1]),c=S.ChangeObjectPoint(e[i+t*w+1]);n.addPoint(r),n.addPoint(o),n.addPoint(l),n.addPoint(c),n.calculateCentroid(),n.calculateDistance(),s[a]=n,a++}return s}(T);for(i=0;i<g.length;i++)_[_.length]=g[i];for(_.sort(greg.ross.visualisation.PolygonComaparator),m.lineWidth=1,m.strokeStyle="#888",m.lineJoin="round",i=0;i<_.length;i++){var k=_[i];if(k.isAnAxis()){var M=k.getPoint(0),O=k.getPoint(1);m.beginPath(),m.moveTo(M.ax,M.ay),m.lineTo(O.ax,O.ay),m.stroke()}else{M=k.getPoint(0),O=k.getPoint(1);var P=k.getPoint(2),D=k.getPoint(3),J=A.getColour((1*M.lz+1*O.lz+1*P.lz+1*D.lz)/4);m.fillStyle="rgb("+J.red+","+J.green+","+J.blue+")",m.beginPath(),m.moveTo(M.ax,M.ay),m.lineTo(O.ax,O.ay),m.lineTo(P.ax,P.ay),m.lineTo(D.ax,D.ay),m.lineTo(M.ax,M.ay),c?m.fill():m.stroke()}}m.stroke(),H()&&function(e){var t=new greg.ross.visualisation.Point3D(0,.5,0),i=new greg.ross.visualisation.Point3D(-.5,0,0),s=new greg.ross.visualisation.Point3D(-.5,.5,.5),a=S.ChangeObjectPoint(t),n=S.ChangeObjectPoint(i),r=S.ChangeObjectPoint(s),o=e[0],l=e[1],c=e[2];m.fillStyle="#fff",o.distanceFromCamera>l.distanceFromCamera&&m.fillText(h,a.ax,a.ay),o.distanceFromCamera<l.distanceFromCamera&&m.fillText(u,n.ax,n.ay),o.distanceFromCamera<c.distanceFromCamera&&m.fillText(d,r.ax,r.ay)}(g)}function H(){return _?k:(_=!0,k=!!document.createElement("canvas").getContext)}function W(e){!function(e){if(parseInt(navigator.appVersion)>3){var t="Netscape"==navigator.appName?e:event;if("Netscape"==navigator.appName&&4==parseInt(navigator.appVersion)?"1"==(e.modifiers+32).toString(2).substring(3,6).charAt(0):t.shiftKey)return!0}return!1}(e)?(M=!0,j=$(e)):(O=!0,F=$(e))}function q(e){M?E=J:O&&(L=J),M=!1,O=!1}function G(e){var t=$(e);if(M)z(),function(e){J=new greg.ross.visualisation.Point(greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE),null==E&&(E=new greg.ross.visualisation.Point(greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE,greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE)),null!=j&&(J=new greg.ross.visualisation.Point(E.x+(j.x-e.x),E.y+(j.y-e.y))),b=J.x%360,y=J.y%360,p&&(y<0?y=0:y>90&&(y=90)),R=null,B(data)}(t);else if(O)z(),function(e){J=new greg.ross.visualisation.Point(0,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR),null==L&&(L=new greg.ross.visualisation.Point(0,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR)),null!=F&&(J=new greg.ross.visualisation.Point(L.x+(F.x-e.x),L.y+(F.y-e.y))),(v=J.y*greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR)<greg.ross.visualisation.JSSurfacePlot.MIN_SCALE?v=greg.ross.visualisation.JSSurfacePlot.MIN_SCALE+1:v>greg.ross.visualisation.JSSurfacePlot.MAX_SCALE&&(v=greg.ross.visualisation.JSSurfacePlot.MAX_SCALE-1),J.y=v/greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR,R=null,B(data)}(t);else{R=null;for(var i=Number.MAX_VALUE,s=0;s<T.length;s++){var n=T[s],r=a({x:n.ax,y:n.ay},t);r<i&&(i=r,R=s)}if(i>16)return void z();new greg.ross.visualisation.Point(t.x,t.y),N.show(l[R],200)}return!1}function $(e){if(function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e}()>-1)if(1==(e=window.event).srcElement.getAttribute("Stroked")){if(null==P||null==D)return}else P=e.offsetX,D=e.offsetY;else e.layerX||0==e.layerX?(P=e.layerX,D=e.layerY):e.offsetX||0==e.offsetX?(P=e.offsetX,D=e.offsetY):(e.touches[0].pageX||0==e.touches[0].pageX)&&(P=e.touches[0].pageX,D=e.touches[0].pageY);return new greg.ross.visualisation.Point(P,D)}this.redraw=function(e){x=1*e.getNumberOfRows(),w=1*e.getNumberOfColumns();for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,s=0;s<x;s++)for(var a=0;a<w;a++){var n=1*e.getFormattedValue(s,a);n<t&&(t=n),n>i&&(i=n)}A=new greg.ross.visualisation.ColourGradient(t,i,r||[{red:0,green:0,blue:255},{red:0,green:255,blue:255},{red:0,green:255,blue:0},{red:255,green:255,blue:0},{red:255,green:0,blue:0}]);var o,l,c=1/(x-1),h=1/(w-1);T=new Array;var u=0;for(s=0,o=-.5;s<x;s++,o+=c)for(a=0,l=.5;a<w;a++,l-=h)T[u]=new greg.ross.visualisation.Point3D(o,l,e.getFormattedValue(s,a)),u++;B(e)},S=new greg.ross.visualisation.Th3dtran,function(){this.targetDiv=document.createElement("div"),this.targetDiv.id=g,this.targetDiv.className="surfaceplot",this.targetDiv.style.background="#ffffff",this.targetDiv.style.position="absolute",o?(this.targetDiv.style.position="relative",o.appendChild(this.targetDiv)):document.body.appendChild(this.targetDiv),this.targetDiv.style.left=e+"px",this.targetDiv.style.top=t+"px"}(),targetDiv&&(f=document.createElement("canvas"),H()||(G_vmlCanvasManager.initElement(f),f.style.width=s,f.style.height=n),f.className="surfacePlotCanvas",f.setAttribute("width",s),f.setAttribute("height",n),f.style.left="0px",f.style.top="0px",targetDiv.appendChild(f),(m=f.getContext("2d")).font="bold 18px sans-serif",m.clearRect(0,0,f.width,f.height),m.fillStyle="#000",m.fillRect(0,0,f.width,f.height),m.beginPath(),m.rect(0,0,f.width,f.height),m.strokeStyle="#888",m.stroke(),f.onmousemove=G,f.onmouseout=z,f.onmousedown=W,f.onmouseup=q,f.addEventListener("touchstart",W,!1),f.addEventListener("touchmove",G,!1),f.addEventListener("touchend",q,!1),f.addEventListener("touchcancel",z,!1))},greg.ross.visualisation.Matrix3d=function(){this.matrix=new Array,this.numRows=4,this.numCols=4,this.init=function(){this.matrix=new Array;for(var e=0;e<this.numRows;e++)this.matrix[e]=new Array},this.getMatrix=function(){return this.matrix},this.matrixReset=function(){for(var e=0;e<this.numRows;e++)for(var t=0;t<this.numCols;t++)this.matrix[e][t]=0},this.matrixIdentity=function(){this.matrixReset(),this.matrix[0][0]=this.matrix[1][1]=this.matrix[2][2]=this.matrix[3][3]=1},this.matrixCopy=function(e){var t,i,s=new greg.ross.visualisation.Matrix3d;for(t=0;t<this.numRows;t++)for(i=0;i<this.numCols;i++)s.getMatrix()[t][i]=this.matrix[t][0]*e.getMatrix()[0][i]+this.matrix[t][1]*e.getMatrix()[1][i]+this.matrix[t][2]*e.getMatrix()[2][i]+this.matrix[t][3]*e.getMatrix()[3][i];for(t=0;t<this.numRows;t++)this.matrix[t][0]=s.getMatrix()[t][0],this.matrix[t][1]=s.getMatrix()[t][1],this.matrix[t][2]=s.getMatrix()[t][2],this.matrix[t][3]=s.getMatrix()[t][3]},this.matrixMult=function(e,t){var i,s,a=new greg.ross.visualisation.Matrix3d;for(i=0;i<this.numRows;i++)for(s=0;s<this.numCols;s++)a.getMatrix()[i][s]=t.getMatrix()[i][0]*e.getMatrix()[0][s]+t.getMatrix()[i][1]*e.getMatrix()[1][s]+t.getMatrix()[i][2]*e.getMatrix()[2][s]+t.getMatrix()[i][3]*e.getMatrix()[3][s];for(i=0;i<this.numRows;i++)e.getMatrix()[i][0]=a.getMatrix()[i][0],e.getMatrix()[i][1]=a.getMatrix()[i][1],e.getMatrix()[i][2]=a.getMatrix()[i][2],e.getMatrix()[i][3]=a.getMatrix()[i][3]},this.init()},greg.ross.visualisation.Point3D=function(e,t,i){this.displayValue="",this.initPoint=function(){this.lx=this.ly=this.lz=this.ax=this.ay=this.az=this.at=this.wx=this.wy=this.wz=0,this.lt=this.wt=1},this.init=function(e,t,i){this.initPoint(),this.lx=e,this.ly=t,this.lz=i,this.ax=this.lx,this.ay=this.ly,this.az=this.lz},this.init(e,t,i)},greg.ross.visualisation.Polygon=function(e,t){this.points=new Array,this.cameraPosition=e,this.isAxis=t,this.centroid=null,this.distanceFromCamera=null,this.isAnAxis=function(){return this.isAxis},this.addPoint=function(e){this.points[this.points.length]=e},this.distance=function(){return this.distance2(this.cameraPosition,this.centroid)},this.calculateDistance=function(){this.distanceFromCamera=this.distance()},this.calculateCentroid=function(){for(var e=0,t=0,i=0,s=1*this.points.length,a=0;a<s;a++)e+=this.points[a].ax,t+=this.points[a].ay,i+=this.points[a].az;e/=s,t/=s,i/=s,this.centroid=new greg.ross.visualisation.Point3D(e,t,i)},this.distance2=function(e,t){return(e.ax-t.ax)*(e.ax-t.ax)+(e.ay-t.ay)*(e.ay-t.ay)+(e.az-t.az)*(e.az-t.az)},this.getPoint=function(e){return this.points[e]}},greg.ross.visualisation.PolygonComaparator=function(e,t){var i=e.distanceFromCamera-t.distanceFromCamera;return 0==i?0:i<0?-1:i>0?1:0},greg.ross.visualisation.Th3dtran=function(){this.local=!0,this.init=function(){this.matrix=new greg.ross.visualisation.Matrix3d,this.rMat=new greg.ross.visualisation.Matrix3d,this.rMatrix=new greg.ross.visualisation.Matrix3d,this.objectMatrix=new greg.ross.visualisation.Matrix3d,this.initMatrix()},this.initMatrix=function(){this.matrix.matrixIdentity(),this.objectMatrix.matrixIdentity()},this.translate=function(e,t,i){this.rMat.matrixIdentity(),this.rMat.getMatrix()[3][0]=e,this.rMat.getMatrix()[3][1]=t,this.rMat.getMatrix()[3][2]=i,this.local?this.objectMatrix.matrixCopy(this.rMat):this.matrix.matrixCopy(this.rMat)},this.rotate=function(e,t,i){var s=e*(Math.PI/180),a=t*(Math.PI/180),n=i*(Math.PI/180);this.rMatrix.matrixIdentity(),this.rMat.matrixIdentity(),this.rMat.getMatrix()[1][1]=Math.cos(s),this.rMat.getMatrix()[1][2]=Math.sin(s),this.rMat.getMatrix()[2][1]=-Math.sin(s),this.rMat.getMatrix()[2][2]=Math.cos(s),this.rMatrix.matrixMult(this.rMatrix,this.rMat),this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=Math.cos(a),this.rMat.getMatrix()[0][2]=-Math.sin(a),this.rMat.getMatrix()[2][0]=Math.sin(a),this.rMat.getMatrix()[2][2]=Math.cos(a),this.rMat.matrixMult(this.rMatrix,this.rMat),this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=Math.cos(n),this.rMat.getMatrix()[0][1]=Math.sin(n),this.rMat.getMatrix()[1][0]=-Math.sin(n),this.rMat.getMatrix()[1][1]=Math.cos(n),this.rMat.matrixMult(this.rMatrix,this.rMat),this.local?this.objectMatrix.matrixCopy(this.rMatrix):this.matrix.matrixCopy(this.rMatrix)},this.scale=function(e){this.rMat.matrixIdentity(),this.rMat.getMatrix()[0][0]=e,this.rMat.getMatrix()[1][1]=e,this.rMat.getMatrix()[2][2]=e,this.local?this.objectMatrix.matrixCopy(this.rMat):this.matrix.matrixCopy(this.rMat)},this.changeLocalObject=function(e){return e.wx=e.ax*this.matrix.getMatrix()[0][0]+e.ay*this.matrix.getMatrix()[1][0]+e.az*this.matrix.getMatrix()[2][0]+this.matrix.getMatrix()[3][0],e.wy=e.ax*this.matrix.getMatrix()[0][1]+e.ay*this.matrix.getMatrix()[1][1]+e.az*this.matrix.getMatrix()[2][1]+this.matrix.getMatrix()[3][1],e.wz=e.ax*this.matrix.getMatrix()[0][2]+e.ay*this.matrix.getMatrix()[1][2]+e.az*this.matrix.getMatrix()[2][2]+this.matrix.getMatrix()[3][2],e},this.ChangeObjectPoint=function(e){return e.ax=e.lx*this.objectMatrix.getMatrix()[0][0]+e.ly*this.objectMatrix.getMatrix()[1][0]+e.lz*this.objectMatrix.getMatrix()[2][0]+this.objectMatrix.getMatrix()[3][0],e.ay=e.lx*this.objectMatrix.getMatrix()[0][1]+e.ly*this.objectMatrix.getMatrix()[1][1]+e.lz*this.objectMatrix.getMatrix()[2][1]+this.objectMatrix.getMatrix()[3][1],e.az=e.lx*this.objectMatrix.getMatrix()[0][2]+e.ly*this.objectMatrix.getMatrix()[1][2]+e.lz*this.objectMatrix.getMatrix()[2][2]+this.objectMatrix.getMatrix()[3][2],e},this.init()},greg.ross.visualisation.Point=function(e,t){this.x=e,this.y=t},greg.ross.visualisation.Tooltip=function(e){var t,i,s,a,n,r=10,o=95,l=0,c=!!document.all;function h(e){if(l!=o&&1==e||0!=l&&-1==e){var i=r;o-l<r&&1==e?i=o-l:l<r&&-1==e&&(i=l),t.style.opacity=.01*(l+=i*e),t.style.filter="alpha(opacity="+l+")"}else clearInterval(t.timer),-1==e&&(t.style.display="none")}this.show=function(r,o){null==t&&((t=document.createElement("div")).style.color="#fff",t.style.position="absolute",t.style.display="block",(i=document.createElement("div")).style.display="block",i.style.height="5px",i.style.marginleft="5px",i.style.overflow="hidden",s=document.createElement("div"),a=document.createElement("div"),t.appendChild(i),t.appendChild(s),t.appendChild(a),document.body.appendChild(t),c?t.style.opacity=1:(t.style.opacity=0,t.style.filter="alpha(opacity=0)")),e||(document.onmousemove=this.pos),t.style.display="block",s.innerHTML='<span style="font-weight:bold; font-family: arial;">'+r+"</span>",t.style.width=o?o+"px":"auto",!o&&c&&(i.style.display="none",a.style.display="none",t.style.width=t.offsetWidth,i.style.display="block",a.style.display="block"),t.offsetWidth>300&&(t.style.width="300px"),n=parseInt(t.offsetHeight)+3,c||(clearInterval(t.timer),t.timer=setInterval(function(){h(1)},20))},this.setPos=function(e){t.style.top=e.y+"px",t.style.left=e.x+"px"},this.pos=function(e){var i=c?event.clientY+document.documentElement.scrollTop:e.pageY,s=c?event.clientX+document.documentElement.scrollLeft:e.pageX;t.style.top=i-n+"px",t.style.left=s+3+"px"},this.hide=function(){null!=t&&(c?t.style.display="none":(clearInterval(t.timer),t.timer=setInterval(function(){h(-1)},20)))}},greg.ross.visualisation.JSSurfacePlot.DEFAULT_X_ANGLE=47,greg.ross.visualisation.JSSurfacePlot.DEFAULT_Z_ANGLE=47,greg.ross.visualisation.JSSurfacePlot.DATA_DOT_SIZE=3,greg.ross.visualisation.JSSurfacePlot.DEFAULT_SCALE=350,greg.ross.visualisation.JSSurfacePlot.MIN_SCALE=50,greg.ross.visualisation.JSSurfacePlot.MAX_SCALE=1100,greg.ross.visualisation.JSSurfacePlot.SCALE_FACTOR=1.4},{}]},{},[1]),function e(t,i,s){function a(r,o){if(!i[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[r]={exports:{}};t[r][0].call(h.exports,function(e){return a(t[r][1][e]||e)},h,h.exports,e,t,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t,i){!function(){"use strict";var t=e("./imexam");i.bin1d=t.typed(function(e,i){var s=t.typed.clone(e.shape).map(function(e){return e/i+.5|0}),a=t.typed.array(e.type,s);return a[0/i|0]+=e,a});var s=t.typed(function(e,t,i){return t[0/i|0][0/i|0]+=e,t});i.bin2d=function(e,i){var a=t.typed.clone(e.shape).map(function(e){return e/i+.5|0}),n=t.typed.array(a,e);return s(e,n,i)},i.smooth_gaussian2d=function(e,i){var s,a,n,r=t.typed.array(e.shape,"float32"),o=t.typed.array(e.shape,"float32"),l=i,c=[];for(s=0;s<10;s++)c[s]=1*Math.pow(2.71828,-s*s/(2*l*l))+0;for(s=0;s<c.length&&!(c[s]<.001);s++);c.length=s-1;var h=t.typed.clone(c);for(c=c.reverse(),s=1;s<h.length;s++)c[c.length]=h[s];c.shape[0]=c.length,c=t.typed.div(c,t.typed.sum(c));var u=e.shape[1],d=e.shape[0],p=c.shape[0];for(a=0;a<d;a++)for(s=0;s<u;s++)for(n=-p/2|0;n<p/2|0;n++)s+n>=0&&s+n<d&&(r.data[a*u+s]+=c[n+p/2|0]*e.data[a*u+s+n]);for(a=0;a<d;a++)for(s=0;s<u;s++)for(n=-p/2|0;n<p/2|0;n++)a+n>=0&&a+n<d&&(o.data[a*u+s]+=c[n+p/2|0]*r.data[(a+n)*u+s]);return o}}()},{"./imexam":void 0}],2:[function(e,t,i){var s=function(){var e=function(e,t){var i=e.x-t.x,s=e.y-t.y;return i*i+s*s<1e-20},t=function(e){for(var t=e.head;t;){var i=t.next;t.next=t.prev,t.prev=i,t=i}i=e.head,e.head=e.tail,e.tail=i},i=function(e){this.count=0,this.level=e,this.s=null,this.count=0};i.prototype.remove_seq=function(e){e.prev?e.prev.next=e.next:this.s=e.next,e.next&&(e.next.prev=e.prev),--this.count},i.prototype.addSegment=function(i,s){var a=this.s,n=null,r=null,o=!1,l=!1;if(this.count++>1e5)throw new Error("Too many calls to coutour AddSegment");for(;a&&(null==n&&(e(i,a.head.p)?(n=a,o=!0):e(i,a.tail.p)&&(n=a)),null==r&&(e(s,a.head.p)?(r=a,l=!0):e(s,a.tail.p)&&(r=a)),null==r||null==n);)a=a.next;switch((null!=n?1:0)|(null!=r?2:0)){case 0:var c={p:i,prev:null},h={p:s,next:null};c.next=h,h.prev=c,n={head:c,tail:h,next:this.s,prev:null,closed:!1},this.s&&(this.s.prev=n),this.s=n,++this.count;break;case 1:var u={p:s};o?(u.next=n.head,u.prev=null,n.head.prev=u,n.head=u):(u.next=null,u.prev=n.tail,n.tail.next=u,n.tail=u);break;case 2:u={p:i},l?(u.next=r.head,u.prev=null,r.head.prev=u,r.head=u):(u.next=null,u.prev=r.tail,r.tail.next=u,r.tail=u);break;case 3:if(n===r){n.head.prev=u={p:n.tail.p,next:n.head,prev:null},n.head=u,n.closed=!0;break}switch((o?1:0)|(l?2:0)){case 0:t(n);case 1:r.tail.next=n.head,n.head.prev=r.tail,r.tail=n.tail,this.remove_seq(n);break;case 3:t(n);case 2:n.tail.next=r.head,r.head.prev=n.tail,n.tail=r.tail,this.remove_seq(r)}}};var s=function(e){if(e)this.drawContour=e;else{var t=this;t.contours={},this.drawContour=function(e,s,a,n,r,o){var l=t.contours[o];l||(l=t.contours[o]=new i(r)),l.addSegment({x:s,y:e},{x:n,y:a})},this.contourList=function(){var e=[],i=t.contours;for(var s in i)for(var a=i[s].s,n=i[s].level;a;){var r=a.head,o=[];for(o.level=n,o.k=s;r&&r.p;)o.push(r.p),r=r.next;e.push(o),a=a.next}return e.sort(function(e,t){return t.k-e.k}),e}}this.h=new Array(5),this.sh=new Array(5),this.xh=new Array(5),this.yh=new Array(5)};return s.prototype.contour=function(e,t,i,s,a,n,r,o,l){var c=this.h,h=this.sh,u=this.xh,d=this.yh,p=this.drawContour;this.contours={};for(var f,g,m,v,b,y=function(e,t){return(c[t]*u[e]-c[e]*u[t])/(c[t]-c[e])},x=function(e,t){return(c[t]*d[e]-c[e]*d[t])/(c[t]-c[e])},w=0,S=0,C=0,A=0,_=[0,1,1,0],k=[0,0,1,1],T=[[[0,0,8],[0,2,5],[7,6,9]],[[0,3,4],[1,3,1],[4,3,0]],[[9,6,7],[5,2,0],[8,0,0]]],I=a-1;I>=s;I--)for(var M=t;M<=i-1;M++){var O,P;if(O=Math.min(e.get(M,I),e.get(M,I+1)),P=Math.min(e.get(M+1,I),e.get(M+1,I+1)),v=Math.min(O,P),O=Math.max(e.get(M,I),e.get(M,I+1)),P=Math.max(e.get(M+1,I),e.get(M+1,I+1)),(b=Math.max(O,P))>=l[0]&&v<=l[o-1])for(var D=0;D<o;D++)if(l[D]>=v&&l[D]<=b){for(var J=4;J>=0;J--)J>0?(c[J]=e.get(M+_[J-1],I+k[J-1])-l[D],u[J]=n[M+_[J-1]],d[J]=r[I+k[J-1]]):(c[0]=.25*(c[1]+c[2]+c[3]+c[4]),u[0]=.5*(n[M]+n[M+1]),d[0]=.5*(r[I]+r[I+1])),h[J]=c[J]>0?1:c[J]<0?-1:0;for(J=1;J<=4;J++)if(0!=(m=T[h[f=J]+1][h[0]+1][h[g=4!=J?J+1:1]+1])){switch(m){case 1:w=u[f],C=d[f],S=u[0],A=d[0];break;case 2:w=u[0],C=d[0],S=u[g],A=d[g];break;case 3:w=u[g],C=d[g],S=u[f],A=d[f];break;case 4:w=u[f],C=d[f],S=y(0,g),A=x(0,g);break;case 5:w=u[0],C=d[0],S=y(g,f),A=x(g,f);break;case 6:w=u[g],C=d[g],S=y(f,0),A=x(f,0);break;case 7:w=y(f,0),C=x(f,0),S=y(0,g),A=x(0,g);break;case 8:w=y(0,g),C=x(0,g),S=y(g,f),A=x(g,f);break;case 9:w=y(g,f),C=x(g,f),S=y(f,0),A=x(f,0)}p(w,C,S,A,l[D],D)}}}},s}();void 0!==i&&(i.Conrec=s)},{}],3:[function(e,t,i){"use strict";!function(){var e=0,i=1,s=2,a=3,n=4;function r(t,r,o,l,c,h,u,d,p){for(var f,g,m,v,b,y,x,w=l,S=c,C=h,A=1,_=w<0||w>=t-1||S<0&&S>=r-1;!_;){if(f=0,g=u[S*t+w],m=u[S*t+w+1],v=u[(S+1)*t+w+1],b=u[(S+1)*t+w],A)switch(A=0,h){case e:y=(o-g)/(m-g)+w,x=S;break;case i:y=w+1,x=(o-m)/(v-m)+S;break;case s:y=(o-v)/(b-v)+w,x=S+1;break;case a:y=w,x=(o-g)/(b-g)+S}else{h==e&&(d[S*t+w]=1);do{switch(++h==n&&(h=e),h){case e:g>=o&&o>m&&(f=1,y=(o-g)/(m-g)+w,x=S,S--);break;case i:m>=o&&o>v&&(f=1,y=w+1,x=(o-m)/(v-m)+S,w++);break;case s:v>=o&&o>b&&(f=1,y=(o-b)/(v-b)+w,x=S+1,S++);break;case a:b>=o&&o>g&&(f=1,y=w,x=(o-g)/(b-g)+S,w--)}}while(!f);++h===n&&(h=e),++h===n&&(h=e),w==l&&S==c&&h==C&&(_=1),(w<0||w>=t-1||S<0||S>=r-1)&&(_=1)}p(y+.5,x+.5,o),_&&p(0,0,void 0)}}t.exports=function(t,n,o,l,c){var h,u,d,p,f=new Uint8Array(n*o);for(h=0;h<t.length;h++){for(u=t[h],d=0;d<n*o;d++)f[d]=0;for(p=0,d=0;d<n-1;d++)l[p*n+d]<u&&u<=l[p*n+d+1]&&r(n,o,u,d,p,e,l,f,c);for(p=0;p<o-1;p++)l[p*n+d]<u&&u<=l[(p+1)*n+d]&&r(n,o,u,d-1,p,i,l,f,c);for(d--;d>=0;d--)l[p*n+d+1]<u&&u<=l[p*n+d]&&r(n,o,u,d,p-1,s,l,f,c);for(d=0,p--;p>=0;p--)l[(p+1)*n+d]<u&&u<=l[p*n+d]&&r(n,o,u,d,p,a,l,f,c);for(p=1;p<o-1;p++)for(d=0;d<n-1;d++)!f[p*n+d]&&l[p*n+d]<u&&u<=l[p*n+d+1]&&r(n,o,u,d,p,e,l,f,c)}}}()},{}],4:[function(e,t,i){!function(){"use strict";var t=e("./imexam"),i=e("./conrec"),s=e("./contfv"),a=e("./bin");function n(e,i){var s=JS9.GetImage({display:i});if(s){var a=$(e).find(".contour-form")[0],n=t.ndops.ndarray(s.raw.data,[s.raw.width,s.raw.height]);a.min.value=t.ndops.minvalue(n).toFixed(2),a.max.value=t.ndops.maxvalue(n).toFixed(2)}}function r(e,i){var s;if(JS9.GetImage({display:i})){var a=$(e).find(".contour-form")[0],n=Number(a.nlevel.value),r=t.ndops.ndarray(t.ndops.iota(1,n)),o=Number(a.min.value),l=Number(a.max.value);t.ndops.divs(r,r,n+1),t.ndops.muls(r,r,l-o),t.ndops.adds(r,r,o);var c=[];for(s=0;s<r.shape[0];s++)c.push(r.data[s].toFixed(2));a.level.value=c.join("\n")}}JS9.RegisterPlugin("ImExam","Contours",function(){var e=JS9.GetImage({display:this.display}),o=this.div;o.innerHTML='<form class="contour-form js9Form">\t\t\t\t\t\t\t\t    <table style="border-collapse: separate; border-spacing: 10px 5px;"><tr>\t<td><b>num:</b></td>\t\t\t\t<td><input type=text name=nlevel value=5 size="10" style="text-align:right;"></td>\t\t\t\t\t\t       \t<td><input type=button value="Draw contours" class="drw-contour"></td></tr>\t\t           <tr>\t<td><b>min:</b></td>\t\t\t\t\t\t\t\t\t\t\t\t<td><input type=text name=min size="10" style="text-align:right;"></td>\t\t\t\t\t\t\t       \t<td><input type=button value="Reset min/max" class="get-min-max"></td></tr>\t\t           <tr>\t<td><b>max:</b></td>\t\t\t\t\t\t\t\t\t\t\t\t<td><input type=text name=max size="10" style="text-align:right;"></td></tr>\t\t\t\t\t           <tr>\t<td valign=top><b>levels:</b></td>\t\t\t\t\t\t\t\t    \t\t<td rowspan=5><textarea rows=12 cols="10" name=level class="contour-levels" style="text-align:right;">\t\t\t\t    </textarea>\t\t\t\t\t\t\t\t\t\t\t       \t<td valign=top><input type=button value="Make levels" class="make-levels"></td>\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t   <tr><td></td><td valign=top>\t\t\t\t\t\t\t\t\t\t\t\t<b>binning:</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\t\t\t\t\t\t\t\t<select id=binning name=binpix>\t\t\t\t\t\t\t\t\t\t<option>none</option>\t\t\t\t\t\t\t\t\t\t\t<option>2</option>\t\t\t\t\t\t\t\t\t\t\t<option>3</option>\t\t\t\t\t\t\t\t\t\t\t<option>4</option>\t\t\t\t\t\t\t\t\t\t\t<option>5</option>\t\t\t\t\t\t\t\t\t\t\t<option>6</option>\t\t\t\t\t\t\t\t\t\t\t<option>7</option>\t\t\t\t\t\t\t\t\t\t\t<option>8</option>\t\t\t\t\t\t\t\t\t\t\t</select>\t\t\t\t\t\t\t\t\t\t\t\tpix\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t   <tr><td></td><td valign=top>\t\t\t\t\t\t\t\t\t\t\t\t<b>smoothing:</b>&nbsp;\t\t\t\t\t\t\t\t\t\t\t\t<select id=smooth name=smopix>\t\t\t\t\t\t\t\t\t\t<option>none</option>\t\t\t\t\t\t\t\t\t\t\t<option value=0.75 selected>3</option>\t\t\t\t\t\t\t\t\t<option value=1.00>5</option>\t\t\t\t\t\t\t\t\t\t<option value=1.25>7</option>\t\t\t\t\t\t\t\t\t\t</select>\t\t\t\t\t\t\t\t\t\t\t\tpix\t\t\t\t\t\t\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t\t   <tr><td></td><td valign=top>\t\t\t\t\t\t\t\t\t\t\t\t<b>quality:</b>&nbsp;\t\t\t\t\t\t\t\t\t\t\t<input type=radio name=quality value=faster checked>faster\t\t\t\t\t\t<input type=radio name=quality value=better>better\t\t\t\t\t\t</td>\t\t\t\t\t\t\t\t\t\t\t\t   </tr>\t\t\t\t\t\t\t\t\t\t\t    </table>\t\t\t\t\t\t\t\t\t\t\t\t    <p>\t\t\t\t\t\t\t\t\t\t\t\t\t    </form>';var l=this.display;$(o).find(".drw-contour").on("mouseup",function(){!function(e,n){var r=JS9.GetImage({display:n}),o=$(e).find(".contour-form")[0],l=t.ndops.ndarray(r.raw.data,[r.raw.height,r.raw.width]),c=o.level.value,h=$(o).find("#binning").val(),u=$(o).find("#smooth").val(),d=$(o).find("input[type=radio]:checked").val();"none"===h?h=1:l=a.bin2d(l,parseInt(h));var p,f=JSON.parse("["+c.trim().split(/\s+/).join(",")+"]").map(function(e){return e*h*h});"none"!==u&&(l=a.smooth_gaussian2d(l,parseFloat(u))),JS9.waiting(!0),setTimeout(function(){try{if("better"===d){var e=new i.Conrec;try{var a=t.ndops.iota(0,l.shape[0]-1).map(function(e){return e*h+(h-1)/2+1}),n=t.ndops.iota(0,l.shape[1]-1).map(function(e){return e*h+(h-1)/2+1});e.contour(l,0,l.shape[0]-1,0,l.shape[1]-1,a,n,f.length,f)}catch(c){return void alert("Too many coutour segments: Check your coutour levels.\n\nAre you trying to coutour the background levels of an image?")}p=e.contourList().map(function(e){return{shape:"polygon",pts:e}})}else{var o=[];(p=[]).push({shape:"polygon",pts:o}),s(f,l.shape[0],l.shape[1],l.data,function(e,t,i){void 0===i?p.push({shape:"polygon",pts:o=[]}):o.push({x:e*h+.5,y:t*h+.5})}),p.length=p.length-1}JS9.NewShapeLayer("contour",JS9.Catalogs.opts,{display:r}),JS9.RemoveShapes("contour",{display:r}),JS9.AddShapes("contour",p,{color:"yellow"},{display:r})}finally{JS9.waiting(!1)}},200)}(o,l)}),$(o).find(".get-min-max").on("mouseup",function(){n(o,l)}),$(o).find(".make-levels").on("mouseup",function(){r(o,l)}),void 0!==e&&(n(o,l),r(o,l)),t.fixupDiv(this)},{menu:"view",winTitle:"Contours",menuItem:"Contours",help:"imexam/contours.html",toolbarSeparate:!0,winDims:[370,300]})}()},{"./bin":1,"./conrec":2,"./contfv":3,"./imexam":void 0}]},{},[4]);